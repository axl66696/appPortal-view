(self.webpackChunkapp_portal=self.webpackChunkapp_portal||[]).push([[176,9159],{9159:(Et,je,q)=>{q.r(je),q.d(je,{AckPolicy:()=>Vs,DeliverPolicy:()=>Ys,JSONCodec:()=>Ae,JetstreamWsService:()=>Vr,RetentionPolicy:()=>Ws,SubscribeType:()=>hr});var j=q(5861),le=q(7582),ie=q(5863),ee=q(5126),H=q(6296);function z(s,e){this.v=s,this.k=e}function te(s){return new z(s,0)}function oe(s){var e,t;function r(i,o){try{var c=s[i](o),f=c.value,d=f instanceof z;Promise.resolve(d?f.v:f).then(function(g){if(d){var p="return"===i?"return":"next";if(!f.k||g.done)return r(p,g);g=s[p](g).value}n(c.done?"return":"normal",g)},function(g){r("throw",g)})}catch(g){n("throw",g)}}function n(i,o){switch(i){case"return":e.resolve({value:o,done:!0});break;case"throw":e.reject(o);break;default:e.resolve({value:o,done:!1})}(e=e.next)?r(e.key,e.arg):t=null}this._invoke=function(i,o){return new Promise(function(c,f){var d={key:i,arg:o,resolve:c,reject:f,next:null};t?t=t.next=d:(e=t=d,r(i,o))})},"function"!=typeof s.return&&(this.return=void 0)}function we(s){return function(){return new oe(s.apply(this,arguments))}}oe.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},oe.prototype.next=function(s){return this._invoke("next",s)},oe.prototype.throw=function(s){return this._invoke("throw",s)},oe.prototype.return=function(s){return this._invoke("return",s)};const re=new Uint8Array(0),he=new TextEncoder,ce=new TextDecoder;function Me(...s){const e=[];for(let t=0;t<s.length;t++)e.push(he.encode(s[t]));return 0===e.length?re:1===e.length?e[0]:function Pt(...s){let e=0;for(let n=0;n<s.length;n++)e+=s[n].length;const t=new Uint8Array(e);let r=0;for(let n=0;n<s.length;n++)t.set(s[n],r),r+=s[n].length;return t}(...e)}function ut(s){return s&&0!==s.length?ce.decode(s):""}const X="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";const Qe=new class Yt{buf;seq;inc;constructor(){this.buf=new Uint8Array(22),this.init()}init(){this.setPre(),this.initSeqAndInc(),this.fillSeq()}initSeqAndInc(){this.seq=Math.floor(0xcfd41b9100000*Math.random()),this.inc=Math.floor(300*Math.random()+33)}setPre(){const e=new Uint8Array(12);!function Sr(s){globalThis?.crypto?.getRandomValues?globalThis.crypto.getRandomValues(s):function Wt(s){for(let e=0;e<s.length;e++)s[e]=Math.floor(255*Math.random())}(s)}(e);for(let t=0;t<12;t++)this.buf[t]=X.charCodeAt(e[t]%36)}fillSeq(){let e=this.seq;for(let t=21;t>=12;t--)this.buf[t]=X.charCodeAt(e%36),e=Math.floor(e/36)}next(){return this.seq+=this.inc,this.seq>0xcfd41b9100000&&(this.setPre(),this.initSeqAndInc()),this.fillSeq(),String.fromCharCode.apply(String,this.buf)}reset(){this.init()}};var Le=function(s){return s.Disconnect="disconnect",s.Reconnect="reconnect",s.Update="update",s.LDM="ldm",s.Error="error",s}(Le||{}),lt=function(s){return s.Reconnecting="reconnecting",s.PingTimer="pingTimer",s.StaleConnection="staleConnection",s}(lt||{}),M=function(s){return s.ApiError="BAD API",s.BadAuthentication="BAD_AUTHENTICATION",s.BadCreds="BAD_CREDS",s.BadHeader="BAD_HEADER",s.BadJson="BAD_JSON",s.BadPayload="BAD_PAYLOAD",s.BadSubject="BAD_SUBJECT",s.Cancelled="CANCELLED",s.ConnectionClosed="CONNECTION_CLOSED",s.ConnectionDraining="CONNECTION_DRAINING",s.ConnectionRefused="CONNECTION_REFUSED",s.ConnectionTimeout="CONNECTION_TIMEOUT",s.Disconnect="DISCONNECT",s.InvalidOption="INVALID_OPTION",s.InvalidPayload="INVALID_PAYLOAD",s.MaxPayloadExceeded="MAX_PAYLOAD_EXCEEDED",s.NoResponders="503",s.NotFunction="NOT_FUNC",s.RequestError="REQUEST_ERROR",s.ServerOptionNotAvailable="SERVER_OPT_NA",s.SubClosed="SUB_CLOSED",s.SubDraining="SUB_DRAINING",s.Timeout="TIMEOUT",s.Tls="TLS",s.Unknown="UNKNOWN_ERROR",s.WssRequired="WSS_REQUIRED",s.JetStreamInvalidAck="JESTREAM_INVALID_ACK",s.JetStream404NoMessages="404",s.JetStream408RequestTimeout="408",s.JetStream409MaxAckPendingExceeded="409",s.JetStream409="409",s.JetStreamNotEnabled="503",s.JetStreamIdleHeartBeat="IDLE_HEARTBEAT",s.AuthorizationViolation="AUTHORIZATION_VIOLATION",s.AuthenticationExpired="AUTHENTICATION_EXPIRED",s.ProtocolError="NATS_PROTOCOL_ERR",s.PermissionsViolation="PERMISSIONS_VIOLATION",s.AuthenticationTimeout="AUTHENTICATION_TIMEOUT",s}(M||{});class Xt{messages;constructor(){this.messages=new Map,this.messages.set(M.InvalidPayload,"Invalid payload type - payloads can be 'binary', 'string', or 'json'"),this.messages.set(M.BadJson,"Bad JSON"),this.messages.set(M.WssRequired,"TLS is required, therefore a secure websocket connection is also required")}static getMessage(e){return Pr.getMessage(e)}getMessage(e){return this.messages.get(e)||e}}const Pr=new Xt;class $ extends Error{name;message;code;permissionContext;chainedError;api_error;constructor(e,t,r){super(e),this.name="NatsError",this.message=e,this.code=t,this.chainedError=r}static errorForCode(e,t){const r=Xt.getMessage(e);return new $(r,e,t)}isAuthError(){return this.code===M.AuthenticationExpired||this.code===M.AuthorizationViolation}isAuthTimeout(){return this.code===M.AuthenticationTimeout}isPermissionError(){return this.code===M.PermissionsViolation}isProtocolError(){return this.code===M.ProtocolError}isJetStreamError(){return void 0!==this.api_error}jsError(){return this.api_error?this.api_error:null}}var Pe=function(s){return s[s.Exact=0]="Exact",s[s.CanonicalMIME=1]="CanonicalMIME",s[s.IgnoreCase=2]="IgnoreCase",s}(Pe||{}),Te=function(s){return s.Timer="timer",s.Count="count",s.JitterTimer="jitterTimer",s.SentinelMsg="sentinelMsg",s}(Te||{}),kt=function(s){return s.STATS="io.nats.micro.v1.stats_response",s.INFO="io.nats.micro.v1.info_response",s.PING="io.nats.micro.v1.ping_response",s}(kt||{});const _="Nats-Service-Error",x="Nats-Service-Error-Code";class E extends Error{code;constructor(e,t){super(t),this.code=e}static isServiceError(e){return null!==E.toServiceError(e)}static toServiceError(e){const t=e?.headers?.get(x)||"";if(""!==t){const r=parseInt(t)||400,n=e?.headers?.get(_)||"";return new E(r,n.length?n:t)}return null}}function v(s=""){if("string"!=typeof(s=s||"_INBOX"))throw new Error("prefix must be a string");return s.split(".").forEach(e=>{if("*"===e||">"===e)throw new Error(`inbox prefixes cannot have wildcards '${s}'`)}),`${s}.${Qe.next()}`}const T="127.0.0.1";var I=function(s){return s.PING="PING",s.STATS="STATS",s.INFO="INFO",s}(I||{});function L(s,...e){for(let t=0;t<e.length;t++){const r=e[t];Object.keys(r).forEach(function(n){s[n]=r[n]})}return s}function Z(s){return ce.decode(s).replace(/\n/g,"\u240a").replace(/\r/g,"\u240d")}function de(s){const e=$.errorForCode(M.Timeout);let t,r;const n=new Promise((i,o)=>{t={cancel:()=>{r&&clearTimeout(r)}},r=setTimeout(()=>{o(e)},s)});return Object.assign(n,t)}function B(s=0){return new Promise(e=>{setTimeout(()=>{e()},s)})}function F(){let s={};const e=new Promise((t,r)=>{s={resolve:t,reject:r}});return Object.assign(e,s)}function me(s){for(let e=s.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[s[e],s[t]]=[s[t],s[e]]}return s}class ge{buffers;byteLength;constructor(){this.buffers=[],this.byteLength=0}static concat(...e){let t=0;for(let i=0;i<e.length;i++)t+=e[i].length;const r=new Uint8Array(t);let n=0;for(let i=0;i<e.length;i++)r.set(e[i],n),n+=e[i].length;return r}static fromAscii(e){return e||(e=""),he.encode(e)}static toAscii(e){return ce.decode(e)}reset(){this.buffers.length=0,this.byteLength=0}pack(){if(this.buffers.length>1){const e=new Uint8Array(this.byteLength);let t=0;for(let r=0;r<this.buffers.length;r++)e.set(this.buffers[r],t),t+=this.buffers[r].length;this.buffers.length=0,this.buffers.push(e)}}shift(){if(this.buffers.length){const e=this.buffers.shift();if(e)return this.byteLength-=e.length,e}return new Uint8Array(0)}drain(e){if(this.buffers.length){this.pack();const t=this.buffers.pop();if(t){const r=this.byteLength;(void 0===e||e>r)&&(e=r);const n=t.subarray(0,e);return r>e&&this.buffers.push(t.subarray(e)),this.byteLength=r-e,n}}return new Uint8Array(0)}fill(e,...t){e&&(this.buffers.push(e),this.byteLength+=e.length);for(let r=0;r<t.length;r++)t[r]&&t[r].length&&(this.buffers.push(t[r]),this.byteLength+=t[r].length)}peek(){return this.buffers.length?(this.pack(),this.buffers[0]):new Uint8Array(0)}size(){return this.byteLength}length(){return this.buffers.length}}let ae;function Be(){return void 0!==ae&&void 0!==ae.defaultPort?ae.defaultPort:4222}function Je(){return void 0!==ae&&ae.urlParseFn?ae.urlParseFn:void 0}function ls(){return void 0!==ae&&ae.dnsResolveFn?ae.dnsResolveFn:void 0}const Qt=ge.fromAscii("\r\n"),mn=new Uint8Array(Qt)[0],pn=new Uint8Array(Qt)[1];const yn=4,hs=48,_n=65,xn=97;function Ar(s){return void 0!==function vn(s){for(let e=0;e<s.length;e++)switch(s[e]){case".":return fs(s);case":":return Sn(s)}}(s)}function fs(s){const e=new Uint8Array(4);for(let t=0;t<4;t++){if(0===s.length)return;if(t>0){if("."!==s[0])return;s=s.substring(1)}const{n:r,c:n,ok:i}=En(s);if(!i||r>255)return;s=s.substring(n),e[t]=r}return function wn(s,e,t,r){const n=new Uint8Array(16);return[0,0,0,0,0,0,0,0,0,0,255,255].forEach((o,c)=>{n[c]=o}),n[12]=s,n[13]=e,n[14]=t,n[15]=r,n}(e[0],e[1],e[2],e[3])}function Sn(s){const e=new Uint8Array(16);let t=-1;if(s.length>=2&&":"===s[0]&&":"===s[1]&&(t=0,0===(s=s.substring(2)).length))return e;let r=0;for(;r<16;){const{n,c:i,ok:o}=Pn(s);if(!o||n>65535)return;if(i<s.length&&"."===s[i]){if(t<0&&12!=r||r+4>16)return;const c=fs(s);if(void 0===c)return;e[r]=c[12],e[r+1]=c[13],e[r+2]=c[14],e[r+3]=c[15],s="",r+=yn;break}if(e[r]=n>>8,e[r+1]=n,r+=2,0===(s=s.substring(i)).length)break;if(":"!==s[0]||1==s.length)return;if(":"===(s=s.substring(1))[0]){if(t>=0)return;if(t=r,0===(s=s.substring(1)).length)break}}if(0===s.length){if(r<16){if(t<0)return;const n=16-r;for(let i=r-1;i>=t;i--)e[i+n]=e[i];for(let i=t+n-1;i>=t;i--)e[i]=0}else if(t>=0)return;return e}}function En(s){let e=0,t=0;for(e=0;e<s.length&&48<=s.charCodeAt(e)&&s.charCodeAt(e)<=57;e++)if(t=10*t+(s.charCodeAt(e)-hs),t>=16777215)return{n:16777215,c:e,ok:!1};return 0===e?{n:0,c:0,ok:!1}:{n:t,c:e,ok:!0}}function Pn(s){let e=0,t=0;for(t=0;t<s.length;t++){if(48<=s.charCodeAt(t)&&s.charCodeAt(t)<=57)e*=16,e+=s.charCodeAt(t)-hs;else if(97<=s.charCodeAt(t)&&s.charCodeAt(t)<=102)e*=16,e+=s.charCodeAt(t)-xn+10;else{if(!(65<=s.charCodeAt(t)&&s.charCodeAt(t)<=70))break;e*=16,e+=s.charCodeAt(t)-_n+10}if(e>=16777215)return{n:0,c:t,ok:!1}}return 0===t?{n:0,c:t,ok:!1}:{n:e,c:t,ok:!0}}function kr(s){return!function An(s){return-1!==s.indexOf(".")||-1===s.indexOf("[")&&-1===s.indexOf("::")&&s.split(":").length<=2}(s)}class Ot{src;listen;hostname;port;didConnect;reconnects;lastConnect;gossiped;tlsName;resolves;constructor(e,t=!1){this.src=e,this.tlsName="";const r=function jn(s){(s=s.trim()).match(/^(.*:\/\/)(.*)/m)&&(s=s.replace(/^(.*:\/\/)(.*)/gm,"$2")),s=function kn(s){const t=s.toUpperCase().indexOf("::FFFF:");if(-1!==t&&-1!==s.indexOf(".")){let r=s.substring(t+7);return r=r.replace("[",""),r.replace("]","")}return s}(s),kr(s)&&-1===s.indexOf("[")&&(s=`[${s}]`);const e=kr(s)?s.match(/(]:)(\d+)/):s.match(/(:)(\d+)/),t=e&&3===e.length&&e[1]&&e[2]?parseInt(e[2]):4222,n=new URL(`${80===t?"https":"http"}://${s}`);n.port=`${t}`;let i=n.hostname;return"["===i.charAt(0)&&(i=i.substring(1,i.length-1)),{listen:n.host,hostname:i,port:t}}(e);this.listen=r.listen,this.hostname=r.hostname,this.port=r.port,this.didConnect=!1,this.reconnects=0,this.lastConnect=0,this.gossiped=t}toString(){return this.listen}resolve(e){var t=this;return(0,j.Z)(function*(){if(!e.fn)return[t];const r=[];if(Ar(t.hostname))return[t];{const n=yield e.fn(t.hostname);e.debug&&console.log(`resolve ${t.hostname} = ${n.join(",")}`);for(const i of n){const c=new URL(`${80===t.port?"https":"http"}://${kr(i)?"["+i+"]":i}`);c.port=`${t.port}`;const f=new Ot(c.host,!1);f.tlsName=t.hostname,r.push(f)}}return e.randomize&&me(r),t.resolves=r,r})()}}class On{firstSelect;servers;currentServer;tlsName;randomize;constructor(e=[],t={}){this.firstSelect=!0,this.servers=[],this.tlsName="",this.randomize=t.randomize||!1;const r=Je();e&&(e.forEach(n=>{n=r?r(n):n,this.servers.push(new Ot(n))}),this.randomize&&(this.servers=me(this.servers))),0===this.servers.length&&this.addServer(`${T}:${Be()}`,!1),this.currentServer=this.servers[0]}clear(){this.servers.length=0}updateTLSName(){const e=this.getCurrentServer();Ar(e.hostname)||(this.tlsName=e.hostname,this.servers.forEach(t=>{t.gossiped&&(t.tlsName=this.tlsName)}))}getCurrentServer(){return this.currentServer}addServer(e,t=!1){const r=Je();e=r?r(e):e;const n=new Ot(e,t);Ar(n.hostname)&&(n.tlsName=this.tlsName),this.servers.push(n)}selectServer(){if(this.firstSelect)return this.firstSelect=!1,this.currentServer;const e=this.servers.shift();return e&&(this.servers.push(e),this.currentServer=e),e}removeCurrentServer(){this.removeServer(this.currentServer)}removeServer(e){if(e){const t=this.servers.indexOf(e);this.servers.splice(t,1)}}length(){return this.servers.length}next(){return this.servers.length?this.servers[0]:void 0}getServers(){return this.servers}update(e){const t=[];let r=[];const n=Je(),i=new Map;e.connect_urls&&e.connect_urls.length>0&&e.connect_urls.forEach(c=>{c=n?n(c):c;const f=new Ot(c,!0);i.set(c,f)});const o=[];return this.servers.forEach((c,f)=>{const d=c.listen;c.gossiped&&this.currentServer.listen!==d&&void 0===i.get(d)&&o.push(f),i.delete(d)}),o.reverse(),o.forEach(c=>{const f=this.servers.splice(c,1);r=r.concat(f[0].listen)}),i.forEach((c,f)=>{this.servers.push(c),t.push(f)}),{added:t,deleted:r}}}class _e{inflight;processed;received;noIterator;iterClosed;done;signal;yields;filtered;pendingFiltered;ingestionFilterFn;protocolFilterFn;dispatchedFn;ctx;_data;err;time;constructor(){this.inflight=0,this.filtered=0,this.pendingFiltered=0,this.processed=0,this.received=0,this.noIterator=!1,this.done=!1,this.signal=F(),this.yields=[],this.iterClosed=F(),this.time=0}[Symbol.asyncIterator](){return this.iterate()}push(e){if(this.done)return;if("function"==typeof e)return this.yields.push(e),void this.signal.resolve();const{ingest:t,protocol:r}=this.ingestionFilterFn?this.ingestionFilterFn(e,this.ctx||this):{ingest:!0,protocol:!1};t&&(r&&(this.filtered++,this.pendingFiltered++),this.yields.push(e),this.signal.resolve())}iterate(){var e=this;return we(function*(){if(e.noIterator)throw new $("unsupported iterator",M.ApiError);try{for(;;){if(0===e.yields.length&&(yield te(e.signal)),e.err)throw e.err;const t=e.yields;e.inflight=t.length,e.yields=[];for(let r=0;r<t.length;r++)if("function"!=typeof t[r]){if(!e.protocolFilterFn||e.protocolFilterFn(t[r])){e.processed++;const i=Date.now();yield t[r],e.time=Date.now()-i,e.dispatchedFn&&t[r]&&e.dispatchedFn(t[r])}else e.pendingFiltered--;e.inflight--}else{const i=t[r];try{i()}catch(o){throw o}if(e.err)throw e.err}if(e.done)break;0===e.yields.length&&(t.length=0,e.yields=t,e.signal=F())}}finally{e.stop()}})()}stop(e){this.done||(this.err=e,this.done=!0,this.signal.resolve(),this.iterClosed.resolve())}getProcessed(){return this.noIterator?this.received:this.processed}getPending(){return this.yields.length+this.inflight-this.pendingFiltered}getReceived(){return this.received-this.filtered}}function ds(s){let r=!0;const n=new Array(s.length);for(let i=0;i<s.length;i++){let o=s.charCodeAt(i);if(58===o||o<33||o>126)throw new $(`'${s[i]}' is not a valid character for a header key`,M.BadHeader);r&&97<=o&&o<=122?o-=32:!r&&65<=o&&o<=90&&(o+=32),n[i]=o,r=45==o}return String.fromCharCode(...n)}function Ze(s=0,e=""){if(0===s&&""!==e||s>0&&""===e)throw new Error("setting status requires both code and description");return new et(s,e)}const jr="NATS/1.0";class et{_code;headers;_description;constructor(e=0,t=""){this._code=e,this._description=t,this.headers=new Map}[Symbol.iterator](){return this.headers.entries()}size(){return this.headers.size}equals(e){if(e&&this.headers.size===e.headers.size&&this._code===e._code){for(const[t,r]of this.headers){const n=e.values(t);if(r.length!==n.length)return!1;const i=[...r].sort(),o=[...n].sort();for(let c=0;c<i.length;c++)if(i[c]!==o[c])return!1}return!0}return!1}static decode(e){const t=new et,n=ce.decode(e).split("\r\n"),i=n[0];if(i!==jr){let o=i.replace(jr,"").trim();if(o.length>0){t._code=parseInt(o,10),isNaN(t._code)&&(t._code=0);const c=t._code.toString();o=o.replace(c,""),t._description=o.trim()}}return n.length>=1&&n.slice(1).map(o=>{if(o){const c=o.indexOf(":");if(c>-1){const f=o.slice(0,c),d=o.slice(c+1).trim();t.append(f,d)}}}),t}toString(){if(0===this.headers.size&&0===this._code)return"";let e=jr;this._code>0&&""!==this._description&&(e+=` ${this._code} ${this._description}`);for(const[t,r]of this.headers)for(let n=0;n<r.length;n++)e=`${e}\r\n${t}: ${r[n]}`;return`${e}\r\n\r\n`}encode(){return he.encode(this.toString())}static validHeaderValue(e){if(/[\r\n]/.test(e))throw new $("invalid header value - \\r and \\n are not allowed.",M.BadHeader);return e.trim()}keys(){const e=[];for(const t of this.headers.keys())e.push(t);return e}findKeys(e,t=Pe.Exact){const r=this.keys();switch(t){case Pe.Exact:return r.filter(n=>n===e);case Pe.CanonicalMIME:return e=ds(e),r.filter(n=>n===e);default:{const n=e.toLowerCase();return r.filter(i=>n===i.toLowerCase())}}}get(e,t=Pe.Exact){const r=this.findKeys(e,t);if(r.length){const n=this.headers.get(r[0]);if(n)return Array.isArray(n)?n[0]:n}return""}has(e,t=Pe.Exact){return this.findKeys(e,t).length>0}set(e,t,r=Pe.Exact){this.delete(e,r),this.append(e,t,r)}append(e,t,r=Pe.Exact){const n=ds(e);r===Pe.CanonicalMIME&&(e=n);const i=this.findKeys(e,r);e=i.length>0?i[0]:e;const o=et.validHeaderValue(t);let c=this.headers.get(e);c||(c=[],this.headers.set(e,c)),c.push(o)}values(e,t=Pe.Exact){const r=[];return this.findKeys(e,t).forEach(i=>{const o=this.headers.get(i);o&&r.push(...o)}),r}delete(e,t=Pe.Exact){this.findKeys(e,t).forEach(n=>{this.headers.delete(n)})}get hasError(){return this._code>=300}get status(){return`${this._code} ${this._description}`.trim()}toRecord(){const e={};return this.keys().forEach(t=>{e[t]=this.values(t)}),e}get code(){return this._code}get description(){return this._description}static fromRecord(e){const t=new et;for(const r in e)t.headers.set(r,e[r]);return t}}function Ae(s){return{encode(e){try{return void 0===e&&(e=null),he.encode(JSON.stringify(e))}catch(t){throw $.errorForCode(M.BadJson,t)}},decode(e){try{return JSON.parse(ce.decode(e),s)}catch(t){throw $.errorForCode(M.BadJson,t)}}}}function ms(s){return s&&0===s.data.length&&503===s.headers?.code?$.errorForCode(M.NoResponders):null}let ps=(()=>class s{_headers;_msg;_rdata;_reply;_subject;publisher;static jc;constructor(t,r,n){this._msg=t,this._rdata=r,this.publisher=n}get subject(){return this._subject||(this._subject=ce.decode(this._msg.subject)),this._subject}get reply(){return this._reply||(this._reply=ce.decode(this._msg.reply)),this._reply}get sid(){return this._msg.sid}get headers(){if(this._msg.hdr>-1&&!this._headers){const t=this._rdata.subarray(0,this._msg.hdr);this._headers=et.decode(t)}return this._headers}get data(){return this._rdata?this._msg.hdr>-1?this._rdata.subarray(this._msg.hdr):this._rdata:new Uint8Array(0)}respond(t=re,r){return!!this.reply&&(this.publisher.publish(this.reply,t,r),!0)}size(){return this._msg.subject.length+(this._msg.reply?.length||0)+(-1===this._msg.size?0:this._msg.size)}json(t){return Ae(t).decode(this.data)}string(){return ce.decode(this.data)}})();class In{baseInbox;reqs;constructor(){this.reqs=new Map}size(){return this.reqs.size}init(e){return this.baseInbox=`${v(e)}.`,this.baseInbox}add(e){isNaN(e.received)||(e.received=0),this.reqs.set(e.token,e)}get(e){return this.reqs.get(e)}cancel(e){this.reqs.delete(e.token)}getToken(e){const t=e.subject||"";return 0===t.indexOf(this.baseInbox)?t.substring(this.baseInbox.length):null}all(){return Array.from(this.reqs.values())}handleError(e,t){if(t&&t.permissionContext){if(e)return this.all().forEach(n=>{n.resolver(t,{})}),!0;const r=t.permissionContext;if("publish"===r.operation){const n=this.all().find(i=>i.requestSubject===r.subject);if(n)return n.resolver(t,{}),!0}}return!1}dispatcher(){return(e,t)=>{const r=this.getToken(t);if(r){const n=this.get(r);n&&(null===e&&t.headers&&(e=ms(t)),n.resolver(e,t))}}}close(){const e=$.errorForCode(M.Timeout);this.reqs.forEach(t=>{t.resolver(e,{})})}}class Mn{ph;interval;maxOut;timer;pendings;constructor(e,t,r){this.ph=e,this.interval=t,this.maxOut=r,this.pendings=[]}start(){this.cancel(),this._schedule()}cancel(e){this.timer&&(clearTimeout(this.timer),this.timer=void 0),this._reset(),e&&this.ph.disconnect()}_schedule(){this.timer=setTimeout(()=>{if(this.ph.dispatchStatus({type:lt.PingTimer,data:`${this.pendings.length+1}`}),this.pendings.length===this.maxOut)return void this.cancel(!0);const e=F();this.ph.flush(e).then(()=>{this._reset()}).catch(()=>{this.cancel()}),this.pendings.push(e),this._schedule()},this.interval)}_reset(){this.pendings=this.pendings.filter(e=>(e.resolve(),!1))}}class Tn extends Error{constructor(e){super(e),this.name="AssertionError"}}const Or=2**32-2;function er(s,e,t=0){const r=e.byteLength-t;return s.byteLength>r&&(s=s.subarray(0,r)),e.set(s,t),s.byteLength}class Cr{_buf;_off;constructor(e){this._off=0,this._buf=null!=e?new Uint8Array(e):new Uint8Array(0)}bytes(e={copy:!0}){return!1===e.copy?this._buf.subarray(this._off):this._buf.slice(this._off)}empty(){return this._buf.byteLength<=this._off}get length(){return this._buf.byteLength-this._off}get capacity(){return this._buf.buffer.byteLength}truncate(e){if(0!==e){if(e<0||e>this.length)throw Error("bytes.Buffer: truncation out of range");this._reslice(this._off+e)}else this.reset()}reset(){this._reslice(0),this._off=0}_tryGrowByReslice(e){const t=this._buf.byteLength;return e<=this.capacity-t?(this._reslice(t+e),t):-1}_reslice(e){(function Nn(s,e="Assertion failed."){if(!s)throw new Tn(e)})(e<=this._buf.buffer.byteLength),this._buf=new Uint8Array(this._buf.buffer,0,e)}readByte(){const e=new Uint8Array(1);return this.read(e)?e[0]:null}read(e){if(this.empty())return this.reset(),0===e.byteLength?0:null;const t=er(this._buf.subarray(this._off),e);return this._off+=t,t}writeByte(e){return this.write(Uint8Array.of(e))}writeString(e){return this.write(he.encode(e))}write(e){const t=this._grow(e.byteLength);return er(e,this._buf,t)}_grow(e){const t=this.length;0===t&&0!==this._off&&this.reset();const r=this._tryGrowByReslice(e);if(r>=0)return r;const n=this.capacity;if(e<=Math.floor(n/2)-t)er(this._buf.subarray(this._off),this._buf);else{if(n+e>Or)throw new Error("The buffer cannot be grown beyond the maximum size.");{const i=new Uint8Array(Math.min(2*n+e,Or));er(this._buf.subarray(this._off),i),this._buf=i}}return this._off=0,this._reslice(Math.min(t+e,Or)),t}grow(e){if(e<0)throw Error("Buffer._grow: negative count");const t=this._grow(e);this._reslice(t)}readFrom(e){let t=0;const r=new Uint8Array(32768);for(;;){const n=this.capacity-this.length<32768,i=n?r:new Uint8Array(this._buf.buffer,this.length),o=e.read(i);if(null===o)return t;n?this.write(i.subarray(0,o)):this._reslice(this.length+o),t+=o}}}var ve=function(s){return s[s.OK=0]="OK",s[s.ERR=1]="ERR",s[s.MSG=2]="MSG",s[s.INFO=3]="INFO",s[s.PING=4]="PING",s[s.PONG=5]="PONG",s}(ve||{});class ys{dispatcher;state;as;drop;hdr;ma;argBuf;msgBuf;constructor(e){this.dispatcher=e,this.state=N.OP_START,this.as=0,this.drop=0,this.hdr=0}parse(e){let t;for(t=0;t<e.length;t++){const r=e[t];switch(this.state){case N.OP_START:switch(r){case R.M:case R.m:this.state=N.OP_M,this.hdr=-1,this.ma={sid:-1,hdr:-1,size:-1};break;case R.H:case R.h:this.state=N.OP_H,this.hdr=0,this.ma={sid:-1,hdr:-1,size:-1};break;case R.P:case R.p:this.state=N.OP_P;break;case R.PLUS:this.state=N.OP_PLUS;break;case R.MINUS:this.state=N.OP_MINUS;break;case R.I:case R.i:this.state=N.OP_I;break;default:throw this.fail(e.subarray(t))}break;case N.OP_H:switch(r){case R.M:case R.m:this.state=N.OP_M;break;default:throw this.fail(e.subarray(t))}break;case N.OP_M:switch(r){case R.S:case R.s:this.state=N.OP_MS;break;default:throw this.fail(e.subarray(t))}break;case N.OP_MS:switch(r){case R.G:case R.g:this.state=N.OP_MSG;break;default:throw this.fail(e.subarray(t))}break;case N.OP_MSG:switch(r){case R.SPACE:case R.TAB:this.state=N.OP_MSG_SPC;break;default:throw this.fail(e.subarray(t))}break;case N.OP_MSG_SPC:switch(r){case R.SPACE:case R.TAB:continue;default:this.state=N.MSG_ARG,this.as=t}break;case N.MSG_ARG:switch(r){case R.CR:this.drop=1;break;case R.NL:{const n=this.argBuf?this.argBuf.bytes():e.subarray(this.as,t-this.drop);this.processMsgArgs(n),this.drop=0,this.as=t+1,this.state=N.MSG_PAYLOAD,t=this.as+this.ma.size-1;break}default:this.argBuf&&this.argBuf.writeByte(r)}break;case N.MSG_PAYLOAD:if(this.msgBuf)if(this.msgBuf.length>=this.ma.size){const n=this.msgBuf.bytes({copy:!1});this.dispatcher.push({kind:ve.MSG,msg:this.ma,data:n}),this.argBuf=void 0,this.msgBuf=void 0,this.state=N.MSG_END}else{let n=this.ma.size-this.msgBuf.length;const i=e.length-t;i<n&&(n=i),n>0?(this.msgBuf.write(e.subarray(t,t+n)),t=t+n-1):this.msgBuf.writeByte(r)}else t-this.as>=this.ma.size&&(this.dispatcher.push({kind:ve.MSG,msg:this.ma,data:e.subarray(this.as,t)}),this.argBuf=void 0,this.msgBuf=void 0,this.state=N.MSG_END);break;case N.MSG_END:if(r!==R.NL)continue;this.drop=0,this.as=t+1,this.state=N.OP_START;break;case N.OP_PLUS:switch(r){case R.O:case R.o:this.state=N.OP_PLUS_O;break;default:throw this.fail(e.subarray(t))}break;case N.OP_PLUS_O:switch(r){case R.K:case R.k:this.state=N.OP_PLUS_OK;break;default:throw this.fail(e.subarray(t))}break;case N.OP_PLUS_OK:r===R.NL&&(this.dispatcher.push({kind:ve.OK}),this.drop=0,this.state=N.OP_START);break;case N.OP_MINUS:switch(r){case R.E:case R.e:this.state=N.OP_MINUS_E;break;default:throw this.fail(e.subarray(t))}break;case N.OP_MINUS_E:switch(r){case R.R:case R.r:this.state=N.OP_MINUS_ER;break;default:throw this.fail(e.subarray(t))}break;case N.OP_MINUS_ER:switch(r){case R.R:case R.r:this.state=N.OP_MINUS_ERR;break;default:throw this.fail(e.subarray(t))}break;case N.OP_MINUS_ERR:switch(r){case R.SPACE:case R.TAB:this.state=N.OP_MINUS_ERR_SPC;break;default:throw this.fail(e.subarray(t))}break;case N.OP_MINUS_ERR_SPC:switch(r){case R.SPACE:case R.TAB:continue;default:this.state=N.MINUS_ERR_ARG,this.as=t}break;case N.MINUS_ERR_ARG:switch(r){case R.CR:this.drop=1;break;case R.NL:{let n;this.argBuf?(n=this.argBuf.bytes(),this.argBuf=void 0):n=e.subarray(this.as,t-this.drop),this.dispatcher.push({kind:ve.ERR,data:n}),this.drop=0,this.as=t+1,this.state=N.OP_START;break}default:this.argBuf&&this.argBuf.write(Uint8Array.of(r))}break;case N.OP_P:switch(r){case R.I:case R.i:this.state=N.OP_PI;break;case R.O:case R.o:this.state=N.OP_PO;break;default:throw this.fail(e.subarray(t))}break;case N.OP_PO:switch(r){case R.N:case R.n:this.state=N.OP_PON;break;default:throw this.fail(e.subarray(t))}break;case N.OP_PON:switch(r){case R.G:case R.g:this.state=N.OP_PONG;break;default:throw this.fail(e.subarray(t))}break;case N.OP_PONG:r===R.NL&&(this.dispatcher.push({kind:ve.PONG}),this.drop=0,this.state=N.OP_START);break;case N.OP_PI:switch(r){case R.N:case R.n:this.state=N.OP_PIN;break;default:throw this.fail(e.subarray(t))}break;case N.OP_PIN:switch(r){case R.G:case R.g:this.state=N.OP_PING;break;default:throw this.fail(e.subarray(t))}break;case N.OP_PING:r===R.NL&&(this.dispatcher.push({kind:ve.PING}),this.drop=0,this.state=N.OP_START);break;case N.OP_I:switch(r){case R.N:case R.n:this.state=N.OP_IN;break;default:throw this.fail(e.subarray(t))}break;case N.OP_IN:switch(r){case R.F:case R.f:this.state=N.OP_INF;break;default:throw this.fail(e.subarray(t))}break;case N.OP_INF:switch(r){case R.O:case R.o:this.state=N.OP_INFO;break;default:throw this.fail(e.subarray(t))}break;case N.OP_INFO:switch(r){case R.SPACE:case R.TAB:this.state=N.OP_INFO_SPC;break;default:throw this.fail(e.subarray(t))}break;case N.OP_INFO_SPC:switch(r){case R.SPACE:case R.TAB:continue;default:this.state=N.INFO_ARG,this.as=t}break;case N.INFO_ARG:switch(r){case R.CR:this.drop=1;break;case R.NL:{let n;this.argBuf?(n=this.argBuf.bytes(),this.argBuf=void 0):n=e.subarray(this.as,t-this.drop),this.dispatcher.push({kind:ve.INFO,data:n}),this.drop=0,this.as=t+1,this.state=N.OP_START;break}default:this.argBuf&&this.argBuf.writeByte(r)}break;default:throw this.fail(e.subarray(t))}}(this.state===N.MSG_ARG||this.state===N.MINUS_ERR_ARG||this.state===N.INFO_ARG)&&!this.argBuf&&(this.argBuf=new Cr(e.subarray(this.as,t-this.drop))),this.state===N.MSG_PAYLOAD&&!this.msgBuf&&(this.argBuf||this.cloneMsgArg(),this.msgBuf=new Cr(e.subarray(this.as)))}cloneMsgArg(){const e=this.ma.subject.length,r=new Uint8Array(e+(this.ma.reply?this.ma.reply.length:0));r.set(this.ma.subject),this.ma.reply&&r.set(this.ma.reply,e),this.argBuf=new Cr(r),this.ma.subject=r.subarray(0,e),this.ma.reply&&(this.ma.reply=r.subarray(e))}processMsgArgs(e){if(this.hdr>=0)return this.processHeaderMsgArgs(e);const t=[];let r=-1;for(let n=0;n<e.length;n++)switch(e[n]){case R.SPACE:case R.TAB:case R.CR:case R.NL:r>=0&&(t.push(e.subarray(r,n)),r=-1);break;default:r<0&&(r=n)}switch(r>=0&&t.push(e.subarray(r)),t.length){case 3:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=void 0,this.ma.size=this.protoParseInt(t[2]);break;case 4:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=t[2],this.ma.size=this.protoParseInt(t[3]);break;default:throw this.fail(e,"processMsgArgs Parse Error")}if(this.ma.sid<0)throw this.fail(e,"processMsgArgs Bad or Missing Sid Error");if(this.ma.size<0)throw this.fail(e,"processMsgArgs Bad or Missing Size Error")}fail(e,t=""){return t=t?`${t} [${this.state}]`:`parse error [${this.state}]`,new Error(`${t}: ${ce.decode(e)}`)}processHeaderMsgArgs(e){const t=[];let r=-1;for(let n=0;n<e.length;n++)switch(e[n]){case R.SPACE:case R.TAB:case R.CR:case R.NL:r>=0&&(t.push(e.subarray(r,n)),r=-1);break;default:r<0&&(r=n)}switch(r>=0&&t.push(e.subarray(r)),t.length){case 4:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=void 0,this.ma.hdr=this.protoParseInt(t[2]),this.ma.size=this.protoParseInt(t[3]);break;case 5:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=t[2],this.ma.hdr=this.protoParseInt(t[3]),this.ma.size=this.protoParseInt(t[4]);break;default:throw this.fail(e,"processHeaderMsgArgs Parse Error")}if(this.ma.sid<0)throw this.fail(e,"processHeaderMsgArgs Bad or Missing Sid Error");if(this.ma.hdr<0||this.ma.hdr>this.ma.size)throw this.fail(e,"processHeaderMsgArgs Bad or Missing Header Size Error");if(this.ma.size<0)throw this.fail(e,"processHeaderMsgArgs Bad or Missing Size Error")}protoParseInt(e){if(0===e.length)return-1;let t=0;for(let r=0;r<e.length;r++){if(e[r]<48||e[r]>57)return-1;t=10*t+(e[r]-48)}return t}}var N=function(s){return s[s.OP_START=0]="OP_START",s[s.OP_PLUS=1]="OP_PLUS",s[s.OP_PLUS_O=2]="OP_PLUS_O",s[s.OP_PLUS_OK=3]="OP_PLUS_OK",s[s.OP_MINUS=4]="OP_MINUS",s[s.OP_MINUS_E=5]="OP_MINUS_E",s[s.OP_MINUS_ER=6]="OP_MINUS_ER",s[s.OP_MINUS_ERR=7]="OP_MINUS_ERR",s[s.OP_MINUS_ERR_SPC=8]="OP_MINUS_ERR_SPC",s[s.MINUS_ERR_ARG=9]="MINUS_ERR_ARG",s[s.OP_M=10]="OP_M",s[s.OP_MS=11]="OP_MS",s[s.OP_MSG=12]="OP_MSG",s[s.OP_MSG_SPC=13]="OP_MSG_SPC",s[s.MSG_ARG=14]="MSG_ARG",s[s.MSG_PAYLOAD=15]="MSG_PAYLOAD",s[s.MSG_END=16]="MSG_END",s[s.OP_H=17]="OP_H",s[s.OP_P=18]="OP_P",s[s.OP_PI=19]="OP_PI",s[s.OP_PIN=20]="OP_PIN",s[s.OP_PING=21]="OP_PING",s[s.OP_PO=22]="OP_PO",s[s.OP_PON=23]="OP_PON",s[s.OP_PONG=24]="OP_PONG",s[s.OP_I=25]="OP_I",s[s.OP_IN=26]="OP_IN",s[s.OP_INF=27]="OP_INF",s[s.OP_INFO=28]="OP_INFO",s[s.OP_INFO_SPC=29]="OP_INFO_SPC",s[s.INFO_ARG=30]="INFO_ARG",s}(N||{}),R=function(s){return s[s.CR="\r".charCodeAt(0)]="CR",s[s.E="E".charCodeAt(0)]="E",s[s.e="e".charCodeAt(0)]="e",s[s.F="F".charCodeAt(0)]="F",s[s.f="f".charCodeAt(0)]="f",s[s.G="G".charCodeAt(0)]="G",s[s.g="g".charCodeAt(0)]="g",s[s.H="H".charCodeAt(0)]="H",s[s.h="h".charCodeAt(0)]="h",s[s.I="I".charCodeAt(0)]="I",s[s.i="i".charCodeAt(0)]="i",s[s.K="K".charCodeAt(0)]="K",s[s.k="k".charCodeAt(0)]="k",s[s.M="M".charCodeAt(0)]="M",s[s.m="m".charCodeAt(0)]="m",s[s.MINUS="-".charCodeAt(0)]="MINUS",s[s.N="N".charCodeAt(0)]="N",s[s.n="n".charCodeAt(0)]="n",s[s.NL="\n".charCodeAt(0)]="NL",s[s.O="O".charCodeAt(0)]="O",s[s.o="o".charCodeAt(0)]="o",s[s.P="P".charCodeAt(0)]="P",s[s.p="p".charCodeAt(0)]="p",s[s.PLUS="+".charCodeAt(0)]="PLUS",s[s.R="R".charCodeAt(0)]="R",s[s.r="r".charCodeAt(0)]="r",s[s.S="S".charCodeAt(0)]="S",s[s.s="s".charCodeAt(0)]="s",s[s.SPACE=" ".charCodeAt(0)]="SPACE",s[s.TAB="\t".charCodeAt(0)]="TAB",s}(R||{});function it(s=""){const e=s.match(/(\d+).(\d+).(\d+)/);if(e)return{major:parseInt(e[1]),minor:parseInt(e[2]),micro:parseInt(e[3])};throw new Error(`'${s}' is not a semver value`)}function Ir(s,e){return s.major<e.major?-1:s.major>e.major?1:s.minor<e.minor?-1:s.minor>e.minor?1:s.micro<e.micro?-1:s.micro>e.micro?1:0}var K=function(s){return s.JS_KV="js_kv",s.JS_OBJECTSTORE="js_objectstore",s.JS_PULL_MAX_BYTES="js_pull_max_bytes",s.JS_NEW_CONSUMER_CREATE_API="js_new_consumer_create",s.JS_ALLOW_DIRECT="js_allow_direct",s.JS_MULTIPLE_CONSUMER_FILTER="js_multiple_consumer_filter",s.JS_SIMPLIFICATION="js_simplification",s.JS_STREAM_CONSUMER_METADATA="js_stream_consumer_metadata",s.JS_CONSUMER_FILTER_SUBJECTS="js_consumer_filter_subjects",s.JS_STREAM_FIRST_SEQ="js_stream_first_seq",s.JS_STREAM_SUBJECT_TRANSFORM="js_stream_subject_transform",s.JS_STREAM_SOURCE_SUBJECT_TRANSFORM="js_stream_source_subject_transform",s.JS_STREAM_COMPRESSION="js_stream_compression",s.JS_DEFAULT_CONSUMER_LIMITS="js_default_consumer_limits",s}(K||{});class $n{server;features;disabled;constructor(e){this.features=new Map,this.disabled=[],this.update(e)}resetDisabled(){this.disabled.length=0,this.update(this.server)}disable(e){this.disabled.push(e),this.update(this.server)}isDisabled(e){return-1!==this.disabled.indexOf(e)}update(e){"string"==typeof e&&(e=it(e)),this.server=e,this.set(K.JS_KV,"2.6.2"),this.set(K.JS_OBJECTSTORE,"2.6.3"),this.set(K.JS_PULL_MAX_BYTES,"2.8.3"),this.set(K.JS_NEW_CONSUMER_CREATE_API,"2.9.0"),this.set(K.JS_ALLOW_DIRECT,"2.9.0"),this.set(K.JS_MULTIPLE_CONSUMER_FILTER,"2.10.0"),this.set(K.JS_SIMPLIFICATION,"2.9.4"),this.set(K.JS_STREAM_CONSUMER_METADATA,"2.10.0"),this.set(K.JS_CONSUMER_FILTER_SUBJECTS,"2.10.0"),this.set(K.JS_STREAM_FIRST_SEQ,"2.10.0"),this.set(K.JS_STREAM_SUBJECT_TRANSFORM,"2.10.0"),this.set(K.JS_STREAM_SOURCE_SUBJECT_TRANSFORM,"2.10.0"),this.set(K.JS_STREAM_COMPRESSION,"2.10.0"),this.set(K.JS_DEFAULT_CONSUMER_LIMITS,"2.10.0"),this.disabled.forEach(t=>{this.features.delete(t)})}set(e,t){this.features.set(e,{min:t,ok:Ir(this.server,it(t))>=0})}get(e){return this.features.get(e)||{min:"unknown",ok:!1}}supports(e){return this.get(e)?.ok||!1}require(e){return"string"==typeof e&&(e=it(e)),Ir(this.server,e)>=0}}!function(s){"use strict";var e=function(a,l){this.hi=0|a,this.lo=0|l},t=function(a){var l,u=new Float64Array(16);if(a)for(l=0;l<a.length;l++)u[l]=a[l];return u},r=function(){throw new Error("no PRNG")},n=new Uint8Array(16),i=new Uint8Array(32);i[0]=9;var o=t(),c=t([1]),f=t([56129,1]),d=t([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),g=t([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),p=t([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),w=t([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),S=t([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function k(a,l){return a<<l|a>>>32-l}function C(a,l){var u=255&a[l+3];return(u=(u=u<<8|255&a[l+2])<<8|255&a[l+1])<<8|255&a[l+0]}function V(a,l){return new e(a[l]<<24|a[l+1]<<16|a[l+2]<<8|a[l+3],a[l+4]<<24|a[l+5]<<16|a[l+6]<<8|a[l+7])}function D(a,l,u){var h;for(h=0;h<4;h++)a[l+h]=255&u,u>>>=8}function pe(a,l,u){a[l]=u.hi>>24&255,a[l+1]=u.hi>>16&255,a[l+2]=u.hi>>8&255,a[l+3]=255&u.hi,a[l+4]=u.lo>>24&255,a[l+5]=u.lo>>16&255,a[l+6]=u.lo>>8&255,a[l+7]=255&u.lo}function be(a,l,u,h,m){var b,A=0;for(b=0;b<m;b++)A|=a[l+b]^u[h+b];return(1&A-1>>>8)-1}function Ne(a,l,u,h){return be(a,l,u,h,16)}function st(a,l,u,h){return be(a,l,u,h,32)}function bt(a,l,u,h,m){var P,U,J,b=new Uint32Array(16),A=new Uint32Array(16),O=new Uint32Array(16),y=new Uint32Array(4);for(P=0;P<4;P++)A[5*P]=C(h,4*P),A[1+P]=C(u,4*P),A[6+P]=C(l,4*P),A[11+P]=C(u,16+4*P);for(P=0;P<16;P++)O[P]=A[P];for(P=0;P<20;P++){for(U=0;U<4;U++){for(J=0;J<4;J++)y[J]=A[(5*U+4*J)%16];for(y[1]^=k(y[0]+y[3]|0,7),y[2]^=k(y[1]+y[0]|0,9),y[3]^=k(y[2]+y[1]|0,13),y[0]^=k(y[3]+y[2]|0,18),J=0;J<4;J++)b[4*U+(U+J)%4]=y[J]}for(J=0;J<16;J++)A[J]=b[J]}if(m){for(P=0;P<16;P++)A[P]=A[P]+O[P]|0;for(P=0;P<4;P++)A[5*P]=A[5*P]-C(h,4*P)|0,A[6+P]=A[6+P]-C(l,4*P)|0;for(P=0;P<4;P++)D(a,4*P,A[5*P]),D(a,16+4*P,A[6+P])}else for(P=0;P<16;P++)D(a,4*P,A[P]+O[P]|0)}function fr(a,l,u,h){return bt(a,l,u,h,!1),0}function ot(a,l,u,h){return bt(a,l,u,h,!0),0}var Re=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);function gt(a,l,u,h,m,b,A){var P,U,O=new Uint8Array(16),y=new Uint8Array(64);if(!m)return 0;for(U=0;U<16;U++)O[U]=0;for(U=0;U<8;U++)O[U]=b[U];for(;m>=64;){for(fr(y,O,A,Re),U=0;U<64;U++)a[l+U]=(u?u[h+U]:0)^y[U];for(P=1,U=8;U<16;U++)O[U]=255&(P=P+(255&O[U])|0),P>>>=8;m-=64,l+=64,u&&(h+=64)}if(m>0)for(fr(y,O,A,Re),U=0;U<m;U++)a[l+U]=(u?u[h+U]:0)^y[U];return 0}function dr(a,l,u,h,m){return gt(a,l,null,0,u,h,m)}function yt(a,l,u,h,m){var b=new Uint8Array(32);return ot(b,h,m,Re),dr(a,l,u,h.subarray(16),b)}function Dt(a,l,u,h,m,b,A){var O=new Uint8Array(32);return ot(O,b,A,Re),gt(a,l,u,h,m,b.subarray(16),O)}function nt(a,l){var u,h=0;for(u=0;u<17;u++)a[u]=255&(h=h+(a[u]+l[u]|0)|0),h>>>=8}var Eo=new Uint32Array([5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,252]);function Wr(a,l,u,h,m,b){var A,O,y,P,U=new Uint32Array(17),J=new Uint32Array(17),ne=new Uint32Array(17),qe=new Uint32Array(17),St=new Uint32Array(17);for(y=0;y<17;y++)J[y]=ne[y]=0;for(y=0;y<16;y++)J[y]=b[y];for(J[3]&=15,J[4]&=252,J[7]&=15,J[8]&=252,J[11]&=15,J[12]&=252,J[15]&=15;m>0;){for(y=0;y<17;y++)qe[y]=0;for(y=0;y<16&&y<m;++y)qe[y]=u[h+y];for(qe[y]=1,h+=y,m-=y,nt(ne,qe),O=0;O<17;O++)for(U[O]=0,y=0;y<17;y++)U[O]=0|U[O]+ne[y]*(y<=O?J[O-y]:320*J[O+17-y]|0);for(O=0;O<17;O++)ne[O]=U[O];for(P=0,y=0;y<16;y++)ne[y]=255&(P=P+ne[y]|0),P>>>=8;for(ne[16]=3&(P=P+ne[16]|0),P=5*(P>>>2)|0,y=0;y<16;y++)ne[y]=255&(P=P+ne[y]|0),P>>>=8;ne[16]=P=P+ne[16]|0}for(y=0;y<17;y++)St[y]=ne[y];for(nt(ne,Eo),A=0|-(ne[16]>>>7),y=0;y<17;y++)ne[y]^=A&(St[y]^ne[y]);for(y=0;y<16;y++)qe[y]=b[y+16];for(qe[16]=0,nt(ne,qe),y=0;y<16;y++)a[l+y]=ne[y];return 0}function Xs(a,l,u,h,m,b){var A=new Uint8Array(16);return Wr(A,0,u,h,m,b),Ne(a,l,A,0)}function Yr(a,l,u,h,m){var b;if(u<32)return-1;for(Dt(a,0,l,0,u,h,m),Wr(a,16,a,32,u-32,a),b=0;b<16;b++)a[b]=0;return 0}function Xr(a,l,u,h,m){var b,A=new Uint8Array(32);if(u<32||(yt(A,0,32,h,m),0!==Xs(l,16,l,32,u-32,A)))return-1;for(Dt(a,0,l,0,u,h,m),b=0;b<32;b++)a[b]=0;return 0}function Ve(a,l){var u;for(u=0;u<16;u++)a[u]=0|l[u]}function Ht(a){var l,u;for(u=0;u<16;u++)a[u]+=65536,l=Math.floor(a[u]/65536),a[(u+1)*(u<15?1:0)]+=l-1+37*(l-1)*(15===u?1:0),a[u]-=65536*l}function _t(a,l,u){for(var h,m=~(u-1),b=0;b<16;b++)a[b]^=h=m&(a[b]^l[b]),l[b]^=h}function xt(a,l){var u,h,m,b=t(),A=t();for(u=0;u<16;u++)A[u]=l[u];for(Ht(A),Ht(A),Ht(A),h=0;h<2;h++){for(b[0]=A[0]-65517,u=1;u<15;u++)b[u]=A[u]-65535-(b[u-1]>>16&1),b[u-1]&=65535;b[15]=A[15]-32767-(b[14]>>16&1),m=b[15]>>16&1,b[14]&=65535,_t(A,b,1-m)}for(u=0;u<16;u++)a[2*u]=255&A[u],a[2*u+1]=A[u]>>8}function Qs(a,l){var u=new Uint8Array(32),h=new Uint8Array(32);return xt(u,a),xt(h,l),st(u,0,h,0)}function en(a){var l=new Uint8Array(32);return xt(l,a),1&l[0]}function Qr(a,l){var u;for(u=0;u<16;u++)a[u]=l[2*u]+(l[2*u+1]<<8);a[15]&=32767}function $e(a,l,u){var h;for(h=0;h<16;h++)a[h]=l[h]+u[h]|0}function Ue(a,l,u){var h;for(h=0;h<16;h++)a[h]=l[h]-u[h]|0}function G(a,l,u){var h,m,b=new Float64Array(31);for(h=0;h<31;h++)b[h]=0;for(h=0;h<16;h++)for(m=0;m<16;m++)b[h+m]+=l[h]*u[m];for(h=0;h<15;h++)b[h]+=38*b[h+16];for(h=0;h<16;h++)a[h]=b[h];Ht(a),Ht(a)}function Ie(a,l){G(a,l,l)}function tn(a,l){var h,u=t();for(h=0;h<16;h++)u[h]=l[h];for(h=253;h>=0;h--)Ie(u,u),2!==h&&4!==h&&G(u,u,l);for(h=0;h<16;h++)a[h]=u[h]}function rn(a,l){var h,u=t();for(h=0;h<16;h++)u[h]=l[h];for(h=250;h>=0;h--)Ie(u,u),1!==h&&G(u,u,l);for(h=0;h<16;h++)a[h]=u[h]}function mr(a,l,u){var b,A,h=new Uint8Array(32),m=new Float64Array(80),O=t(),y=t(),P=t(),U=t(),J=t(),ne=t();for(A=0;A<31;A++)h[A]=l[A];for(h[31]=127&l[31]|64,h[0]&=248,Qr(m,u),A=0;A<16;A++)y[A]=m[A],U[A]=O[A]=P[A]=0;for(O[0]=U[0]=1,A=254;A>=0;--A)_t(O,y,b=h[A>>>3]>>>(7&A)&1),_t(P,U,b),$e(J,O,P),Ue(O,O,P),$e(P,y,U),Ue(y,y,U),Ie(U,J),Ie(ne,O),G(O,P,O),G(P,y,J),$e(J,O,P),Ue(O,O,P),Ie(y,O),Ue(P,U,ne),G(O,P,f),$e(O,O,U),G(P,P,O),G(O,U,ne),G(U,y,m),Ie(y,J),_t(O,y,b),_t(P,U,b);for(A=0;A<16;A++)m[A+16]=O[A],m[A+32]=P[A],m[A+48]=y[A],m[A+64]=U[A];var qe=m.subarray(32),St=m.subarray(16);return tn(qe,qe),G(St,St,qe),xt(a,St),0}function pr(a,l){return mr(a,l,i)}function sn(a,l){return r(l,32),pr(a,l)}function br(a,l,u){var h=new Uint8Array(32);return mr(h,u,l),ot(a,n,h,Re)}var nn=Yr,Po=Xr;function Gt(){var b,A,O,a=0,l=0,u=0,h=0,m=65535;for(O=0;O<arguments.length;O++)a+=(b=arguments[O].lo)&m,l+=b>>>16,u+=(A=arguments[O].hi)&m,h+=A>>>16;return new e((u+=(l+=a>>>16)>>>16)&m|(h+=u>>>16)<<16,a&m|l<<16)}function on(a,l){return new e(a.hi>>>l,a.lo>>>l|a.hi<<32-l)}function gr(){var u,a=0,l=0;for(u=0;u<arguments.length;u++)a^=arguments[u].lo,l^=arguments[u].hi;return new e(l,a)}function He(a,l){var u,h,m=32-l;return l<32?(u=a.hi>>>l|a.lo<<m,h=a.lo>>>l|a.hi<<m):l<64&&(u=a.lo>>>l|a.hi<<m,h=a.hi>>>l|a.lo<<m),new e(u,h)}function jo(a,l,u){return new e(a.hi&l.hi^~a.hi&u.hi,a.lo&l.lo^~a.lo&u.lo)}function Oo(a,l,u){return new e(a.hi&l.hi^a.hi&u.hi^l.hi&u.hi,a.lo&l.lo^a.lo&u.lo^l.lo&u.lo)}function Co(a){return gr(He(a,28),He(a,34),He(a,39))}function Io(a){return gr(He(a,14),He(a,18),He(a,41))}function Mo(a){return gr(He(a,1),He(a,8),on(a,7))}function To(a){return gr(He(a,19),He(a,61),on(a,6))}var No=[new e(1116352408,3609767458),new e(1899447441,602891725),new e(3049323471,3964484399),new e(3921009573,2173295548),new e(961987163,4081628472),new e(1508970993,3053834265),new e(2453635748,2937671579),new e(2870763221,3664609560),new e(3624381080,2734883394),new e(310598401,1164996542),new e(607225278,1323610764),new e(1426881987,3590304994),new e(1925078388,4068182383),new e(2162078206,991336113),new e(2614888103,633803317),new e(3248222580,3479774868),new e(3835390401,2666613458),new e(4022224774,944711139),new e(264347078,2341262773),new e(604807628,2007800933),new e(770255983,1495990901),new e(1249150122,1856431235),new e(1555081692,3175218132),new e(1996064986,2198950837),new e(2554220882,3999719339),new e(2821834349,766784016),new e(2952996808,2566594879),new e(3210313671,3203337956),new e(3336571891,1034457026),new e(3584528711,2466948901),new e(113926993,3758326383),new e(338241895,168717936),new e(666307205,1188179964),new e(773529912,1546045734),new e(1294757372,1522805485),new e(1396182291,2643833823),new e(1695183700,2343527390),new e(1986661051,1014477480),new e(2177026350,1206759142),new e(2456956037,344077627),new e(2730485921,1290863460),new e(2820302411,3158454273),new e(3259730800,3505952657),new e(3345764771,106217008),new e(3516065817,3606008344),new e(3600352804,1432725776),new e(4094571909,1467031594),new e(275423344,851169720),new e(430227734,3100823752),new e(506948616,1363258195),new e(659060556,3750685593),new e(883997877,3785050280),new e(958139571,3318307427),new e(1322822218,3812723403),new e(1537002063,2003034995),new e(1747873779,3602036899),new e(1955562222,1575990012),new e(2024104815,1125592928),new e(2227730452,2716904306),new e(2361852424,442776044),new e(2428436474,593698344),new e(2756734187,3733110249),new e(3204031479,2999351573),new e(3329325298,3815920427),new e(3391569614,3928383900),new e(3515267271,566280711),new e(3940187606,3454069534),new e(4118630271,4000239992),new e(116418474,1914138554),new e(174292421,2731055270),new e(289380356,3203993006),new e(460393269,320620315),new e(685471733,587496836),new e(852142971,1086792851),new e(1017036298,365543100),new e(1126000580,2618297676),new e(1288033470,3409855158),new e(1501505948,4234509866),new e(1607167915,987167468),new e(1816402316,1246189591)];function an(a,l,u){var O,y,P,h=[],m=[],b=[],A=[];for(y=0;y<8;y++)h[y]=b[y]=V(a,8*y);for(var U=0;u>=128;){for(y=0;y<16;y++)A[y]=V(l,8*y+U);for(y=0;y<80;y++){for(P=0;P<8;P++)m[P]=b[P];for(O=Gt(b[7],Io(b[4]),jo(b[4],b[5],b[6]),No[y],A[y%16]),m[7]=Gt(O,Co(b[0]),Oo(b[0],b[1],b[2])),m[3]=Gt(m[3],O),P=0;P<8;P++)b[(P+1)%8]=m[P];if(y%16==15)for(P=0;P<16;P++)A[P]=Gt(A[P],A[(P+9)%16],Mo(A[(P+1)%16]),To(A[(P+14)%16]))}for(y=0;y<8;y++)b[y]=Gt(b[y],h[y]),h[y]=b[y];U+=128,u-=128}for(y=0;y<8;y++)pe(a,8*y,h[y]);return u}var Ro=new Uint8Array([106,9,230,103,243,188,201,8,187,103,174,133,132,202,167,59,60,110,243,114,254,148,248,43,165,79,245,58,95,29,54,241,81,14,82,127,173,230,130,209,155,5,104,140,43,62,108,31,31,131,217,171,251,65,189,107,91,224,205,25,19,126,33,121]);function at(a,l,u){var b,h=new Uint8Array(64),m=new Uint8Array(256),A=u;for(b=0;b<64;b++)h[b]=Ro[b];for(an(h,l,u),u%=128,b=0;b<256;b++)m[b]=0;for(b=0;b<u;b++)m[b]=l[A-u+b];for(m[u]=128,m[(u=256-128*(u<112?1:0))-9]=0,pe(m,u-8,new e(A/536870912|0,A<<3)),an(h,m,u),b=0;b<64;b++)a[b]=h[b];return 0}function yr(a,l){var u=t(),h=t(),m=t(),b=t(),A=t(),O=t(),y=t(),P=t(),U=t();Ue(u,a[1],a[0]),Ue(U,l[1],l[0]),G(u,u,U),$e(h,a[0],a[1]),$e(U,l[0],l[1]),G(h,h,U),G(m,a[3],l[3]),G(m,m,g),G(b,a[2],l[2]),$e(b,b,b),Ue(A,h,u),Ue(O,b,m),$e(y,b,m),$e(P,h,u),G(a[0],A,O),G(a[1],P,y),G(a[2],y,O),G(a[3],A,P)}function cn(a,l,u){var h;for(h=0;h<4;h++)_t(a[h],l[h],u)}function es(a,l){var u=t(),h=t(),m=t();tn(m,l[2]),G(u,l[0],m),G(h,l[1],m),xt(a,h),a[31]^=en(u)<<7}function ts(a,l,u){var h,m;for(Ve(a[0],o),Ve(a[1],c),Ve(a[2],c),Ve(a[3],o),m=255;m>=0;--m)cn(a,l,h=u[m/8|0]>>(7&m)&1),yr(l,a),yr(a,a),cn(a,l,h)}function _r(a,l){var u=[t(),t(),t(),t()];Ve(u[0],p),Ve(u[1],w),Ve(u[2],c),G(u[3],p,w),ts(a,u,l)}function rs(a,l,u){var b,h=new Uint8Array(64),m=[t(),t(),t(),t()];for(u||r(l,32),at(h,l,32),h[0]&=248,h[31]&=127,h[31]|=64,_r(m,h),es(a,m),b=0;b<32;b++)l[b+32]=a[b];return 0}var a,xr=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function ss(a,l){var u,h,m,b;for(h=63;h>=32;--h){for(u=0,m=h-32,b=h-12;m<b;++m)l[m]+=u-16*l[h]*xr[m-(h-32)],u=Math.floor((l[m]+128)/256),l[m]-=256*u;l[m]+=u,l[h]=0}for(u=0,m=0;m<32;m++)l[m]+=u-(l[31]>>4)*xr[m],u=l[m]>>8,l[m]&=255;for(m=0;m<32;m++)l[m]-=u*xr[m];for(h=0;h<32;h++)l[h+1]+=l[h]>>8,a[h]=255&l[h]}function ns(a){var u,l=new Float64Array(64);for(u=0;u<64;u++)l[u]=a[u];for(u=0;u<64;u++)a[u]=0;ss(a,l)}function un(a,l,u,h){var O,y,m=new Uint8Array(64),b=new Uint8Array(64),A=new Uint8Array(64),P=new Float64Array(64),U=[t(),t(),t(),t()];at(m,h,32),m[0]&=248,m[31]&=127,m[31]|=64;var J=u+64;for(O=0;O<u;O++)a[64+O]=l[O];for(O=0;O<32;O++)a[32+O]=m[32+O];for(at(A,a.subarray(32),u+32),ns(A),_r(U,A),es(a,U),O=32;O<64;O++)a[O]=h[O];for(at(b,a,u+64),ns(b),O=0;O<64;O++)P[O]=0;for(O=0;O<32;O++)P[O]=A[O];for(O=0;O<32;O++)for(y=0;y<32;y++)P[O+y]+=b[O]*m[y];return ss(a.subarray(32),P),J}function is(a,l,u,h){var m,b=new Uint8Array(32),A=new Uint8Array(64),O=[t(),t(),t(),t()],y=[t(),t(),t(),t()];if(u<64||function $o(a,l){var u=t(),h=t(),m=t(),b=t(),A=t(),O=t(),y=t();return Ve(a[2],c),Qr(a[1],l),Ie(m,a[1]),G(b,m,d),Ue(m,m,a[2]),$e(b,a[2],b),Ie(A,b),Ie(O,A),G(y,O,A),G(u,y,m),G(u,u,b),rn(u,u),G(u,u,m),G(u,u,b),G(u,u,b),G(a[0],u,b),Ie(h,a[0]),G(h,h,b),Qs(h,m)&&G(a[0],a[0],S),Ie(h,a[0]),G(h,h,b),Qs(h,m)?-1:(en(a[0])===l[31]>>7&&Ue(a[0],o,a[0]),G(a[3],a[0],a[1]),0)}(y,h))return-1;for(m=0;m<u;m++)a[m]=l[m];for(m=0;m<32;m++)a[m+32]=h[m];if(at(A,a,u),ns(A),ts(O,y,A),_r(y,l.subarray(32)),yr(O,y),es(b,O),u-=64,st(l,0,b,0)){for(m=0;m<u;m++)a[m]=0;return-1}for(m=0;m<u;m++)a[m]=l[m+64];return u}function hn(a,l){if(32!==a.length)throw new Error("bad key size");if(24!==l.length)throw new Error("bad nonce size")}function ke(){for(var a=0;a<arguments.length;a++)if(!(arguments[a]instanceof Uint8Array))throw new TypeError("unexpected type, use Uint8Array")}function fn(a){for(var l=0;l<a.length;l++)a[l]=0}s.lowlevel={crypto_core_hsalsa20:ot,crypto_stream_xor:Dt,crypto_stream:yt,crypto_stream_salsa20_xor:gt,crypto_stream_salsa20:dr,crypto_onetimeauth:Wr,crypto_onetimeauth_verify:Xs,crypto_verify_16:Ne,crypto_verify_32:st,crypto_secretbox:Yr,crypto_secretbox_open:Xr,crypto_scalarmult:mr,crypto_scalarmult_base:pr,crypto_box_beforenm:br,crypto_box_afternm:nn,crypto_box:function Ao(a,l,u,h,m,b){var A=new Uint8Array(32);return br(A,m,b),nn(a,l,u,h,A)},crypto_box_open:function ko(a,l,u,h,m,b){var A=new Uint8Array(32);return br(A,m,b),Po(a,l,u,h,A)},crypto_box_keypair:sn,crypto_hash:at,crypto_sign:un,crypto_sign_keypair:rs,crypto_sign_open:is,crypto_secretbox_KEYBYTES:32,crypto_secretbox_NONCEBYTES:24,crypto_secretbox_ZEROBYTES:32,crypto_secretbox_BOXZEROBYTES:16,crypto_scalarmult_BYTES:32,crypto_scalarmult_SCALARBYTES:32,crypto_box_PUBLICKEYBYTES:32,crypto_box_SECRETKEYBYTES:32,crypto_box_BEFORENMBYTES:32,crypto_box_NONCEBYTES:24,crypto_box_ZEROBYTES:32,crypto_box_BOXZEROBYTES:16,crypto_sign_BYTES:64,crypto_sign_PUBLICKEYBYTES:32,crypto_sign_SECRETKEYBYTES:64,crypto_sign_SEEDBYTES:32,crypto_hash_BYTES:64,gf:t,D:d,L:xr,pack25519:xt,unpack25519:Qr,M:G,A:$e,S:Ie,Z:Ue,pow2523:rn,add:yr,set25519:Ve,modL:ss,scalarmult:ts,scalarbase:_r},s.randomBytes=function(a){var l=new Uint8Array(a);return r(l,a),l},s.secretbox=function(a,l,u){ke(a,l,u),hn(u,l);for(var h=new Uint8Array(32+a.length),m=new Uint8Array(h.length),b=0;b<a.length;b++)h[b+32]=a[b];return Yr(m,h,h.length,l,u),m.subarray(16)},s.secretbox.open=function(a,l,u){ke(a,l,u),hn(u,l);for(var h=new Uint8Array(16+a.length),m=new Uint8Array(h.length),b=0;b<a.length;b++)h[b+16]=a[b];return h.length<32||0!==Xr(m,h,h.length,l,u)?null:m.subarray(32)},s.secretbox.keyLength=32,s.secretbox.nonceLength=24,s.secretbox.overheadLength=16,s.scalarMult=function(a,l){if(ke(a,l),32!==a.length)throw new Error("bad n size");if(32!==l.length)throw new Error("bad p size");var u=new Uint8Array(32);return mr(u,a,l),u},s.scalarMult.base=function(a){if(ke(a),32!==a.length)throw new Error("bad n size");var l=new Uint8Array(32);return pr(l,a),l},s.scalarMult.scalarLength=32,s.scalarMult.groupElementLength=32,s.box=function(a,l,u,h){var m=s.box.before(u,h);return s.secretbox(a,l,m)},s.box.before=function(a,l){ke(a,l),function Lo(a,l){if(32!==a.length)throw new Error("bad public key size");if(32!==l.length)throw new Error("bad secret key size")}(a,l);var u=new Uint8Array(32);return br(u,a,l),u},s.box.after=s.secretbox,s.box.open=function(a,l,u,h){var m=s.box.before(u,h);return s.secretbox.open(a,l,m)},s.box.open.after=s.secretbox.open,s.box.keyPair=function(){var a=new Uint8Array(32),l=new Uint8Array(32);return sn(a,l),{publicKey:a,secretKey:l}},s.box.keyPair.fromSecretKey=function(a){if(ke(a),32!==a.length)throw new Error("bad secret key size");var l=new Uint8Array(32);return pr(l,a),{publicKey:l,secretKey:new Uint8Array(a)}},s.box.publicKeyLength=32,s.box.secretKeyLength=32,s.box.sharedKeyLength=32,s.box.nonceLength=24,s.box.overheadLength=s.secretbox.overheadLength,s.sign=function(a,l){if(ke(a,l),64!==l.length)throw new Error("bad secret key size");var u=new Uint8Array(64+a.length);return un(u,a,a.length,l),u},s.sign.open=function(a,l){if(ke(a,l),32!==l.length)throw new Error("bad public key size");var u=new Uint8Array(a.length),h=is(u,a,a.length,l);if(h<0)return null;for(var m=new Uint8Array(h),b=0;b<m.length;b++)m[b]=u[b];return m},s.sign.detached=function(a,l){for(var u=s.sign(a,l),h=new Uint8Array(64),m=0;m<h.length;m++)h[m]=u[m];return h},s.sign.detached.verify=function(a,l,u){if(ke(a,l,u),64!==l.length)throw new Error("bad signature size");if(32!==u.length)throw new Error("bad public key size");var b,h=new Uint8Array(64+a.length),m=new Uint8Array(64+a.length);for(b=0;b<64;b++)h[b]=l[b];for(b=0;b<a.length;b++)h[b+64]=a[b];return is(m,h,h.length,u)>=0},s.sign.keyPair=function(){var a=new Uint8Array(32),l=new Uint8Array(64);return rs(a,l),{publicKey:a,secretKey:l}},s.sign.keyPair.fromSecretKey=function(a){if(ke(a),64!==a.length)throw new Error("bad secret key size");for(var l=new Uint8Array(32),u=0;u<l.length;u++)l[u]=a[32+u];return{publicKey:l,secretKey:new Uint8Array(a)}},s.sign.keyPair.fromSeed=function(a){if(ke(a),32!==a.length)throw new Error("bad seed size");for(var l=new Uint8Array(32),u=new Uint8Array(64),h=0;h<32;h++)u[h]=a[h];return rs(l,u,!0),{publicKey:l,secretKey:u}},s.sign.publicKeyLength=32,s.sign.secretKeyLength=64,s.sign.seedLength=32,s.sign.signatureLength=64,s.hash=function(a){ke(a);var l=new Uint8Array(64);return at(l,a,a.length),l},s.hash.hashLength=64,s.verify=function(a,l){return ke(a,l),0!==a.length&&0!==l.length&&a.length===l.length&&0===be(a,0,l,0,a.length)},s.setPRNG=function(a){r=a},(a=typeof globalThis<"u"?globalThis.crypto||globalThis.msCrypto:null)&&a.getRandomValues?s.setPRNG(function(u,h){var m,b=new Uint8Array(h);for(m=0;m<h;m+=65536)a.getRandomValues(b.subarray(m,m+Math.min(h-m,65536)));for(m=0;m<h;m++)u[m]=b[m];fn(b)}):typeof require<"u"&&(a=require("crypto"))&&a.randomBytes&&s.setPRNG(function(u,h){var m,b=a.randomBytes(h);for(m=0;m<h;m++)u[m]=b[m];fn(b)})}(typeof module<"u"&&module.exports?module.exports:globalThis.nacl=globalThis.nacl||{});const tr=typeof module<"u"&&module.exports?module.exports:globalThis.nacl,Un={fromSeed:tr.sign.keyPair.fromSeed,sign:tr.sign.detached,verify:tr.sign.detached.verify,randomBytes:tr.randomBytes};let _s;new Uint16Array([0,4129,8258,12387,16516,20645,24774,28903,33032,37161,41290,45419,49548,53677,57806,61935,4657,528,12915,8786,21173,17044,29431,25302,37689,33560,45947,41818,54205,50076,62463,58334,9314,13379,1056,5121,25830,29895,17572,21637,42346,46411,34088,38153,58862,62927,50604,54669,13907,9842,5649,1584,30423,26358,22165,18100,46939,42874,38681,34616,63455,59390,55197,51132,18628,22757,26758,30887,2112,6241,10242,14371,51660,55789,59790,63919,35144,39273,43274,47403,23285,19156,31415,27286,6769,2640,14899,10770,56317,52188,64447,60318,39801,35672,47931,43802,27814,31879,19684,23749,11298,15363,3168,7233,60846,64911,52716,56781,44330,48395,36200,40265,32407,28342,24277,20212,15891,11826,7761,3696,65439,61374,57309,53244,48923,44858,40793,36728,37256,33193,45514,41451,53516,49453,61774,57711,4224,161,12482,8419,20484,16421,28742,24679,33721,37784,41979,46042,49981,54044,58239,62302,689,4752,8947,13010,16949,21012,25207,29270,46570,42443,38312,34185,62830,58703,54572,50445,13538,9411,5280,1153,29798,25671,21540,17413,42971,47098,34713,38840,59231,63358,50973,55100,9939,14066,1681,5808,26199,30326,17941,22068,55628,51565,63758,59695,39368,35305,47498,43435,22596,18533,30726,26663,6336,2273,14466,10403,52093,56156,60223,64286,35833,39896,43963,48026,19061,23124,27191,31254,2801,6864,10931,14994,64814,60687,56684,52557,48554,44427,40424,36297,31782,27655,23652,19525,15522,11395,7392,3265,61215,65342,53085,57212,44955,49082,36825,40952,28183,32310,20053,24180,11923,16050,3793,7920]),Error,function qn(s){_s=s}(Un);function si(s){const e=`${T}:${Be()}`;if((s=s||{servers:[e]}).servers=s.servers||[],"string"==typeof s.servers&&(s.servers=[s.servers]),s.servers.length>0&&s.port)throw new $("port and servers options are mutually exclusive",M.InvalidOption);0===s.servers.length&&s.port&&(s.servers=[`${T}:${s.port}`]),s.servers&&0===s.servers.length&&(s.servers=[e]);const t=L({maxPingOut:2,maxReconnectAttempts:10,noRandomize:!1,pedantic:!1,pingInterval:12e4,reconnect:!0,reconnectJitter:100,reconnectJitterTLS:1e3,reconnectTimeWait:2e3,tls:void 0,verbose:!1,waitOnFirstConnect:!1,ignoreAuthErrorAbort:!1},s);if(t.authenticator=function ri(s){const e=[];return"function"==typeof s.authenticator&&e.push(s.authenticator),Array.isArray(s.authenticator)&&e.push(...s.authenticator),s.token&&e.push(function Yn(s){return()=>({auth_token:"function"==typeof s?s():s})}(s.token)),s.user&&e.push(function Wn(s,e){return()=>({user:"function"==typeof s?s():s,pass:"function"==typeof e?e():e})}(s.user,s.pass)),0===e.length?()=>{}:function Kn(s){return e=>{let t={};return s.forEach(r=>{const n=r(e)||{};t=Object.assign(t,n)}),t}}(e)}(t),["reconnectDelayHandler","authenticator"].forEach(r=>{if(t[r]&&"function"!=typeof t[r])throw new $(`${r} option should be a function`,M.NotFunction)}),t.reconnectDelayHandler||(t.reconnectDelayHandler=()=>{let r=t.tls?t.reconnectJitterTLS:t.reconnectJitter;return r&&(r++,r=Math.floor(Math.random()*r)),t.reconnectTimeWait+r}),t.inboxPrefix)try{v(t.inboxPrefix)}catch(r){throw new $(r.message,M.ApiError)}if(t.resolve&&"function"!=typeof ls())throw new $("'resolve' is not supported on this client",M.InvalidOption);return t}const oi=/^INFO\s+([^\r\n]+)\r\n/i,ai=Me("PONG\r\n"),Ps=Me("PING\r\n");class ci{echo;no_responders;protocol;verbose;pedantic;jwt;nkey;sig;user;pass;auth_token;tls_required;name;lang;version;headers;constructor(e,t,r){this.protocol=1,this.version=e.version,this.lang=e.lang,this.echo=!t.noEcho&&void 0,this.verbose=t.verbose,this.pedantic=t.pedantic,this.tls_required=!!t.tls||void 0,this.name=t.name,L(this,(t&&"function"==typeof t.authenticator?t.authenticator(r):{})||{})}}class As extends _e{sid;queue;draining;max;subject;drained;protocol;timer;info;cleanupFn;closed;requestSubject;constructor(e,t,r={}){super(),L(this,r),this.protocol=e,this.subject=t,this.draining=!1,this.noIterator="function"==typeof r.callback,this.closed=F(),r.timeout&&(this.timer=de(r.timeout),this.timer.then(()=>{this.timer=void 0}).catch(n=>{this.stop(n),this.noIterator&&this.callback(n,{})})),this.noIterator||this.iterClosed.then(()=>{this.closed.resolve(),this.unsubscribe()})}setPrePostHandlers(e){if(this.noIterator){const t=this.callback,r=e.ingestionFilterFn?e.ingestionFilterFn:()=>({ingest:!0,protocol:!1}),n=e.protocolFilterFn?e.protocolFilterFn:()=>!0,i=e.dispatchedFn?e.dispatchedFn:()=>{};this.callback=(o,c)=>{const{ingest:f}=r(c);f&&n(c)&&(t(o,c),i(c))}}else this.protocolFilterFn=e.protocolFilterFn,this.dispatchedFn=e.dispatchedFn}callback(e,t){this.cancelTimeout(),e?this.stop(e):this.push(t)}close(){if(!this.isClosed()){this.cancelTimeout();const e=()=>{if(this.stop(),this.cleanupFn)try{this.cleanupFn(this,this.info)}catch{}this.closed.resolve()};this.noIterator?e():this.push(e)}}unsubscribe(e){this.protocol.unsubscribe(this,e)}cancelTimeout(){this.timer&&(this.timer.cancel(),this.timer=void 0)}drain(){return this.protocol.isClosed()?Promise.reject($.errorForCode(M.ConnectionClosed)):this.isClosed()?Promise.reject($.errorForCode(M.SubClosed)):(this.drained||(this.draining=!0,this.protocol.unsub(this),this.drained=this.protocol.flush(F()).then(()=>{this.protocol.subscriptions.cancel(this)}).catch(()=>{this.protocol.subscriptions.cancel(this)})),this.drained)}isDraining(){return this.draining}isClosed(){return this.done}getSubject(){return this.subject}getMax(){return this.max}getID(){return this.sid}}class ui{mux;subs;sidCounter;constructor(){this.sidCounter=0,this.mux=null,this.subs=new Map}size(){return this.subs.size}add(e){return this.sidCounter++,e.sid=this.sidCounter,this.subs.set(e.sid,e),e}setMux(e){return this.mux=e,e}getMux(){return this.mux}get(e){return this.subs.get(e)}resub(e){return this.sidCounter++,this.subs.delete(e.sid),e.sid=this.sidCounter,this.subs.set(e.sid,e),e}all(){return Array.from(this.subs.values())}cancel(e){e&&(e.close(),this.subs.delete(e.sid))}handleError(e){if(e&&e.permissionContext){const t=e.permissionContext,r=this.all();let n;if("subscription"===t.operation&&(n=r.find(i=>i.subject===t.subject)),"publish"===t.operation&&(n=r.find(i=>i.requestSubject===t.subject)),n)return n.callback(e,{}),n.close(),this.subs.delete(n.sid),n!==this.mux}return!1}close(){this.subs.forEach(e=>{e.close()})}}class nr{connected;connectedOnce;infoReceived;info;muxSubscriptions;options;outbound;pongs;subscriptions;transport;noMorePublishing;connectError;publisher;_closed;closed;listeners;heartbeats;parser;outMsgs;inMsgs;outBytes;inBytes;pendingLimit;lastError;abortReconnect;servers;server;features;connectPromise;constructor(e,t){this._closed=!1,this.connected=!1,this.connectedOnce=!1,this.infoReceived=!1,this.noMorePublishing=!1,this.abortReconnect=!1,this.listeners=[],this.pendingLimit=32768,this.outMsgs=0,this.inMsgs=0,this.outBytes=0,this.inBytes=0,this.options=e,this.publisher=t,this.subscriptions=new ui,this.muxSubscriptions=new In,this.outbound=new ge,this.pongs=[],this.pendingLimit=e.pendingLimit||this.pendingLimit,this.features=new $n({major:0,minor:0,micro:0}),this.connectPromise=null,this.servers=new On("string"==typeof e.servers?[e.servers]:e.servers,{randomize:!e.noRandomize}),this.closed=F(),this.parser=new ys(this),this.heartbeats=new Mn(this,this.options.pingInterval||12e4,this.options.maxPingOut||2)}resetOutbound(){this.outbound.reset();const e=this.pongs;this.pongs=[];const t=$.errorForCode(M.Disconnect);t.stack="",e.forEach(r=>{r.reject(t)}),this.parser=new ys(this),this.infoReceived=!1}dispatchStatus(e){this.listeners.forEach(t=>{t.push(e)})}status(){const e=new _e;return this.listeners.push(e),e}prepare(){var e=this;this.transport&&this.transport.discard(),this.info=void 0,this.resetOutbound();const t=F();return t.catch(()=>{}),this.pongs.unshift(t),this.connectError=r=>{t.reject(r)},this.transport=function dn(){if(!ae||"function"!=typeof ae.factory)throw new Error("transport fn is not set");return ae.factory()}(),this.transport.closed().then(function(){var r=(0,j.Z)(function*(n){e.connected=!1,e.isClosed()||(yield e.disconnected(e.transport.closeError||e.lastError))});return function(n){return r.apply(this,arguments)}}()),t}disconnect(){this.dispatchStatus({type:lt.StaleConnection,data:""}),this.transport.disconnect()}disconnected(e){var t=this;return(0,j.Z)(function*(){t.dispatchStatus({type:Le.Disconnect,data:t.servers.getCurrentServer().toString()}),t.options.reconnect?yield t.dialLoop().then(()=>{t.dispatchStatus({type:Le.Reconnect,data:t.servers.getCurrentServer().toString()}),t.lastError?.code===M.AuthenticationExpired&&(t.lastError=void 0)}).catch(r=>{t._close(r)}):yield t._close(e)})()}dial(e){var t=this;return(0,j.Z)(function*(){const r=t.prepare();let n;try{n=de(t.options.timeout||2e4);const i=t.transport.connect(e,t.options);yield Promise.race([i,n]),(0,j.Z)(function*(){try{var f,o=!1,c=!1;try{for(var g,d=(0,H.Z)(t.transport);o=!(g=yield d.next()).done;o=!1)t.parser.parse(g.value)}catch(p){c=!0,f=p}finally{try{o&&null!=d.return&&(yield d.return())}finally{if(c)throw f}}}catch(p){console.log("reader closed",p)}})().then()}catch(i){r.reject(i)}try{yield Promise.race([n,r]),n&&n.cancel(),t.connected=!0,t.connectError=void 0,t.sendSubscriptions(),t.connectedOnce=!0,t.server.didConnect=!0,t.server.reconnects=0,t.flushPending(),t.heartbeats.start()}catch(i){throw n&&n.cancel(),yield t.transport.close(i),i}})()}_doDial(e){var t=this;return(0,j.Z)(function*(){const r=yield e.resolve({fn:ls(),debug:t.options.debug,randomize:!t.options.noRandomize});let n=null;for(const i of r)try{return n=null,t.dispatchStatus({type:lt.Reconnecting,data:i.toString()}),void(yield t.dial(i))}catch(o){n=o}throw n})()}dialLoop(){return null===this.connectPromise&&(this.connectPromise=this.dodialLoop(),this.connectPromise.then(()=>{}).catch(()=>{}).finally(()=>{this.connectPromise=null})),this.connectPromise}dodialLoop(){var e=this;return(0,j.Z)(function*(){let t;for(;;){e._closed&&e.servers.clear();const r=e.options.reconnectDelayHandler?e.options.reconnectDelayHandler():2e3;let n=r;const i=e.selectServer();if(!i||e.abortReconnect)throw t||(e.lastError?e.lastError:$.errorForCode(M.ConnectionRefused));const o=Date.now();if(0===i.lastConnect||i.lastConnect+r<=o){i.lastConnect=Date.now();try{yield e._doDial(i);break}catch(c){if(t=c,!e.connectedOnce){if(e.options.waitOnFirstConnect)continue;e.servers.removeCurrentServer()}i.reconnects++;const f=e.options.maxReconnectAttempts||0;-1!==f&&i.reconnects>=f&&e.servers.removeCurrentServer()}}else n=Math.min(n,i.lastConnect+r-o),yield B(n)}})()}static connect(e,t){return(0,j.Z)(function*(){const r=new nr(e,t);return yield r.dialLoop(),r})()}static toError(e){const t=e?e.toLowerCase():"";if(-1!==t.indexOf("permissions violation")){const r=new $(e,M.PermissionsViolation),n=e.match(/(Publish|Subscription) to "(\S+)"/);return n&&(r.permissionContext={operation:n[1].toLowerCase(),subject:n[2]}),r}return-1!==t.indexOf("authorization violation")?new $(e,M.AuthorizationViolation):-1!==t.indexOf("user authentication expired")?new $(e,M.AuthenticationExpired):-1!==t.indexOf("authentication timeout")?new $(e,M.AuthenticationTimeout):new $(e,M.ProtocolError)}processMsg(e,t){if(this.inMsgs++,this.inBytes+=t.length,!this.subscriptions.sidCounter)return;const r=this.subscriptions.get(e.sid);r&&(r.received+=1,r.callback&&r.callback(null,new ps(e,t,this)),void 0!==r.max&&r.received>=r.max&&r.unsubscribe())}processError(e){const t=ut(e),r=nr.toError(t),n={type:Le.Error,data:r.code};if(r.isPermissionError()){let i=!1;r.permissionContext&&(n.permissionContext=r.permissionContext,i=this.subscriptions.getMux()?.subject===r.permissionContext.subject),this.subscriptions.handleError(r),this.muxSubscriptions.handleError(i,r),i&&this.subscriptions.setMux(null)}this.dispatchStatus(n),this.handleError(r)}handleError(e){e.isAuthError()?this.handleAuthError(e):(e.isProtocolError()||e.isAuthTimeout())&&(this.lastError=e),e.isPermissionError()||(this.lastError=e)}handleAuthError(e){this.lastError&&e.code===this.lastError.code&&!1===this.options.ignoreAuthErrorAbort&&(this.abortReconnect=!0),this.connectError?this.connectError(e):this.disconnect()}processPing(){this.transport.send(ai)}processPong(){const e=this.pongs.shift();e&&e.resolve()}processInfo(e){const t=JSON.parse(ut(e));this.info=t;const r=this.options&&this.options.ignoreClusterUpdates?void 0:this.servers.update(t);if(!this.infoReceived){this.features.update(it(t.version)),this.infoReceived=!0,this.transport.isEncrypted()&&this.servers.updateTLSName();const{version:i,lang:o}=this.transport;try{const c=new ci({version:i,lang:o},this.options,t.nonce);t.headers&&(c.headers=!0,c.no_responders=!0);const f=JSON.stringify(c);this.transport.send(Me(`CONNECT ${f}\r\n`)),this.transport.send(Ps)}catch(c){this._close(c)}}r&&this.dispatchStatus({type:Le.Update,data:r}),void 0!==t.ldm&&t.ldm&&this.dispatchStatus({type:Le.LDM,data:this.servers.getCurrentServer().toString()})}push(e){switch(e.kind){case ve.MSG:{const{msg:t,data:r}=e;this.processMsg(t,r);break}case ve.OK:break;case ve.ERR:this.processError(e.data);break;case ve.PING:this.processPing();break;case ve.PONG:this.processPong();break;case ve.INFO:this.processInfo(e.data)}}sendCommand(e,...t){const r=this.outbound.length();let n;n="string"==typeof e?Me(e):e,this.outbound.fill(n,...t),0===r?queueMicrotask(()=>{this.flushPending()}):this.outbound.size()>=this.pendingLimit&&this.flushPending()}publish(e,t=re,r){let n;if(t instanceof Uint8Array)n=t;else{if("string"!=typeof t)throw $.errorForCode(M.BadPayload);n=he.encode(t)}let i=n.length;(r=r||{}).reply=r.reply||"";let f,o=re,c=0;if(r.headers){if(this.info&&!this.info.headers)throw new $("headers",M.ServerOptionNotAvailable);o=r.headers.encode(),c=o.length,i=n.length+c}if(this.info&&i>this.info.max_payload)throw $.errorForCode(M.MaxPayloadExceeded);this.outBytes+=i,this.outMsgs++,r.headers?(f=r.reply?`HPUB ${e} ${r.reply} ${c} ${i}\r\n`:`HPUB ${e} ${c} ${i}\r\n`,this.sendCommand(f,o,n,Qt)):(f=r.reply?`PUB ${e} ${r.reply} ${i}\r\n`:`PUB ${e} ${i}\r\n`,this.sendCommand(f,n,Qt))}request(e){return this.initMux(),this.muxSubscriptions.add(e),e}subscribe(e){return this.subscriptions.add(e),this._subunsub(e),e}_sub(e){this.sendCommand(e.queue?`SUB ${e.subject} ${e.queue} ${e.sid}\r\n`:`SUB ${e.subject} ${e.sid}\r\n`)}_subunsub(e){return this._sub(e),e.max&&this.unsubscribe(e,e.max),e}unsubscribe(e,t){this.unsub(e,t),(void 0===e.max||e.received>=e.max)&&this.subscriptions.cancel(e)}unsub(e,t){!e||this.isClosed()||(this.sendCommand(t?`UNSUB ${e.sid} ${t}\r\n`:`UNSUB ${e.sid}\r\n`),e.max=t)}resub(e,t){!e||this.isClosed()||(e.subject=t,this.subscriptions.resub(e),this._sub(e))}flush(e){return e||(e=F()),this.pongs.push(e),this.outbound.fill(Ps),this.flushPending(),e}sendSubscriptions(){const e=[];this.subscriptions.all().forEach(t=>{e.push(t.queue?`SUB ${t.subject} ${t.queue} ${t.sid}\r\n`:`SUB ${t.subject} ${t.sid}\r\n`)}),e.length&&this.transport.send(Me(e.join("")))}_close(e){var t=this;return(0,j.Z)(function*(){t._closed||(t.heartbeats.cancel(),t.connectError&&(t.connectError(e),t.connectError=void 0),t.muxSubscriptions.close(),t.subscriptions.close(),t.listeners.forEach(r=>{r.stop()}),t._closed=!0,yield t.transport.close(e),yield t.closed.resolve(e))})()}close(){return this._close()}isClosed(){return this._closed}drain(){var e=this;const t=this.subscriptions.all(),r=[];return t.forEach(n=>{r.push(n.drain())}),Promise.all(r).then((0,j.Z)(function*(){return e.noMorePublishing=!0,yield e.flush(),e.close()})).catch(()=>{})}flushPending(){if(this.infoReceived&&this.connected&&this.outbound.size()){const e=this.outbound.drain();this.transport.send(e)}}initMux(){if(!this.subscriptions.getMux()){const t=this.muxSubscriptions.init(this.options.inboxPrefix),r=new As(this,`${t}*`);r.callback=this.muxSubscriptions.dispatcher(),this.subscriptions.setMux(r),this.subscribe(r)}}selectServer(){const e=this.servers.selectServer();if(void 0!==e)return this.server=e,this.server}getServer(){return this.server}}class ks{token;received;ctx;requestSubject;mux;constructor(e,t){this.mux=e,this.requestSubject=t,this.received=0,this.token=Qe.next(),this.ctx=new Error}}class li extends ks{callback;done;timer;max;opts;constructor(e,t,r={maxWait:1e3}){if(super(e,t),this.opts=r,"function"!=typeof this.opts.callback)throw new Error("callback is required");this.callback=this.opts.callback,this.max="number"==typeof r.maxMessages&&r.maxMessages>0?r.maxMessages:-1,this.done=F(),this.done.then(()=>{this.callback(null,null)}),this.timer=setTimeout(()=>{this.cancel()},r.maxWait)}cancel(e){e&&this.callback(e,null),clearTimeout(this.timer),this.mux.cancel(this),this.done.resolve()}resolver(e,t){e?(e.stack+=`\n\n${this.ctx.stack}`,this.cancel(e)):(this.callback(null,t),this.opts.strategy===Te.Count&&(this.max--,0===this.max&&this.cancel()),this.opts.strategy===Te.JitterTimer&&(clearTimeout(this.timer),this.timer=setTimeout(()=>{this.cancel()},this.opts.jitter||300)),this.opts.strategy===Te.SentinelMsg&&t&&0===t.data.length&&this.cancel())}}class js extends ks{deferred;timer;constructor(e,t,r={timeout:1e3}){super(e,t),this.deferred=F(),this.timer=de(r.timeout)}resolver(e,t){this.timer&&this.timer.cancel(),e?(e.stack+=`\n\n${this.ctx.stack}`,this.deferred.reject(e)):this.deferred.resolve(t),this.cancel()}cancel(e){this.timer&&this.timer.cancel(),this.mux.cancel(this),this.deferred.reject(e||$.errorForCode(M.Cancelled))}}function ft(s){return Tr("durable",s)}function Se(s){return Tr("stream",s)}function Tr(s,e=""){if(""===e)throw Error(`${s} name required`);return[".","*",">","/","\\"," ","\t","\n","\r"].forEach(r=>{if(-1!==e.indexOf(r)){switch(r){case"\n":r="\\n";break;case"\r":r="\\r";break;case"\t":r="\\t"}throw Error(`invalid ${s} name - ${s} name cannot contain '${r}'`)}}),""}function Ct(s,e=""){if(""===e)throw Error(`${s} name required`);const t=function hi(s=""){if(""===s)throw Error("name required");const e=/^[-\w]+$/g;if(null===s.match(e))for(const r of s.split(""))if(null===r.match(e))return`cannot contain '${r}'`;return""}(e);if(t.length)throw new Error(`invalid ${s} name - ${s} name ${t}`)}function se(s){return 1e6*s}function Nr(s){return Math.floor(s/1e6)}function Rr(s){if(s.data.length>0)return!1;const e=s.headers;return!!e&&e.code>=100&&e.code<200}function $r(s){return Rr(s)&&"Idle Heartbeat"===s.headers?.description}function dt(s){if(0!==s.data.length)return null;const e=s.headers;return e?Os(e.code,e.description):null}var Oe=function(s){return s.MaxBatchExceeded="exceeded maxrequestbatch of",s.MaxExpiresExceeded="exceeded maxrequestexpires of",s.MaxBytesExceeded="exceeded maxrequestmaxbytes of",s.MaxMessageSizeExceeded="message size exceeds maxbytes",s.PushConsumer="consumer is push based",s.MaxWaitingExceeded="exceeded maxwaiting",s.IdleHeartbeatMissed="idle heartbeats missed",s.ConsumerDeleted="consumer deleted",s}(Oe||{});let di=!1;function Os(s,e=""){if(s<300)return null;switch(e=e.toLowerCase(),s){case 404:return new $(e,M.JetStream404NoMessages);case 408:return new $(e,M.JetStream408RequestTimeout);case 409:{const t=e.startsWith(Oe.IdleHeartbeatMissed)?M.JetStreamIdleHeartBeat:M.JetStream409;return new $(e,t)}case 503:return $.errorForCode(M.JetStreamNotEnabled,new Error(e));default:return""===e&&(e=M.Unknown),new $(e,`${s}`)}}class It{nc;opts;prefix;timeout;jc;constructor(e,t){this.nc=e,this.opts=function bi(s){return(s=s||{}).domain&&(s.apiPrefix=`$JS.${s.domain}.API`,delete s.domain),L({apiPrefix:"$JS.API",timeout:5e3},s)}(t),this._parseOpts(),this.prefix=this.opts.apiPrefix,this.timeout=this.opts.timeout,this.jc=Ae()}getOptions(){return Object.assign({},this.opts)}_parseOpts(){let e=this.opts.apiPrefix;if(!e||0===e.length)throw new Error("invalid empty prefix");"."===e[e.length-1]&&(e=e.substr(0,e.length-1)),this.opts.apiPrefix=e}_request(e,t=null,r){var n=this;return(0,j.Z)(function*(){(r=r||{}).timeout=n.timeout;let i=re;t&&(i=n.jc.encode(t));const o=yield n.nc.request(e,i,r);return n.parseJsResponse(o)})()}findStream(e){var t=this;return(0,j.Z)(function*(){const r={subject:e},i=yield t._request(`${t.prefix}.STREAM.NAMES`,r);if(!i.streams||1!==i.streams.length)throw new Error("no stream matches subject");return i.streams[0]})()}getConnection(){return this.nc}parseJsResponse(e){const t=this.jc.decode(e.data),r=t;if(r.error){const n=Os(r.error.code,r.error.description);if(null!==n)throw n.api_error=r.error,n}return t}}class gi{static encode(e){if("string"==typeof e)return btoa(e);const t=Array.from(e);return btoa(String.fromCharCode(...t))}static decode(e,t=!1){const r=atob(e);return t?Uint8Array.from(r,n=>n.charCodeAt(0)):r}}class Mt{static encode(e){return Mt.toB64URLEncoding(gi.encode(e))}static decode(e,t=!1){return Mt.decode(Mt.fromB64URLEncoding(e),t)}static toB64URLEncoding(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}static fromB64URLEncoding(e){return e.replace(/_/g,"/").replace(/-/g,"+")}}var Cs=function(s){return s.Limits="limits",s.Interest="interest",s.Workqueue="workqueue",s}(Cs||{}),ir=function(s){return s.Old="old",s.New="new",s}(ir||{}),Is=function(s){return s.File="file",s.Memory="memory",s}(Is||{}),fe=function(s){return s.All="all",s.Last="last",s.New="new",s.StartSequence="by_start_sequence",s.StartTime="by_start_time",s.LastPerSubject="last_per_subject",s}(fe||{}),ye=function(s){return s.None="none",s.All="all",s.Explicit="explicit",s.NotSet="",s}(ye||{}),Tt=function(s){return s.Instant="instant",s.Original="original",s}(Tt||{}),Ur=function(s){return s.CreateOrUpdate="",s.Update="update",s.Create="create",s}(Ur||{}),Ee=function(s){return s.StreamSourceHdr="Nats-Stream-Source",s.LastConsumerSeqHdr="Nats-Last-Consumer",s.LastStreamSeqHdr="Nats-Last-Stream",s.ConsumerStalledHdr="Nats-Consumer-Stalled",s.MessageSizeHdr="Nats-Msg-Size",s.RollupHdr="Nats-Rollup",s.RollupValueSubject="sub",s.RollupValueAll="all",s.PendingMessagesHdr="Nats-Pending-Messages",s.PendingBytesHdr="Nats-Pending-Bytes",s}(Ee||{}),De=function(s){return s.LastValue="",s.AllHistory="history",s.UpdatesOnly="updates",s}(De||{}),Nt=function(s){return s.Stream="Nats-Stream",s.Sequence="Nats-Sequence",s.TimeStamp="Nats-Time-Stamp",s.Subject="Nats-Subject",s}(Nt||{});const Ce="KV_";class vi{config;ordered;mack;stream;callbackFn;max;qname;isBind;filters;constructor(e){this.stream="",this.mack=!1,this.ordered=!1,this.config=function _i(s,e={}){return Object.assign({name:s,deliver_policy:fe.All,ack_policy:ye.Explicit,ack_wait:se(3e4),replay_policy:Tt.Instant},e)}("",e||{})}getOpts(){const e={};if(e.config=Object.assign({},this.config),e.config.filter_subject&&(this.filterSubject(e.config.filter_subject),e.config.filter_subject=void 0),e.config.filter_subjects&&(e.config.filter_subjects?.forEach(t=>{this.filterSubject(t)}),e.config.filter_subjects=void 0),e.mack=this.mack,e.stream=this.stream,e.callbackFn=this.callbackFn,e.max=this.max,e.queue=this.qname,e.ordered=this.ordered,e.config.ack_policy=e.ordered?ye.None:e.config.ack_policy,e.isBind=e.isBind||!1,this.filters)switch(this.filters.length){case 0:break;case 1:e.config.filter_subject=this.filters[0];break;default:e.config.filter_subjects=this.filters}return e}description(e){return this.config.description=e,this}deliverTo(e){return this.config.deliver_subject=e,this}durable(e){return ft(e),this.config.durable_name=e,this}startSequence(e){if(e<=0)throw new Error("sequence must be greater than 0");return this.config.deliver_policy=fe.StartSequence,this.config.opt_start_seq=e,this}startTime(e){return this.config.deliver_policy=fe.StartTime,this.config.opt_start_time=e.toISOString(),this}deliverAll(){return this.config.deliver_policy=fe.All,this}deliverLastPerSubject(){return this.config.deliver_policy=fe.LastPerSubject,this}deliverLast(){return this.config.deliver_policy=fe.Last,this}deliverNew(){return this.config.deliver_policy=fe.New,this}startAtTimeDelta(e){return this.startTime(new Date(Date.now()-e)),this}headersOnly(){return this.config.headers_only=!0,this}ackNone(){return this.config.ack_policy=ye.None,this}ackAll(){return this.config.ack_policy=ye.All,this}ackExplicit(){return this.config.ack_policy=ye.Explicit,this}ackWait(e){return this.config.ack_wait=se(e),this}maxDeliver(e){return this.config.max_deliver=e,this}filterSubject(e){return this.filters=this.filters||[],this.filters.push(e),this}replayInstantly(){return this.config.replay_policy=Tt.Instant,this}replayOriginal(){return this.config.replay_policy=Tt.Original,this}sample(e){if((e=Math.trunc(e))<0||e>100)throw new Error("value must be between 0-100");return this.config.sample_freq=`${e}%`,this}limit(e){return this.config.rate_limit_bps=e,this}maxWaiting(e){return this.config.max_waiting=e,this}maxAckPending(e){return this.config.max_ack_pending=e,this}idleHeartbeat(e){return this.config.idle_heartbeat=se(e),this}flowControl(){return this.config.flow_control=!0,this}deliverGroup(e){return this.queue(e),this}manualAck(){return this.mack=!0,this}maxMessages(e){return this.max=e,this}callback(e){return this.callbackFn=e,this}queue(e){return this.qname=e,this.config.deliver_group=e,this}orderedConsumer(){return this.ordered=!0,this}bind(e,t){return this.stream=e,this.config.durable_name=t,this.isBind=!0,this}bindStream(e){return this.stream=e,this}inactiveEphemeralThreshold(e){return this.config.inactive_threshold=se(e),this}maxPullBatch(e){return this.config.max_batch=e,this}maxPullRequestExpires(e){return this.config.max_expires=se(e),this}memory(){return this.config.mem_storage=!0,this}numReplicas(e){return this.config.num_replicas=e,this}}function rt(s){return new vi(s)}function Ms(s){return"function"==typeof s.getOpts}function Ts(s){const e=s.length;let t=s.indexOf("=");return-1===t&&(t=e),[t,t===e?0:4-t%4]}const Ns=[],Rs=[],qr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";for(let s=0,e=64;s<e;++s)Ns[s]=qr[s],Rs[qr.charCodeAt(s)]=s;const{toUint8Array:Ei,fromUint8Array:Pi}=function Si(s,e,t=!1){function r(o,c){return Math.floor(3*(o+c)/4-c)}function n(o){return s[o>>18&63]+s[o>>12&63]+s[o>>6&63]+s[63&o]}function i(o,c,f){const d=new Array((f-c)/3);for(let g=c,p=0;g<f;g+=3)d[p++]=n((o[g]<<16)+(o[g+1]<<8)+o[g+2]);return d.join("")}return{byteLength:o=>r.apply(null,Ts(o)),toUint8Array(o){const[c,f]=Ts(o),d=new Uint8Array(r(c,f)),g=f?c-4:c;let p,S,w=0;for(S=0;S<g;S+=4)p=e[o.charCodeAt(S)]<<18|e[o.charCodeAt(S+1)]<<12|e[o.charCodeAt(S+2)]<<6|e[o.charCodeAt(S+3)],d[w++]=p>>16&255,d[w++]=p>>8&255,d[w++]=255&p;return 2===f?(p=e[o.charCodeAt(S)]<<2|e[o.charCodeAt(S+1)]>>4,d[w++]=255&p):1===f&&(p=e[o.charCodeAt(S)]<<10|e[o.charCodeAt(S+1)]<<4|e[o.charCodeAt(S+2)]>>2,d[w++]=p>>8&255,d[w++]=255&p),d},fromUint8Array(o){const f=o.length,d=f%3,g=f-d,p=new Array(Math.ceil(g/16383)+(d?1:0));let S,k,w=0;for(let C=0;C<g;C+=16383)S=C+16383,p[w++]=i(o,C,S>g?g:S);return 1===d?(k=o[g],p[w]=s[k>>2]+s[k<<4&63],t||(p[w]+="==")):2===d&&(k=o[g]<<8|255&o[g+1],p[w]=s[k>>10]+s[k>>4&63]+s[k<<2&63],t||(p[w]+="=")),p.join("")}}}(Ns,Rs,!0),Ai=new TextDecoder,ki=new TextEncoder;class $s{hashSize=32;_buf;_bufIdx;_count;_K;_H;_finalized;constructor(){this._buf=new Uint8Array(64),this._K=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),this.init()}init(){return this._H=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),this._bufIdx=0,this._count=new Uint32Array(2),this._buf.fill(0),this._finalized=!1,this}update(e,t){if(null===e)throw new TypeError("msg must be a string or Uint8Array.");"string"==typeof e&&(e=function Ii(s,e="utf8"){if(/^utf-?8$/i.test(e))return ki.encode(s);if(/^base64$/i.test(e))return Ei(s);if(/^hex(?:adecimal)?$/i.test(e))return function Oi(s){const e=s.length;if(e%2||!/^[0-9a-fA-F]+$/.test(s))throw new TypeError("Invalid hex string.");s=s.toLowerCase();const t=new Uint8Array(Math.floor(e/2)),r=e/2;for(let n=0;n<r;++n)t[n]=parseInt(s.substr(2*n,2),16);return t}(s);throw new TypeError("Unsupported string encoding.")}(e,t));for(let n=0,i=e.length;n<i;n++)this._buf[this._bufIdx++]=e[n],64===this._bufIdx&&(this._transform(),this._bufIdx=0);const r=this._count;return(r[0]+=e.length<<3)<e.length<<3&&r[1]++,r[1]+=e.length>>>29,this}digest(e){if(this._finalized)throw new Error("digest has already been called.");this._finalized=!0;const t=this._buf;let r=this._bufIdx;for(t[r++]=128;56!==r;)64===r&&(this._transform(),r=0),t[r++]=0;const n=this._count;t[56]=n[1]>>>24&255,t[57]=n[1]>>>16&255,t[58]=n[1]>>>8&255,t[59]=n[1]>>>0&255,t[60]=n[0]>>>24&255,t[61]=n[0]>>>16&255,t[62]=n[0]>>>8&255,t[63]=n[0]>>>0&255,this._transform();const i=new Uint8Array(32);for(let o=0;o<8;o++)i[0+(o<<2)]=this._H[o]>>>24&255,i[1+(o<<2)]=this._H[o]>>>16&255,i[2+(o<<2)]=this._H[o]>>>8&255,i[3+(o<<2)]=this._H[o]>>>0&255;return this.init(),e?function Ci(s,e="utf8"){if(/^utf-?8$/i.test(e))return Ai.decode(s);if(/^base64$/i.test(e))return Pi(s);if(/^hex(?:adecimal)?$/i.test(e))return function ji(s){return s.reduce((e,t)=>`${e}${t<16?"0":""}${t.toString(16)}`,"")}(s);throw new TypeError("Unsupported string encoding.")}(i,e):i}_transform(){const e=this._H;let t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],c=e[5],f=e[6],d=e[7];const g=new Uint32Array(16);let p;for(p=0;p<16;p++)g[p]=this._buf[3+(p<<2)]|this._buf[2+(p<<2)]<<8|this._buf[1+(p<<2)]<<16|this._buf[p<<2]<<24;for(p=0;p<64;p++){let w;if(p<16)w=g[p];else{let S=g[p+1&15],k=g[p+14&15];w=g[15&p]=(S>>>7^S>>>18^S>>>3^S<<25^S<<14)+(k>>>17^k>>>19^k>>>10^k<<15^k<<13)+g[15&p]+g[p+9&15]|0}w=w+d+(o>>>6^o>>>11^o>>>25^o<<26^o<<21^o<<7)+(f^o&(c^f))+this._K[p]|0,d=f,f=c,c=o,o=i+w,i=n,n=r,r=t,t=w+(r&n^i&(r^n))+(r>>>2^r>>>13^r>>>22^r<<30^r<<19^r<<10)|0}e[0]=e[0]+t|0,e[1]=e[1]+r|0,e[2]=e[2]+n|0,e[3]=e[3]+i|0,e[4]=e[4]+o|0,e[5]=e[5]+c|0,e[6]=e[6]+f|0,e[7]=e[7]+d|0}}class Rt{err;offset;pageInfo;subject;jsm;filter;payload;constructor(e,t,r,n){if(!e)throw new Error("subject is required");this.subject=e,this.jsm=r,this.offset=0,this.pageInfo={},this.filter=t,this.payload=n||{}}next(){var e=this;return(0,j.Z)(function*(){if(e.err)return[];if(e.pageInfo&&e.offset>=e.pageInfo.total)return[];const t={offset:e.offset};e.payload&&Object.assign(t,e.payload);try{const r=yield e.jsm._request(e.subject,t,{timeout:e.jsm.timeout});return e.pageInfo=r,e.offset+=e.countResponse(r),e.filter(r)}catch(r){throw e.err=r,r}})()}countResponse(e){switch(e?.type){case"io.nats.jetstream.api.v1.stream_names_response":case"io.nats.jetstream.api.v1.stream_list_response":return e.streams.length;case"io.nats.jetstream.api.v1.consumer_list_response":return e.consumers.length;default:return console.error(`jslister.ts: unknown API response for paged output: ${e?.type}`),e.streams?.length||0}return 0}[Symbol.asyncIterator](){var e=this;return we(function*(){let t=yield te(e.next());for(;t.length>0;){for(const r of t)yield r;t=yield te(e.next())}})()}}class Lr extends It{constructor(e,t){super(e,t)}add(e,t,r=Ur.Create){var n=this;return(0,j.Z)(function*(){if(Se(e),t.deliver_group&&t.flow_control)throw new Error("jetstream flow control is not supported with queue groups");if(t.deliver_group&&t.idle_heartbeat)throw new Error("jetstream idle heartbeat is not supported with queue groups");const i={};i.config=t,i.stream_name=e,i.action=r,i.config.durable_name&&ft(i.config.durable_name);const o=n.nc;let{min:c,ok:f}=o.features.get(K.JS_NEW_CONSUMER_CREATE_API);const d=""===t.name?void 0:t.name;if(d&&!f)throw new Error(`consumer 'name' requires server ${c}`);if(d)try{Tr("name",d)}catch(S){const k=S.message,C=k.indexOf("cannot contain");throw-1!==C?new Error(`consumer 'name' ${k.substring(C)}`):S}let g,p="";if(Array.isArray(t.filter_subjects)){const{min:S,ok:k}=o.features.get(K.JS_MULTIPLE_CONSUMER_FILTER);if(!k)throw new Error(`consumer 'filter_subjects' requires server ${S}`);f=!1}if(t.metadata){const{min:S,ok:k}=o.features.get(K.JS_STREAM_CONSUMER_METADATA);if(!k)throw new Error(`consumer 'metadata' requires server ${S}`)}if(f&&(p=t.name??t.durable_name??""),""!==p){let S=t.filter_subject??void 0;">"===S&&(S=void 0),g=void 0!==S?`${n.prefix}.CONSUMER.CREATE.${e}.${p}.${S}`:`${n.prefix}.CONSUMER.CREATE.${e}.${p}`}else g=t.durable_name?`${n.prefix}.CONSUMER.DURABLE.CREATE.${e}.${t.durable_name}`:`${n.prefix}.CONSUMER.CREATE.${e}`;return yield n._request(g,i)})()}update(e,t,r){var n=this;return(0,j.Z)(function*(){const i=yield n.info(e,t);return n.add(e,Object.assign(i.config,r),Ur.Update)})()}info(e,t){var r=this;return(0,j.Z)(function*(){return Se(e),ft(t),yield r._request(`${r.prefix}.CONSUMER.INFO.${e}.${t}`)})()}delete(e,t){var r=this;return(0,j.Z)(function*(){return Se(e),ft(t),(yield r._request(`${r.prefix}.CONSUMER.DELETE.${e}.${t}`)).success})()}list(e){return Se(e),new Rt(`${this.prefix}.CONSUMER.LIST.${e}`,n=>n.consumers,this)}}const Us=Uint8Array.of(43,65,67,75),Mi=Uint8Array.of(45,78,65,75),$t=Uint8Array.of(43,87,80,73),Ti=Uint8Array.of(43,78,88,84),Ni=Uint8Array.of(43,84,69,82,77),Ri=Uint8Array.of(32);function Ut(s){return new Ui(s)}class Ui{msg;di;didAck;constructor(e){this.msg=e,this.didAck=!1}get subject(){return this.msg.subject}get sid(){return this.msg.sid}get data(){return this.msg.data}get headers(){return this.msg.headers}get info(){return this.di||(this.di=function $i(s){const e=s.split(".");if(9===e.length&&e.splice(2,0,"_",""),e.length<11||"$JS"!==e[0]||"ACK"!==e[1])throw new Error("not js message");const t={};return t.domain="_"===e[2]?"":e[2],t.account_hash=e[3],t.stream=e[4],t.consumer=e[5],t.redeliveryCount=parseInt(e[6],10),t.redelivered=t.redeliveryCount>1,t.streamSequence=parseInt(e[7],10),t.deliverySequence=parseInt(e[8],10),t.timestampNanos=parseInt(e[9],10),t.pending=parseInt(e[10],10),t}(this.reply)),this.di}get redelivered(){return this.info.redeliveryCount>1}get reply(){return this.msg.reply||""}get seq(){return this.info.streamSequence}doAck(e){this.didAck||(this.didAck=!this.isWIP(e),this.msg.respond(e))}isWIP(e){return 4===e.length&&e[0]===$t[0]&&e[1]===$t[1]&&e[2]===$t[2]&&e[3]===$t[3]}ackAck(){var e=this;return(0,j.Z)(function*(){if(!e.didAck&&(e.didAck=!0,e.msg.reply)){const r=e.msg.publisher,n=new js(r.muxSubscriptions,e.msg.reply);r.request(n);try{r.publish(e.msg.reply,Us,{reply:`${r.muxSubscriptions.baseInbox}${n.token}`})}catch(i){n.cancel(i)}try{return yield Promise.race([n.timer,n.deferred]),!0}catch(i){n.cancel(i)}}return!1})()}ack(){this.doAck(Us)}nak(e){let t=Mi;e&&(t=function Cn(){return{encode:s=>he.encode(s),decode:s=>ce.decode(s)}}().encode(`-NAK ${JSON.stringify({delay:se(e)})}`)),this.doAck(t)}working(){this.doAck($t)}next(e,t={batch:1}){const r={};r.batch=t.batch||1,r.no_wait=t.no_wait||!1,t.expires&&t.expires>0&&(r.expires=se(t.expires));const n=Ae().encode(r),i=ge.concat(Ti,Ri,n);this.msg.respond(i,e?{reply:e}:void 0)}term(){this.doAck(Ni)}json(){return this.msg.json()}string(){return this.msg.string()}}function mt(s,e,t=!1){if(!0===t&&!s)throw $.errorForCode(M.ApiError,new Error(`${e} is not a function`));if(s&&"function"!=typeof s)throw $.errorForCode(M.ApiError,new Error(`${e} is not a function`))}class qi extends _e{sub;adapter;subIterDone;constructor(e,t,r){var n;super(),n=this,mt(r.adapter,"adapter",!0),this.adapter=r.adapter,r.callback&&mt(r.callback,"callback"),this.noIterator="function"==typeof r.callback,r.ingestionFilterFn&&(mt(r.ingestionFilterFn,"ingestionFilterFn"),this.ingestionFilterFn=r.ingestionFilterFn),r.protocolFilterFn&&(mt(r.protocolFilterFn,"protocolFilterFn"),this.protocolFilterFn=r.protocolFilterFn),r.dispatchedFn&&(mt(r.dispatchedFn,"dispatchedFn"),this.dispatchedFn=r.dispatchedFn),r.cleanupFn&&mt(r.cleanupFn,"cleanupFn");let i=(g,p)=>{this.callback(g,p)};if(r.callback){const g=r.callback;i=(p,w)=>{const[S,k]=this.adapter(p,w);if(S)return void g(S,null);const{ingest:C}=this.ingestionFilterFn?this.ingestionFilterFn(k,this):{ingest:!0};C&&(!this.protocolFilterFn||this.protocolFilterFn(k))&&(g(S,k),this.dispatchedFn&&k&&this.dispatchedFn(k))}}const{max:o,queue:c,timeout:f}=r,d={queue:c,timeout:f,callback:i};var g;o&&o>0&&(d.max=o),this.sub=e.subscribe(t,d),r.cleanupFn&&(this.sub.cleanupFn=r.cleanupFn),this.noIterator||this.iterClosed.then(()=>{this.unsubscribe()}),this.subIterDone=F(),Promise.all([this.sub.closed,this.iterClosed]).then(()=>{this.subIterDone.resolve()}).catch(()=>{this.subIterDone.resolve()}),(g=(0,j.Z)(function*(p){yield p.closed,n.stop()}),function(p){return g.apply(this,arguments)})(this.sub).then().catch()}unsubscribe(e){this.sub.unsubscribe(e)}drain(){return this.sub.drain()}isDraining(){return this.sub.isDraining()}isClosed(){return this.sub.isClosed()}callback(e,t){this.sub.cancelTimeout();const[r,n]=this.adapter(e,t);r&&this.stop(r),n&&this.push(n)}getSubject(){return this.sub.getSubject()}getReceived(){return this.sub.getReceived()}getProcessed(){return this.sub.getProcessed()}getPending(){return this.sub.getPending()}getID(){return this.sub.getID()}getMax(){return this.sub.getMax()}get closed(){return this.sub.closed}}class Fr{interval;maxOut;cancelAfter;timer;autoCancelTimer;last;missed;count;callback;constructor(e,t,r={maxOut:2}){this.interval=e,this.maxOut=r?.maxOut||2,this.cancelAfter=r?.cancelAfter||0,this.last=Date.now(),this.missed=0,this.count=0,this.callback=t,this._schedule()}cancel(){this.autoCancelTimer&&clearTimeout(this.autoCancelTimer),this.timer&&clearInterval(this.timer),this.timer=0,this.autoCancelTimer=0}work(){this.last=Date.now(),this.missed=0}_change(e,t=0,r=2){this.interval=e,this.maxOut=r,this.cancelAfter=t,this.restart()}restart(){this.cancel(),this._schedule()}_schedule(){this.cancelAfter>0&&(this.autoCancelTimer=setTimeout(()=>{this.cancel()},this.cancelAfter)),this.timer=setInterval(()=>{if(this.count++,Date.now()-this.last>this.interval&&this.missed++,this.missed>=this.maxOut)try{!0===this.callback(this.missed)&&this.cancel()}catch(e){console.log(e)}},this.interval)}}var Ke,ze=function(s){return s[s.Unset=-1]="Unset",s[s.Consume=0]="Consume",s[s.Fetch=1]="Fetch",s}(ze||{}),Br=function(s){return s.HeartbeatsMissed="heartbeats_missed",s}(Br||{}),or=function(s){return s.DebugEvent="debug",s.Discard="discard",s.Next="next",s}(or||{});class Dr extends _e{consumer;opts;sub;monitor;pending;inbox;refilling;stack;pong;callback;timeout;cleanupHandler;listeners;statusIterator;constructor(e,t,r=!1){var n;super(),n=this,this.consumer=e,this.opts=this.parseOptions(t,r),this.callback=t.callback||null,this.noIterator="function"==typeof this.callback,this.monitor=null,this.pong=null,this.pending={msgs:0,bytes:0,requests:0},this.refilling=r,this.stack=(new Error).stack.split("\n").slice(1).join("\n"),this.timeout=null,this.inbox=v(e.api.nc.options.inboxPrefix),this.listeners=[];const{max_messages:i,max_bytes:o,idle_heartbeat:c,threshold_bytes:f,threshold_messages:d}=this.opts;this.closed().then(()=>{if(this.cleanupHandler)try{this.cleanupHandler()}catch{}});const{sub:g}=this;g&&g.unsubscribe(),this.sub=e.api.nc.subscribe(this.inbox,{callback:(p,w)=>{if(p)this.stop();else{if(this.monitor?.work(),w.subject===this.inbox){if($r(w))return;const k=w.headers?.code,C=w.headers?.description?.toLowerCase()||"unknown",{msgsLeft:V,bytesLeft:D}=this.parseDiscard(w.headers);if(V>0||D>0)this.pending.msgs-=V,this.pending.bytes-=D,this.pending.requests--,this.notify(or.Discard,{msgsLeft:V,bytesLeft:D});else{const pe=()=>{const be=new $(C,`${k}`);return be.stack+=`\n\n${this.stack}`,be};if(400===k){const be=pe();this._push(()=>{this.stop(be)})}else if(409===k&&"consumer deleted"===C){const be=pe();this.stop(be)}else this.notify(or.DebugEvent,`${k} ${C}`)}}else this._push(Ut(w)),this.received++,this.pending.msgs&&this.pending.msgs--,this.pending.bytes&&(this.pending.bytes-=w.size());if(0===this.pending.msgs&&0===this.pending.bytes&&(this.pending.requests=0),this.refilling){if(i&&this.pending.msgs<=d||o&&this.pending.bytes<=f){const k=this.pullOptions();this.pull(k)}}else 0===this.pending.requests&&this._push(()=>{this.stop()})}}}),this.sub.closed.then(()=>{this.sub.draining&&this._push(()=>{this.stop()})}),c&&(this.monitor=new Fr(c,p=>(this.notify(Br.HeartbeatsMissed,p),this.resetPending().then(()=>{}).catch(()=>{}),!1),{maxOut:2})),(0,j.Z)(function*(){const p=e.api.nc.status();n.statusIterator=p;var k,w=!1,S=!1;try{for(var V,C=(0,H.Z)(p);w=!(V=yield C.next()).done;w=!1)switch(V.value.type){case Le.Disconnect:n.monitor?.cancel();break;case Le.Reconnect:n.resetPending().then(pe=>{pe&&n.monitor?.restart()}).catch(()=>{})}}catch(D){S=!0,k=D}finally{try{w&&null!=C.return&&(yield C.return())}finally{if(S)throw k}}})(),this.pull(this.pullOptions())}_push(e){if(this.callback){const t="function"==typeof e?e:null;try{t?t():this.callback(e)}catch(r){this.stop(r)}}else super.push(e)}notify(e,t){this.listeners.length>0&&this.listeners.forEach(r=>{r.done||r.push({type:e,data:t})})}resetPending(){return this.consumer.info().then(e=>(this.pending.msgs=0,this.pending.bytes=0,this.pending.requests=0,this.pull(this.pullOptions()),!0)).catch(e=>("consumer not found"===e.message&&this.stop(e),!1))}pull(e){this.pending.bytes+=e.max_bytes??0,this.pending.msgs+=e.batch??0,this.pending.requests++;const t=this.consumer.api.nc;this._push(()=>{t.publish(`${this.consumer.api.prefix}.CONSUMER.MSG.NEXT.${this.consumer.stream}.${this.consumer.name}`,this.consumer.api.jc.encode(e),{reply:this.inbox}),this.notify(or.Next,e)})}pullOptions(){return{batch:this.opts.max_messages-this.pending.msgs,max_bytes:this.opts.max_bytes-this.pending.bytes,idle_heartbeat:se(this.opts.idle_heartbeat),expires:se(this.opts.expires)}}parseDiscard(e){const t={msgsLeft:0,bytesLeft:0},r=e?.get(Ee.PendingMessagesHdr);r&&(t.msgsLeft=parseInt(r));const n=e?.get(Ee.PendingBytesHdr);return n&&(t.bytesLeft=parseInt(n)),t}trackTimeout(e){this.timeout=e}close(){return this.stop(),this.iterClosed}closed(){return this.iterClosed}clearTimers(){this.monitor?.cancel(),this.monitor=null,this.timeout?.cancel(),this.timeout=null}setCleanupHandler(e){this.cleanupHandler=e}stop(e){this.sub?.unsubscribe(),this.clearTimers(),this.statusIterator?.stop(),this._push(()=>{super.stop(e),this.listeners.forEach(t=>{t.stop()})})}parseOptions(e,t=!1){const r=e||{};if(r.max_messages=r.max_messages||0,r.max_bytes=r.max_bytes||0,0!==r.max_messages&&0!==r.max_bytes)throw new Error("only specify one of max_messages or max_bytes");if(0===r.max_messages&&(r.max_messages=100),r.expires=r.expires||3e4,r.expires<1e3)throw new Error("expires should be at least 1000ms");if(r.idle_heartbeat=r.idle_heartbeat||r.expires/2,r.idle_heartbeat=r.idle_heartbeat>3e4?3e4:r.idle_heartbeat,t){const n=Math.round(.75*r.max_messages)||1;r.threshold_messages=r.threshold_messages||n;const i=Math.round(.75*r.max_bytes)||1;r.threshold_bytes=r.threshold_bytes||i}return r}status(){const e=new _e;return this.listeners.push(e),Promise.resolve(e)}}class qs extends _e{src;constructor(){super()}setSource(e){this.src&&(this.src.setCleanupHandler(),this.src.stop()),this.src=e,this.src.setCleanupHandler(()=>{this.close().catch()})}stop(e){this.src?.stop(e),super.stop(e)}close(){return this.stop(),this.iterClosed}status(){return Promise.reject(new Error("ordered consumers don't report consumer status"))}}class Ls{api;_info;stream;name;constructor(e,t){this.api=e,this._info=t,this.stream=t.stream_name,this.name=t.name}consume(e={max_messages:100,expires:3e4}){return Promise.resolve(new Dr(this,e,!0))}fetch(e={max_messages:100,expires:3e4}){const t=new Dr(this,e,!1),n=de(Math.round(1.05*t.opts.expires));return t.closed().then(()=>{n.cancel()}),n.catch(()=>{t.close().catch()}),t.trackTimeout(n),Promise.resolve(t)}next(e={expires:3e4}){const t=F(),r=e;r.max_messages=1;const n=new Dr(this,r,!1),i=Math.round(1.05*n.opts.expires);i>=6e4&&(0,j.Z)(function*(){var d,c=!1,f=!1;try{for(var p,g=(0,H.Z)(yield n.status());c=!(p=yield g.next()).done;c=!1){const w=p.value;if(w.type===Br.HeartbeatsMissed&&w.data>=2){t.reject(new Error("consumer missed heartbeats"));break}}}catch(w){f=!0,d=w}finally{try{c&&null!=g.return&&(yield g.return())}finally{if(f)throw d}}})().catch(),(0,j.Z)(function*(){var d,c=!1,f=!1;try{for(var p,g=(0,H.Z)(n);c=!(p=yield g.next()).done;c=!1){t.resolve(p.value);break}}catch(w){f=!0,d=w}finally{try{c&&null!=g.return&&(yield g.return())}finally{if(f)throw d}}})().catch();const o=de(i);return n.closed().then(()=>{t.resolve(null),o.cancel()}).catch(c=>{t.reject(c)}),o.catch(c=>{t.resolve(null),n.close().catch()}),n.trackTimeout(o),t}delete(){const{stream_name:e,name:t}=this._info;return this.api.delete(e,t)}info(e=!1){if(e)return Promise.resolve(this._info);const{stream_name:t,name:r}=this._info;return this.api.info(t,r).then(n=>(this._info=n,this._info))}}class Li{api;consumerOpts;consumer;opts;cursor;stream;namePrefix;serial;currentConsumer;userCallback;iter;type;startSeq;constructor(e,t,r={}){this.api=e,this.stream=t,this.cursor={stream_seq:1,deliver_seq:0},this.namePrefix=Qe.next(),this.serial=0,this.currentConsumer=null,this.userCallback=null,this.iter=null,this.type=ze.Unset,this.consumerOpts=r,this.startSeq=this.consumerOpts.opt_start_seq||0,this.cursor.stream_seq=this.startSeq>0?this.startSeq-1:0}getConsumerOpts(e){this.serial++;const r={name:`${this.namePrefix}_${this.serial}`,deliver_policy:fe.StartSequence,opt_start_seq:e=0===e?1:e,ack_policy:ye.None,inactive_threshold:se(3e5),num_replicas:1};return!0===this.consumerOpts.headers_only&&(r.headers_only=!0),Array.isArray(this.consumerOpts.filterSubjects)&&(r.filter_subjects=this.consumerOpts.filterSubjects),"string"==typeof this.consumerOpts.filterSubjects&&(r.filter_subject=this.consumerOpts.filterSubjects),e===this.startSeq+1&&(r.deliver_policy=this.consumerOpts.deliver_policy||fe.StartSequence,(this.consumerOpts.deliver_policy===fe.LastPerSubject||this.consumerOpts.deliver_policy===fe.New||this.consumerOpts.deliver_policy===fe.Last)&&(delete r.opt_start_seq,r.deliver_policy=this.consumerOpts.deliver_policy),r.deliver_policy===fe.LastPerSubject&&typeof r.filter_subjects>"u"&&typeof r.filter_subject>"u"&&(r.filter_subject=">"),this.consumerOpts.opt_start_time&&(delete r.opt_start_seq,r.deliver_policy=fe.StartTime,r.opt_start_time=this.consumerOpts.opt_start_time),this.consumerOpts.inactive_threshold&&(r.inactive_threshold=se(this.consumerOpts.inactive_threshold))),r}resetConsumer(e=0){var t=this;return(0,j.Z)(function*(){if(t.consumer)for(;;)try{yield t.delete();break}catch(i){if("TIMEOUT"!==i.message)throw i}e=0===e?1:e,t.cursor.deliver_seq=0;const r=t.getConsumerOpts(e);let n;for(r.max_deliver=1,r.mem_storage=!0;;)try{n=yield t.api.add(t.stream,r);break}catch(i){if("TIMEOUT"!==i.message)throw i}return n})()}internalHandler(e){return t=>{if(this.serial!==e)return;const r=t.info.deliverySequence;r===this.cursor.deliver_seq+1?(this.cursor.deliver_seq=r,this.cursor.stream_seq=t.info.streamSequence,this.userCallback?this.userCallback(t):this.iter?.push(t)):this.reset(this.opts)}}reset(e={max_messages:100,expires:3e4},t=!1){var r=this;return(0,j.Z)(function*(){r.currentConsumer=yield r.resetConsumer(r.cursor.stream_seq+1),null===r.iter&&(r.iter=new qs),r.consumer=new Ls(r.api,r.currentConsumer),e.callback=r.internalHandler(r.serial);let i=null;if(r.type===ze.Fetch&&t)i=yield r.consumer.fetch(e);else{if(r.type!==ze.Consume)return Promise.reject("reset called with unset consumer type");i=yield r.consumer.consume(e)}return r.iter.setSource(i),r.iter})()}consume(e={max_messages:100,expires:3e4}){if(this.type===ze.Fetch)return Promise.reject(new Error("ordered consumer initialized as fetch"));if(this.type===ze.Consume)return Promise.reject(new Error("ordered consumer doesn't support concurrent consume"));const{callback:t}=e;return t&&(this.userCallback=t),this.type=ze.Consume,this.opts=e,this.reset(e)}fetch(e={max_messages:100,expires:3e4}){if(this.type===ze.Consume)return Promise.reject(new Error("ordered consumer already initialized as consume"));if(!1===this.iter?.done)return Promise.reject(new Error("ordered consumer doesn't support concurrent fetch"));const{callback:t}=e;return t&&(this.userCallback=t),this.type=ze.Fetch,this.opts=e,this.iter=new qs,this.reset(e,!0)}next(e={expires:3e4}){var t=this;return(0,j.Z)(function*(){const r=F(),n=e;return n.max_messages=1,n.callback=o=>{t.userCallback=null,r.resolve(o)},(yield t.fetch(n)).iterClosed.then(()=>{r.resolve(null)}).catch(o=>{r.reject(o)}),r})()}delete(){return this.currentConsumer?this.api.delete(this.stream,this.currentConsumer.name).then(e=>Promise.resolve(e)).catch(e=>Promise.reject(e)).finally(()=>{this.currentConsumer=null}):Promise.resolve(!1)}info(e){var t=this;return(0,j.Z)(function*(){return null==t.currentConsumer?(t.currentConsumer=yield t.resetConsumer(t.serial),Promise.resolve(t.currentConsumer)):e&&t.currentConsumer?Promise.resolve(t.currentConsumer):t.api.info(t.stream,t.currentConsumer.name)})()}}function ar(s){if(void 0===s)return;const{domain:e}=s;if(void 0===e)return s;const t=Object.assign({},s);if(delete t.domain,""===e)return t;if(t.external)throw new Error("domain and external are both set");return t.external={api:`$JS.${e}.API`},t}const Hr="OBJ_";class Fs{api;notified;constructor(e){this.api=e,this.notified=!1}checkVersion(){const e=this.api.nc.features.get(K.JS_SIMPLIFICATION);return e.ok?Promise.resolve():Promise.reject(new Error(`consumers framework is only supported on servers ${e.min} or better`))}get(e,t={}){var r=this;return(0,j.Z)(function*(){return"object"==typeof t?r.ordered(e,t):(yield r.checkVersion(),r.api.info(e,t).then(n=>void 0!==n.config.deliver_subject?Promise.reject(new Error("push consumer not supported")):new Ls(r.api,n)).catch(n=>Promise.reject(n)))})()}ordered(e,t){var r=this;return(0,j.Z)(function*(){yield r.checkVersion();const n=r.api;return new Jr(n.nc,n.opts).info(e).then(o=>Promise.resolve(new Li(r.api,e,t))).catch(o=>Promise.reject(o))})()}}class cr{api;_info;constructor(e,t){this.api=e,this._info=t}get name(){return this._info.config.name}alternates(){return this.info().then(e=>e.alternates?e.alternates:[])}best(){var e=this;return(0,j.Z)(function*(){if(yield e.info(),e._info.alternates){const t=yield e.api.info(e._info.alternates[0].name);return new cr(e.api,t)}return e})()}info(e=!1,t){return e?Promise.resolve(this._info):this.api.info(this.name,t).then(r=>(this._info=r,this._info))}getConsumer(e){return new Fs(new Lr(this.api.nc,this.api.opts)).get(this.name,e)}getMessage(e){return this.api.getMessage(this.name,e)}deleteMessage(e,t){return this.api.deleteMessage(this.name,e,t)}}const ur="KV-Operation",Bi=/^[-/=.\w]+$/,Di=/^[-/=.>*\w]+$/,Hi=/^[-\w]+$/;function Gi(s){if(s.startsWith(".")||s.endsWith(".")||!Bi.test(s))throw new Error(`invalid key: ${s}`)}function Ji(s){if(s.startsWith(".")||s.endsWith(".")||!Di.test(s))throw new Error(`invalid key: ${s}`)}function Zi(s){if(s.startsWith(".")||s.endsWith("."))throw new Error(`invalid key: ${s}`);const e=s.split(".");let t=!1;for(let r=0;r<e.length;r++)switch(e[r]){case"*":t=!0;break;case">":if(r!==e.length-1)throw new Error(`invalid key: ${s}`);t=!0}return t}function lr(s){if(!Hi.test(s))throw new Error(`invalid bucket name: ${s}`)}var s;(s=Ke||(Ke={})).MsgIdHdr="Nats-Msg-Id",s.ExpectedStreamHdr="Nats-Expected-Stream",s.ExpectedLastSeqHdr="Nats-Expected-Last-Sequence",s.ExpectedLastMsgIdHdr="Nats-Expected-Last-Msg-Id",s.ExpectedLastSubjectSequenceHdr="Nats-Expected-Last-Subject-Sequence";class qt{js;jsm;stream;bucket;direct;codec;prefix;editPrefix;useJsPrefix;_prefixLen;constructor(e,t,r){lr(e),this.js=t,this.jsm=r,this.bucket=e,this.prefix="$KV",this.editPrefix="",this.useJsPrefix=!1,this._prefixLen=0}static create(e,t,r={}){return(0,j.Z)(function*(){lr(t);const n=yield e.jetstreamManager(),i=new qt(t,e,n);return yield i.init(r),i})()}static bind(e,t,r={}){return(0,j.Z)(function*(){const n=yield e.jetstreamManager(),i=yield n.streams.info(`${Ce}${t}`);lr(i.config.name);const o=new qt(t,e,n);return Object.assign(o,i),o.codec=r.codec||{key:{encode:s=>s,decode:s=>s},value:{encode:s=>s,decode:s=>s}},o.direct=i.config.allow_direct??!1,o.initializePrefixes(i),o})()}init(e={}){var t=this;return(0,j.Z)(function*(){const r=Object.assign(function Fi(){return{replicas:1,history:1,timeout:2e3,maxBucketSize:-1,maxValueSize:-1,codec:{key:{encode:s=>s,decode:s=>s},value:{encode:s=>s,decode:s=>s}},storage:Is.File}}(),e);t.codec=r.codec;const n={};t.stream=n.name=e.streamName??t.bucketName(),n.retention=Cs.Limits,n.max_msgs_per_subject=r.history,r.maxBucketSize&&(r.max_bytes=r.maxBucketSize),r.max_bytes&&(n.max_bytes=r.max_bytes),n.max_msg_size=r.maxValueSize,n.storage=r.storage;const i=e.placementCluster??"";if(i&&(e.placement={},e.placement.cluster=i,e.placement.tags=[]),e.placement&&(n.placement=e.placement),e.republish&&(n.republish=e.republish),e.description&&(n.description=e.description),e.mirror){const w=Object.assign({},e.mirror);w.name.startsWith(Ce)||(w.name=`${Ce}${w.name}`),n.mirror=w,n.mirror_direct=!0}else if(e.sources){const w=e.sources.map(S=>{const k=Object.assign({},S);k.name.startsWith(Ce)||(k.name=`${Ce}${k.name}`)});n.sources=w}else n.subjects=[t.subjectForBucket()];e.metadata&&(n.metadata=e.metadata);const o=t.js.nc,c=o.getServerVersion(),f=!!c&&Ir(c,it("2.7.2"))>=0;n.discard=f?ir.New:ir.Old;const{ok:d,min:g}=o.features.get(K.JS_ALLOW_DIRECT);if(!d&&!0===e.allow_direct)return Promise.reject(new Error(`allow_direct is not available on server version ${c?`${c.major}.${c.minor}.${c.micro}`:"unknown"} - requires ${g}`));let p;e.allow_direct="boolean"==typeof e.allow_direct?e.allow_direct:d,n.allow_direct=e.allow_direct,t.direct=n.allow_direct,n.num_replicas=r.replicas,r.ttl&&(n.max_age=se(r.ttl)),n.allow_rollup_hdrs=!0;try{p=yield t.jsm.streams.info(n.name),!p.config.allow_direct&&!0===t.direct&&(t.direct=!1)}catch(w){if("stream not found"!==w.message)throw w;p=yield t.jsm.streams.add(n)}t.initializePrefixes(p)})()}initializePrefixes(e){this._prefixLen=0,this.prefix=`$KV.${this.bucket}`,this.useJsPrefix="$JS.API"!==this.js.apiPrefix;const{mirror:t}=e.config;if(t){let r=t.name;if(r.startsWith(Ce)&&(r=r.substring(3)),t.external&&""!==t.external.api){const n=t.name.substring(3);this.useJsPrefix=!1,this.prefix=`$KV.${n}`,this.editPrefix=`${t.external.api}.$KV.${r}`}else this.editPrefix=this.prefix}}bucketName(){return this.stream??`${Ce}${this.bucket}`}subjectForBucket(){return`${this.prefix}.${this.bucket}.>`}subjectForKey(e,t=!1){const r=[];return t?(this.useJsPrefix&&r.push(this.js.apiPrefix),r.push(""!==this.editPrefix?this.editPrefix:this.prefix)):this.prefix&&r.push(this.prefix),r.push(e),r.join(".")}fullKeyName(e){return""!==this.prefix?`${this.prefix}.${e}`:`$KV.${this.bucket}.${e}`}get prefixLen(){return 0===this._prefixLen&&(this._prefixLen=this.prefix.length+1),this._prefixLen}encodeKey(e){const t=[];for(const r of e.split("."))switch(r){case">":case"*":t.push(r);break;default:t.push(this.codec.key.encode(r))}return t.join(".")}decodeKey(e){const t=[];for(const r of e.split("."))switch(r){case">":case"*":t.push(r);break;default:t.push(this.codec.key.decode(r))}return t.join(".")}validateKey=Gi;validateSearchKey=Ji;hasWildcards=Zi;close(){return Promise.resolve()}dataLen(e,t){const r=t&&t.get(Ee.MessageSizeHdr)||"";return""!==r?parseInt(r,10):e.length}smToEntry(e){return new Yi(this.bucket,this.prefixLen,e)}jmToEntry(e){const t=this.decodeKey(e.subject.substring(this.prefixLen));return new Xi(this.bucket,t,e)}create(e,t){var r=this;return(0,j.Z)(function*(){let n;try{const o=yield r.put(e,t,{previousSeq:0});return Promise.resolve(o)}catch(o){if(n=o,10071!==o?.api_error?.err_code)return Promise.reject(o)}let i=0;try{const o=yield r.get(e);return"DEL"===o?.operation||"PURGE"===o?.operation?(i=null!==o?o.revision:0,r.update(e,t,i)):Promise.reject(n)}catch(o){return Promise.reject(o)}})()}update(e,t,r){if(r<=0)throw new Error("version must be greater than 0");return this.put(e,t,{previousSeq:r})}put(e,t,r={}){var n=this;return(0,j.Z)(function*(){const i=n.encodeKey(e);n.validateKey(i);const o={};if(void 0!==r.previousSeq){const c=Ze();o.headers=c,c.set(Ke.ExpectedLastSubjectSequenceHdr,`${r.previousSeq}`)}try{return(yield n.js.publish(n.subjectForKey(i,!0),t,o)).seq}catch(c){const f=c;return f.isJetStreamError()?(f.message=f.api_error?.description,f.code=`${f.api_error?.code}`,Promise.reject(f)):Promise.reject(c)}})()}get(e,t){var r=this;return(0,j.Z)(function*(){const n=r.encodeKey(e);r.validateKey(n);let o,i={last_by_subj:r.subjectForKey(n)};t&&t.revision>0&&(i={seq:t.revision});try{o=r.direct?yield r.jsm.direct.getMessage(r.bucketName(),i):yield r.jsm.streams.getMessage(r.bucketName(),i);const c=r.smToEntry(o);return c.key!==n?null:c}catch(c){if(c.code===M.JetStream404NoMessages)return null;throw c}})()}purge(e){return this._deleteOrPurge(e,"PURGE")}delete(e){return this._deleteOrPurge(e,"DEL")}purgeDeletes(e=18e5){var t=this;return(0,j.Z)(function*(){const r=F(),n=[],i=yield t.watch({key:">",initializedFn:()=>{r.resolve()}});(0,j.Z)(function*(){var p,d=!1,g=!1;try{for(var S,w=(0,H.Z)(i);d=!(S=yield w.next()).done;d=!1){const k=S.value;("DEL"===k.operation||"PURGE"===k.operation)&&n.push(k)}}catch(k){g=!0,p=k}finally{try{d&&null!=w.return&&(yield w.return())}finally{if(g)throw p}}})().then(),yield r,i.stop();const o=Date.now()-e,c=n.map(d=>{const g=t.subjectForKey(d.key);return d.created.getTime()>=o?t.jsm.streams.purge(t.stream,{filter:g,keep:1}):t.jsm.streams.purge(t.stream,{filter:g,keep:0})}),f=yield Promise.all(c);return f.unshift({success:!0,purged:0}),f.reduce((d,g)=>(d.purged+=g.purged,d))})()}_deleteOrPurge(e,t){var r=this;return(0,j.Z)(function*(){if(!r.hasWildcards(e))return r._doDeleteOrPurge(e,t);const n=yield r.keys(e),i=[];var f,o=!1,c=!1;try{for(var g,d=(0,H.Z)(n);o=!(g=yield d.next()).done;o=!1)i.push(r._doDeleteOrPurge(g.value,t)),100===i.length&&(yield Promise.all(i),i.length=0)}catch(p){c=!0,f=p}finally{try{o&&null!=d.return&&(yield d.return())}finally{if(c)throw f}}i.length>0&&(yield Promise.all(i))})()}_doDeleteOrPurge(e,t){var r=this;return(0,j.Z)(function*(){const n=r.encodeKey(e);r.validateKey(n);const i=Ze();i.set(ur,t),"PURGE"===t&&i.set(Ee.RollupHdr,Ee.RollupValueSubject),yield r.js.publish(r.subjectForKey(n,!0),re,{headers:i})})()}_buildCC(e,t,r={}){const n=this.encodeKey(e);this.validateSearchKey(e);let i=fe.LastPerSubject;return t===De.AllHistory&&(i=fe.All),t===De.UpdatesOnly&&(i=fe.New),Object.assign({deliver_policy:i,ack_policy:ye.None,filter_subject:this.fullKeyName(n),flow_control:!0,idle_heartbeat:se(5e3)},r)}remove(e){return this.purge(e)}history(e={}){var t=this;return(0,j.Z)(function*(){const r=e.key??">",n=new _e,i={};let o;i.headers_only=e.headers_only||!1,o=()=>{n.stop()};let c=0;const f=t._buildCC(r,De.AllHistory,i),d=f.filter_subject,g=rt(f);g.bindStream(t.stream),g.orderedConsumer(),g.callback((w,S)=>{if(w)n.stop(w);else if(S){const k=t.jmToEntry(S);n.push(k),n.received++,(o&&c>0&&n.received>=c||0===S.info.pending)&&(n.push(o),o=void 0)}});const p=yield t.js.subscribe(d,g);if(o){const{info:{last:w}}=p,S=w.num_pending+w.delivered.consumer_seq;if(0===S||n.received>=S)try{o()}catch(k){n.stop(k)}finally{o=void 0}else c=S}return n._data=p,n.iterClosed.then(()=>{p.unsubscribe()}),p.closed.then(()=>{n.stop()}).catch(w=>{n.stop(w)}),n})()}watch(e={}){var t=this;return(0,j.Z)(function*(){const r=e.key??">",n=new _e,i={};i.headers_only=e.headers_only||!1;let o=De.LastValue;e.include===De.AllHistory?o=De.AllHistory:e.include===De.UpdatesOnly&&(o=De.UpdatesOnly);const c=!0===e.ignoreDeletes;let f=e.initializedFn,d=0;const g=t._buildCC(r,o,i),p=g.filter_subject,w=rt(g);w.bindStream(t.stream),w.orderedConsumer(),w.callback((k,C)=>{if(k)n.stop(k);else if(C){const V=t.jmToEntry(C);if(c&&"DEL"===V.operation)return;n.push(V),n.received++,f&&(d>0&&n.received>=d||0===C.info.pending)&&(n.push(f),f=void 0)}});const S=yield t.js.subscribe(p,w);if(f){const{info:{last:k}}=S,C=k.num_pending+k.delivered.consumer_seq;if(0===C||n.received>=C)try{f()}catch(V){n.stop(V)}finally{f=void 0}else d=C}return n._data=S,n.iterClosed.then(()=>{S.unsubscribe()}),S.closed.then(()=>{n.stop()}).catch(k=>{n.stop(k)}),n})()}keys(e=">"){var t=this;return(0,j.Z)(function*(){const r=new _e,n=t._buildCC(e,De.LastValue,{headers_only:!0}),i=n.filter_subject,o=rt(n);o.bindStream(t.stream),o.orderedConsumer();const c=yield t.js.subscribe(i,o);return(0,j.Z)(function*(){var p,d=!1,g=!1;try{for(var S,w=(0,H.Z)(c);d=!(S=yield w.next()).done;d=!1){const k=S.value;{const C=k.headers?.get(ur);if("DEL"!==C&&"PURGE"!==C){const V=t.decodeKey(k.subject.substring(t.prefixLen));r.push(V)}0===k.info.pending&&c.unsubscribe()}}}catch(k){g=!0,p=k}finally{try{d&&null!=w.return&&(yield w.return())}finally{if(g)throw p}}})().then(()=>{r.stop()}).catch(d=>{r.stop(d)}),0===c.info.last.num_pending&&c.unsubscribe(),r})()}purgeBucket(e){return this.jsm.streams.purge(this.bucketName(),e)}destroy(){return this.jsm.streams.delete(this.bucketName())}status(){var e=this;return(0,j.Z)(function*(){const r=e.js.nc.info?.cluster??"",n=e.bucketName(),i=yield e.jsm.streams.info(n);return new Hs(i,r)})()}}class Hs{si;cluster;constructor(e,t=""){this.si=e,this.cluster=t}get bucket(){return this.si.config.name.startsWith(Ce)?this.si.config.name.substring(3):this.si.config.name}get values(){return this.si.state.messages}get history(){return this.si.config.max_msgs_per_subject}get ttl(){return Nr(this.si.config.max_age)}get bucket_location(){return this.cluster}get backingStore(){return this.si.config.storage}get storage(){return this.si.config.storage}get replicas(){return this.si.config.num_replicas}get description(){return this.si.config.description??""}get maxBucketSize(){return this.si.config.max_bytes}get maxValueSize(){return this.si.config.max_msg_size}get max_bytes(){return this.si.config.max_bytes}get placement(){return this.si.config.placement||{cluster:"",tags:[]}}get placementCluster(){return this.si.config.placement?.cluster??""}get republish(){return this.si.config.republish??{src:"",dest:""}}get streamInfo(){return this.si}get size(){return this.si.state.bytes}get metadata(){return this.si.config.metadata??{}}}const Gs="SHA-256=";class Gr{si;backingStore;constructor(e){this.si=e,this.backingStore="JetStream"}get bucket(){return function Ki(s){return s.startsWith(Hr)?s.substring(4):s}(this.si.config.name)}get description(){return this.si.config.description??""}get ttl(){return this.si.config.max_age}get storage(){return this.si.config.storage}get replicas(){return this.si.config.num_replicas}get sealed(){return this.si.config.sealed}get size(){return this.si.state.bytes}get streamInfo(){return this.si}get metadata(){return this.si.config.metadata}}class Jr extends It{constructor(e,t){super(e,t)}checkStreamConfigVersions(e){const t=this.nc;if(e.metadata){const{min:n,ok:i}=t.features.get(K.JS_STREAM_CONSUMER_METADATA);if(!i)throw new Error(`stream 'metadata' requires server ${n}`)}if(e.first_seq){const{min:n,ok:i}=t.features.get(K.JS_STREAM_FIRST_SEQ);if(!i)throw new Error(`stream 'first_seq' requires server ${n}`)}if(e.subject_transform){const{min:n,ok:i}=t.features.get(K.JS_STREAM_SUBJECT_TRANSFORM);if(!i)throw new Error(`stream 'subject_transform' requires server ${n}`)}if(e.compression){const{min:n,ok:i}=t.features.get(K.JS_STREAM_COMPRESSION);if(!i)throw new Error(`stream 'compression' requires server ${n}`)}if(e.consumer_limits){const{min:n,ok:i}=t.features.get(K.JS_DEFAULT_CONSUMER_LIMITS);if(!i)throw new Error(`stream 'consumer_limits' requires server ${n}`)}function r(n,i){if((i.subject_transforms?.length||0)>0){const{min:c,ok:f}=t.features.get(K.JS_STREAM_SOURCE_SUBJECT_TRANSFORM);if(!f)throw new Error(`${n} 'subject_transforms' requires server ${c}`)}}e.sources&&e.sources.forEach(n=>{r("stream sources",n)}),e.mirror&&r("stream mirror",e.mirror)}add(e={}){var t=this;return(0,j.Z)(function*(){t.checkStreamConfigVersions(e),Se(e.name),e.mirror=ar(e.mirror),e.sources=e.sources?.map(ar);const n=yield t._request(`${t.prefix}.STREAM.CREATE.${e.name}`,e);return t._fixInfo(n),n})()}delete(e){var t=this;return(0,j.Z)(function*(){return Se(e),(yield t._request(`${t.prefix}.STREAM.DELETE.${e}`)).success})()}update(e,t={}){var r=this;return(0,j.Z)(function*(){if("object"==typeof e){const f=e;e=f.name,t=f,console.trace("\x1b[33m >> streams.update(config: StreamConfig) api changed to streams.update(name: string, config: StreamUpdateConfig) - this shim will be removed - update your code.  \x1b[0m")}r.checkStreamConfigVersions(t),Se(e);const n=yield r.info(e),i=Object.assign(n.config,t);i.mirror=ar(i.mirror),i.sources=i.sources?.map(ar);const c=yield r._request(`${r.prefix}.STREAM.UPDATE.${e}`,i);return r._fixInfo(c),c})()}info(e,t){var r=this;return(0,j.Z)(function*(){Se(e);const n=`${r.prefix}.STREAM.INFO.${e}`;let o=yield r._request(n,t),{total:c,limit:f}=o,d=o.state.subjects?Object.getOwnPropertyNames(o.state.subjects).length:1;if(c&&c>d){const g=[o],p=t||{};let w=0;for(;c>d;){w++,p.offset=f*w;const k=yield r._request(n,p);c=k.total,g.push(k);const C=Object.getOwnPropertyNames(k.state.subjects).length;if(d+=C,C<f)break}let S={};for(let k=0;k<g.length;k++)o=g[k],o.state.subjects&&(S=Object.assign(S,o.state.subjects));o.offset=0,o.total=0,o.limit=0,o.state.subjects=S}return r._fixInfo(o),o})()}list(e=""){return new Rt(`${this.prefix}.STREAM.LIST`,i=>{const o=i;return o.streams.forEach(c=>{this._fixInfo(c)}),o.streams},this,e?.length?{subject:e}:{})}_fixInfo(e){e.config.sealed=e.config.sealed||!1,e.config.deny_delete=e.config.deny_delete||!1,e.config.deny_purge=e.config.deny_purge||!1,e.config.allow_rollup_hdrs=e.config.allow_rollup_hdrs||!1}purge(e,t){var r=this;return(0,j.Z)(function*(){if(t){const{keep:i,seq:o}=t;if("number"==typeof i&&"number"==typeof o)throw new Error("can specify one of keep or seq")}return Se(e),yield r._request(`${r.prefix}.STREAM.PURGE.${e}`,t)})()}deleteMessage(e,t,r=!0){var n=this;return(0,j.Z)(function*(){Se(e);const i={seq:t};return r||(i.no_erase=!0),(yield n._request(`${n.prefix}.STREAM.MSG.DELETE.${e}`,i)).success})()}getMessage(e,t){var r=this;return(0,j.Z)(function*(){Se(e);const i=yield r._request(`${r.prefix}.STREAM.MSG.GET.${e}`,t);return new Vi(i)})()}find(e){return this.findStream(e)}listKvs(){return new Rt(`${this.prefix}.STREAM.LIST`,r=>{const i=r.streams.filter(f=>f.config.name.startsWith(Ce));i.forEach(f=>{this._fixInfo(f)});let o="";return i.length&&(o=this.nc.info?.cluster??""),i.map(f=>new Hs(f,o))},this)}listObjectStores(){return new Rt(`${this.prefix}.STREAM.LIST`,r=>{const i=r.streams.filter(c=>c.config.name.startsWith(Hr));return i.forEach(c=>{this._fixInfo(c)}),i.map(c=>new Gr(c))},this)}names(e=""){return new Rt(`${this.prefix}.STREAM.NAMES`,i=>i.streams,this,e?.length?{subject:e}:{})}get(e){var t=this;return(0,j.Z)(function*(){const r=yield t.info(e);return Promise.resolve(new cr(t,r))})()}}let Vi=(()=>class s{_header;smr;static jc;constructor(t){this.smr=t}get subject(){return this.smr.message.subject}get seq(){return this.smr.message.seq}get timestamp(){return this.smr.message.time}get time(){return new Date(Date.parse(this.timestamp))}get data(){return this.smr.message.data?this._parse(this.smr.message.data):re}get header(){if(!this._header)if(this.smr.message.hdrs){const t=this._parse(this.smr.message.hdrs);this._header=et.decode(t)}else this._header=Ze();return this._header}_parse(t){const r=atob(t),n=r.length,i=new Uint8Array(n);for(let o=0;o<n;o++)i[o]=r.charCodeAt(o);return i}json(t){return Ae(t).decode(this.data)}string(){return ce.decode(this.data)}})();class Wi{api;constructor(e){this.api=e}get(e){return this.api.info(e).then(t=>new cr(this.api,t))}}class Yi{bucket;sm;prefixLen;constructor(e,t,r){this.bucket=e,this.prefixLen=t,this.sm=r}get key(){return this.sm.subject.substring(this.prefixLen)}get value(){return this.sm.data}get delta(){return 0}get created(){return this.sm.time}get revision(){return this.sm.seq}get operation(){return this.sm.header.get(ur)||"PUT"}get length(){const e=this.sm.header.get(Ee.MessageSizeHdr)||"";return""!==e?parseInt(e,10):this.sm.data.length}json(){return this.sm.json()}string(){return this.sm.string()}}class Xi{bucket;key;sm;constructor(e,t,r){this.bucket=e,this.key=t,this.sm=r}get value(){return this.sm.data}get created(){return new Date(Nr(this.sm.info.timestampNanos))}get revision(){return this.sm.seq}get operation(){return this.sm.headers?.get(ur)||"PUT"}get delta(){return this.sm.info.pending}get length(){const e=this.sm.headers?.get(Ee.MessageSizeHdr)||"";return""!==e?parseInt(e,10):this.sm.data.length}json(){return this.sm.json()}string(){return this.sm.string()}}class Zr{info;hdrs;constructor(e){this.info=e}get name(){return this.info.name}get description(){return this.info.description??""}get headers(){return this.hdrs||(this.hdrs=et.fromRecord(this.info.headers||{})),this.hdrs}get options(){return this.info.options}get bucket(){return this.info.bucket}get chunks(){return this.info.chunks}get deleted(){return this.info.deleted??!1}get digest(){return this.info.digest}get mtime(){return this.info.mtime}get nuid(){return this.info.nuid}get size(){return this.info.size}get revision(){return this.info.revision}get metadata(){return this.info.metadata||{}}isLink(){return void 0!==this.info.options?.link}}function Js(s){const e={name:s.name,description:s.description??"",options:s.options,metadata:s.metadata};return s.headers&&(e.headers=s.headers.toRecord()),e}class Lt{jsm;js;stream;name;constructor(e,t,r){this.name=e,this.jsm=t,this.js=r}_checkNotEmpty(e){return e&&0!==e.length?{name:e}:{name:e,error:new Error("name cannot be empty")}}info(e){var t=this;return(0,j.Z)(function*(){const r=yield t.rawInfo(e);return r?new Zr(r):null})()}list(){var e=this;return(0,j.Z)(function*(){const t=[],r=yield e.watch({ignoreDeletes:!0,includeHistory:!0});var o,n=!1,i=!1;try{for(var f,c=(0,H.Z)(r);n=!(f=yield c.next()).done;n=!1){const d=f.value;if(null===d)break;t.push(d)}}catch(d){i=!0,o=d}finally{try{n&&null!=c.return&&(yield c.return())}finally{if(i)throw o}}return Promise.resolve(t)})()}rawInfo(e){var t=this;return(0,j.Z)(function*(){const{name:r,error:n}=t._checkNotEmpty(e);if(n)return Promise.reject(n);const i=t._metaSubject(r);try{const o=yield t.jsm.streams.getMessage(t.stream,{last_by_subj:i}),f=Ae().decode(o.data);return f.revision=o.seq,f}catch(o){return"404"===o.code?null:Promise.reject(o)}})()}_si(e){var t=this;return(0,j.Z)(function*(){try{return yield t.jsm.streams.info(t.stream,e)}catch(r){return"404"===r.code?null:Promise.reject(r)}})()}seal(){var e=this;return(0,j.Z)(function*(){let t=yield e._si();return null===t?Promise.reject(new Error("object store not found")):(t.config.sealed=!0,t=yield e.jsm.streams.update(e.stream,t.config),Promise.resolve(new Gr(t)))})()}status(e){var t=this;return(0,j.Z)(function*(){const r=yield t._si(e);return null===r?Promise.reject(new Error("object store not found")):Promise.resolve(new Gr(r))})()}destroy(){return this.jsm.streams.delete(this.stream)}_put(e,t,r){var n=this;return(0,j.Z)(function*(){const i=n.js.getOptions();(r=r||{timeout:i.timeout}).timeout=r.timeout||i.timeout,r.previousRevision=r.previousRevision??void 0;const{timeout:o,previousRevision:c}=r,d=n.js.nc.info?.max_payload||1024;(e=e||{}).options=e.options||{};let g=e.options?.max_chunk_size||131072;g=g>d?d:g,e.options.max_chunk_size=g;const p=yield n.info(e.name),{name:w,error:S}=n._checkNotEmpty(e.name);if(S)return Promise.reject(S);const k=Qe.next(),C=n._chunkSubject(k),V=n._metaSubject(w),D=Object.assign({bucket:n.name,nuid:k,size:0,chunks:0},Js(e)),pe=F(),be=[],Ne=new ge;try{const st=t?t.getReader():null,bt=new $s;for(;;){const{done:fr,value:ot}=st?yield st.read():{done:!0,value:void 0};if(fr){if(Ne.size()>0){const nt=Ne.drain();bt.update(nt),D.chunks++,D.size+=nt.length,be.push(n.js.publish(C,nt,{timeout:o}))}yield Promise.all(be),be.length=0,D.mtime=(new Date).toISOString();const Re=bt.digest("base64"),gt=Re.length%3,dr=gt>0?"=".repeat(gt):"";D.digest=`${Gs}${Re}${dr}`,D.deleted=!1;const yt=Ze();"number"==typeof c&&yt.set(Ke.ExpectedLastSubjectSequenceHdr,`${c}`),yt.set(Ee.RollupHdr,Ee.RollupValueSubject);const Dt=yield n.js.publish(V,Ae().encode(D),{headers:yt,timeout:o});if(D.revision=Dt.seq,p)try{yield n.jsm.streams.purge(n.stream,{filter:`$O.${n.name}.C.${p.nuid}`})}catch{}pe.resolve(new Zr(D));break}if(ot)for(Ne.fill(ot);Ne.size()>g;){D.chunks++,D.size+=g;const Re=Ne.drain(e.options.max_chunk_size);bt.update(Re),be.push(n.js.publish(C,Re,{timeout:o}))}}}catch(st){yield n.jsm.streams.purge(n.stream,{filter:C}),pe.reject(st)}return pe})()}putBlob(e,t,r){return null===t&&(t=new Uint8Array(0)),this.put(e,function n(i){return new ReadableStream({pull(o){o.enqueue(i),o.close()}})}(t),r)}put(e,t,r){return e?.options?.link?Promise.reject(new Error("link cannot be set when putting the object in bucket")):this._put(e,t,r)}getBlob(e){var t=this;return(0,j.Z)(function*(){function n(){return(n=(0,j.Z)(function*(c){const f=new ge,d=c.getReader();for(;;){const{done:g,value:p}=yield d.read();if(g)return f.drain();p&&p.length&&f.fill(p)}})).apply(this,arguments)}const i=yield t.get(e);if(null===i)return Promise.resolve(null);const o=yield Promise.all([i.error,function r(c){return n.apply(this,arguments)}(i.data)]);return o[0]?Promise.reject(o[0]):Promise.resolve(o[1])})()}get(e){var t=this;return(0,j.Z)(function*(){const r=yield t.rawInfo(e);if(null===r||r.deleted)return Promise.resolve(null);if(r.options&&r.options.link){const p=r.options.link.name||"";if(""===p)throw new Error("link is a bucket");return(r.options.link.bucket!==t.name?yield Lt.create(t.js,r.options.link.bucket):t).get(p)}const n=F(),i={info:new Zr(r),error:n};if(0===r.size)return i.data=function Qi(){return new ReadableStream({pull(s){s.enqueue(new Uint8Array(0)),s.close()}})}(),n.resolve(null),Promise.resolve(i);let o;const c=rt();c.orderedConsumer();const f=new $s,d=`$O.${t.name}.C.${r.nuid}`,g=yield t.js.subscribe(d,c);return(0,j.Z)(function*(){var S,p=!1,w=!1;try{for(var C,k=(0,H.Z)(g);p=!(C=yield k.next()).done;p=!1){const V=C.value;if(V.data.length>0&&(f.update(V.data),o.enqueue(V.data)),0===V.info.pending){const D=f.digest("base64"),pe=D.length%3,be=pe>0?"=".repeat(pe):"",Ne=`${Gs}${D}${be}`;Ne!==r.digest?o.error(new Error(`received a corrupt object, digests do not match received: ${r.digest} calculated ${Ne}`)):o.close(),g.unsubscribe()}}}catch(V){w=!0,S=V}finally{try{p&&null!=k.return&&(yield k.return())}finally{if(w)throw S}}})().then(()=>{n.resolve()}).catch(p=>{o.error(p),n.reject(p)}),i.data=new ReadableStream({start(p){o=p},cancel(){g.unsubscribe()}}),i})()}linkStore(e,t){if(!(t instanceof Lt))return Promise.reject("bucket required");const r=t,{name:n,error:i}=this._checkNotEmpty(e);return i?Promise.reject(i):this._put({name:n,options:{link:{bucket:r.name}}},null)}link(e,t){var r=this;return(0,j.Z)(function*(){const{name:n,error:i}=r._checkNotEmpty(e);if(i)return Promise.reject(i);if(t.deleted)return Promise.reject(new Error("src object is deleted"));if(t.isLink())return Promise.reject(new Error("src object is a link"));const o=yield r.rawInfo(e);if(null!==o&&!o.deleted)return Promise.reject(new Error("an object already exists with that name"));const f={name:n,options:{link:{bucket:t.bucket,name:t.name}}};yield r.js.publish(r._metaSubject(e),JSON.stringify(f));const d=yield r.info(e);return Promise.resolve(d)})()}delete(e){var t=this;return(0,j.Z)(function*(){const r=yield t.rawInfo(e);if(null===r)return Promise.resolve({purged:0,success:!1});r.deleted=!0,r.size=0,r.chunks=0,r.digest="";const n=Ae(),i=Ze();return i.set(Ee.RollupHdr,Ee.RollupValueSubject),yield t.js.publish(t._metaSubject(r.name),n.encode(r),{headers:i}),t.jsm.streams.purge(t.stream,{filter:t._chunkSubject(r.nuid)})})()}update(e,t={}){var r=this;return(0,j.Z)(function*(){const n=yield r.rawInfo(e);if(null===n)return Promise.reject(new Error("object not found"));if(n.deleted)return Promise.reject(new Error("cannot update meta for a deleted object"));t.name=t.name??n.name;const{name:i,error:o}=r._checkNotEmpty(t.name);if(o)return Promise.reject(o);if(e!==t.name){const d=yield r.info(t.name);if(d&&!d.deleted)return Promise.reject(new Error("an object already exists with that name"))}t.name=i;const c=Object.assign({},n,Js(t)),f=yield r.js.publish(r._metaSubject(c.name),JSON.stringify(c));return e!==t.name&&(yield r.jsm.streams.purge(r.stream,{filter:r._metaSubject(e)})),Promise.resolve(f)})()}watch(e={}){var t=this;return(0,j.Z)(function*(){e.includeHistory=e.includeHistory??!1,e.ignoreDeletes=e.ignoreDeletes??!1;let r=!1;const n=new _e,i=t._metaSubjectAll();try{yield t.jsm.streams.getMessage(t.stream,{last_by_subj:i})}catch(d){"404"===d.code?(n.push(null),r=!0):n.stop(d)}const o=Ae(),c=rt();c.orderedConsumer(),e.includeHistory?c.deliverLastPerSubject():(r=!0,c.deliverNew()),c.callback((d,g)=>{if(d)n.stop(d);else if(null!==g){const p=o.decode(g.data);p.deleted&&!0===e.ignoreDeletes||n.push(p),0===g.info?.pending&&!r&&(r=!0,n.push(null))}});const f=yield t.js.subscribe(i,c);return n._data=f,n.iterClosed.then(()=>{f.unsubscribe()}),f.closed.then(()=>{n.stop()}).catch(d=>{n.stop(d)}),n})()}_chunkSubject(e){return`$O.${this.name}.C.${e}`}_metaSubject(e){return`$O.${this.name}.M.${Mt.encode(e)}`}_metaSubjectAll(){return`$O.${this.name}.M.>`}init(e={}){var t=this;return(0,j.Z)(function*(){try{t.stream=function zi(s){return lr(s),`${Hr}${s}`}(t.name)}catch(i){return Promise.reject(i)}const r=e?.ttl||0;delete e.ttl;const n=Object.assign({max_age:r},e);n.name=t.stream,n.allow_direct=!0,n.allow_rollup_hdrs=!0,n.discard=ir.New,n.subjects=[`$O.${t.name}.C.>`,`$O.${t.name}.M.>`],e.placement&&(n.placement=e.placement),e.metadata&&(n.metadata=e.metadata);try{yield t.jsm.streams.info(n.name)}catch(i){"stream not found"===i.message&&(yield t.jsm.streams.add(n))}})()}static create(e,t,r={}){return(0,j.Z)(function*(){const n=yield e.jetstreamManager(),i=new Lt(t,n,e);return yield i.init(r),Promise.resolve(i)})()}}class eo{js;jsm;constructor(e){this.js=e}kv(e,t={}){const r=this.js,{ok:n,min:i}=r.nc.features.get(K.JS_KV);return n?t.bindOnly?qt.bind(this.js,e):qt.create(this.js,e,t):Promise.reject(new Error(`kv is only supported on servers ${i} or better`))}os(e,t={}){if("function"!=typeof crypto?.subtle?.digest)return Promise.reject(new Error("objectstore: unable to calculate hashes - crypto.subtle.digest with sha256 support is required"));const r=this.js,{ok:n,min:i}=r.nc.features.get(K.JS_OBJECTSTORE);return n?Lt.create(this.js,e,t):Promise.reject(new Error(`objectstore is only supported on servers ${i} or better`))}}class zr extends It{consumers;streams;consumerAPI;streamAPI;constructor(e,t){super(e,t),this.consumerAPI=new Lr(e,t),this.streamAPI=new Jr(e,t),this.consumers=new Fs(this.consumerAPI),this.streams=new Wi(this.streamAPI)}jetstreamManager(){return this.nc.jetstreamManager(this.opts)}get apiPrefix(){return this.prefix}get views(){return new eo(this)}publish(e,t=re,r){var n=this;return(0,j.Z)(function*(){(r=r||{}).expect=r.expect||{};const i=r?.headers||Ze();r&&(r.msgID&&i.set(Ke.MsgIdHdr,r.msgID),r.expect.lastMsgID&&i.set(Ke.ExpectedLastMsgIdHdr,r.expect.lastMsgID),r.expect.streamName&&i.set(Ke.ExpectedStreamHdr,r.expect.streamName),"number"==typeof r.expect.lastSequence&&i.set(Ke.ExpectedLastSeqHdr,`${r.expect.lastSequence}`),"number"==typeof r.expect.lastSubjectSequence&&i.set(Ke.ExpectedLastSubjectSequenceHdr,`${r.expect.lastSubjectSequence}`));const o=r.timeout||n.timeout,c={};o&&(c.timeout=o),r&&(c.headers=i);let g,{retries:f,retry_delay:d}=r;f=f||1,d=d||250;for(let w=0;w<f;w++)try{g=yield n.nc.request(e,t,c);break}catch(S){if(!("503"===S.code&&w+1<f))throw S;yield B(d)}const p=n.parseJsResponse(g);if(""===p.stream)throw $.errorForCode(M.JetStreamInvalidAck);return p.duplicate=!!p.duplicate&&p.duplicate,p})()}pull(e,t,r=0){var n=this;return(0,j.Z)(function*(){Se(e),ft(t);let i=n.timeout;r>i&&(i=r);const o={batch:1,no_wait:0===(r=r<0?0:se(r)),expires:r},c=yield n.nc.request(`${n.prefix}.CONSUMER.MSG.NEXT.${e}.${t}`,n.jc.encode(o),{noMux:!0,timeout:i}),f=dt(c);if(f)throw f;return Ut(c)})()}fetch(e,t,r={}){Se(e),ft(t);let n=null;const i=(r.max_bytes??0)>0;let o=0;const c=i?r.max_bytes:0;let f=null;const d={};if(d.batch=r.batch||1,c){const D=this.nc.features.get(K.JS_PULL_MAX_BYTES);if(!D.ok)throw new Error(`max_bytes is only supported on servers ${D.min} or better`);d.max_bytes=c}d.no_wait=r.no_wait||!1,d.no_wait&&d.expires&&(d.expires=0);const g=r.expires||0;if(g&&(d.expires=se(g)),0===g&&!1===d.no_wait)throw new Error("expires or no_wait is required");const p=r.idle_heartbeat||0;p&&(d.idle_heartbeat=se(p),!0===r.delay_heartbeat&&(d.idle_heartbeat=se(4*p)));const w=new _e,S=d.batch;let k=0;w.protocolFilterFn=(D,pe=!1)=>!$r(D.msg)||(f?.work(),!1),w.dispatchedFn=D=>{if(D){if(i&&(o+=D.data.length),k++,n&&0===D.info.pending)return;(1===w.getPending()&&0===D.info.pending||S===k||c>0&&o>=c)&&w.stop()}};const C=v(this.nc.options.inboxPrefix),V=this.nc.subscribe(C,{max:r.batch,callback:(D,pe)=>{null===D&&(D=dt(pe)),null!==D?(n&&(n.cancel(),n=null),function Er(s){return"string"==typeof s.code}(D)?w.stop(null===zs(D)?void 0:D):w.stop(D)):(f?.work(),w.received++,w.push(Ut(pe)))}});return g&&(n=de(g),n.catch(()=>{V.isClosed()||(V.drain().catch(()=>{}),n=null),f&&f.cancel()})),(0,j.Z)(function*(){try{p&&(f=new Fr(p,D=>(w.push(()=>{w.err=new $(`${Oe.IdleHeartbeatMissed}: ${D}`,M.JetStreamIdleHeartBeat)}),!0)))}catch{}yield V.closed,null!==n&&(n.cancel(),n=null),f&&f.cancel(),w.stop()})().catch(),this.nc.publish(`${this.prefix}.CONSUMER.MSG.NEXT.${e}.${t}`,this.jc.encode(d),{reply:C}),w}pullSubscribe(e,t=rt()){var r=this;return(0,j.Z)(function*(){const n=yield r._processOptions(e,t);if(n.ordered)throw new Error("pull subscribers cannot be be ordered");if(n.config.deliver_subject)throw new Error("consumer info specifies deliver_subject - pull consumers cannot have deliver_subject set");const i=n.config.ack_policy;if(i===ye.None||i===ye.All)throw new Error("ack policy for pull consumers must be explicit");const o=r._buildTypedSubscriptionOpts(n),c=new to(r,n.deliver,o);c.info=n;try{yield r._maybeCreateConsumer(n)}catch(f){throw c.unsubscribe(),f}return c})()}subscribe(e,t=rt()){var r=this;return(0,j.Z)(function*(){const n=yield r._processOptions(e,t);if(!n.isBind&&!n.config.deliver_subject)throw new Error("push consumer requires deliver_subject");const i=r._buildTypedSubscriptionOpts(n),o=new Zs(r,n.deliver,i);o.info=n;try{yield r._maybeCreateConsumer(n)}catch(c){throw o.unsubscribe(),c}return o._maybeSetupHbMonitoring(),o})()}_processOptions(e,t=rt()){var r=this;return(0,j.Z)(function*(){const n=Ms(t)?t.getOpts():t;if(n.isBind=!!Ms(t)&&t.isBind,n.flow_control={heartbeat_count:0,fc_count:0,consumer_restarts:0},n.ordered){if(n.ordered_consumer_sequence={stream_seq:0,delivery_seq:0},n.config.ack_policy!==ye.NotSet&&n.config.ack_policy!==ye.None)throw new $("ordered consumer: ack_policy can only be set to 'none'",M.ApiError);if(n.config.durable_name&&n.config.durable_name.length>0)throw new $("ordered consumer: durable_name cannot be set",M.ApiError);if(n.config.deliver_subject&&n.config.deliver_subject.length>0)throw new $("ordered consumer: deliver_subject cannot be set",M.ApiError);if(void 0!==n.config.max_deliver&&n.config.max_deliver>1)throw new $("ordered consumer: max_deliver cannot be set",M.ApiError);if(n.config.deliver_group&&n.config.deliver_group.length>0)throw new $("ordered consumer: deliver_group cannot be set",M.ApiError);n.config.deliver_subject=v(r.nc.options.inboxPrefix),n.config.ack_policy=ye.None,n.config.max_deliver=1,n.config.flow_control=!0,n.config.idle_heartbeat=n.config.idle_heartbeat||se(5e3),n.config.ack_wait=se(792e5),n.config.mem_storage=!0,n.config.num_replicas=1}if(n.config.ack_policy===ye.NotSet&&(n.config.ack_policy=ye.All),n.api=r,n.config=n.config||{},n.stream=n.stream?n.stream:yield r.findStream(e),n.attached=!1,n.config.durable_name)try{const i=yield r.consumerAPI.info(n.stream,n.config.durable_name);if(i){if(i.config.filter_subject&&i.config.filter_subject!==e)throw new Error("subject does not match consumer");const o=n.config.deliver_group??"";if(""===o&&!0===i.push_bound)throw new Error("duplicate subscription");const c=i.config.deliver_group??"";if(o!==c)throw""===c?new Error("durable requires no queue group"):new Error(`durable requires queue group '${c}'`);n.last=i,n.config=i.config,n.attached=!0,n.config.durable_name||(n.name=i.name)}}catch(i){if("404"!==i.code)throw i}return!n.attached&&void 0===n.config.filter_subject&&void 0===n.config.filter_subjects&&(n.config.filter_subject=e),n.deliver=n.config.deliver_subject||v(r.nc.options.inboxPrefix),n})()}_buildTypedSubscriptionOpts(e){const t={};return t.adapter=function ro(s){return s?no:so}(void 0===e.callbackFn),t.ingestionFilterFn=zr.ingestionFn(e.ordered),t.protocolFilterFn=(r,n=!1)=>{const i=r;return!Rr(i.msg)||(n||i.msg.respond(),!1)},!e.mack&&e.config.ack_policy!==ye.None&&(t.dispatchedFn=io),e.callbackFn&&(t.callback=e.callbackFn),t.max=e.max||0,t.queue=e.queue,t}_maybeCreateConsumer(e){var t=this;return(0,j.Z)(function*(){if(e.attached)return;if(e.isBind)throw new Error(`unable to bind - durable consumer ${e.config.durable_name} doesn't exist in ${e.stream}`);e.config=Object.assign({deliver_policy:fe.All,ack_policy:ye.Explicit,ack_wait:se(3e4),replay_policy:Tt.Instant},e.config);const r=yield t.consumerAPI.add(e.stream,e.config);if(Array.isArray(e.config.filter_subjects&&!Array.isArray(r.config.filter_subjects)))throw new Error("jetstream server doesn't support consumers with multiple filter subjects");e.name=r.name,e.config=r.config,e.last=r})()}static ingestionFn(e){return(t,r)=>{const n=r;if(!t)return{ingest:!1,protocol:!1};const i=t;if(dt(i.msg)||n.monitor?.work(),$r(i.msg)){const c=!e||n._checkHbOrderConsumer(i.msg);return e||n.info.flow_control.heartbeat_count++,{ingest:c,protocol:!0}}return Rr(i.msg)?(n.info.flow_control.fc_count++,{ingest:!0,protocol:!0}):{ingest:!e||n._checkOrderedConsumer(t),protocol:!1}}}}class Zs extends qi{js;monitor;constructor(e,t,r){super(e.nc,t,r),this.js=e,this.monitor=null,this.sub.closed.then(()=>{this.monitor&&this.monitor.cancel()})}set info(e){this.sub.info=e}get info(){return this.sub.info}_resetOrderedConsumer(e){if(null===this.info||this.sub.isClosed())return;const t=v(this.js.nc.options.inboxPrefix);this.js.nc._resub(this.sub,t);const n=this.info;n.ordered_consumer_sequence.delivery_seq=0,n.flow_control.heartbeat_count=0,n.flow_control.fc_count=0,n.flow_control.consumer_restarts++,n.deliver=t,n.config.deliver_subject=t,n.config.deliver_policy=fe.StartSequence,n.config.opt_start_seq=e;const i={};i.stream_name=this.info.stream,i.config=n.config,this.js._request(`${n.api.prefix}.CONSUMER.CREATE.${n.stream}`,i).then(c=>{const f=c;this.info.config=f.config,this.info.name=f.name}).catch(c=>{const f=new $(`unable to recreate ordered consumer ${n.stream} at seq ${e}`,M.RequestError,c);this.sub.callback(f,{})})}_maybeSetupHbMonitoring(){const e=this.info?.config?.idle_heartbeat||0;e&&this._setupHbMonitoring(Nr(e))}_setupHbMonitoring(e,t=0){const r={cancelAfter:0,maxOut:2};t&&(r.cancelAfter=t);const n=this.sub;this.monitor=new Fr(e,o=>{const c=function fi(s,e,t){const r=Ze(s,e),i=new ps({hdr:1,sid:0,size:0},re,{});return i._headers=r,i._subject=t,i}(409,`${Oe.IdleHeartbeatMissed}: ${o}`,this.sub.subject);return this.info?.ordered?!!this.js.nc.protocol.connected&&(this._resetOrderedConsumer((this.info?.ordered_consumer_sequence?.stream_seq||0)+1),!1):(this.sub.callback(null,c),!n.noIterator)},r)}_checkHbOrderConsumer(e){const t=e.headers.get(Ee.ConsumerStalledHdr);""!==t&&this.js.nc.publish(t);const r=parseInt(e.headers.get(Ee.LastConsumerSeqHdr),10),n=this.info.ordered_consumer_sequence;return this.info.flow_control.heartbeat_count++,r!==n.delivery_seq&&this._resetOrderedConsumer(n.stream_seq+1),!1}_checkOrderedConsumer(e){const t=this.info.ordered_consumer_sequence,r=e.info.streamSequence,n=e.info.deliverySequence;return n!=t.delivery_seq+1?(this._resetOrderedConsumer(t.stream_seq+1),!1):(t.delivery_seq=n,t.stream_seq=r,!0)}destroy(){var e=this;return(0,j.Z)(function*(){e.isClosed()||(yield e.drain());const t=e.sub.info,n=`${t.api.prefix}.CONSUMER.DELETE.${t.stream}.${t.config.durable_name||t.name}`;yield t.api._request(n)})()}consumerInfo(){var e=this;return(0,j.Z)(function*(){const t=e.sub.info,n=`${t.api.prefix}.CONSUMER.INFO.${t.stream}.${t.config.durable_name||t.name}`,i=yield t.api._request(n);return t.last=i,i})()}}class to extends Zs{constructor(e,t,r){super(e,t,r)}pull(e={batch:1}){const{stream:t,config:r,name:n}=this.sub.info,i=r.durable_name??n,o={};if(o.batch=e.batch||1,o.no_wait=e.no_wait||!1,(e.max_bytes??0)>0){const d=this.js.nc.features.get(K.JS_PULL_MAX_BYTES);if(!d.ok)throw new Error(`max_bytes is only supported on servers ${d.min} or better`);o.max_bytes=e.max_bytes}let c=0;e.expires&&e.expires>0&&(c=e.expires,o.expires=se(c));let f=0;if(e.idle_heartbeat&&e.idle_heartbeat>0&&(f=e.idle_heartbeat,o.idle_heartbeat=se(f)),f&&0===c)throw new Error("idle_heartbeat requires expires");if(f>c)throw new Error("expires must be greater than idle_heartbeat");if(this.info){this.monitor&&this.monitor.cancel(),c&&f&&(this.monitor?this.monitor._change(f,c):this._setupHbMonitoring(f,c));const d=this.info.api,p=this.sub.subject;d.nc.publish(`${d.prefix}.CONSUMER.MSG.NEXT.${t}.${i}`,d.jc.encode(o),{reply:p})}}}function so(s,e){return s||(s=dt(e))?[s,null]:[null,Ut(e)]}function no(s,e){if(s)return[s,null];const t=dt(e);return null!==t?[zs(t),null]:[null,Ut(e)]}function zs(s){if(null!==s)switch(s.code){case M.JetStream404NoMessages:case M.JetStream408RequestTimeout:return null;case M.JetStream409:return function mi(s){if(s.code!==M.JetStream409)return!1;const e=[Oe.MaxBatchExceeded,Oe.MaxExpiresExceeded,Oe.MaxBytesExceeded,Oe.MaxMessageSizeExceeded,Oe.PushConsumer,Oe.IdleHeartbeatMissed,Oe.ConsumerDeleted];return di&&e.push(Oe.MaxWaitingExceeded),void 0!==e.find(t=>-1!==s.message.indexOf(t))}(s)?s:null;default:return s}return null}function io(s){s&&s.ack()}class oo extends It{constructor(e,t){super(e,t)}getMessage(e,t){var r=this;return(0,j.Z)(function*(){Se(e);let n=t;const{last_by_subj:i}=n;i&&(n=null);const o=n?r.jc.encode(n):re,c=r.opts.apiPrefix||"$JS.API",f=i?`${c}.DIRECT.GET.${e}.${i}`:`${c}.DIRECT.GET.${e}`,d=yield r.nc.request(f,o),g=dt(d);if(g)return Promise.reject(g);const p=new ao(d);return Promise.resolve(p)})()}}let ao=(()=>class s{data;header;static jc;constructor(t){if(!t.headers)throw new Error("headers expected");this.data=t.data,this.header=t.headers}get subject(){return this.header.get(Nt.Subject)}get seq(){const t=this.header.get(Nt.Sequence);return"string"==typeof t?parseInt(t):0}get time(){return new Date(Date.parse(this.timestamp))}get timestamp(){return this.header.get(Nt.TimeStamp)}get stream(){return this.header.get(Nt.Stream)}json(t){return Ae(t).decode(this.data)}string(){return ce.decode(this.data)}})();class co extends It{streams;consumers;direct;constructor(e,t){super(e,t),this.streams=new Jr(e,t),this.consumers=new Lr(e,t),this.direct=new oo(e,t)}getAccountInfo(){var e=this;return(0,j.Z)(function*(){return yield e._request(`${e.prefix}.INFO`)})()}jetstream(){return this.nc.jetstream(this.getOptions())}advisories(){const e=new _e;return this.nc.subscribe("$JS.EVENT.ADVISORY.>",{callback:(t,r)=>{if(t)throw t;try{const n=this.parseJsResponse(r),i=n.type.split(".");e.push({kind:i[i.length-1],data:n})}catch(n){e.stop(n)}}}),e}}class Ks{msg;constructor(e){this.msg=e}get data(){return this.msg.data}get sid(){return this.msg.sid}get subject(){return this.msg.subject}get reply(){return this.msg.reply||""}get headers(){return this.msg.headers}respond(e,t){return this.msg.respond(e,t)}respondError(e,t,r,n){return(n=n||{}).headers=n.headers||Ze(),n.headers?.set(x,`${e}`),n.headers?.set(_,t),this.msg.respond(r,n)}json(e){return this.msg.json(e)}string(){return this.msg.string()}}class Ft{subject;queue;srv;constructor(e,t="",r=""){""!==t&&function ho(s,e){if(-1!==e.indexOf(" "))throw new Error(`${s} cannot contain spaces: '${e}'`);e.split(".").forEach(r=>{if(">"===r)throw new Error(`${s} name cannot contain internal '>': '${e}'`)})}("service group",t);let n="";if(e instanceof Bt)this.srv=e,n="";else{if(!(e instanceof Ft))throw new Error("unknown ServiceGroup type");{const i=e;this.srv=i.srv,""===r&&""!==i.queue&&(r=i.queue),n=i.subject}}this.subject=this.calcSubject(n,t),this.queue=r}calcSubject(e,t=""){return""===t?e:""!==e?`${e}.${t}`:t}addEndpoint(e="",t){const r="function"==typeof(t=t||{subject:e})?{handler:t,subject:e}:t;Ct("endpoint",e);let{subject:n,handler:i,metadata:o,queue:c}=r;return n=n||e,c=c||this.queue,function lo(s,e){if(""===e)throw new Error(`${s} cannot be empty`);if(-1!==e.indexOf(" "))throw new Error(`${s} cannot contain spaces: '${e}'`);const t=e.split(".");t.forEach((r,n)=>{if(">"===r&&n!==t.length-1)throw new Error(`${s} cannot have internal '>': '${e}'`)})}("endpoint subject",n),n=this.calcSubject(this.subject,n),this.srv._addEndpoint({name:e,subject:n,queue:c,handler:i,metadata:o})}addGroup(e="",t=""){return new Ft(this,e,t)}}class Bt{nc;_id;config;handlers;internal;_stopped;_done;started;static controlSubject(e,t="",r="",n){const i=n??"$SRV";return""===t&&""===r?`${i}.${e}`:(Ct("control subject name",t),""!==r?(Ct("control subject id",r),`${i}.${e}.${t}.${r}`):`${i}.${e}.${t}`)}constructor(e,t={name:"",version:""}){this.nc=e,this.config=Object.assign({},t),this.config.queue||(this.config.queue="q"),Ct("name",this.config.name),Ct("queue",this.config.queue),it(this.config.version),this._id=Qe.next(),this.internal=[],this._done=F(),this._stopped=!1,this.handlers=[],this.started=(new Date).toISOString(),this.reset(),this.nc.closed().then(()=>{this.close().catch()}).catch(r=>{this.close(r).catch()})}get subjects(){return this.handlers.filter(e=>!1===e.internal).map(e=>e.subject)}get id(){return this._id}get name(){return this.config.name}get description(){return this.config.description??""}get version(){return this.config.version}get metadata(){return this.config.metadata}errorToHeader(e){const t=Ze();if(e instanceof E){const r=e;t.set(_,r.message),t.set(x,`${r.code}`)}else t.set(_,e.message),t.set(x,"500");return t}setupHandler(e,t=!1){const r=t?"":e.queue?e.queue:this.config.queue,{name:n,subject:i,handler:o}=e,c=e;c.internal=t,t&&this.internal.push(c),c.stats=new fo(n,i,r),c.queue=r;const f=o?(d,g)=>{if(d)return void this.close(d);const p=Date.now();try{o(d,new Ks(g))}catch(w){c.stats.countError(w),g?.respond(re,{headers:this.errorToHeader(w)})}finally{c.stats.countLatency(p)}}:void 0;return c.sub=this.nc.subscribe(i,{callback:f,queue:r}),c.sub.closed.then(()=>{this._stopped||this.close(new Error(`required subscription ${e.subject} stopped`)).catch()}).catch(d=>{if(!this._stopped){const g=new Error(`required subscription ${e.subject} errored: ${d.message}`);g.stack=d.stack,this.close(g).catch()}}),c}info(){return{type:kt.INFO,name:this.name,id:this.id,version:this.version,description:this.description,metadata:this.metadata,endpoints:this.endpoints()}}endpoints(){return this.handlers.map(e=>{const{subject:t,metadata:r,name:n,queue:i}=e;return{subject:t,metadata:r,name:n,queue_group:i}})}stats(){var e=this;return(0,j.Z)(function*(){const t=[];for(const r of e.handlers){if("function"==typeof e.config.statsHandler)try{r.stats.data=yield e.config.statsHandler(r)}catch(n){r.stats.countError(n)}t.push(r.stats.stats(r.qi))}return{type:kt.STATS,name:e.name,id:e.id,version:e.version,started:e.started,metadata:e.metadata,endpoints:t}})()}addInternalHandler(e,t){const r=`${e}`.toUpperCase();this._doAddInternalHandler(`${r}-all`,e,t),this._doAddInternalHandler(`${r}-kind`,e,t,this.name),this._doAddInternalHandler(`${r}`,e,t,this.name,this.id)}_doAddInternalHandler(e,t,r,n="",i=""){const o={};o.name=e,o.subject=Bt.controlSubject(t,n,i),o.handler=r,this.setupHandler(o,!0)}start(){const e=Ae(),n=e.encode(this.ping());return this.addInternalHandler(I.PING,(o,c)=>o?(this.close(o).then().catch(),Promise.reject(o)):(c.respond(n),Promise.resolve())),this.addInternalHandler(I.STATS,(o,c)=>o?(this.close(o),Promise.reject(o)):this.stats().then(f=>(c?.respond(e.encode(f)),Promise.resolve()))),this.addInternalHandler(I.INFO,(o,c)=>o?(this.close(o),Promise.reject(o)):(c?.respond(e.encode(this.info())),Promise.resolve())),this.handlers.forEach(o=>{const{subject:c}=o;"string"==typeof c&&null!==o.handler&&this.setupHandler(o)}),Promise.resolve(this)}close(e){if(this._stopped)return this._done;this._stopped=!0;let t=[];return this.nc.isClosed()||(t=this.handlers.concat(this.internal).map(r=>r.sub.drain())),Promise.allSettled(t).then(()=>{this._done.resolve(e||null)}),this._done}get stopped(){return this._done}get isStopped(){return this._stopped}stop(e){return this.close(e)}ping(){return{type:kt.PING,name:this.name,id:this.id,version:this.version,metadata:this.metadata}}reset(){if(this.started=(new Date).toISOString(),this.handlers)for(const e of this.handlers)e.stats.reset(e.qi)}addGroup(e,t){return new Ft(this,e,t)}addEndpoint(e,t){return new Ft(this).addEndpoint(e,t)}_addEndpoint(e){const t=new _e;t.noIterator="function"==typeof e.handler,t.noIterator||(e.handler=(n,i)=>{n?this.stop(n).catch():t.push(new Ks(i))},t.iterClosed.then(()=>{this.close().catch()}));const r=this.setupHandler(e,!1);return r.qi=t,this.handlers.push(r),t}}class fo{name;subject;average_processing_time;num_requests;processing_time;num_errors;last_error;data;metadata;queue;constructor(e,t,r=""){this.name=e,this.subject=t,this.average_processing_time=0,this.num_errors=0,this.num_requests=0,this.processing_time=0,this.queue=r}reset(e){this.num_requests=0,this.processing_time=0,this.average_processing_time=0,this.num_errors=0,this.last_error=void 0,this.data=void 0;const t=e;t&&(t.time=0,t.processed=0)}countLatency(e){this.num_requests++,this.processing_time+=se(Date.now()-e),this.average_processing_time=Math.round(this.processing_time/this.num_requests)}countError(e){this.num_errors++,this.last_error=e.message}_stats(){const{name:e,subject:t,average_processing_time:r,num_errors:n,num_requests:i,processing_time:o,last_error:c,data:f,queue:d}=this;return{name:e,subject:t,average_processing_time:r,num_errors:n,num_requests:i,processing_time:o,last_error:c,data:f,queue_group:d}}stats(e){const t=e;return!1===t?.noIterator&&(this.processing_time=t.time,this.num_requests=t.processed,this.average_processing_time=this.processing_time>0&&this.num_requests>0?this.processing_time/this.num_requests:0),this._stats()}}class mo{nc;prefix;opts;constructor(e,t={strategy:Te.JitterTimer,maxWait:2e3},r){this.nc=e,this.prefix=r,this.opts=t}ping(e="",t=""){return this.q(I.PING,e,t)}stats(e="",t=""){return this.q(I.STATS,e,t)}info(e="",t=""){return this.q(I.INFO,e,t)}q(e,t="",r=""){var n=this;return(0,j.Z)(function*(){const i=new _e,o=Ae(),c=Bt.controlSubject(e,t,r,n.prefix),f=yield n.nc.requestMany(c,re,n.opts);return(0,j.Z)(function*(){var p,d=!1,g=!1;try{for(var S,w=(0,H.Z)(f);d=!(S=yield w.next()).done;d=!1){const k=S.value;try{const C=o.decode(k.data);i.push(C)}catch(C){i.push(()=>{i.stop(C)})}}}catch(k){g=!0,p=k}finally{try{d&&null!=w.return&&(yield w.return())}finally{if(g)throw p}}i.push(()=>{i.stop()})})().catch(d=>{i.stop(d)}),i})()}}class Kr{options;protocol;draining;listeners;_services;constructor(e){this.draining=!1,this.options=si(e),this.listeners=[]}static connect(e={}){return new Promise((t,r)=>{const n=new Kr(e);nr.connect(n.options,n).then(i=>{n.protocol=i,(0,j.Z)(function*(){var f,o=!1,c=!1;try{for(var g,d=(0,H.Z)(i.status());o=!(g=yield d.next()).done;o=!1){const p=g.value;n.listeners.forEach(w=>{w.push(p)})}}catch(p){c=!0,f=p}finally{try{o&&null!=d.return&&(yield d.return())}finally{if(c)throw f}}})(),t(n)}).catch(i=>{r(i)})})}closed(){return this.protocol.closed}close(){var e=this;return(0,j.Z)(function*(){yield e.protocol.close()})()}_check(e,t,r){if(this.isClosed())throw $.errorForCode(M.ConnectionClosed);if(t&&this.isDraining()||r&&this.protocol.noMorePublishing)throw $.errorForCode(M.ConnectionDraining);if(0===(e=e||"").length)throw $.errorForCode(M.BadSubject)}publish(e,t,r){this._check(e,!1,!0),this.protocol.publish(e,t,r)}subscribe(e,t={}){this._check(e,!0,!1);const r=new As(this.protocol,e,t);return this.protocol.subscribe(r),r}_resub(e,t,r){this._check(t,!0,!1);const n=e;n.max=r,r&&(n.max=r+n.received),this.protocol.resub(n,t)}requestMany(e,t=re,r={maxWait:1e3,maxMessages:-1}){try{this._check(e,!0,!0)}catch(c){return Promise.reject(c)}if(r.strategy=r.strategy||Te.Timer,r.maxWait=r.maxWait||1e3,r.maxWait<1)return Promise.reject(new $("timeout",M.InvalidOption));const n=new _e;function i(c){n.push(()=>{n.stop(c)})}function o(c,f){c||null===f?i(null===c?void 0:c):n.push(f)}if(r.noMux){const c=(new Error).stack;let f="number"==typeof r.maxMessages&&r.maxMessages>0?r.maxMessages:-1;const d=this.subscribe(v(this.options.inboxPrefix),{callback:(S,k)=>{if(0===k?.data?.length&&k?.headers?.status===M.NoResponders&&(S=$.errorForCode(M.NoResponders)),S)return S.stack+=`\n\n${c}`,void g(S);o(null,k),r.strategy===Te.Count&&(f--,0===f&&g()),r.strategy===Te.JitterTimer&&(w(),p=setTimeout(()=>{g()},300)),r.strategy===Te.SentinelMsg&&k&&0===k.data.length&&g()}});d.closed.then(()=>{i()}).catch(S=>{n.stop(S)});const g=S=>{S&&n.push(()=>{throw S}),w(),d.drain().then(()=>{i()}).catch(k=>{i()})};n.iterClosed.then(()=>{w(),d?.unsubscribe()}).catch(S=>{w(),d?.unsubscribe()});try{this.publish(e,t,{reply:d.getSubject()})}catch(S){g(S)}let p=setTimeout(()=>{g()},r.maxWait);const w=()=>{p&&clearTimeout(p)}}else{const c=r;c.callback=o,n.iterClosed.then(()=>{f.cancel()}).catch(d=>{f.cancel(d)});const f=new li(this.protocol.muxSubscriptions,e,c);this.protocol.request(f);try{this.publish(e,t,{reply:`${this.protocol.muxSubscriptions.baseInbox}${f.token}`,headers:r.headers})}catch(d){f.cancel(d)}}return Promise.resolve(n)}request(e,t,r={timeout:1e3,noMux:!1}){try{this._check(e,!0,!0)}catch(n){return Promise.reject(n)}if(r.timeout=r.timeout||1e3,r.timeout<1)return Promise.reject(new $("timeout",M.InvalidOption));if(!r.noMux&&r.reply)return Promise.reject(new $("reply can only be used with noMux",M.InvalidOption));if(r.noMux){const n=r.reply?r.reply:v(this.options.inboxPrefix),i=F(),o=new Error;return this.subscribe(n,{max:1,timeout:r.timeout,callback:(f,d)=>{f?(f.code!==M.Timeout&&(f.stack+=`\n\n${o.stack}`),i.reject(f)):(f=ms(d))?(f.stack+=`\n\n${o.stack}`,i.reject(f)):i.resolve(d)}}).requestSubject=e,this.protocol.publish(e,t,{reply:n,headers:r.headers}),i}{const n=new js(this.protocol.muxSubscriptions,e,r);this.protocol.request(n);try{this.publish(e,t,{reply:`${this.protocol.muxSubscriptions.baseInbox}${n.token}`,headers:r.headers})}catch(o){n.cancel(o)}const i=Promise.race([n.timer,n.deferred]);return i.catch(()=>{n.cancel()}),i}}flush(){return this.isClosed()?Promise.reject($.errorForCode(M.ConnectionClosed)):this.protocol.flush()}drain(){return this.isClosed()?Promise.reject($.errorForCode(M.ConnectionClosed)):this.isDraining()?Promise.reject($.errorForCode(M.ConnectionDraining)):(this.draining=!0,this.protocol.drain())}isClosed(){return this.protocol.isClosed()}isDraining(){return this.draining}getServer(){const e=this.protocol.getServer();return e?e.listen:""}status(){const e=new _e;return e.iterClosed.then(()=>{const t=this.listeners.indexOf(e);this.listeners.splice(t,1)}),this.listeners.push(e),e}get info(){return this.protocol.isClosed()?void 0:this.protocol.info}stats(){return{inBytes:this.protocol.inBytes,outBytes:this.protocol.outBytes,inMsgs:this.protocol.inMsgs,outMsgs:this.protocol.outMsgs}}jetstreamManager(e={}){var t=this;return(0,j.Z)(function*(){const r=new co(t,e);try{yield r.getAccountInfo()}catch(n){const i=n;throw i.code===M.NoResponders&&(i.code=M.JetStreamNotEnabled),i}return r})()}jetstream(e={}){return new zr(this,e)}getServerVersion(){const e=this.info;return e?it(e.version):void 0}rtt(){var e=this;return(0,j.Z)(function*(){if(!e.protocol._closed&&!e.protocol.connected)throw $.errorForCode(M.Disconnect);const t=Date.now();return yield e.flush(),Date.now()-t})()}get features(){return this.protocol.features}get services(){return this._services||(this._services=new po(this)),this._services}}class po{nc;constructor(e){this.nc=e}add(e){try{return new Bt(this.nc,e).start()}catch(t){return Promise.reject(t)}}client(e,t){return new mo(this.nc,e,t)}}class wo{version;lang;closeError;connected;done;socket;options;socketClosed;encrypted;peeked;yields;signal;closedNotification;constructor(){this.version="1.18.0",this.lang="nats.ws",this.connected=!1,this.done=!1,this.socketClosed=!1,this.encrypted=!1,this.peeked=!1,this.yields=[],this.signal=F(),this.closedNotification=F()}connect(e,t){var r=this;return(0,j.Z)(function*(){const i=F();if(t.tls)return i.reject(new $("tls",M.InvalidOption)),i;r.options=t;const o=e.src;if(t.wsFactory){const{socket:c,encrypted:f}=yield t.wsFactory(e.src,t);r.socket=c,r.encrypted=f}else r.encrypted=0===o.indexOf("wss://"),r.socket=new WebSocket(o);return r.socket.binaryType="arraybuffer",r.socket.onopen=()=>{r.isDiscarded()},r.socket.onmessage=c=>{if(r.isDiscarded())return;if(r.yields.push(new Uint8Array(c.data)),r.peeked)return void r.signal.resolve();const f=ge.concat(...r.yields),d=function gn(s){const e=function bn(s){for(let e=0;e<s.length;e++){const t=e+1;if(s.byteLength>t&&s[e]===mn&&s[t]===pn)return t+1}return 0}(s);if(e>0){const r=new Uint8Array(s).slice(0,e);return ce.decode(r)}return""}(f);if(""!==d){const g=oi.exec(d);if(!g)return t.debug&&console.error("!!!",Z(f)),void i.reject(new Error("unexpected response from server"));try{(function ni(s,e){const{proto:t,tls_required:r,tls_available:n}=s;if((void 0===t||t<1)&&e.noEcho)throw new $("noEcho",M.ServerOptionNotAvailable);if(e.tls&&!r&&!n)throw new $("tls",M.ServerOptionNotAvailable)})(JSON.parse(g[1]),r.options),r.peeked=!0,r.connected=!0,r.signal.resolve(),i.resolve()}catch(p){return void i.reject(p)}}},r.socket.onclose=c=>{if(r.isDiscarded())return;let f;r.socketClosed=!0,r.done||(c.wasClean||(f=new Error(c.reason)),r._closed(f))},r.socket.onerror=c=>{if(r.isDiscarded())return;const d=new $(c.message,M.Unknown,new Error(c.error));i.reject(d)},i})()}disconnect(){this._closed(void 0,!0)}_closed(e,t=!0){var r=this;return(0,j.Z)(function*(){if(!r.isDiscarded()&&r.connected&&!r.done){if(r.closeError=e,!e)for(;!r.socketClosed&&r.socket.bufferedAmount>0;)yield B(100);r.done=!0;try{r.socket.close(e?1002:1e3,e?e.message:void 0)}catch{}t&&r.closedNotification.resolve(e)}})()}get isClosed(){return this.done}[Symbol.asyncIterator](){return this.iterate()}iterate(){var e=this;return we(function*(){for(;;){if(e.isDiscarded())return;0===e.yields.length&&(yield te(e.signal));const t=e.yields;e.yields=[];for(let r=0;r<t.length;r++)e.options.debug&&console.info(`> ${Z(t[r])}`),yield t[r];if(e.done)break;0===e.yields.length&&(t.length=0,e.yields=t,e.signal=F())}})()}isEncrypted(){return this.connected&&this.encrypted}send(e){if(!this.isDiscarded())try{return this.socket.send(e.buffer),void(this.options.debug&&console.info(`< ${Z(e)}`))}catch(t){this.options.debug&&console.error(`!!! ${Z(e)}: ${t}`)}}close(e){return this._closed(e,!1)}closed(){return this.closedNotification}isDiscarded(){return!!this.done&&(this.discard(),!0)}discard(){this.done=!0;try{this.socket?.close()}catch{}}}function vo(s){/^(.*:\/\/)(.*)/.test(s)||(s=`https://${s}`);let t=new URL(s);const r=t.protocol.toLowerCase();let n,i;"https:"!==r&&"http"!==r&&(s=s.replace(/^(.*:\/\/)(.*)/gm,"$2"),t=new URL(`http://${s}`));const o=t.hostname,c=t.pathname,f=t.search||"";switch(r){case"http:":case"ws:":case"nats:":i=t.port||"80",n="ws:";break;default:i=t.port||"443",n="wss:"}return`${n}//${o}:${i}${c}${f}`}q(6021);let Vr=class{#t;#e;#r;#s=Ae();#n;constructor(e){this.#t=e||{name:""}}connect(e,t,r){var n=this;return(0,j.Z)(function*(){try{n.#e=yield function So(s={}){return function Fe(s){ae=s}({defaultPort:443,urlParseFn:vo,factory:()=>new wo}),Kr.connect(s)}({servers:e,user:t,pass:r})}catch(i){console.error(i)}n.#r=yield n.#e.jetstream()})()}publish(e,t){var r=this;return(0,j.Z)(function*(){try{const n={data:t};yield r.#r.publish(e,r.#s.encode(n))}catch(n){console.log(n)}})()}unsubscribe(){void 0!==this.#n?this.#n.close():console.error("Should have subscribed first")}subscribe(e=hr.Pull,t,r){return new ee.Observable(n=>{(e===hr.Pull?this.#o(t):this.#i(t,r)).then(o=>{this.#n=o,n.next(o)})})}#i(e,t){var r=this;return(0,j.Z)(function*(){return t?(yield r.#r.consumers.get(r.#t.name,{filterSubjects:e,inactive_threshold:1e3,deliver_policy:t})).consume():(yield r.#r.consumers.get(r.#t.name,{filterSubjects:e,inactive_threshold:1e3})).consume()})()}#o(e){var t=this;return(0,j.Z)(function*(){return(yield t.#r.consumers.get(t.#t.name,e)).consume()})()}request(e,t){const r=new ee.Subject;let n;return n=(0,ee.from)(null!=t&&""!==t&&0!==t&&!1!==t?this.#e.request(`core.${e}`,this.#s.encode({data:t})):this.#e.request(`core.${e}`,this.#s.encode({data:{}}))),n.subscribe(c=>{r.next(this.#s.decode(c.data))}),r.asObservable()}drain(){var e=this;return(0,j.Z)(function*(){yield e.#e.drain()})()}};Vr=(0,le.gn)([(0,ie.Injectable)({providedIn:"root"})],Vr);var hr=function(s){return s.Pull="pull",s.Push="push",s}(hr||{}),Vs=function(s){return s.None="none",s.All="all",s.Explicit="explicit",s.NotSet="",s}(Vs||{}),Ws=function(s){return s.Limits="limits",s.Interest="interest",s.Workqueue="workqueue",s}(Ws||{}),Ys=function(s){return s.All="all",s.Last="last",s.New="new",s.StartSequence="by_start_sequence",s.StartTime="by_start_time",s.LastPerSubject="last_per_subject",s}(Ys||{})},2743:(Et,je,q)=>{q.d(je,{S:()=>H});var j=q(5861),le=q(5863),ie=q(9159);let H=(()=>{class z{#t="ws://localhost:8080";#e=(0,le.inject)(ie.JetstreamWsService);connect(){var oe=this;return(0,j.Z)(function*(){console.log("connected"),yield oe.#e.connect(oe.#t)})()}disconnect(){var oe=this;return(0,j.Z)(function*(){yield oe.#e.drain()})()}static#r=this.\u0275fac=function(we){return new(we||z)};static#s=this.\u0275prov=le.\u0275\u0275defineInjectable({token:z,factory:z.\u0275fac,providedIn:"root"})}return z})()},176:(Et,je,q)=>{q.r(je);var j=q(1201),le=q(5863),ie=q(6701),ee=q(3850),H=q(7752);const z=[{path:"login",loadComponent:()=>q.e(3107).then(q.bind(q,3107)).then(X=>X.LoginComponent)},{path:"login/:token",loadComponent:()=>q.e(3107).then(q.bind(q,3107)).then(X=>X.LoginComponent)},{path:"",loadComponent:()=>q.e(5207).then(q.bind(q,5207)).then(X=>X.NavigationViewComponent),children:[{path:"home",loadComponent:()=>q.e(4799).then(q.bind(q,4799)).then(X=>X.UserProfileComponent)},{path:"news",loadComponent:()=>q.e(4864).then(q.bind(q,931)).then(X=>X.NewsInfoComponent)},{path:"appStore",loadComponent:()=>q.e(9191).then(q.bind(q,9191)).then(X=>X.AppStoreComponent)}]}];var te=q(6753),oe=q(3433),we=q(1519);const he={providers:[(0,ie.provideRouter)(z,(0,ie.withComponentInputBinding)()),(0,ee.provideAnimations)(),(0,H.provideHttpClient)(),{provide:te.JetstreamWsService,useValue:new te.JetstreamWsService({name:"OPD"})},(0,le.importProvidersFrom)(oe.TranslateModule.forRoot({loader:{provide:oe.TranslateLoader,useFactory:function re(X){return new we.TranslateHttpLoader(X,"../../assets/i18n/",".json")},deps:[H.HttpClient]}}))]};var ce=q(5861),Pt=q(575),Me=q(2743);(0,j.bootstrapApplication)((()=>{class X{constructor(){this.title="app-portal",this.#t=(0,le.inject)(Me.S),this.#e=(0,le.inject)(oe.TranslateService)}#t;#e;ngOnInit(){var Ye=this;return(0,ce.Z)(function*(){yield Ye.#t.connect(),Ye.#e.setDefaultLang("zh-Hant")})()}static#r=this.\u0275fac=function(Xe){return new(Xe||X)};static#s=this.\u0275cmp=le.\u0275\u0275defineComponent({type:X,selectors:[["app-root"]],standalone:!0,features:[le.\u0275\u0275StandaloneFeature],decls:1,vars:0,template:function(Xe,Vt){1&Xe&&le.\u0275\u0275element(0,"router-outlet")},dependencies:[Pt.CommonModule,ie.RouterOutlet,oe.TranslateModule]})}return X})(),he).catch(X=>console.error(X))},6296:(Et,je,q)=>{function j(ie){var ee,H,z,te=2;for(typeof Symbol<"u"&&(H=Symbol.asyncIterator,z=Symbol.iterator);te--;){if(H&&null!=(ee=ie[H]))return ee.call(ie);if(z&&null!=(ee=ie[z]))return new le(ee.call(ie));H="@@asyncIterator",z="@@iterator"}throw new TypeError("Object is not async iterable")}function le(ie){function ee(H){if(Object(H)!==H)return Promise.reject(new TypeError(H+" is not an object."));var z=H.done;return Promise.resolve(H.value).then(function(te){return{value:te,done:z}})}return(le=function(z){this.s=z,this.n=z.next}).prototype={s:null,n:null,next:function(){return ee(this.n.apply(this.s,arguments))},return:function(z){var te=this.s.return;return void 0===te?Promise.resolve({value:z,done:!0}):ee(te.apply(this.s,arguments))},throw:function(z){var te=this.s.return;return void 0===te?Promise.reject(z):ee(te.apply(this.s,arguments))}},new le(ie)}q.d(je,{Z:()=>j})},5861:(Et,je,q)=>{function j(ie,ee,H,z,te,oe,we){try{var re=ie[oe](we),he=re.value}catch(ce){return void H(ce)}re.done?ee(he):Promise.resolve(he).then(z,te)}function le(ie){return function(){var ee=this,H=arguments;return new Promise(function(z,te){var oe=ie.apply(ee,H);function we(he){j(oe,z,te,we,re,"next",he)}function re(he){j(oe,z,te,we,re,"throw",he)}we(void 0)})}}q.d(je,{Z:()=>le})},7582:(Et,je,q)=>{function H(_,x,E,v){var L,T=arguments.length,I=T<3?x:null===v?v=Object.getOwnPropertyDescriptor(x,E):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)I=Reflect.decorate(_,x,E,v);else for(var Z=_.length-1;Z>=0;Z--)(L=_[Z])&&(I=(T<3?L(I):T>3?L(x,E,I):L(x,E))||I);return T>3&&I&&Object.defineProperty(x,E,I),I}function ce(_,x,E,v){return new(E||(E=Promise))(function(I,L){function Z(F){try{B(v.next(F))}catch(me){L(me)}}function de(F){try{B(v.throw(F))}catch(me){L(me)}}function B(F){F.done?I(F.value):function T(I){return I instanceof E?I:new E(function(L){L(I)})}(F.value).then(Z,de)}B((v=v.apply(_,x||[])).next())})}function Ge(_){return this instanceof Ge?(this.v=_,this):new Ge(_)}function Wt(_,x,E){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var T,v=E.apply(_,x||[]),I=[];return T={},L("next"),L("throw"),L("return"),T[Symbol.asyncIterator]=function(){return this},T;function L(ue){v[ue]&&(T[ue]=function(ge){return new Promise(function(ae,Fe){I.push([ue,ge,ae,Fe])>1||Z(ue,ge)})})}function Z(ue,ge){try{!function de(ue){ue.value instanceof Ge?Promise.resolve(ue.value.v).then(B,F):me(I[0][2],ue)}(v[ue](ge))}catch(ae){me(I[0][3],ae)}}function B(ue){Z("next",ue)}function F(ue){Z("throw",ue)}function me(ue,ge){ue(ge),I.shift(),I.length&&Z(I[0][0],I[0][1])}}function Yt(_){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var E,x=_[Symbol.asyncIterator];return x?x.call(_):(_=function X(_){var x="function"==typeof Symbol&&Symbol.iterator,E=x&&_[x],v=0;if(E)return E.call(_);if(_&&"number"==typeof _.length)return{next:function(){return _&&v>=_.length&&(_=void 0),{value:_&&_[v++],done:!_}}};throw new TypeError(x?"Object is not iterable.":"Symbol.iterator is not defined.")}(_),E={},v("next"),v("throw"),v("return"),E[Symbol.asyncIterator]=function(){return this},E);function v(I){E[I]=_[I]&&function(L){return new Promise(function(Z,de){!function T(I,L,Z,de){Promise.resolve(de).then(function(B){I({value:B,done:Z})},L)}(Z,de,(L=_[I](L)).done,L.value)})}}}q.d(je,{FC:()=>Wt,KL:()=>Yt,gn:()=>H,mG:()=>ce,qq:()=>Ge}),"function"==typeof SuppressedError&&SuppressedError}}]);