(self.webpackChunkapp_portal=self.webpackChunkapp_portal||[]).push([[3107,3395],{9159:(Zr,vt,ge)=>{ge.r(vt),ge.d(vt,{AckPolicy:()=>Cn,DeliverPolicy:()=>Pn,JSONCodec:()=>Ge,JetstreamWsService:()=>Rs,RetentionPolicy:()=>An,SubscribeType:()=>ns});var B=ge(5861),d=ge(7582),Ke=ge(5863),Ze=ge(5126),fe=ge(6296);function Me(s,e){this.v=s,this.k=e}function Oe(s){return new Me(s,0)}function X(s){var e,t;function r(i,o){try{var c=s[i](o),m=c.value,S=m instanceof Me;Promise.resolve(S?m.v:m).then(function(I){if(S){var P="return"===i?"return":"next";if(!m.k||I.done)return r(P,I);I=s[P](I).value}n(c.done?"return":"normal",I)},function(I){r("throw",I)})}catch(I){n("throw",I)}}function n(i,o){switch(i){case"return":e.resolve({value:o,done:!0});break;case"throw":e.reject(o);break;default:e.resolve({value:o,done:!1})}(e=e.next)?r(e.key,e.arg):t=null}this._invoke=function(i,o){return new Promise(function(c,m){var S={key:i,arg:o,resolve:c,reject:m,next:null};t?t=t.next=S:(e=t=S,r(i,o))})},"function"!=typeof s.return&&(this.return=void 0)}function $e(s){return function(){return new X(s.apply(this,arguments))}}X.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},X.prototype.next=function(s){return this._invoke("next",s)},X.prototype.throw=function(s){return this._invoke("throw",s)},X.prototype.return=function(s){return this._invoke("return",s)};const ye=new Uint8Array(0),ve=new TextEncoder,Te=new TextDecoder;function ct(...s){const e=[];for(let t=0;t<s.length;t++)e.push(ve.encode(s[t]));return 0===e.length?ye:1===e.length?e[0]:function it(...s){let e=0;for(let n=0;n<s.length;n++)e+=s[n].length;const t=new Uint8Array(e);let r=0;for(let n=0;n<s.length;n++)t.set(s[n],r),r+=s[n].length;return t}(...e)}function Ce(s){return s&&0!==s.length?Te.decode(s):""}const dt="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";const Et=new class Fe{buf;seq;inc;constructor(){this.buf=new Uint8Array(22),this.init()}init(){this.setPre(),this.initSeqAndInc(),this.fillSeq()}initSeqAndInc(){this.seq=Math.floor(0xcfd41b9100000*Math.random()),this.inc=Math.floor(300*Math.random()+33)}setPre(){const e=new Uint8Array(12);!function Ht(s){globalThis?.crypto?.getRandomValues?globalThis.crypto.getRandomValues(s):function St(s){for(let e=0;e<s.length;e++)s[e]=Math.floor(255*Math.random())}(s)}(e);for(let t=0;t<12;t++)this.buf[t]=dt.charCodeAt(e[t]%36)}fillSeq(){let e=this.seq;for(let t=21;t>=12;t--)this.buf[t]=dt.charCodeAt(e%36),e=Math.floor(e/36)}next(){return this.seq+=this.inc,this.seq>0xcfd41b9100000&&(this.setPre(),this.initSeqAndInc()),this.fillSeq(),String.fromCharCode.apply(String,this.buf)}reset(){this.init()}};var qe=function(s){return s.Disconnect="disconnect",s.Reconnect="reconnect",s.Update="update",s.LDM="ldm",s.Error="error",s}(qe||{}),ut=function(s){return s.Reconnecting="reconnecting",s.PingTimer="pingTimer",s.StaleConnection="staleConnection",s}(ut||{}),G=function(s){return s.ApiError="BAD API",s.BadAuthentication="BAD_AUTHENTICATION",s.BadCreds="BAD_CREDS",s.BadHeader="BAD_HEADER",s.BadJson="BAD_JSON",s.BadPayload="BAD_PAYLOAD",s.BadSubject="BAD_SUBJECT",s.Cancelled="CANCELLED",s.ConnectionClosed="CONNECTION_CLOSED",s.ConnectionDraining="CONNECTION_DRAINING",s.ConnectionRefused="CONNECTION_REFUSED",s.ConnectionTimeout="CONNECTION_TIMEOUT",s.Disconnect="DISCONNECT",s.InvalidOption="INVALID_OPTION",s.InvalidPayload="INVALID_PAYLOAD",s.MaxPayloadExceeded="MAX_PAYLOAD_EXCEEDED",s.NoResponders="503",s.NotFunction="NOT_FUNC",s.RequestError="REQUEST_ERROR",s.ServerOptionNotAvailable="SERVER_OPT_NA",s.SubClosed="SUB_CLOSED",s.SubDraining="SUB_DRAINING",s.Timeout="TIMEOUT",s.Tls="TLS",s.Unknown="UNKNOWN_ERROR",s.WssRequired="WSS_REQUIRED",s.JetStreamInvalidAck="JESTREAM_INVALID_ACK",s.JetStream404NoMessages="404",s.JetStream408RequestTimeout="408",s.JetStream409MaxAckPendingExceeded="409",s.JetStream409="409",s.JetStreamNotEnabled="503",s.JetStreamIdleHeartBeat="IDLE_HEARTBEAT",s.AuthorizationViolation="AUTHORIZATION_VIOLATION",s.AuthenticationExpired="AUTHENTICATION_EXPIRED",s.ProtocolError="NATS_PROTOCOL_ERR",s.PermissionsViolation="PERMISSIONS_VIOLATION",s.AuthenticationTimeout="AUTHENTICATION_TIMEOUT",s}(G||{});class jt{messages;constructor(){this.messages=new Map,this.messages.set(G.InvalidPayload,"Invalid payload type - payloads can be 'binary', 'string', or 'json'"),this.messages.set(G.BadJson,"Bad JSON"),this.messages.set(G.WssRequired,"TLS is required, therefore a secure websocket connection is also required")}static getMessage(e){return Wt.getMessage(e)}getMessage(e){return this.messages.get(e)||e}}const Wt=new jt;class Q extends Error{name;message;code;permissionContext;chainedError;api_error;constructor(e,t,r){super(e),this.name="NatsError",this.message=e,this.code=t,this.chainedError=r}static errorForCode(e,t){const r=jt.getMessage(e);return new Q(r,e,t)}isAuthError(){return this.code===G.AuthenticationExpired||this.code===G.AuthorizationViolation}isAuthTimeout(){return this.code===G.AuthenticationTimeout}isPermissionError(){return this.code===G.PermissionsViolation}isProtocolError(){return this.code===G.ProtocolError}isJetStreamError(){return void 0!==this.api_error}jsError(){return this.api_error?this.api_error:null}}var Ve=function(s){return s[s.Exact=0]="Exact",s[s.CanonicalMIME=1]="CanonicalMIME",s[s.IgnoreCase=2]="IgnoreCase",s}(Ve||{}),rt=function(s){return s.Timer="timer",s.Count="count",s.JitterTimer="jitterTimer",s.SentinelMsg="sentinelMsg",s}(rt||{}),bt=function(s){return s.STATS="io.nats.micro.v1.stats_response",s.INFO="io.nats.micro.v1.info_response",s.PING="io.nats.micro.v1.ping_response",s}(bt||{});const h="Nats-Service-Error",j="Nats-Service-Error-Code";class M extends Error{code;constructor(e,t){super(t),this.code=e}static isServiceError(e){return null!==M.toServiceError(e)}static toServiceError(e){const t=e?.headers?.get(j)||"";if(""!==t){const r=parseInt(t)||400,n=e?.headers?.get(h)||"";return new M(r,n.length?n:t)}return null}}function T(s=""){if("string"!=typeof(s=s||"_INBOX"))throw new Error("prefix must be a string");return s.split(".").forEach(e=>{if("*"===e||">"===e)throw new Error(`inbox prefixes cannot have wildcards '${s}'`)}),`${s}.${Et.next()}`}const V="127.0.0.1";var K=function(s){return s.PING="PING",s.STATS="STATS",s.INFO="INFO",s}(K||{});function te(s,...e){for(let t=0;t<e.length;t++){const r=e[t];Object.keys(r).forEach(function(n){s[n]=r[n]})}return s}function pe(s){return Te.decode(s).replace(/\n/g,"\u240a").replace(/\r/g,"\u240d")}function Ne(s){const e=Q.errorForCode(G.Timeout);let t,r;const n=new Promise((i,o)=>{t={cancel:()=>{r&&clearTimeout(r)}},r=setTimeout(()=>{o(e)},s)});return Object.assign(n,t)}function ie(s=0){return new Promise(e=>{setTimeout(()=>{e()},s)})}function ce(){let s={};const e=new Promise((t,r)=>{s={resolve:t,reject:r}});return Object.assign(e,s)}function je(s){for(let e=s.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[s[e],s[t]]=[s[t],s[e]]}return s}class Be{buffers;byteLength;constructor(){this.buffers=[],this.byteLength=0}static concat(...e){let t=0;for(let i=0;i<e.length;i++)t+=e[i].length;const r=new Uint8Array(t);let n=0;for(let i=0;i<e.length;i++)r.set(e[i],n),n+=e[i].length;return r}static fromAscii(e){return e||(e=""),ve.encode(e)}static toAscii(e){return Te.decode(e)}reset(){this.buffers.length=0,this.byteLength=0}pack(){if(this.buffers.length>1){const e=new Uint8Array(this.byteLength);let t=0;for(let r=0;r<this.buffers.length;r++)e.set(this.buffers[r],t),t+=this.buffers[r].length;this.buffers.length=0,this.buffers.push(e)}}shift(){if(this.buffers.length){const e=this.buffers.shift();if(e)return this.byteLength-=e.length,e}return new Uint8Array(0)}drain(e){if(this.buffers.length){this.pack();const t=this.buffers.pop();if(t){const r=this.byteLength;(void 0===e||e>r)&&(e=r);const n=t.subarray(0,e);return r>e&&this.buffers.push(t.subarray(e)),this.byteLength=r-e,n}}return new Uint8Array(0)}fill(e,...t){e&&(this.buffers.push(e),this.byteLength+=e.length);for(let r=0;r<t.length;r++)t[r]&&t[r].length&&(this.buffers.push(t[r]),this.byteLength+=t[r].length)}peek(){return this.buffers.length?(this.pack(),this.buffers[0]):new Uint8Array(0)}size(){return this.byteLength}length(){return this.buffers.length}}let Ae;function De(){return void 0!==Ae&&void 0!==Ae.defaultPort?Ae.defaultPort:4222}function lt(){return void 0!==Ae&&Ae.urlParseFn?Ae.urlParseFn:void 0}function Mt(){return void 0!==Ae&&Ae.dnsResolveFn?Ae.dnsResolveFn:void 0}const Ct=Be.fromAscii("\r\n"),Xt=new Uint8Array(Ct)[0],Qt=new Uint8Array(Ct)[1];const Er=4,E=48,u=65,y=97;function A(s){return void 0!==function R(s){for(let e=0;e<s.length;e++)switch(s[e]){case".":return D(s);case":":return ee(s)}}(s)}function D(s){const e=new Uint8Array(4);for(let t=0;t<4;t++){if(0===s.length)return;if(t>0){if("."!==s[0])return;s=s.substring(1)}const{n:r,c:n,ok:i}=z(s);if(!i||r>255)return;s=s.substring(n),e[t]=r}return function _(s,e,t,r){const n=new Uint8Array(16);return[0,0,0,0,0,0,0,0,0,0,255,255].forEach((o,c)=>{n[c]=o}),n[12]=s,n[13]=e,n[14]=t,n[15]=r,n}(e[0],e[1],e[2],e[3])}function ee(s){const e=new Uint8Array(16);let t=-1;if(s.length>=2&&":"===s[0]&&":"===s[1]&&(t=0,0===(s=s.substring(2)).length))return e;let r=0;for(;r<16;){const{n,c:i,ok:o}=W(s);if(!o||n>65535)return;if(i<s.length&&"."===s[i]){if(t<0&&12!=r||r+4>16)return;const c=D(s);if(void 0===c)return;e[r]=c[12],e[r+1]=c[13],e[r+2]=c[14],e[r+3]=c[15],s="",r+=Er;break}if(e[r]=n>>8,e[r+1]=n,r+=2,0===(s=s.substring(i)).length)break;if(":"!==s[0]||1==s.length)return;if(":"===(s=s.substring(1))[0]){if(t>=0)return;if(t=r,0===(s=s.substring(1)).length)break}}if(0===s.length){if(r<16){if(t<0)return;const n=16-r;for(let i=r-1;i>=t;i--)e[i+n]=e[i];for(let i=t+n-1;i>=t;i--)e[i]=0}else if(t>=0)return;return e}}function z(s){let e=0,t=0;for(e=0;e<s.length&&48<=s.charCodeAt(e)&&s.charCodeAt(e)<=57;e++)if(t=10*t+(s.charCodeAt(e)-E),t>=16777215)return{n:16777215,c:e,ok:!1};return 0===e?{n:0,c:0,ok:!1}:{n:t,c:e,ok:!0}}function W(s){let e=0,t=0;for(t=0;t<s.length;t++){if(48<=s.charCodeAt(t)&&s.charCodeAt(t)<=57)e*=16,e+=s.charCodeAt(t)-E;else if(97<=s.charCodeAt(t)&&s.charCodeAt(t)<=102)e*=16,e+=s.charCodeAt(t)-y+10;else{if(!(65<=s.charCodeAt(t)&&s.charCodeAt(t)<=70))break;e*=16,e+=s.charCodeAt(t)-u+10}if(e>=16777215)return{n:0,c:t,ok:!1}}return 0===t?{n:0,c:t,ok:!1}:{n:e,c:t,ok:!0}}function $(s){return!function se(s){return-1!==s.indexOf(".")||-1===s.indexOf("[")&&-1===s.indexOf("::")&&s.split(":").length<=2}(s)}class ne{src;listen;hostname;port;didConnect;reconnects;lastConnect;gossiped;tlsName;resolves;constructor(e,t=!1){this.src=e,this.tlsName="";const r=function ae(s){(s=s.trim()).match(/^(.*:\/\/)(.*)/m)&&(s=s.replace(/^(.*:\/\/)(.*)/gm,"$2")),s=function Y(s){const t=s.toUpperCase().indexOf("::FFFF:");if(-1!==t&&-1!==s.indexOf(".")){let r=s.substring(t+7);return r=r.replace("[",""),r.replace("]","")}return s}(s),$(s)&&-1===s.indexOf("[")&&(s=`[${s}]`);const e=$(s)?s.match(/(]:)(\d+)/):s.match(/(:)(\d+)/),t=e&&3===e.length&&e[1]&&e[2]?parseInt(e[2]):4222,n=new URL(`${80===t?"https":"http"}://${s}`);n.port=`${t}`;let i=n.hostname;return"["===i.charAt(0)&&(i=i.substring(1,i.length-1)),{listen:n.host,hostname:i,port:t}}(e);this.listen=r.listen,this.hostname=r.hostname,this.port=r.port,this.didConnect=!1,this.reconnects=0,this.lastConnect=0,this.gossiped=t}toString(){return this.listen}resolve(e){var t=this;return(0,B.Z)(function*(){if(!e.fn)return[t];const r=[];if(A(t.hostname))return[t];{const n=yield e.fn(t.hostname);e.debug&&console.log(`resolve ${t.hostname} = ${n.join(",")}`);for(const i of n){const c=new URL(`${80===t.port?"https":"http"}://${$(i)?"["+i+"]":i}`);c.port=`${t.port}`;const m=new ne(c.host,!1);m.tlsName=t.hostname,r.push(m)}}return e.randomize&&je(r),t.resolves=r,r})()}}class he{firstSelect;servers;currentServer;tlsName;randomize;constructor(e=[],t={}){this.firstSelect=!0,this.servers=[],this.tlsName="",this.randomize=t.randomize||!1;const r=lt();e&&(e.forEach(n=>{n=r?r(n):n,this.servers.push(new ne(n))}),this.randomize&&(this.servers=je(this.servers))),0===this.servers.length&&this.addServer(`${V}:${De()}`,!1),this.currentServer=this.servers[0]}clear(){this.servers.length=0}updateTLSName(){const e=this.getCurrentServer();A(e.hostname)||(this.tlsName=e.hostname,this.servers.forEach(t=>{t.gossiped&&(t.tlsName=this.tlsName)}))}getCurrentServer(){return this.currentServer}addServer(e,t=!1){const r=lt();e=r?r(e):e;const n=new ne(e,t);A(n.hostname)&&(n.tlsName=this.tlsName),this.servers.push(n)}selectServer(){if(this.firstSelect)return this.firstSelect=!1,this.currentServer;const e=this.servers.shift();return e&&(this.servers.push(e),this.currentServer=e),e}removeCurrentServer(){this.removeServer(this.currentServer)}removeServer(e){if(e){const t=this.servers.indexOf(e);this.servers.splice(t,1)}}length(){return this.servers.length}next(){return this.servers.length?this.servers[0]:void 0}getServers(){return this.servers}update(e){const t=[];let r=[];const n=lt(),i=new Map;e.connect_urls&&e.connect_urls.length>0&&e.connect_urls.forEach(c=>{c=n?n(c):c;const m=new ne(c,!0);i.set(c,m)});const o=[];return this.servers.forEach((c,m)=>{const S=c.listen;c.gossiped&&this.currentServer.listen!==S&&void 0===i.get(S)&&o.push(m),i.delete(S)}),o.reverse(),o.forEach(c=>{const m=this.servers.splice(c,1);r=r.concat(m[0].listen)}),i.forEach((c,m)=>{this.servers.push(c),t.push(m)}),{added:t,deleted:r}}}class ue{inflight;processed;received;noIterator;iterClosed;done;signal;yields;filtered;pendingFiltered;ingestionFilterFn;protocolFilterFn;dispatchedFn;ctx;_data;err;time;constructor(){this.inflight=0,this.filtered=0,this.pendingFiltered=0,this.processed=0,this.received=0,this.noIterator=!1,this.done=!1,this.signal=ce(),this.yields=[],this.iterClosed=ce(),this.time=0}[Symbol.asyncIterator](){return this.iterate()}push(e){if(this.done)return;if("function"==typeof e)return this.yields.push(e),void this.signal.resolve();const{ingest:t,protocol:r}=this.ingestionFilterFn?this.ingestionFilterFn(e,this.ctx||this):{ingest:!0,protocol:!1};t&&(r&&(this.filtered++,this.pendingFiltered++),this.yields.push(e),this.signal.resolve())}iterate(){var e=this;return $e(function*(){if(e.noIterator)throw new Q("unsupported iterator",G.ApiError);try{for(;;){if(0===e.yields.length&&(yield Oe(e.signal)),e.err)throw e.err;const t=e.yields;e.inflight=t.length,e.yields=[];for(let r=0;r<t.length;r++)if("function"!=typeof t[r]){if(!e.protocolFilterFn||e.protocolFilterFn(t[r])){e.processed++;const i=Date.now();yield t[r],e.time=Date.now()-i,e.dispatchedFn&&t[r]&&e.dispatchedFn(t[r])}else e.pendingFiltered--;e.inflight--}else{const i=t[r];try{i()}catch(o){throw o}if(e.err)throw e.err}if(e.done)break;0===e.yields.length&&(t.length=0,e.yields=t,e.signal=ce())}}finally{e.stop()}})()}stop(e){this.done||(this.err=e,this.done=!0,this.signal.resolve(),this.iterClosed.resolve())}getProcessed(){return this.noIterator?this.received:this.processed}getPending(){return this.yields.length+this.inflight-this.pendingFiltered}getReceived(){return this.received-this.filtered}}function He(s){let r=!0;const n=new Array(s.length);for(let i=0;i<s.length;i++){let o=s.charCodeAt(i);if(58===o||o<33||o>126)throw new Q(`'${s[i]}' is not a valid character for a header key`,G.BadHeader);r&&97<=o&&o<=122?o-=32:!r&&65<=o&&o<=90&&(o+=32),n[i]=o,r=45==o}return String.fromCharCode(...n)}function me(s=0,e=""){if(0===s&&""!==e||s>0&&""===e)throw new Error("setting status requires both code and description");return new Ie(s,e)}const et="NATS/1.0";class Ie{_code;headers;_description;constructor(e=0,t=""){this._code=e,this._description=t,this.headers=new Map}[Symbol.iterator](){return this.headers.entries()}size(){return this.headers.size}equals(e){if(e&&this.headers.size===e.headers.size&&this._code===e._code){for(const[t,r]of this.headers){const n=e.values(t);if(r.length!==n.length)return!1;const i=[...r].sort(),o=[...n].sort();for(let c=0;c<i.length;c++)if(i[c]!==o[c])return!1}return!0}return!1}static decode(e){const t=new Ie,n=Te.decode(e).split("\r\n"),i=n[0];if(i!==et){let o=i.replace(et,"").trim();if(o.length>0){t._code=parseInt(o,10),isNaN(t._code)&&(t._code=0);const c=t._code.toString();o=o.replace(c,""),t._description=o.trim()}}return n.length>=1&&n.slice(1).map(o=>{if(o){const c=o.indexOf(":");if(c>-1){const m=o.slice(0,c),S=o.slice(c+1).trim();t.append(m,S)}}}),t}toString(){if(0===this.headers.size&&0===this._code)return"";let e=et;this._code>0&&""!==this._description&&(e+=` ${this._code} ${this._description}`);for(const[t,r]of this.headers)for(let n=0;n<r.length;n++)e=`${e}\r\n${t}: ${r[n]}`;return`${e}\r\n\r\n`}encode(){return ve.encode(this.toString())}static validHeaderValue(e){if(/[\r\n]/.test(e))throw new Q("invalid header value - \\r and \\n are not allowed.",G.BadHeader);return e.trim()}keys(){const e=[];for(const t of this.headers.keys())e.push(t);return e}findKeys(e,t=Ve.Exact){const r=this.keys();switch(t){case Ve.Exact:return r.filter(n=>n===e);case Ve.CanonicalMIME:return e=He(e),r.filter(n=>n===e);default:{const n=e.toLowerCase();return r.filter(i=>n===i.toLowerCase())}}}get(e,t=Ve.Exact){const r=this.findKeys(e,t);if(r.length){const n=this.headers.get(r[0]);if(n)return Array.isArray(n)?n[0]:n}return""}has(e,t=Ve.Exact){return this.findKeys(e,t).length>0}set(e,t,r=Ve.Exact){this.delete(e,r),this.append(e,t,r)}append(e,t,r=Ve.Exact){const n=He(e);r===Ve.CanonicalMIME&&(e=n);const i=this.findKeys(e,r);e=i.length>0?i[0]:e;const o=Ie.validHeaderValue(t);let c=this.headers.get(e);c||(c=[],this.headers.set(e,c)),c.push(o)}values(e,t=Ve.Exact){const r=[];return this.findKeys(e,t).forEach(i=>{const o=this.headers.get(i);o&&r.push(...o)}),r}delete(e,t=Ve.Exact){this.findKeys(e,t).forEach(n=>{this.headers.delete(n)})}get hasError(){return this._code>=300}get status(){return`${this._code} ${this._description}`.trim()}toRecord(){const e={};return this.keys().forEach(t=>{e[t]=this.values(t)}),e}get code(){return this._code}get description(){return this._description}static fromRecord(e){const t=new Ie;for(const r in e)t.headers.set(r,e[r]);return t}}function Ge(s){return{encode(e){try{return void 0===e&&(e=null),ve.encode(JSON.stringify(e))}catch(t){throw Q.errorForCode(G.BadJson,t)}},decode(e){try{return JSON.parse(Te.decode(e),s)}catch(t){throw Q.errorForCode(G.BadJson,t)}}}}function nr(s){return s&&0===s.data.length&&503===s.headers?.code?Q.errorForCode(G.NoResponders):null}let ir=(()=>class s{_headers;_msg;_rdata;_reply;_subject;publisher;static jc;constructor(t,r,n){this._msg=t,this._rdata=r,this.publisher=n}get subject(){return this._subject||(this._subject=Te.decode(this._msg.subject)),this._subject}get reply(){return this._reply||(this._reply=Te.decode(this._msg.reply)),this._reply}get sid(){return this._msg.sid}get headers(){if(this._msg.hdr>-1&&!this._headers){const t=this._rdata.subarray(0,this._msg.hdr);this._headers=Ie.decode(t)}return this._headers}get data(){return this._rdata?this._msg.hdr>-1?this._rdata.subarray(this._msg.hdr):this._rdata:new Uint8Array(0)}respond(t=ye,r){return!!this.reply&&(this.publisher.publish(this.reply,t,r),!0)}size(){return this._msg.subject.length+(this._msg.reply?.length||0)+(-1===this._msg.size?0:this._msg.size)}json(t){return Ge(t).decode(this.data)}string(){return Te.decode(this.data)}})();class Gr{baseInbox;reqs;constructor(){this.reqs=new Map}size(){return this.reqs.size}init(e){return this.baseInbox=`${T(e)}.`,this.baseInbox}add(e){isNaN(e.received)||(e.received=0),this.reqs.set(e.token,e)}get(e){return this.reqs.get(e)}cancel(e){this.reqs.delete(e.token)}getToken(e){const t=e.subject||"";return 0===t.indexOf(this.baseInbox)?t.substring(this.baseInbox.length):null}all(){return Array.from(this.reqs.values())}handleError(e,t){if(t&&t.permissionContext){if(e)return this.all().forEach(n=>{n.resolver(t,{})}),!0;const r=t.permissionContext;if("publish"===r.operation){const n=this.all().find(i=>i.requestSubject===r.subject);if(n)return n.resolver(t,{}),!0}}return!1}dispatcher(){return(e,t)=>{const r=this.getToken(t);if(r){const n=this.get(r);n&&(null===e&&t.headers&&(e=nr(t)),n.resolver(e,t))}}}close(){const e=Q.errorForCode(G.Timeout);this.reqs.forEach(t=>{t.resolver(e,{})})}}class gs{ph;interval;maxOut;timer;pendings;constructor(e,t,r){this.ph=e,this.interval=t,this.maxOut=r,this.pendings=[]}start(){this.cancel(),this._schedule()}cancel(e){this.timer&&(clearTimeout(this.timer),this.timer=void 0),this._reset(),e&&this.ph.disconnect()}_schedule(){this.timer=setTimeout(()=>{if(this.ph.dispatchStatus({type:ut.PingTimer,data:`${this.pendings.length+1}`}),this.pendings.length===this.maxOut)return void this.cancel(!0);const e=ce();this.ph.flush(e).then(()=>{this._reset()}).catch(()=>{this.cancel()}),this.pendings.push(e),this._schedule()},this.interval)}_reset(){this.pendings=this.pendings.filter(e=>(e.resolve(),!1))}}class Jr extends Error{constructor(e){super(e),this.name="AssertionError"}}const or=2**32-2;function ar(s,e,t=0){const r=e.byteLength-t;return s.byteLength>r&&(s=s.subarray(0,r)),e.set(s,t),s.byteLength}class Ar{_buf;_off;constructor(e){this._off=0,this._buf=null!=e?new Uint8Array(e):new Uint8Array(0)}bytes(e={copy:!0}){return!1===e.copy?this._buf.subarray(this._off):this._buf.slice(this._off)}empty(){return this._buf.byteLength<=this._off}get length(){return this._buf.byteLength-this._off}get capacity(){return this._buf.buffer.byteLength}truncate(e){if(0!==e){if(e<0||e>this.length)throw Error("bytes.Buffer: truncation out of range");this._reslice(this._off+e)}else this.reset()}reset(){this._reslice(0),this._off=0}_tryGrowByReslice(e){const t=this._buf.byteLength;return e<=this.capacity-t?(this._reslice(t+e),t):-1}_reslice(e){(function Vr(s,e="Assertion failed."){if(!s)throw new Jr(e)})(e<=this._buf.buffer.byteLength),this._buf=new Uint8Array(this._buf.buffer,0,e)}readByte(){const e=new Uint8Array(1);return this.read(e)?e[0]:null}read(e){if(this.empty())return this.reset(),0===e.byteLength?0:null;const t=ar(this._buf.subarray(this._off),e);return this._off+=t,t}writeByte(e){return this.write(Uint8Array.of(e))}writeString(e){return this.write(ve.encode(e))}write(e){const t=this._grow(e.byteLength);return ar(e,this._buf,t)}_grow(e){const t=this.length;0===t&&0!==this._off&&this.reset();const r=this._tryGrowByReslice(e);if(r>=0)return r;const n=this.capacity;if(e<=Math.floor(n/2)-t)ar(this._buf.subarray(this._off),this._buf);else{if(n+e>or)throw new Error("The buffer cannot be grown beyond the maximum size.");{const i=new Uint8Array(Math.min(2*n+e,or));ar(this._buf.subarray(this._off),i),this._buf=i}}return this._off=0,this._reslice(Math.min(t+e,or)),t}grow(e){if(e<0)throw Error("Buffer._grow: negative count");const t=this._grow(e);this._reslice(t)}readFrom(e){let t=0;const r=new Uint8Array(32768);for(;;){const n=this.capacity-this.length<32768,i=n?r:new Uint8Array(this._buf.buffer,this.length),o=e.read(i);if(null===o)return t;n?this.write(i.subarray(0,o)):this._reslice(this.length+o),t+=o}}}var nt=function(s){return s[s.OK=0]="OK",s[s.ERR=1]="ERR",s[s.MSG=2]="MSG",s[s.INFO=3]="INFO",s[s.PING=4]="PING",s[s.PONG=5]="PONG",s}(nt||{});class v{dispatcher;state;as;drop;hdr;ma;argBuf;msgBuf;constructor(e){this.dispatcher=e,this.state=g.OP_START,this.as=0,this.drop=0,this.hdr=0}parse(e){let t;for(t=0;t<e.length;t++){const r=e[t];switch(this.state){case g.OP_START:switch(r){case w.M:case w.m:this.state=g.OP_M,this.hdr=-1,this.ma={sid:-1,hdr:-1,size:-1};break;case w.H:case w.h:this.state=g.OP_H,this.hdr=0,this.ma={sid:-1,hdr:-1,size:-1};break;case w.P:case w.p:this.state=g.OP_P;break;case w.PLUS:this.state=g.OP_PLUS;break;case w.MINUS:this.state=g.OP_MINUS;break;case w.I:case w.i:this.state=g.OP_I;break;default:throw this.fail(e.subarray(t))}break;case g.OP_H:switch(r){case w.M:case w.m:this.state=g.OP_M;break;default:throw this.fail(e.subarray(t))}break;case g.OP_M:switch(r){case w.S:case w.s:this.state=g.OP_MS;break;default:throw this.fail(e.subarray(t))}break;case g.OP_MS:switch(r){case w.G:case w.g:this.state=g.OP_MSG;break;default:throw this.fail(e.subarray(t))}break;case g.OP_MSG:switch(r){case w.SPACE:case w.TAB:this.state=g.OP_MSG_SPC;break;default:throw this.fail(e.subarray(t))}break;case g.OP_MSG_SPC:switch(r){case w.SPACE:case w.TAB:continue;default:this.state=g.MSG_ARG,this.as=t}break;case g.MSG_ARG:switch(r){case w.CR:this.drop=1;break;case w.NL:{const n=this.argBuf?this.argBuf.bytes():e.subarray(this.as,t-this.drop);this.processMsgArgs(n),this.drop=0,this.as=t+1,this.state=g.MSG_PAYLOAD,t=this.as+this.ma.size-1;break}default:this.argBuf&&this.argBuf.writeByte(r)}break;case g.MSG_PAYLOAD:if(this.msgBuf)if(this.msgBuf.length>=this.ma.size){const n=this.msgBuf.bytes({copy:!1});this.dispatcher.push({kind:nt.MSG,msg:this.ma,data:n}),this.argBuf=void 0,this.msgBuf=void 0,this.state=g.MSG_END}else{let n=this.ma.size-this.msgBuf.length;const i=e.length-t;i<n&&(n=i),n>0?(this.msgBuf.write(e.subarray(t,t+n)),t=t+n-1):this.msgBuf.writeByte(r)}else t-this.as>=this.ma.size&&(this.dispatcher.push({kind:nt.MSG,msg:this.ma,data:e.subarray(this.as,t)}),this.argBuf=void 0,this.msgBuf=void 0,this.state=g.MSG_END);break;case g.MSG_END:if(r!==w.NL)continue;this.drop=0,this.as=t+1,this.state=g.OP_START;break;case g.OP_PLUS:switch(r){case w.O:case w.o:this.state=g.OP_PLUS_O;break;default:throw this.fail(e.subarray(t))}break;case g.OP_PLUS_O:switch(r){case w.K:case w.k:this.state=g.OP_PLUS_OK;break;default:throw this.fail(e.subarray(t))}break;case g.OP_PLUS_OK:r===w.NL&&(this.dispatcher.push({kind:nt.OK}),this.drop=0,this.state=g.OP_START);break;case g.OP_MINUS:switch(r){case w.E:case w.e:this.state=g.OP_MINUS_E;break;default:throw this.fail(e.subarray(t))}break;case g.OP_MINUS_E:switch(r){case w.R:case w.r:this.state=g.OP_MINUS_ER;break;default:throw this.fail(e.subarray(t))}break;case g.OP_MINUS_ER:switch(r){case w.R:case w.r:this.state=g.OP_MINUS_ERR;break;default:throw this.fail(e.subarray(t))}break;case g.OP_MINUS_ERR:switch(r){case w.SPACE:case w.TAB:this.state=g.OP_MINUS_ERR_SPC;break;default:throw this.fail(e.subarray(t))}break;case g.OP_MINUS_ERR_SPC:switch(r){case w.SPACE:case w.TAB:continue;default:this.state=g.MINUS_ERR_ARG,this.as=t}break;case g.MINUS_ERR_ARG:switch(r){case w.CR:this.drop=1;break;case w.NL:{let n;this.argBuf?(n=this.argBuf.bytes(),this.argBuf=void 0):n=e.subarray(this.as,t-this.drop),this.dispatcher.push({kind:nt.ERR,data:n}),this.drop=0,this.as=t+1,this.state=g.OP_START;break}default:this.argBuf&&this.argBuf.write(Uint8Array.of(r))}break;case g.OP_P:switch(r){case w.I:case w.i:this.state=g.OP_PI;break;case w.O:case w.o:this.state=g.OP_PO;break;default:throw this.fail(e.subarray(t))}break;case g.OP_PO:switch(r){case w.N:case w.n:this.state=g.OP_PON;break;default:throw this.fail(e.subarray(t))}break;case g.OP_PON:switch(r){case w.G:case w.g:this.state=g.OP_PONG;break;default:throw this.fail(e.subarray(t))}break;case g.OP_PONG:r===w.NL&&(this.dispatcher.push({kind:nt.PONG}),this.drop=0,this.state=g.OP_START);break;case g.OP_PI:switch(r){case w.N:case w.n:this.state=g.OP_PIN;break;default:throw this.fail(e.subarray(t))}break;case g.OP_PIN:switch(r){case w.G:case w.g:this.state=g.OP_PING;break;default:throw this.fail(e.subarray(t))}break;case g.OP_PING:r===w.NL&&(this.dispatcher.push({kind:nt.PING}),this.drop=0,this.state=g.OP_START);break;case g.OP_I:switch(r){case w.N:case w.n:this.state=g.OP_IN;break;default:throw this.fail(e.subarray(t))}break;case g.OP_IN:switch(r){case w.F:case w.f:this.state=g.OP_INF;break;default:throw this.fail(e.subarray(t))}break;case g.OP_INF:switch(r){case w.O:case w.o:this.state=g.OP_INFO;break;default:throw this.fail(e.subarray(t))}break;case g.OP_INFO:switch(r){case w.SPACE:case w.TAB:this.state=g.OP_INFO_SPC;break;default:throw this.fail(e.subarray(t))}break;case g.OP_INFO_SPC:switch(r){case w.SPACE:case w.TAB:continue;default:this.state=g.INFO_ARG,this.as=t}break;case g.INFO_ARG:switch(r){case w.CR:this.drop=1;break;case w.NL:{let n;this.argBuf?(n=this.argBuf.bytes(),this.argBuf=void 0):n=e.subarray(this.as,t-this.drop),this.dispatcher.push({kind:nt.INFO,data:n}),this.drop=0,this.as=t+1,this.state=g.OP_START;break}default:this.argBuf&&this.argBuf.writeByte(r)}break;default:throw this.fail(e.subarray(t))}}(this.state===g.MSG_ARG||this.state===g.MINUS_ERR_ARG||this.state===g.INFO_ARG)&&!this.argBuf&&(this.argBuf=new Ar(e.subarray(this.as,t-this.drop))),this.state===g.MSG_PAYLOAD&&!this.msgBuf&&(this.argBuf||this.cloneMsgArg(),this.msgBuf=new Ar(e.subarray(this.as)))}cloneMsgArg(){const e=this.ma.subject.length,r=new Uint8Array(e+(this.ma.reply?this.ma.reply.length:0));r.set(this.ma.subject),this.ma.reply&&r.set(this.ma.reply,e),this.argBuf=new Ar(r),this.ma.subject=r.subarray(0,e),this.ma.reply&&(this.ma.reply=r.subarray(e))}processMsgArgs(e){if(this.hdr>=0)return this.processHeaderMsgArgs(e);const t=[];let r=-1;for(let n=0;n<e.length;n++)switch(e[n]){case w.SPACE:case w.TAB:case w.CR:case w.NL:r>=0&&(t.push(e.subarray(r,n)),r=-1);break;default:r<0&&(r=n)}switch(r>=0&&t.push(e.subarray(r)),t.length){case 3:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=void 0,this.ma.size=this.protoParseInt(t[2]);break;case 4:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=t[2],this.ma.size=this.protoParseInt(t[3]);break;default:throw this.fail(e,"processMsgArgs Parse Error")}if(this.ma.sid<0)throw this.fail(e,"processMsgArgs Bad or Missing Sid Error");if(this.ma.size<0)throw this.fail(e,"processMsgArgs Bad or Missing Size Error")}fail(e,t=""){return t=t?`${t} [${this.state}]`:`parse error [${this.state}]`,new Error(`${t}: ${Te.decode(e)}`)}processHeaderMsgArgs(e){const t=[];let r=-1;for(let n=0;n<e.length;n++)switch(e[n]){case w.SPACE:case w.TAB:case w.CR:case w.NL:r>=0&&(t.push(e.subarray(r,n)),r=-1);break;default:r<0&&(r=n)}switch(r>=0&&t.push(e.subarray(r)),t.length){case 4:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=void 0,this.ma.hdr=this.protoParseInt(t[2]),this.ma.size=this.protoParseInt(t[3]);break;case 5:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=t[2],this.ma.hdr=this.protoParseInt(t[3]),this.ma.size=this.protoParseInt(t[4]);break;default:throw this.fail(e,"processHeaderMsgArgs Parse Error")}if(this.ma.sid<0)throw this.fail(e,"processHeaderMsgArgs Bad or Missing Sid Error");if(this.ma.hdr<0||this.ma.hdr>this.ma.size)throw this.fail(e,"processHeaderMsgArgs Bad or Missing Header Size Error");if(this.ma.size<0)throw this.fail(e,"processHeaderMsgArgs Bad or Missing Size Error")}protoParseInt(e){if(0===e.length)return-1;let t=0;for(let r=0;r<e.length;r++){if(e[r]<48||e[r]>57)return-1;t=10*t+(e[r]-48)}return t}}var g=function(s){return s[s.OP_START=0]="OP_START",s[s.OP_PLUS=1]="OP_PLUS",s[s.OP_PLUS_O=2]="OP_PLUS_O",s[s.OP_PLUS_OK=3]="OP_PLUS_OK",s[s.OP_MINUS=4]="OP_MINUS",s[s.OP_MINUS_E=5]="OP_MINUS_E",s[s.OP_MINUS_ER=6]="OP_MINUS_ER",s[s.OP_MINUS_ERR=7]="OP_MINUS_ERR",s[s.OP_MINUS_ERR_SPC=8]="OP_MINUS_ERR_SPC",s[s.MINUS_ERR_ARG=9]="MINUS_ERR_ARG",s[s.OP_M=10]="OP_M",s[s.OP_MS=11]="OP_MS",s[s.OP_MSG=12]="OP_MSG",s[s.OP_MSG_SPC=13]="OP_MSG_SPC",s[s.MSG_ARG=14]="MSG_ARG",s[s.MSG_PAYLOAD=15]="MSG_PAYLOAD",s[s.MSG_END=16]="MSG_END",s[s.OP_H=17]="OP_H",s[s.OP_P=18]="OP_P",s[s.OP_PI=19]="OP_PI",s[s.OP_PIN=20]="OP_PIN",s[s.OP_PING=21]="OP_PING",s[s.OP_PO=22]="OP_PO",s[s.OP_PON=23]="OP_PON",s[s.OP_PONG=24]="OP_PONG",s[s.OP_I=25]="OP_I",s[s.OP_IN=26]="OP_IN",s[s.OP_INF=27]="OP_INF",s[s.OP_INFO=28]="OP_INFO",s[s.OP_INFO_SPC=29]="OP_INFO_SPC",s[s.INFO_ARG=30]="INFO_ARG",s}(g||{}),w=function(s){return s[s.CR="\r".charCodeAt(0)]="CR",s[s.E="E".charCodeAt(0)]="E",s[s.e="e".charCodeAt(0)]="e",s[s.F="F".charCodeAt(0)]="F",s[s.f="f".charCodeAt(0)]="f",s[s.G="G".charCodeAt(0)]="G",s[s.g="g".charCodeAt(0)]="g",s[s.H="H".charCodeAt(0)]="H",s[s.h="h".charCodeAt(0)]="h",s[s.I="I".charCodeAt(0)]="I",s[s.i="i".charCodeAt(0)]="i",s[s.K="K".charCodeAt(0)]="K",s[s.k="k".charCodeAt(0)]="k",s[s.M="M".charCodeAt(0)]="M",s[s.m="m".charCodeAt(0)]="m",s[s.MINUS="-".charCodeAt(0)]="MINUS",s[s.N="N".charCodeAt(0)]="N",s[s.n="n".charCodeAt(0)]="n",s[s.NL="\n".charCodeAt(0)]="NL",s[s.O="O".charCodeAt(0)]="O",s[s.o="o".charCodeAt(0)]="o",s[s.P="P".charCodeAt(0)]="P",s[s.p="p".charCodeAt(0)]="p",s[s.PLUS="+".charCodeAt(0)]="PLUS",s[s.R="R".charCodeAt(0)]="R",s[s.r="r".charCodeAt(0)]="r",s[s.S="S".charCodeAt(0)]="S",s[s.s="s".charCodeAt(0)]="s",s[s.SPACE=" ".charCodeAt(0)]="SPACE",s[s.TAB="\t".charCodeAt(0)]="TAB",s}(w||{});function J(s=""){const e=s.match(/(\d+).(\d+).(\d+)/);if(e)return{major:parseInt(e[1]),minor:parseInt(e[2]),micro:parseInt(e[3])};throw new Error(`'${s}' is not a semver value`)}function de(s,e){return s.major<e.major?-1:s.major>e.major?1:s.minor<e.minor?-1:s.minor>e.minor?1:s.micro<e.micro?-1:s.micro>e.micro?1:0}var oe=function(s){return s.JS_KV="js_kv",s.JS_OBJECTSTORE="js_objectstore",s.JS_PULL_MAX_BYTES="js_pull_max_bytes",s.JS_NEW_CONSUMER_CREATE_API="js_new_consumer_create",s.JS_ALLOW_DIRECT="js_allow_direct",s.JS_MULTIPLE_CONSUMER_FILTER="js_multiple_consumer_filter",s.JS_SIMPLIFICATION="js_simplification",s.JS_STREAM_CONSUMER_METADATA="js_stream_consumer_metadata",s.JS_CONSUMER_FILTER_SUBJECTS="js_consumer_filter_subjects",s.JS_STREAM_FIRST_SEQ="js_stream_first_seq",s.JS_STREAM_SUBJECT_TRANSFORM="js_stream_subject_transform",s.JS_STREAM_SOURCE_SUBJECT_TRANSFORM="js_stream_source_subject_transform",s.JS_STREAM_COMPRESSION="js_stream_compression",s.JS_DEFAULT_CONSUMER_LIMITS="js_default_consumer_limits",s}(oe||{});class Se{server;features;disabled;constructor(e){this.features=new Map,this.disabled=[],this.update(e)}resetDisabled(){this.disabled.length=0,this.update(this.server)}disable(e){this.disabled.push(e),this.update(this.server)}isDisabled(e){return-1!==this.disabled.indexOf(e)}update(e){"string"==typeof e&&(e=J(e)),this.server=e,this.set(oe.JS_KV,"2.6.2"),this.set(oe.JS_OBJECTSTORE,"2.6.3"),this.set(oe.JS_PULL_MAX_BYTES,"2.8.3"),this.set(oe.JS_NEW_CONSUMER_CREATE_API,"2.9.0"),this.set(oe.JS_ALLOW_DIRECT,"2.9.0"),this.set(oe.JS_MULTIPLE_CONSUMER_FILTER,"2.10.0"),this.set(oe.JS_SIMPLIFICATION,"2.9.4"),this.set(oe.JS_STREAM_CONSUMER_METADATA,"2.10.0"),this.set(oe.JS_CONSUMER_FILTER_SUBJECTS,"2.10.0"),this.set(oe.JS_STREAM_FIRST_SEQ,"2.10.0"),this.set(oe.JS_STREAM_SUBJECT_TRANSFORM,"2.10.0"),this.set(oe.JS_STREAM_SOURCE_SUBJECT_TRANSFORM,"2.10.0"),this.set(oe.JS_STREAM_COMPRESSION,"2.10.0"),this.set(oe.JS_DEFAULT_CONSUMER_LIMITS,"2.10.0"),this.disabled.forEach(t=>{this.features.delete(t)})}set(e,t){this.features.set(e,{min:t,ok:de(this.server,J(t))>=0})}get(e){return this.features.get(e)||{min:"unknown",ok:!1}}supports(e){return this.get(e)?.ok||!1}require(e){return"string"==typeof e&&(e=J(e)),de(this.server,e)>=0}}!function(s){"use strict";var e=function(a,f){this.hi=0|a,this.lo=0|f},t=function(a){var f,l=new Float64Array(16);if(a)for(f=0;f<a.length;f++)l[f]=a[f];return l},r=function(){throw new Error("no PRNG")},n=new Uint8Array(16),i=new Uint8Array(32);i[0]=9;var o=t(),c=t([1]),m=t([56129,1]),S=t([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),I=t([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),P=t([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),N=t([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),U=t([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function q(a,f){return a<<f|a>>>32-f}function Z(a,f){var l=255&a[f+3];return(l=(l=l<<8|255&a[f+2])<<8|255&a[f+1])<<8|255&a[f+0]}function xe(a,f){return new e(a[f]<<24|a[f+1]<<16|a[f+2]<<8|a[f+3],a[f+4]<<24|a[f+5]<<16|a[f+6]<<8|a[f+7])}function le(a,f,l){var p;for(p=0;p<4;p++)a[f+p]=255&l,l>>>=8}function Ye(a,f,l){a[f]=l.hi>>24&255,a[f+1]=l.hi>>16&255,a[f+2]=l.hi>>8&255,a[f+3]=255&l.hi,a[f+4]=l.lo>>24&255,a[f+5]=l.lo>>16&255,a[f+6]=l.lo>>8&255,a[f+7]=255&l.lo}function We(a,f,l,p,C){var k,L=0;for(k=0;k<C;k++)L|=a[f+k]^l[p+k];return(1&L-1>>>8)-1}function At(a,f,l,p){return We(a,f,l,p,16)}function Jt(a,f,l,p){return We(a,f,l,p,32)}function pr(a,f,l,p,C){var F,re,_e,k=new Uint32Array(16),L=new Uint32Array(16),H=new Uint32Array(16),O=new Uint32Array(4);for(F=0;F<4;F++)L[5*F]=Z(p,4*F),L[1+F]=Z(l,4*F),L[6+F]=Z(f,4*F),L[11+F]=Z(l,16+4*F);for(F=0;F<16;F++)H[F]=L[F];for(F=0;F<20;F++){for(re=0;re<4;re++){for(_e=0;_e<4;_e++)O[_e]=L[(5*re+4*_e)%16];for(O[1]^=q(O[0]+O[3]|0,7),O[2]^=q(O[1]+O[0]|0,9),O[3]^=q(O[2]+O[1]|0,13),O[0]^=q(O[3]+O[2]|0,18),_e=0;_e<4;_e++)k[4*re+(re+_e)%4]=O[_e]}for(_e=0;_e<16;_e++)L[_e]=k[_e]}if(C){for(F=0;F<16;F++)L[F]=L[F]+H[F]|0;for(F=0;F<4;F++)L[5*F]=L[5*F]-Z(p,4*F)|0,L[6+F]=L[6+F]-Z(f,4*F)|0;for(F=0;F<4;F++)le(a,4*F,L[5*F]),le(a,16+4*F,L[6+F])}else for(F=0;F<16;F++)le(a,4*F,L[F]+H[F]|0)}function is(a,f,l,p){return pr(a,f,l,p,!1),0}function tr(a,f,l,p){return pr(a,f,l,p,!0),0}var Pt=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);function mr(a,f,l,p,C,k,L){var F,re,H=new Uint8Array(16),O=new Uint8Array(64);if(!C)return 0;for(re=0;re<16;re++)H[re]=0;for(re=0;re<8;re++)H[re]=k[re];for(;C>=64;){for(is(O,H,L,Pt),re=0;re<64;re++)a[f+re]=(l?l[p+re]:0)^O[re];for(F=1,re=8;re<16;re++)H[re]=255&(F=F+(255&H[re])|0),F>>>=8;C-=64,f+=64,l&&(p+=64)}if(C>0)for(is(O,H,L,Pt),re=0;re<C;re++)a[f+re]=(l?l[p+re]:0)^O[re];return 0}function os(a,f,l,p,C){return mr(a,f,null,0,l,p,C)}function gr(a,f,l,p,C){var k=new Uint8Array(32);return tr(k,p,C,Pt),os(a,f,l,p.subarray(16),k)}function Br(a,f,l,p,C,k,L){var H=new Uint8Array(32);return tr(H,k,L,Pt),mr(a,f,l,p,C,k.subarray(16),H)}function Vt(a,f){var l,p=0;for(l=0;l<17;l++)a[l]=255&(p=p+(a[l]+f[l]|0)|0),p>>>=8}var Eo=new Uint32Array([5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,252]);function Us(a,f,l,p,C,k){var L,H,O,F,re=new Uint32Array(17),_e=new Uint32Array(17),Ue=new Uint32Array(17),Ot=new Uint32Array(17),xr=new Uint32Array(17);for(O=0;O<17;O++)_e[O]=Ue[O]=0;for(O=0;O<16;O++)_e[O]=k[O];for(_e[3]&=15,_e[4]&=252,_e[7]&=15,_e[8]&=252,_e[11]&=15,_e[12]&=252,_e[15]&=15;C>0;){for(O=0;O<17;O++)Ot[O]=0;for(O=0;O<16&&O<C;++O)Ot[O]=l[p+O];for(Ot[O]=1,p+=O,C-=O,Vt(Ue,Ot),H=0;H<17;H++)for(re[H]=0,O=0;O<17;O++)re[H]=0|re[H]+Ue[O]*(O<=H?_e[H-O]:320*_e[H+17-O]|0);for(H=0;H<17;H++)Ue[H]=re[H];for(F=0,O=0;O<16;O++)Ue[O]=255&(F=F+Ue[O]|0),F>>>=8;for(Ue[16]=3&(F=F+Ue[16]|0),F=5*(F>>>2)|0,O=0;O<16;O++)Ue[O]=255&(F=F+Ue[O]|0),F>>>=8;Ue[16]=F=F+Ue[16]|0}for(O=0;O<17;O++)xr[O]=Ue[O];for(Vt(Ue,Eo),L=0|-(Ue[16]>>>7),O=0;O<17;O++)Ue[O]^=L&(xr[O]^Ue[O]);for(O=0;O<16;O++)Ot[O]=k[O+16];for(Ot[16]=0,Vt(Ue,Ot),O=0;O<16;O++)a[f+O]=Ue[O];return 0}function kn(a,f,l,p,C,k){var L=new Uint8Array(16);return Us(L,0,l,p,C,k),At(a,f,L,0)}function $s(a,f,l,p,C){var k;if(l<32)return-1;for(Br(a,0,f,0,l,p,C),Us(a,16,a,32,l-32,a),k=0;k<16;k++)a[k]=0;return 0}function Fs(a,f,l,p,C){var k,L=new Uint8Array(32);if(l<32||(gr(L,0,32,p,C),0!==kn(f,16,f,32,l-32,L)))return-1;for(Br(a,0,f,0,l,p,C),k=0;k<32;k++)a[k]=0;return 0}function Bt(a,f){var l;for(l=0;l<16;l++)a[l]=0|f[l]}function Lr(a){var f,l;for(l=0;l<16;l++)a[l]+=65536,f=Math.floor(a[l]/65536),a[(l+1)*(l<15?1:0)]+=f-1+37*(f-1)*(15===l?1:0),a[l]-=65536*f}function br(a,f,l){for(var p,C=~(l-1),k=0;k<16;k++)a[k]^=p=C&(a[k]^f[k]),f[k]^=p}function _r(a,f){var l,p,C,k=t(),L=t();for(l=0;l<16;l++)L[l]=f[l];for(Lr(L),Lr(L),Lr(L),p=0;p<2;p++){for(k[0]=L[0]-65517,l=1;l<15;l++)k[l]=L[l]-65535-(k[l-1]>>16&1),k[l-1]&=65535;k[15]=L[15]-32767-(k[14]>>16&1),C=k[15]>>16&1,k[14]&=65535,br(L,k,1-C)}for(l=0;l<16;l++)a[2*l]=255&L[l],a[2*l+1]=L[l]>>8}function In(a,f){var l=new Uint8Array(32),p=new Uint8Array(32);return _r(l,a),_r(p,f),Jt(l,0,p,0)}function On(a){var f=new Uint8Array(32);return _r(f,a),1&f[0]}function Bs(a,f){var l;for(l=0;l<16;l++)a[l]=f[2*l]+(f[2*l+1]<<8);a[15]&=32767}function kt(a,f,l){var p;for(p=0;p<16;p++)a[p]=f[p]+l[p]|0}function It(a,f,l){var p;for(p=0;p<16;p++)a[p]=f[p]-l[p]|0}function be(a,f,l){var p,C,k=new Float64Array(31);for(p=0;p<31;p++)k[p]=0;for(p=0;p<16;p++)for(C=0;C<16;C++)k[p+C]+=f[p]*l[C];for(p=0;p<15;p++)k[p]+=38*k[p+16];for(p=0;p<16;p++)a[p]=k[p];Lr(a),Lr(a)}function xt(a,f){be(a,f,f)}function jn(a,f){var p,l=t();for(p=0;p<16;p++)l[p]=f[p];for(p=253;p>=0;p--)xt(l,l),2!==p&&4!==p&&be(l,l,f);for(p=0;p<16;p++)a[p]=l[p]}function Mn(a,f){var p,l=t();for(p=0;p<16;p++)l[p]=f[p];for(p=250;p>=0;p--)xt(l,l),1!==p&&be(l,l,f);for(p=0;p<16;p++)a[p]=l[p]}function as(a,f,l){var k,L,p=new Uint8Array(32),C=new Float64Array(80),H=t(),O=t(),F=t(),re=t(),_e=t(),Ue=t();for(L=0;L<31;L++)p[L]=f[L];for(p[31]=127&f[31]|64,p[0]&=248,Bs(C,l),L=0;L<16;L++)O[L]=C[L],re[L]=H[L]=F[L]=0;for(H[0]=re[0]=1,L=254;L>=0;--L)br(H,O,k=p[L>>>3]>>>(7&L)&1),br(F,re,k),kt(_e,H,F),It(H,H,F),kt(F,O,re),It(O,O,re),xt(re,_e),xt(Ue,H),be(H,F,H),be(F,O,_e),kt(_e,H,F),It(H,H,F),xt(O,H),It(F,re,Ue),be(H,F,m),kt(H,H,re),be(F,F,H),be(H,re,Ue),be(re,O,C),xt(O,_e),br(H,O,k),br(F,re,k);for(L=0;L<16;L++)C[L+16]=H[L],C[L+32]=F[L],C[L+48]=O[L],C[L+64]=re[L];var Ot=C.subarray(32),xr=C.subarray(16);return jn(Ot,Ot),be(xr,xr,Ot),_r(a,xr),0}function cs(a,f){return as(a,f,i)}function Tn(a,f){return r(f,32),cs(a,f)}function us(a,f,l){var p=new Uint8Array(32);return as(p,l,f),tr(a,n,p,Pt)}var Nn=$s,Co=Fs;function qr(){var k,L,H,a=0,f=0,l=0,p=0,C=65535;for(H=0;H<arguments.length;H++)a+=(k=arguments[H].lo)&C,f+=k>>>16,l+=(L=arguments[H].hi)&C,p+=L>>>16;return new e((l+=(f+=a>>>16)>>>16)&C|(p+=l>>>16)<<16,a&C|f<<16)}function Rn(a,f){return new e(a.hi>>>f,a.lo>>>f|a.hi<<32-f)}function ls(){var l,a=0,f=0;for(l=0;l<arguments.length;l++)a^=arguments[l].lo,f^=arguments[l].hi;return new e(f,a)}function Nt(a,f){var l,p,C=32-f;return f<32?(l=a.hi>>>f|a.lo<<C,p=a.lo>>>f|a.hi<<C):f<64&&(l=a.lo>>>f|a.hi<<C,p=a.hi>>>f|a.lo<<C),new e(l,p)}function ko(a,f,l){return new e(a.hi&f.hi^~a.hi&l.hi,a.lo&f.lo^~a.lo&l.lo)}function Io(a,f,l){return new e(a.hi&f.hi^a.hi&l.hi^f.hi&l.hi,a.lo&f.lo^a.lo&l.lo^f.lo&l.lo)}function Oo(a){return ls(Nt(a,28),Nt(a,34),Nt(a,39))}function jo(a){return ls(Nt(a,14),Nt(a,18),Nt(a,41))}function Mo(a){return ls(Nt(a,1),Nt(a,8),Rn(a,7))}function To(a){return ls(Nt(a,19),Nt(a,61),Rn(a,6))}var No=[new e(1116352408,3609767458),new e(1899447441,602891725),new e(3049323471,3964484399),new e(3921009573,2173295548),new e(961987163,4081628472),new e(1508970993,3053834265),new e(2453635748,2937671579),new e(2870763221,3664609560),new e(3624381080,2734883394),new e(310598401,1164996542),new e(607225278,1323610764),new e(1426881987,3590304994),new e(1925078388,4068182383),new e(2162078206,991336113),new e(2614888103,633803317),new e(3248222580,3479774868),new e(3835390401,2666613458),new e(4022224774,944711139),new e(264347078,2341262773),new e(604807628,2007800933),new e(770255983,1495990901),new e(1249150122,1856431235),new e(1555081692,3175218132),new e(1996064986,2198950837),new e(2554220882,3999719339),new e(2821834349,766784016),new e(2952996808,2566594879),new e(3210313671,3203337956),new e(3336571891,1034457026),new e(3584528711,2466948901),new e(113926993,3758326383),new e(338241895,168717936),new e(666307205,1188179964),new e(773529912,1546045734),new e(1294757372,1522805485),new e(1396182291,2643833823),new e(1695183700,2343527390),new e(1986661051,1014477480),new e(2177026350,1206759142),new e(2456956037,344077627),new e(2730485921,1290863460),new e(2820302411,3158454273),new e(3259730800,3505952657),new e(3345764771,106217008),new e(3516065817,3606008344),new e(3600352804,1432725776),new e(4094571909,1467031594),new e(275423344,851169720),new e(430227734,3100823752),new e(506948616,1363258195),new e(659060556,3750685593),new e(883997877,3785050280),new e(958139571,3318307427),new e(1322822218,3812723403),new e(1537002063,2003034995),new e(1747873779,3602036899),new e(1955562222,1575990012),new e(2024104815,1125592928),new e(2227730452,2716904306),new e(2361852424,442776044),new e(2428436474,593698344),new e(2756734187,3733110249),new e(3204031479,2999351573),new e(3329325298,3815920427),new e(3391569614,3928383900),new e(3515267271,566280711),new e(3940187606,3454069534),new e(4118630271,4000239992),new e(116418474,1914138554),new e(174292421,2731055270),new e(289380356,3203993006),new e(460393269,320620315),new e(685471733,587496836),new e(852142971,1086792851),new e(1017036298,365543100),new e(1126000580,2618297676),new e(1288033470,3409855158),new e(1501505948,4234509866),new e(1607167915,987167468),new e(1816402316,1246189591)];function Un(a,f,l){var H,O,F,p=[],C=[],k=[],L=[];for(O=0;O<8;O++)p[O]=k[O]=xe(a,8*O);for(var re=0;l>=128;){for(O=0;O<16;O++)L[O]=xe(f,8*O+re);for(O=0;O<80;O++){for(F=0;F<8;F++)C[F]=k[F];for(H=qr(k[7],jo(k[4]),ko(k[4],k[5],k[6]),No[O],L[O%16]),C[7]=qr(H,Oo(k[0]),Io(k[0],k[1],k[2])),C[3]=qr(C[3],H),F=0;F<8;F++)k[(F+1)%8]=C[F];if(O%16==15)for(F=0;F<16;F++)L[F]=qr(L[F],L[(F+9)%16],Mo(L[(F+1)%16]),To(L[(F+14)%16]))}for(O=0;O<8;O++)k[O]=qr(k[O],p[O]),p[O]=k[O];re+=128,l-=128}for(O=0;O<8;O++)Ye(a,8*O,p[O]);return l}var Ro=new Uint8Array([106,9,230,103,243,188,201,8,187,103,174,133,132,202,167,59,60,110,243,114,254,148,248,43,165,79,245,58,95,29,54,241,81,14,82,127,173,230,130,209,155,5,104,140,43,62,108,31,31,131,217,171,251,65,189,107,91,224,205,25,19,126,33,121]);function rr(a,f,l){var k,p=new Uint8Array(64),C=new Uint8Array(256),L=l;for(k=0;k<64;k++)p[k]=Ro[k];for(Un(p,f,l),l%=128,k=0;k<256;k++)C[k]=0;for(k=0;k<l;k++)C[k]=f[L-l+k];for(C[l]=128,C[(l=256-128*(l<112?1:0))-9]=0,Ye(C,l-8,new e(L/536870912|0,L<<3)),Un(p,C,l),k=0;k<64;k++)a[k]=p[k];return 0}function hs(a,f){var l=t(),p=t(),C=t(),k=t(),L=t(),H=t(),O=t(),F=t(),re=t();It(l,a[1],a[0]),It(re,f[1],f[0]),be(l,l,re),kt(p,a[0],a[1]),kt(re,f[0],f[1]),be(p,p,re),be(C,a[3],f[3]),be(C,C,I),be(k,a[2],f[2]),kt(k,k,k),It(L,p,l),It(H,k,C),kt(O,k,C),kt(F,p,l),be(a[0],L,H),be(a[1],F,O),be(a[2],O,H),be(a[3],L,F)}function $n(a,f,l){var p;for(p=0;p<4;p++)br(a[p],f[p],l)}function Ls(a,f){var l=t(),p=t(),C=t();jn(C,f[2]),be(l,f[0],C),be(p,f[1],C),_r(a,p),a[31]^=On(l)<<7}function qs(a,f,l){var p,C;for(Bt(a[0],o),Bt(a[1],c),Bt(a[2],c),Bt(a[3],o),C=255;C>=0;--C)$n(a,f,p=l[C/8|0]>>(7&C)&1),hs(f,a),hs(a,a),$n(a,f,p)}function fs(a,f){var l=[t(),t(),t(),t()];Bt(l[0],P),Bt(l[1],N),Bt(l[2],c),be(l[3],P,N),qs(a,l,f)}function Ds(a,f,l){var k,p=new Uint8Array(64),C=[t(),t(),t(),t()];for(l||r(f,32),rr(p,f,32),p[0]&=248,p[31]&=127,p[31]|=64,fs(C,p),Ls(a,C),k=0;k<32;k++)f[k+32]=a[k];return 0}var a,ds=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function Hs(a,f){var l,p,C,k;for(p=63;p>=32;--p){for(l=0,C=p-32,k=p-12;C<k;++C)f[C]+=l-16*f[p]*ds[C-(p-32)],l=Math.floor((f[C]+128)/256),f[C]-=256*l;f[C]+=l,f[p]=0}for(l=0,C=0;C<32;C++)f[C]+=l-(f[31]>>4)*ds[C],l=f[C]>>8,f[C]&=255;for(C=0;C<32;C++)f[C]-=l*ds[C];for(p=0;p<32;p++)f[p+1]+=f[p]>>8,a[p]=255&f[p]}function zs(a){var l,f=new Float64Array(64);for(l=0;l<64;l++)f[l]=a[l];for(l=0;l<64;l++)a[l]=0;Hs(a,f)}function Fn(a,f,l,p){var H,O,C=new Uint8Array(64),k=new Uint8Array(64),L=new Uint8Array(64),F=new Float64Array(64),re=[t(),t(),t(),t()];rr(C,p,32),C[0]&=248,C[31]&=127,C[31]|=64;var _e=l+64;for(H=0;H<l;H++)a[64+H]=f[H];for(H=0;H<32;H++)a[32+H]=C[32+H];for(rr(L,a.subarray(32),l+32),zs(L),fs(re,L),Ls(a,re),H=32;H<64;H++)a[H]=p[H];for(rr(k,a,l+64),zs(k),H=0;H<64;H++)F[H]=0;for(H=0;H<32;H++)F[H]=L[H];for(H=0;H<32;H++)for(O=0;O<32;O++)F[H+O]+=k[H]*C[O];return Hs(a.subarray(32),F),_e}function Ks(a,f,l,p){var C,k=new Uint8Array(32),L=new Uint8Array(64),H=[t(),t(),t(),t()],O=[t(),t(),t(),t()];if(l<64||function Uo(a,f){var l=t(),p=t(),C=t(),k=t(),L=t(),H=t(),O=t();return Bt(a[2],c),Bs(a[1],f),xt(C,a[1]),be(k,C,S),It(C,C,a[2]),kt(k,a[2],k),xt(L,k),xt(H,L),be(O,H,L),be(l,O,C),be(l,l,k),Mn(l,l),be(l,l,C),be(l,l,k),be(l,l,k),be(a[0],l,k),xt(p,a[0]),be(p,p,k),In(p,C)&&be(a[0],a[0],U),xt(p,a[0]),be(p,p,k),In(p,C)?-1:(On(a[0])===f[31]>>7&&It(a[0],o,a[0]),be(a[3],a[0],a[1]),0)}(O,p))return-1;for(C=0;C<l;C++)a[C]=f[C];for(C=0;C<32;C++)a[C+32]=p[C];if(rr(L,a,l),zs(L),qs(H,O,L),fs(O,f.subarray(32)),hs(H,O),Ls(k,H),l-=64,Jt(f,0,k,0)){for(C=0;C<l;C++)a[C]=0;return-1}for(C=0;C<l;C++)a[C]=f[C+64];return l}function Ln(a,f){if(32!==a.length)throw new Error("bad key size");if(24!==f.length)throw new Error("bad nonce size")}function gt(){for(var a=0;a<arguments.length;a++)if(!(arguments[a]instanceof Uint8Array))throw new TypeError("unexpected type, use Uint8Array")}function qn(a){for(var f=0;f<a.length;f++)a[f]=0}s.lowlevel={crypto_core_hsalsa20:tr,crypto_stream_xor:Br,crypto_stream:gr,crypto_stream_salsa20_xor:mr,crypto_stream_salsa20:os,crypto_onetimeauth:Us,crypto_onetimeauth_verify:kn,crypto_verify_16:At,crypto_verify_32:Jt,crypto_secretbox:$s,crypto_secretbox_open:Fs,crypto_scalarmult:as,crypto_scalarmult_base:cs,crypto_box_beforenm:us,crypto_box_afternm:Nn,crypto_box:function Ao(a,f,l,p,C,k){var L=new Uint8Array(32);return us(L,C,k),Nn(a,f,l,p,L)},crypto_box_open:function Po(a,f,l,p,C,k){var L=new Uint8Array(32);return us(L,C,k),Co(a,f,l,p,L)},crypto_box_keypair:Tn,crypto_hash:rr,crypto_sign:Fn,crypto_sign_keypair:Ds,crypto_sign_open:Ks,crypto_secretbox_KEYBYTES:32,crypto_secretbox_NONCEBYTES:24,crypto_secretbox_ZEROBYTES:32,crypto_secretbox_BOXZEROBYTES:16,crypto_scalarmult_BYTES:32,crypto_scalarmult_SCALARBYTES:32,crypto_box_PUBLICKEYBYTES:32,crypto_box_SECRETKEYBYTES:32,crypto_box_BEFORENMBYTES:32,crypto_box_NONCEBYTES:24,crypto_box_ZEROBYTES:32,crypto_box_BOXZEROBYTES:16,crypto_sign_BYTES:64,crypto_sign_PUBLICKEYBYTES:32,crypto_sign_SECRETKEYBYTES:64,crypto_sign_SEEDBYTES:32,crypto_hash_BYTES:64,gf:t,D:S,L:ds,pack25519:_r,unpack25519:Bs,M:be,A:kt,S:xt,Z:It,pow2523:Mn,add:hs,set25519:Bt,modL:Hs,scalarmult:qs,scalarbase:fs},s.randomBytes=function(a){var f=new Uint8Array(a);return r(f,a),f},s.secretbox=function(a,f,l){gt(a,f,l),Ln(l,f);for(var p=new Uint8Array(32+a.length),C=new Uint8Array(p.length),k=0;k<a.length;k++)p[k+32]=a[k];return $s(C,p,p.length,f,l),C.subarray(16)},s.secretbox.open=function(a,f,l){gt(a,f,l),Ln(l,f);for(var p=new Uint8Array(16+a.length),C=new Uint8Array(p.length),k=0;k<a.length;k++)p[k+16]=a[k];return p.length<32||0!==Fs(C,p,p.length,f,l)?null:C.subarray(32)},s.secretbox.keyLength=32,s.secretbox.nonceLength=24,s.secretbox.overheadLength=16,s.scalarMult=function(a,f){if(gt(a,f),32!==a.length)throw new Error("bad n size");if(32!==f.length)throw new Error("bad p size");var l=new Uint8Array(32);return as(l,a,f),l},s.scalarMult.base=function(a){if(gt(a),32!==a.length)throw new Error("bad n size");var f=new Uint8Array(32);return cs(f,a),f},s.scalarMult.scalarLength=32,s.scalarMult.groupElementLength=32,s.box=function(a,f,l,p){var C=s.box.before(l,p);return s.secretbox(a,f,C)},s.box.before=function(a,f){gt(a,f),function Bo(a,f){if(32!==a.length)throw new Error("bad public key size");if(32!==f.length)throw new Error("bad secret key size")}(a,f);var l=new Uint8Array(32);return us(l,a,f),l},s.box.after=s.secretbox,s.box.open=function(a,f,l,p){var C=s.box.before(l,p);return s.secretbox.open(a,f,C)},s.box.open.after=s.secretbox.open,s.box.keyPair=function(){var a=new Uint8Array(32),f=new Uint8Array(32);return Tn(a,f),{publicKey:a,secretKey:f}},s.box.keyPair.fromSecretKey=function(a){if(gt(a),32!==a.length)throw new Error("bad secret key size");var f=new Uint8Array(32);return cs(f,a),{publicKey:f,secretKey:new Uint8Array(a)}},s.box.publicKeyLength=32,s.box.secretKeyLength=32,s.box.sharedKeyLength=32,s.box.nonceLength=24,s.box.overheadLength=s.secretbox.overheadLength,s.sign=function(a,f){if(gt(a,f),64!==f.length)throw new Error("bad secret key size");var l=new Uint8Array(64+a.length);return Fn(l,a,a.length,f),l},s.sign.open=function(a,f){if(gt(a,f),32!==f.length)throw new Error("bad public key size");var l=new Uint8Array(a.length),p=Ks(l,a,a.length,f);if(p<0)return null;for(var C=new Uint8Array(p),k=0;k<C.length;k++)C[k]=l[k];return C},s.sign.detached=function(a,f){for(var l=s.sign(a,f),p=new Uint8Array(64),C=0;C<p.length;C++)p[C]=l[C];return p},s.sign.detached.verify=function(a,f,l){if(gt(a,f,l),64!==f.length)throw new Error("bad signature size");if(32!==l.length)throw new Error("bad public key size");var k,p=new Uint8Array(64+a.length),C=new Uint8Array(64+a.length);for(k=0;k<64;k++)p[k]=f[k];for(k=0;k<a.length;k++)p[k+64]=a[k];return Ks(C,p,p.length,l)>=0},s.sign.keyPair=function(){var a=new Uint8Array(32),f=new Uint8Array(64);return Ds(a,f),{publicKey:a,secretKey:f}},s.sign.keyPair.fromSecretKey=function(a){if(gt(a),64!==a.length)throw new Error("bad secret key size");for(var f=new Uint8Array(32),l=0;l<f.length;l++)f[l]=a[32+l];return{publicKey:f,secretKey:new Uint8Array(a)}},s.sign.keyPair.fromSeed=function(a){if(gt(a),32!==a.length)throw new Error("bad seed size");for(var f=new Uint8Array(32),l=new Uint8Array(64),p=0;p<32;p++)l[p]=a[p];return Ds(f,l,!0),{publicKey:f,secretKey:l}},s.sign.publicKeyLength=32,s.sign.secretKeyLength=64,s.sign.seedLength=32,s.sign.signatureLength=64,s.hash=function(a){gt(a);var f=new Uint8Array(64);return rr(f,a,a.length),f},s.hash.hashLength=64,s.verify=function(a,f){return gt(a,f),0!==a.length&&0!==f.length&&a.length===f.length&&0===We(a,0,f,0,a.length)},s.setPRNG=function(a){r=a},(a=typeof globalThis<"u"?globalThis.crypto||globalThis.msCrypto:null)&&a.getRandomValues?s.setPRNG(function(l,p){var C,k=new Uint8Array(p);for(C=0;C<p;C+=65536)a.getRandomValues(k.subarray(C,C+Math.min(p-C,65536)));for(C=0;C<p;C++)l[C]=k[C];qn(k)}):typeof require<"u"&&(a=require("crypto"))&&a.randomBytes&&s.setPRNG(function(l,p){var C,k=a.randomBytes(p);for(C=0;C<p;C++)l[C]=k[C];qn(k)})}(typeof module<"u"&&module.exports?module.exports:globalThis.nacl=globalThis.nacl||{});const ze=typeof module<"u"&&module.exports?module.exports:globalThis.nacl,zt={fromSeed:ze.sign.keyPair.fromSeed,sign:ze.sign.detached,verify:ze.sign.detached.verify,randomBytes:ze.randomBytes};let Kt;new Uint16Array([0,4129,8258,12387,16516,20645,24774,28903,33032,37161,41290,45419,49548,53677,57806,61935,4657,528,12915,8786,21173,17044,29431,25302,37689,33560,45947,41818,54205,50076,62463,58334,9314,13379,1056,5121,25830,29895,17572,21637,42346,46411,34088,38153,58862,62927,50604,54669,13907,9842,5649,1584,30423,26358,22165,18100,46939,42874,38681,34616,63455,59390,55197,51132,18628,22757,26758,30887,2112,6241,10242,14371,51660,55789,59790,63919,35144,39273,43274,47403,23285,19156,31415,27286,6769,2640,14899,10770,56317,52188,64447,60318,39801,35672,47931,43802,27814,31879,19684,23749,11298,15363,3168,7233,60846,64911,52716,56781,44330,48395,36200,40265,32407,28342,24277,20212,15891,11826,7761,3696,65439,61374,57309,53244,48923,44858,40793,36728,37256,33193,45514,41451,53516,49453,61774,57711,4224,161,12482,8419,20484,16421,28742,24679,33721,37784,41979,46042,49981,54044,58239,62302,689,4752,8947,13010,16949,21012,25207,29270,46570,42443,38312,34185,62830,58703,54572,50445,13538,9411,5280,1153,29798,25671,21540,17413,42971,47098,34713,38840,59231,63358,50973,55100,9939,14066,1681,5808,26199,30326,17941,22068,55628,51565,63758,59695,39368,35305,47498,43435,22596,18533,30726,26663,6336,2273,14466,10403,52093,56156,60223,64286,35833,39896,43963,48026,19061,23124,27191,31254,2801,6864,10931,14994,64814,60687,56684,52557,48554,44427,40424,36297,31782,27655,23652,19525,15522,11395,7392,3265,61215,65342,53085,57212,44955,49082,36825,40952,28183,32310,20053,24180,11923,16050,3793,7920]),Error,function cr(s){Kt=s}(zt);function si(s){const e=`${V}:${De()}`;if((s=s||{servers:[e]}).servers=s.servers||[],"string"==typeof s.servers&&(s.servers=[s.servers]),s.servers.length>0&&s.port)throw new Q("port and servers options are mutually exclusive",G.InvalidOption);0===s.servers.length&&s.port&&(s.servers=[`${V}:${s.port}`]),s.servers&&0===s.servers.length&&(s.servers=[e]);const t=te({maxPingOut:2,maxReconnectAttempts:10,noRandomize:!1,pedantic:!1,pingInterval:12e4,reconnect:!0,reconnectJitter:100,reconnectJitterTLS:1e3,reconnectTimeWait:2e3,tls:void 0,verbose:!1,waitOnFirstConnect:!1,ignoreAuthErrorAbort:!1},s);if(t.authenticator=function ri(s){const e=[];return"function"==typeof s.authenticator&&e.push(s.authenticator),Array.isArray(s.authenticator)&&e.push(...s.authenticator),s.token&&e.push(function Wn(s){return()=>({auth_token:"function"==typeof s?s():s})}(s.token)),s.user&&e.push(function Yn(s,e){return()=>({user:"function"==typeof s?s():s,pass:"function"==typeof e?e():e})}(s.user,s.pass)),0===e.length?()=>{}:function Jn(s){return e=>{let t={};return s.forEach(r=>{const n=r(e)||{};t=Object.assign(t,n)}),t}}(e)}(t),["reconnectDelayHandler","authenticator"].forEach(r=>{if(t[r]&&"function"!=typeof t[r])throw new Q(`${r} option should be a function`,G.NotFunction)}),t.reconnectDelayHandler||(t.reconnectDelayHandler=()=>{let r=t.tls?t.reconnectJitterTLS:t.reconnectJitter;return r&&(r++,r=Math.floor(Math.random()*r)),t.reconnectTimeWait+r}),t.inboxPrefix)try{T(t.inboxPrefix)}catch(r){throw new Q(r.message,G.ApiError)}if(t.resolve&&"function"!=typeof Mt())throw new Q("'resolve' is not supported on this client",G.InvalidOption);return t}const oi=/^INFO\s+([^\r\n]+)\r\n/i,ai=ct("PONG\r\n"),en=ct("PING\r\n");class ci{echo;no_responders;protocol;verbose;pedantic;jwt;nkey;sig;user;pass;auth_token;tls_required;name;lang;version;headers;constructor(e,t,r){this.protocol=1,this.version=e.version,this.lang=e.lang,this.echo=!t.noEcho&&void 0,this.verbose=t.verbose,this.pedantic=t.pedantic,this.tls_required=!!t.tls||void 0,this.name=t.name,te(this,(t&&"function"==typeof t.authenticator?t.authenticator(r):{})||{})}}class tn extends ue{sid;queue;draining;max;subject;drained;protocol;timer;info;cleanupFn;closed;requestSubject;constructor(e,t,r={}){super(),te(this,r),this.protocol=e,this.subject=t,this.draining=!1,this.noIterator="function"==typeof r.callback,this.closed=ce(),r.timeout&&(this.timer=Ne(r.timeout),this.timer.then(()=>{this.timer=void 0}).catch(n=>{this.stop(n),this.noIterator&&this.callback(n,{})})),this.noIterator||this.iterClosed.then(()=>{this.closed.resolve(),this.unsubscribe()})}setPrePostHandlers(e){if(this.noIterator){const t=this.callback,r=e.ingestionFilterFn?e.ingestionFilterFn:()=>({ingest:!0,protocol:!1}),n=e.protocolFilterFn?e.protocolFilterFn:()=>!0,i=e.dispatchedFn?e.dispatchedFn:()=>{};this.callback=(o,c)=>{const{ingest:m}=r(c);m&&n(c)&&(t(o,c),i(c))}}else this.protocolFilterFn=e.protocolFilterFn,this.dispatchedFn=e.dispatchedFn}callback(e,t){this.cancelTimeout(),e?this.stop(e):this.push(t)}close(){if(!this.isClosed()){this.cancelTimeout();const e=()=>{if(this.stop(),this.cleanupFn)try{this.cleanupFn(this,this.info)}catch{}this.closed.resolve()};this.noIterator?e():this.push(e)}}unsubscribe(e){this.protocol.unsubscribe(this,e)}cancelTimeout(){this.timer&&(this.timer.cancel(),this.timer=void 0)}drain(){return this.protocol.isClosed()?Promise.reject(Q.errorForCode(G.ConnectionClosed)):this.isClosed()?Promise.reject(Q.errorForCode(G.SubClosed)):(this.drained||(this.draining=!0,this.protocol.unsub(this),this.drained=this.protocol.flush(ce()).then(()=>{this.protocol.subscriptions.cancel(this)}).catch(()=>{this.protocol.subscriptions.cancel(this)})),this.drained)}isDraining(){return this.draining}isClosed(){return this.done}getSubject(){return this.subject}getMax(){return this.max}getID(){return this.sid}}class ui{mux;subs;sidCounter;constructor(){this.sidCounter=0,this.mux=null,this.subs=new Map}size(){return this.subs.size}add(e){return this.sidCounter++,e.sid=this.sidCounter,this.subs.set(e.sid,e),e}setMux(e){return this.mux=e,e}getMux(){return this.mux}get(e){return this.subs.get(e)}resub(e){return this.sidCounter++,this.subs.delete(e.sid),e.sid=this.sidCounter,this.subs.set(e.sid,e),e}all(){return Array.from(this.subs.values())}cancel(e){e&&(e.close(),this.subs.delete(e.sid))}handleError(e){if(e&&e.permissionContext){const t=e.permissionContext,r=this.all();let n;if("subscription"===t.operation&&(n=r.find(i=>i.subject===t.subject)),"publish"===t.operation&&(n=r.find(i=>i.requestSubject===t.subject)),n)return n.callback(e,{}),n.close(),this.subs.delete(n.sid),n!==this.mux}return!1}close(){this.subs.forEach(e=>{e.close()})}}class Wr{connected;connectedOnce;infoReceived;info;muxSubscriptions;options;outbound;pongs;subscriptions;transport;noMorePublishing;connectError;publisher;_closed;closed;listeners;heartbeats;parser;outMsgs;inMsgs;outBytes;inBytes;pendingLimit;lastError;abortReconnect;servers;server;features;connectPromise;constructor(e,t){this._closed=!1,this.connected=!1,this.connectedOnce=!1,this.infoReceived=!1,this.noMorePublishing=!1,this.abortReconnect=!1,this.listeners=[],this.pendingLimit=32768,this.outMsgs=0,this.inMsgs=0,this.outBytes=0,this.inBytes=0,this.options=e,this.publisher=t,this.subscriptions=new ui,this.muxSubscriptions=new Gr,this.outbound=new Be,this.pongs=[],this.pendingLimit=e.pendingLimit||this.pendingLimit,this.features=new Se({major:0,minor:0,micro:0}),this.connectPromise=null,this.servers=new he("string"==typeof e.servers?[e.servers]:e.servers,{randomize:!e.noRandomize}),this.closed=ce(),this.parser=new v(this),this.heartbeats=new gs(this,this.options.pingInterval||12e4,this.options.maxPingOut||2)}resetOutbound(){this.outbound.reset();const e=this.pongs;this.pongs=[];const t=Q.errorForCode(G.Disconnect);t.stack="",e.forEach(r=>{r.reject(t)}),this.parser=new v(this),this.infoReceived=!1}dispatchStatus(e){this.listeners.forEach(t=>{t.push(e)})}status(){const e=new ue;return this.listeners.push(e),e}prepare(){var e=this;this.transport&&this.transport.discard(),this.info=void 0,this.resetOutbound();const t=ce();return t.catch(()=>{}),this.pongs.unshift(t),this.connectError=r=>{t.reject(r)},this.transport=function vr(){if(!Ae||"function"!=typeof Ae.factory)throw new Error("transport fn is not set");return Ae.factory()}(),this.transport.closed().then(function(){var r=(0,B.Z)(function*(n){e.connected=!1,e.isClosed()||(yield e.disconnected(e.transport.closeError||e.lastError))});return function(n){return r.apply(this,arguments)}}()),t}disconnect(){this.dispatchStatus({type:ut.StaleConnection,data:""}),this.transport.disconnect()}disconnected(e){var t=this;return(0,B.Z)(function*(){t.dispatchStatus({type:qe.Disconnect,data:t.servers.getCurrentServer().toString()}),t.options.reconnect?yield t.dialLoop().then(()=>{t.dispatchStatus({type:qe.Reconnect,data:t.servers.getCurrentServer().toString()}),t.lastError?.code===G.AuthenticationExpired&&(t.lastError=void 0)}).catch(r=>{t._close(r)}):yield t._close(e)})()}dial(e){var t=this;return(0,B.Z)(function*(){const r=t.prepare();let n;try{n=Ne(t.options.timeout||2e4);const i=t.transport.connect(e,t.options);yield Promise.race([i,n]),(0,B.Z)(function*(){try{var m,o=!1,c=!1;try{for(var I,S=(0,fe.Z)(t.transport);o=!(I=yield S.next()).done;o=!1)t.parser.parse(I.value)}catch(P){c=!0,m=P}finally{try{o&&null!=S.return&&(yield S.return())}finally{if(c)throw m}}}catch(P){console.log("reader closed",P)}})().then()}catch(i){r.reject(i)}try{yield Promise.race([n,r]),n&&n.cancel(),t.connected=!0,t.connectError=void 0,t.sendSubscriptions(),t.connectedOnce=!0,t.server.didConnect=!0,t.server.reconnects=0,t.flushPending(),t.heartbeats.start()}catch(i){throw n&&n.cancel(),yield t.transport.close(i),i}})()}_doDial(e){var t=this;return(0,B.Z)(function*(){const r=yield e.resolve({fn:Mt(),debug:t.options.debug,randomize:!t.options.noRandomize});let n=null;for(const i of r)try{return n=null,t.dispatchStatus({type:ut.Reconnecting,data:i.toString()}),void(yield t.dial(i))}catch(o){n=o}throw n})()}dialLoop(){return null===this.connectPromise&&(this.connectPromise=this.dodialLoop(),this.connectPromise.then(()=>{}).catch(()=>{}).finally(()=>{this.connectPromise=null})),this.connectPromise}dodialLoop(){var e=this;return(0,B.Z)(function*(){let t;for(;;){e._closed&&e.servers.clear();const r=e.options.reconnectDelayHandler?e.options.reconnectDelayHandler():2e3;let n=r;const i=e.selectServer();if(!i||e.abortReconnect)throw t||(e.lastError?e.lastError:Q.errorForCode(G.ConnectionRefused));const o=Date.now();if(0===i.lastConnect||i.lastConnect+r<=o){i.lastConnect=Date.now();try{yield e._doDial(i);break}catch(c){if(t=c,!e.connectedOnce){if(e.options.waitOnFirstConnect)continue;e.servers.removeCurrentServer()}i.reconnects++;const m=e.options.maxReconnectAttempts||0;-1!==m&&i.reconnects>=m&&e.servers.removeCurrentServer()}}else n=Math.min(n,i.lastConnect+r-o),yield ie(n)}})()}static connect(e,t){return(0,B.Z)(function*(){const r=new Wr(e,t);return yield r.dialLoop(),r})()}static toError(e){const t=e?e.toLowerCase():"";if(-1!==t.indexOf("permissions violation")){const r=new Q(e,G.PermissionsViolation),n=e.match(/(Publish|Subscription) to "(\S+)"/);return n&&(r.permissionContext={operation:n[1].toLowerCase(),subject:n[2]}),r}return-1!==t.indexOf("authorization violation")?new Q(e,G.AuthorizationViolation):-1!==t.indexOf("user authentication expired")?new Q(e,G.AuthenticationExpired):-1!==t.indexOf("authentication timeout")?new Q(e,G.AuthenticationTimeout):new Q(e,G.ProtocolError)}processMsg(e,t){if(this.inMsgs++,this.inBytes+=t.length,!this.subscriptions.sidCounter)return;const r=this.subscriptions.get(e.sid);r&&(r.received+=1,r.callback&&r.callback(null,new ir(e,t,this)),void 0!==r.max&&r.received>=r.max&&r.unsubscribe())}processError(e){const t=Ce(e),r=Wr.toError(t),n={type:qe.Error,data:r.code};if(r.isPermissionError()){let i=!1;r.permissionContext&&(n.permissionContext=r.permissionContext,i=this.subscriptions.getMux()?.subject===r.permissionContext.subject),this.subscriptions.handleError(r),this.muxSubscriptions.handleError(i,r),i&&this.subscriptions.setMux(null)}this.dispatchStatus(n),this.handleError(r)}handleError(e){e.isAuthError()?this.handleAuthError(e):(e.isProtocolError()||e.isAuthTimeout())&&(this.lastError=e),e.isPermissionError()||(this.lastError=e)}handleAuthError(e){this.lastError&&e.code===this.lastError.code&&!1===this.options.ignoreAuthErrorAbort&&(this.abortReconnect=!0),this.connectError?this.connectError(e):this.disconnect()}processPing(){this.transport.send(ai)}processPong(){const e=this.pongs.shift();e&&e.resolve()}processInfo(e){const t=JSON.parse(Ce(e));this.info=t;const r=this.options&&this.options.ignoreClusterUpdates?void 0:this.servers.update(t);if(!this.infoReceived){this.features.update(J(t.version)),this.infoReceived=!0,this.transport.isEncrypted()&&this.servers.updateTLSName();const{version:i,lang:o}=this.transport;try{const c=new ci({version:i,lang:o},this.options,t.nonce);t.headers&&(c.headers=!0,c.no_responders=!0);const m=JSON.stringify(c);this.transport.send(ct(`CONNECT ${m}\r\n`)),this.transport.send(en)}catch(c){this._close(c)}}r&&this.dispatchStatus({type:qe.Update,data:r}),void 0!==t.ldm&&t.ldm&&this.dispatchStatus({type:qe.LDM,data:this.servers.getCurrentServer().toString()})}push(e){switch(e.kind){case nt.MSG:{const{msg:t,data:r}=e;this.processMsg(t,r);break}case nt.OK:break;case nt.ERR:this.processError(e.data);break;case nt.PING:this.processPing();break;case nt.PONG:this.processPong();break;case nt.INFO:this.processInfo(e.data)}}sendCommand(e,...t){const r=this.outbound.length();let n;n="string"==typeof e?ct(e):e,this.outbound.fill(n,...t),0===r?queueMicrotask(()=>{this.flushPending()}):this.outbound.size()>=this.pendingLimit&&this.flushPending()}publish(e,t=ye,r){let n;if(t instanceof Uint8Array)n=t;else{if("string"!=typeof t)throw Q.errorForCode(G.BadPayload);n=ve.encode(t)}let i=n.length;(r=r||{}).reply=r.reply||"";let m,o=ye,c=0;if(r.headers){if(this.info&&!this.info.headers)throw new Q("headers",G.ServerOptionNotAvailable);o=r.headers.encode(),c=o.length,i=n.length+c}if(this.info&&i>this.info.max_payload)throw Q.errorForCode(G.MaxPayloadExceeded);this.outBytes+=i,this.outMsgs++,r.headers?(m=r.reply?`HPUB ${e} ${r.reply} ${c} ${i}\r\n`:`HPUB ${e} ${c} ${i}\r\n`,this.sendCommand(m,o,n,Ct)):(m=r.reply?`PUB ${e} ${r.reply} ${i}\r\n`:`PUB ${e} ${i}\r\n`,this.sendCommand(m,n,Ct))}request(e){return this.initMux(),this.muxSubscriptions.add(e),e}subscribe(e){return this.subscriptions.add(e),this._subunsub(e),e}_sub(e){this.sendCommand(e.queue?`SUB ${e.subject} ${e.queue} ${e.sid}\r\n`:`SUB ${e.subject} ${e.sid}\r\n`)}_subunsub(e){return this._sub(e),e.max&&this.unsubscribe(e,e.max),e}unsubscribe(e,t){this.unsub(e,t),(void 0===e.max||e.received>=e.max)&&this.subscriptions.cancel(e)}unsub(e,t){!e||this.isClosed()||(this.sendCommand(t?`UNSUB ${e.sid} ${t}\r\n`:`UNSUB ${e.sid}\r\n`),e.max=t)}resub(e,t){!e||this.isClosed()||(e.subject=t,this.subscriptions.resub(e),this._sub(e))}flush(e){return e||(e=ce()),this.pongs.push(e),this.outbound.fill(en),this.flushPending(),e}sendSubscriptions(){const e=[];this.subscriptions.all().forEach(t=>{e.push(t.queue?`SUB ${t.subject} ${t.queue} ${t.sid}\r\n`:`SUB ${t.subject} ${t.sid}\r\n`)}),e.length&&this.transport.send(ct(e.join("")))}_close(e){var t=this;return(0,B.Z)(function*(){t._closed||(t.heartbeats.cancel(),t.connectError&&(t.connectError(e),t.connectError=void 0),t.muxSubscriptions.close(),t.subscriptions.close(),t.listeners.forEach(r=>{r.stop()}),t._closed=!0,yield t.transport.close(e),yield t.closed.resolve(e))})()}close(){return this._close()}isClosed(){return this._closed}drain(){var e=this;const t=this.subscriptions.all(),r=[];return t.forEach(n=>{r.push(n.drain())}),Promise.all(r).then((0,B.Z)(function*(){return e.noMorePublishing=!0,yield e.flush(),e.close()})).catch(()=>{})}flushPending(){if(this.infoReceived&&this.connected&&this.outbound.size()){const e=this.outbound.drain();this.transport.send(e)}}initMux(){if(!this.subscriptions.getMux()){const t=this.muxSubscriptions.init(this.options.inboxPrefix),r=new tn(this,`${t}*`);r.callback=this.muxSubscriptions.dispatcher(),this.subscriptions.setMux(r),this.subscribe(r)}}selectServer(){const e=this.servers.selectServer();if(void 0!==e)return this.server=e,this.server}getServer(){return this.server}}class rn{token;received;ctx;requestSubject;mux;constructor(e,t){this.mux=e,this.requestSubject=t,this.received=0,this.token=Et.next(),this.ctx=new Error}}class li extends rn{callback;done;timer;max;opts;constructor(e,t,r={maxWait:1e3}){if(super(e,t),this.opts=r,"function"!=typeof this.opts.callback)throw new Error("callback is required");this.callback=this.opts.callback,this.max="number"==typeof r.maxMessages&&r.maxMessages>0?r.maxMessages:-1,this.done=ce(),this.done.then(()=>{this.callback(null,null)}),this.timer=setTimeout(()=>{this.cancel()},r.maxWait)}cancel(e){e&&this.callback(e,null),clearTimeout(this.timer),this.mux.cancel(this),this.done.resolve()}resolver(e,t){e?(e.stack+=`\n\n${this.ctx.stack}`,this.cancel(e)):(this.callback(null,t),this.opts.strategy===rt.Count&&(this.max--,0===this.max&&this.cancel()),this.opts.strategy===rt.JitterTimer&&(clearTimeout(this.timer),this.timer=setTimeout(()=>{this.cancel()},this.opts.jitter||300)),this.opts.strategy===rt.SentinelMsg&&t&&0===t.data.length&&this.cancel())}}class sn extends rn{deferred;timer;constructor(e,t,r={timeout:1e3}){super(e,t),this.deferred=ce(),this.timer=Ne(r.timeout)}resolver(e,t){this.timer&&this.timer.cancel(),e?(e.stack+=`\n\n${this.ctx.stack}`,this.deferred.reject(e)):this.deferred.resolve(t),this.cancel()}cancel(e){this.timer&&this.timer.cancel(),this.mux.cancel(this),this.deferred.reject(e||Q.errorForCode(G.Cancelled))}}function lr(s){return ys("durable",s)}function ht(s){return ys("stream",s)}function ys(s,e=""){if(""===e)throw Error(`${s} name required`);return[".","*",">","/","\\"," ","\t","\n","\r"].forEach(r=>{if(-1!==e.indexOf(r)){switch(r){case"\n":r="\\n";break;case"\r":r="\\r";break;case"\t":r="\\t"}throw Error(`invalid ${s} name - ${s} name cannot contain '${r}'`)}}),""}function Pr(s,e=""){if(""===e)throw Error(`${s} name required`);const t=function hi(s=""){if(""===s)throw Error("name required");const e=/^[-\w]+$/g;if(null===s.match(e))for(const r of s.split(""))if(null===r.match(e))return`cannot contain '${r}'`;return""}(e);if(t.length)throw new Error(`invalid ${s} name - ${s} name ${t}`)}function Re(s){return 1e6*s}function ws(s){return Math.floor(s/1e6)}function xs(s){if(s.data.length>0)return!1;const e=s.headers;return!!e&&e.code>=100&&e.code<200}function vs(s){return xs(s)&&"Idle Heartbeat"===s.headers?.description}function hr(s){if(0!==s.data.length)return null;const e=s.headers;return e?nn(e.code,e.description):null}var yt=function(s){return s.MaxBatchExceeded="exceeded maxrequestbatch of",s.MaxExpiresExceeded="exceeded maxrequestexpires of",s.MaxBytesExceeded="exceeded maxrequestmaxbytes of",s.MaxMessageSizeExceeded="message size exceeds maxbytes",s.PushConsumer="consumer is push based",s.MaxWaitingExceeded="exceeded maxwaiting",s.IdleHeartbeatMissed="idle heartbeats missed",s.ConsumerDeleted="consumer deleted",s}(yt||{});let di=!1;function nn(s,e=""){if(s<300)return null;switch(e=e.toLowerCase(),s){case 404:return new Q(e,G.JetStream404NoMessages);case 408:return new Q(e,G.JetStream408RequestTimeout);case 409:{const t=e.startsWith(yt.IdleHeartbeatMissed)?G.JetStreamIdleHeartBeat:G.JetStream409;return new Q(e,t)}case 503:return Q.errorForCode(G.JetStreamNotEnabled,new Error(e));default:return""===e&&(e=G.Unknown),new Q(e,`${s}`)}}class kr{nc;opts;prefix;timeout;jc;constructor(e,t){this.nc=e,this.opts=function gi(s){return(s=s||{}).domain&&(s.apiPrefix=`$JS.${s.domain}.API`,delete s.domain),te({apiPrefix:"$JS.API",timeout:5e3},s)}(t),this._parseOpts(),this.prefix=this.opts.apiPrefix,this.timeout=this.opts.timeout,this.jc=Ge()}getOptions(){return Object.assign({},this.opts)}_parseOpts(){let e=this.opts.apiPrefix;if(!e||0===e.length)throw new Error("invalid empty prefix");"."===e[e.length-1]&&(e=e.substr(0,e.length-1)),this.opts.apiPrefix=e}_request(e,t=null,r){var n=this;return(0,B.Z)(function*(){(r=r||{}).timeout=n.timeout;let i=ye;t&&(i=n.jc.encode(t));const o=yield n.nc.request(e,i,r);return n.parseJsResponse(o)})()}findStream(e){var t=this;return(0,B.Z)(function*(){const r={subject:e},i=yield t._request(`${t.prefix}.STREAM.NAMES`,r);if(!i.streams||1!==i.streams.length)throw new Error("no stream matches subject");return i.streams[0]})()}getConnection(){return this.nc}parseJsResponse(e){const t=this.jc.decode(e.data),r=t;if(r.error){const n=nn(r.error.code,r.error.description);if(null!==n)throw n.api_error=r.error,n}return t}}class bi{static encode(e){if("string"==typeof e)return btoa(e);const t=Array.from(e);return btoa(String.fromCharCode(...t))}static decode(e,t=!1){const r=atob(e);return t?Uint8Array.from(r,n=>n.charCodeAt(0)):r}}class Ir{static encode(e){return Ir.toB64URLEncoding(bi.encode(e))}static decode(e,t=!1){return Ir.decode(Ir.fromB64URLEncoding(e),t)}static toB64URLEncoding(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}static fromB64URLEncoding(e){return e.replace(/_/g,"/").replace(/-/g,"+")}}var on=function(s){return s.Limits="limits",s.Interest="interest",s.Workqueue="workqueue",s}(on||{}),Xr=function(s){return s.Old="old",s.New="new",s}(Xr||{}),an=function(s){return s.File="file",s.Memory="memory",s}(an||{}),Je=function(s){return s.All="all",s.Last="last",s.New="new",s.StartSequence="by_start_sequence",s.StartTime="by_start_time",s.LastPerSubject="last_per_subject",s}(Je||{}),tt=function(s){return s.None="none",s.All="all",s.Explicit="explicit",s.NotSet="",s}(tt||{}),Or=function(s){return s.Instant="instant",s.Original="original",s}(Or||{}),Ss=function(s){return s.CreateOrUpdate="",s.Update="update",s.Create="create",s}(Ss||{}),ft=function(s){return s.StreamSourceHdr="Nats-Stream-Source",s.LastConsumerSeqHdr="Nats-Last-Consumer",s.LastStreamSeqHdr="Nats-Last-Stream",s.ConsumerStalledHdr="Nats-Consumer-Stalled",s.MessageSizeHdr="Nats-Msg-Size",s.RollupHdr="Nats-Rollup",s.RollupValueSubject="sub",s.RollupValueAll="all",s.PendingMessagesHdr="Nats-Pending-Messages",s.PendingBytesHdr="Nats-Pending-Bytes",s}(ft||{}),Tt=function(s){return s.LastValue="",s.AllHistory="history",s.UpdatesOnly="updates",s}(Tt||{}),jr=function(s){return s.Stream="Nats-Stream",s.Sequence="Nats-Sequence",s.TimeStamp="Nats-Time-Stamp",s.Subject="Nats-Subject",s}(jr||{});const wt="KV_";class vi{config;ordered;mack;stream;callbackFn;max;qname;isBind;filters;constructor(e){this.stream="",this.mack=!1,this.ordered=!1,this.config=function yi(s,e={}){return Object.assign({name:s,deliver_policy:Je.All,ack_policy:tt.Explicit,ack_wait:Re(3e4),replay_policy:Or.Instant},e)}("",e||{})}getOpts(){const e={};if(e.config=Object.assign({},this.config),e.config.filter_subject&&(this.filterSubject(e.config.filter_subject),e.config.filter_subject=void 0),e.config.filter_subjects&&(e.config.filter_subjects?.forEach(t=>{this.filterSubject(t)}),e.config.filter_subjects=void 0),e.mack=this.mack,e.stream=this.stream,e.callbackFn=this.callbackFn,e.max=this.max,e.queue=this.qname,e.ordered=this.ordered,e.config.ack_policy=e.ordered?tt.None:e.config.ack_policy,e.isBind=e.isBind||!1,this.filters)switch(this.filters.length){case 0:break;case 1:e.config.filter_subject=this.filters[0];break;default:e.config.filter_subjects=this.filters}return e}description(e){return this.config.description=e,this}deliverTo(e){return this.config.deliver_subject=e,this}durable(e){return lr(e),this.config.durable_name=e,this}startSequence(e){if(e<=0)throw new Error("sequence must be greater than 0");return this.config.deliver_policy=Je.StartSequence,this.config.opt_start_seq=e,this}startTime(e){return this.config.deliver_policy=Je.StartTime,this.config.opt_start_time=e.toISOString(),this}deliverAll(){return this.config.deliver_policy=Je.All,this}deliverLastPerSubject(){return this.config.deliver_policy=Je.LastPerSubject,this}deliverLast(){return this.config.deliver_policy=Je.Last,this}deliverNew(){return this.config.deliver_policy=Je.New,this}startAtTimeDelta(e){return this.startTime(new Date(Date.now()-e)),this}headersOnly(){return this.config.headers_only=!0,this}ackNone(){return this.config.ack_policy=tt.None,this}ackAll(){return this.config.ack_policy=tt.All,this}ackExplicit(){return this.config.ack_policy=tt.Explicit,this}ackWait(e){return this.config.ack_wait=Re(e),this}maxDeliver(e){return this.config.max_deliver=e,this}filterSubject(e){return this.filters=this.filters||[],this.filters.push(e),this}replayInstantly(){return this.config.replay_policy=Or.Instant,this}replayOriginal(){return this.config.replay_policy=Or.Original,this}sample(e){if((e=Math.trunc(e))<0||e>100)throw new Error("value must be between 0-100");return this.config.sample_freq=`${e}%`,this}limit(e){return this.config.rate_limit_bps=e,this}maxWaiting(e){return this.config.max_waiting=e,this}maxAckPending(e){return this.config.max_ack_pending=e,this}idleHeartbeat(e){return this.config.idle_heartbeat=Re(e),this}flowControl(){return this.config.flow_control=!0,this}deliverGroup(e){return this.queue(e),this}manualAck(){return this.mack=!0,this}maxMessages(e){return this.max=e,this}callback(e){return this.callbackFn=e,this}queue(e){return this.qname=e,this.config.deliver_group=e,this}orderedConsumer(){return this.ordered=!0,this}bind(e,t){return this.stream=e,this.config.durable_name=t,this.isBind=!0,this}bindStream(e){return this.stream=e,this}inactiveEphemeralThreshold(e){return this.config.inactive_threshold=Re(e),this}maxPullBatch(e){return this.config.max_batch=e,this}maxPullRequestExpires(e){return this.config.max_expires=Re(e),this}memory(){return this.config.mem_storage=!0,this}numReplicas(e){return this.config.num_replicas=e,this}}function Gt(s){return new vi(s)}function cn(s){return"function"==typeof s.getOpts}function un(s){const e=s.length;let t=s.indexOf("=");return-1===t&&(t=e),[t,t===e?0:4-t%4]}const ln=[],hn=[],Es="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";for(let s=0,e=64;s<e;++s)ln[s]=Es[s],hn[Es.charCodeAt(s)]=s;const{toUint8Array:Ei,fromUint8Array:Ci}=function Si(s,e,t=!1){function r(o,c){return Math.floor(3*(o+c)/4-c)}function n(o){return s[o>>18&63]+s[o>>12&63]+s[o>>6&63]+s[63&o]}function i(o,c,m){const S=new Array((m-c)/3);for(let I=c,P=0;I<m;I+=3)S[P++]=n((o[I]<<16)+(o[I+1]<<8)+o[I+2]);return S.join("")}return{byteLength:o=>r.apply(null,un(o)),toUint8Array(o){const[c,m]=un(o),S=new Uint8Array(r(c,m)),I=m?c-4:c;let P,U,N=0;for(U=0;U<I;U+=4)P=e[o.charCodeAt(U)]<<18|e[o.charCodeAt(U+1)]<<12|e[o.charCodeAt(U+2)]<<6|e[o.charCodeAt(U+3)],S[N++]=P>>16&255,S[N++]=P>>8&255,S[N++]=255&P;return 2===m?(P=e[o.charCodeAt(U)]<<2|e[o.charCodeAt(U+1)]>>4,S[N++]=255&P):1===m&&(P=e[o.charCodeAt(U)]<<10|e[o.charCodeAt(U+1)]<<4|e[o.charCodeAt(U+2)]>>2,S[N++]=P>>8&255,S[N++]=255&P),S},fromUint8Array(o){const m=o.length,S=m%3,I=m-S,P=new Array(Math.ceil(I/16383)+(S?1:0));let U,q,N=0;for(let Z=0;Z<I;Z+=16383)U=Z+16383,P[N++]=i(o,Z,U>I?I:U);return 1===S?(q=o[I],P[N]=s[q>>2]+s[q<<4&63],t||(P[N]+="==")):2===S&&(q=o[I]<<8|255&o[I+1],P[N]=s[q>>10]+s[q>>4&63]+s[q<<2&63],t||(P[N]+="=")),P.join("")}}}(ln,hn,!0),Ai=new TextDecoder,Pi=new TextEncoder;class fn{hashSize=32;_buf;_bufIdx;_count;_K;_H;_finalized;constructor(){this._buf=new Uint8Array(64),this._K=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),this.init()}init(){return this._H=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),this._bufIdx=0,this._count=new Uint32Array(2),this._buf.fill(0),this._finalized=!1,this}update(e,t){if(null===e)throw new TypeError("msg must be a string or Uint8Array.");"string"==typeof e&&(e=function ji(s,e="utf8"){if(/^utf-?8$/i.test(e))return Pi.encode(s);if(/^base64$/i.test(e))return Ei(s);if(/^hex(?:adecimal)?$/i.test(e))return function Ii(s){const e=s.length;if(e%2||!/^[0-9a-fA-F]+$/.test(s))throw new TypeError("Invalid hex string.");s=s.toLowerCase();const t=new Uint8Array(Math.floor(e/2)),r=e/2;for(let n=0;n<r;++n)t[n]=parseInt(s.substr(2*n,2),16);return t}(s);throw new TypeError("Unsupported string encoding.")}(e,t));for(let n=0,i=e.length;n<i;n++)this._buf[this._bufIdx++]=e[n],64===this._bufIdx&&(this._transform(),this._bufIdx=0);const r=this._count;return(r[0]+=e.length<<3)<e.length<<3&&r[1]++,r[1]+=e.length>>>29,this}digest(e){if(this._finalized)throw new Error("digest has already been called.");this._finalized=!0;const t=this._buf;let r=this._bufIdx;for(t[r++]=128;56!==r;)64===r&&(this._transform(),r=0),t[r++]=0;const n=this._count;t[56]=n[1]>>>24&255,t[57]=n[1]>>>16&255,t[58]=n[1]>>>8&255,t[59]=n[1]>>>0&255,t[60]=n[0]>>>24&255,t[61]=n[0]>>>16&255,t[62]=n[0]>>>8&255,t[63]=n[0]>>>0&255,this._transform();const i=new Uint8Array(32);for(let o=0;o<8;o++)i[0+(o<<2)]=this._H[o]>>>24&255,i[1+(o<<2)]=this._H[o]>>>16&255,i[2+(o<<2)]=this._H[o]>>>8&255,i[3+(o<<2)]=this._H[o]>>>0&255;return this.init(),e?function Oi(s,e="utf8"){if(/^utf-?8$/i.test(e))return Ai.decode(s);if(/^base64$/i.test(e))return Ci(s);if(/^hex(?:adecimal)?$/i.test(e))return function ki(s){return s.reduce((e,t)=>`${e}${t<16?"0":""}${t.toString(16)}`,"")}(s);throw new TypeError("Unsupported string encoding.")}(i,e):i}_transform(){const e=this._H;let t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],c=e[5],m=e[6],S=e[7];const I=new Uint32Array(16);let P;for(P=0;P<16;P++)I[P]=this._buf[3+(P<<2)]|this._buf[2+(P<<2)]<<8|this._buf[1+(P<<2)]<<16|this._buf[P<<2]<<24;for(P=0;P<64;P++){let N;if(P<16)N=I[P];else{let U=I[P+1&15],q=I[P+14&15];N=I[15&P]=(U>>>7^U>>>18^U>>>3^U<<25^U<<14)+(q>>>17^q>>>19^q>>>10^q<<15^q<<13)+I[15&P]+I[P+9&15]|0}N=N+S+(o>>>6^o>>>11^o>>>25^o<<26^o<<21^o<<7)+(m^o&(c^m))+this._K[P]|0,S=m,m=c,c=o,o=i+N,i=n,n=r,r=t,t=N+(r&n^i&(r^n))+(r>>>2^r>>>13^r>>>22^r<<30^r<<19^r<<10)|0}e[0]=e[0]+t|0,e[1]=e[1]+r|0,e[2]=e[2]+n|0,e[3]=e[3]+i|0,e[4]=e[4]+o|0,e[5]=e[5]+c|0,e[6]=e[6]+m|0,e[7]=e[7]+S|0}}class Mr{err;offset;pageInfo;subject;jsm;filter;payload;constructor(e,t,r,n){if(!e)throw new Error("subject is required");this.subject=e,this.jsm=r,this.offset=0,this.pageInfo={},this.filter=t,this.payload=n||{}}next(){var e=this;return(0,B.Z)(function*(){if(e.err)return[];if(e.pageInfo&&e.offset>=e.pageInfo.total)return[];const t={offset:e.offset};e.payload&&Object.assign(t,e.payload);try{const r=yield e.jsm._request(e.subject,t,{timeout:e.jsm.timeout});return e.pageInfo=r,e.offset+=e.countResponse(r),e.filter(r)}catch(r){throw e.err=r,r}})()}countResponse(e){switch(e?.type){case"io.nats.jetstream.api.v1.stream_names_response":case"io.nats.jetstream.api.v1.stream_list_response":return e.streams.length;case"io.nats.jetstream.api.v1.consumer_list_response":return e.consumers.length;default:return console.error(`jslister.ts: unknown API response for paged output: ${e?.type}`),e.streams?.length||0}return 0}[Symbol.asyncIterator](){var e=this;return $e(function*(){let t=yield Oe(e.next());for(;t.length>0;){for(const r of t)yield r;t=yield Oe(e.next())}})()}}class Cs extends kr{constructor(e,t){super(e,t)}add(e,t,r=Ss.Create){var n=this;return(0,B.Z)(function*(){if(ht(e),t.deliver_group&&t.flow_control)throw new Error("jetstream flow control is not supported with queue groups");if(t.deliver_group&&t.idle_heartbeat)throw new Error("jetstream idle heartbeat is not supported with queue groups");const i={};i.config=t,i.stream_name=e,i.action=r,i.config.durable_name&&lr(i.config.durable_name);const o=n.nc;let{min:c,ok:m}=o.features.get(oe.JS_NEW_CONSUMER_CREATE_API);const S=""===t.name?void 0:t.name;if(S&&!m)throw new Error(`consumer 'name' requires server ${c}`);if(S)try{ys("name",S)}catch(U){const q=U.message,Z=q.indexOf("cannot contain");throw-1!==Z?new Error(`consumer 'name' ${q.substring(Z)}`):U}let I,P="";if(Array.isArray(t.filter_subjects)){const{min:U,ok:q}=o.features.get(oe.JS_MULTIPLE_CONSUMER_FILTER);if(!q)throw new Error(`consumer 'filter_subjects' requires server ${U}`);m=!1}if(t.metadata){const{min:U,ok:q}=o.features.get(oe.JS_STREAM_CONSUMER_METADATA);if(!q)throw new Error(`consumer 'metadata' requires server ${U}`)}if(m&&(P=t.name??t.durable_name??""),""!==P){let U=t.filter_subject??void 0;">"===U&&(U=void 0),I=void 0!==U?`${n.prefix}.CONSUMER.CREATE.${e}.${P}.${U}`:`${n.prefix}.CONSUMER.CREATE.${e}.${P}`}else I=t.durable_name?`${n.prefix}.CONSUMER.DURABLE.CREATE.${e}.${t.durable_name}`:`${n.prefix}.CONSUMER.CREATE.${e}`;return yield n._request(I,i)})()}update(e,t,r){var n=this;return(0,B.Z)(function*(){const i=yield n.info(e,t);return n.add(e,Object.assign(i.config,r),Ss.Update)})()}info(e,t){var r=this;return(0,B.Z)(function*(){return ht(e),lr(t),yield r._request(`${r.prefix}.CONSUMER.INFO.${e}.${t}`)})()}delete(e,t){var r=this;return(0,B.Z)(function*(){return ht(e),lr(t),(yield r._request(`${r.prefix}.CONSUMER.DELETE.${e}.${t}`)).success})()}list(e){return ht(e),new Mr(`${this.prefix}.CONSUMER.LIST.${e}`,n=>n.consumers,this)}}const dn=Uint8Array.of(43,65,67,75),Mi=Uint8Array.of(45,78,65,75),Tr=Uint8Array.of(43,87,80,73),Ti=Uint8Array.of(43,78,88,84),Ni=Uint8Array.of(43,84,69,82,77),Ri=Uint8Array.of(32);function Nr(s){return new $i(s)}class $i{msg;di;didAck;constructor(e){this.msg=e,this.didAck=!1}get subject(){return this.msg.subject}get sid(){return this.msg.sid}get data(){return this.msg.data}get headers(){return this.msg.headers}get info(){return this.di||(this.di=function Ui(s){const e=s.split(".");if(9===e.length&&e.splice(2,0,"_",""),e.length<11||"$JS"!==e[0]||"ACK"!==e[1])throw new Error("not js message");const t={};return t.domain="_"===e[2]?"":e[2],t.account_hash=e[3],t.stream=e[4],t.consumer=e[5],t.redeliveryCount=parseInt(e[6],10),t.redelivered=t.redeliveryCount>1,t.streamSequence=parseInt(e[7],10),t.deliverySequence=parseInt(e[8],10),t.timestampNanos=parseInt(e[9],10),t.pending=parseInt(e[10],10),t}(this.reply)),this.di}get redelivered(){return this.info.redeliveryCount>1}get reply(){return this.msg.reply||""}get seq(){return this.info.streamSequence}doAck(e){this.didAck||(this.didAck=!this.isWIP(e),this.msg.respond(e))}isWIP(e){return 4===e.length&&e[0]===Tr[0]&&e[1]===Tr[1]&&e[2]===Tr[2]&&e[3]===Tr[3]}ackAck(){var e=this;return(0,B.Z)(function*(){if(!e.didAck&&(e.didAck=!0,e.msg.reply)){const r=e.msg.publisher,n=new sn(r.muxSubscriptions,e.msg.reply);r.request(n);try{r.publish(e.msg.reply,dn,{reply:`${r.muxSubscriptions.baseInbox}${n.token}`})}catch(i){n.cancel(i)}try{return yield Promise.race([n.timer,n.deferred]),!0}catch(i){n.cancel(i)}}return!1})()}ack(){this.doAck(dn)}nak(e){let t=Mi;e&&(t=function st(){return{encode:s=>ve.encode(s),decode:s=>Te.decode(s)}}().encode(`-NAK ${JSON.stringify({delay:Re(e)})}`)),this.doAck(t)}working(){this.doAck(Tr)}next(e,t={batch:1}){const r={};r.batch=t.batch||1,r.no_wait=t.no_wait||!1,t.expires&&t.expires>0&&(r.expires=Re(t.expires));const n=Ge().encode(r),i=Be.concat(Ti,Ri,n);this.msg.respond(i,e?{reply:e}:void 0)}term(){this.doAck(Ni)}json(){return this.msg.json()}string(){return this.msg.string()}}function fr(s,e,t=!1){if(!0===t&&!s)throw Q.errorForCode(G.ApiError,new Error(`${e} is not a function`));if(s&&"function"!=typeof s)throw Q.errorForCode(G.ApiError,new Error(`${e} is not a function`))}class Fi extends ue{sub;adapter;subIterDone;constructor(e,t,r){var n;super(),n=this,fr(r.adapter,"adapter",!0),this.adapter=r.adapter,r.callback&&fr(r.callback,"callback"),this.noIterator="function"==typeof r.callback,r.ingestionFilterFn&&(fr(r.ingestionFilterFn,"ingestionFilterFn"),this.ingestionFilterFn=r.ingestionFilterFn),r.protocolFilterFn&&(fr(r.protocolFilterFn,"protocolFilterFn"),this.protocolFilterFn=r.protocolFilterFn),r.dispatchedFn&&(fr(r.dispatchedFn,"dispatchedFn"),this.dispatchedFn=r.dispatchedFn),r.cleanupFn&&fr(r.cleanupFn,"cleanupFn");let i=(I,P)=>{this.callback(I,P)};if(r.callback){const I=r.callback;i=(P,N)=>{const[U,q]=this.adapter(P,N);if(U)return void I(U,null);const{ingest:Z}=this.ingestionFilterFn?this.ingestionFilterFn(q,this):{ingest:!0};Z&&(!this.protocolFilterFn||this.protocolFilterFn(q))&&(I(U,q),this.dispatchedFn&&q&&this.dispatchedFn(q))}}const{max:o,queue:c,timeout:m}=r,S={queue:c,timeout:m,callback:i};var I;o&&o>0&&(S.max=o),this.sub=e.subscribe(t,S),r.cleanupFn&&(this.sub.cleanupFn=r.cleanupFn),this.noIterator||this.iterClosed.then(()=>{this.unsubscribe()}),this.subIterDone=ce(),Promise.all([this.sub.closed,this.iterClosed]).then(()=>{this.subIterDone.resolve()}).catch(()=>{this.subIterDone.resolve()}),(I=(0,B.Z)(function*(P){yield P.closed,n.stop()}),function(P){return I.apply(this,arguments)})(this.sub).then().catch()}unsubscribe(e){this.sub.unsubscribe(e)}drain(){return this.sub.drain()}isDraining(){return this.sub.isDraining()}isClosed(){return this.sub.isClosed()}callback(e,t){this.sub.cancelTimeout();const[r,n]=this.adapter(e,t);r&&this.stop(r),n&&this.push(n)}getSubject(){return this.sub.getSubject()}getReceived(){return this.sub.getReceived()}getProcessed(){return this.sub.getProcessed()}getPending(){return this.sub.getPending()}getID(){return this.sub.getID()}getMax(){return this.sub.getMax()}get closed(){return this.sub.closed}}class As{interval;maxOut;cancelAfter;timer;autoCancelTimer;last;missed;count;callback;constructor(e,t,r={maxOut:2}){this.interval=e,this.maxOut=r?.maxOut||2,this.cancelAfter=r?.cancelAfter||0,this.last=Date.now(),this.missed=0,this.count=0,this.callback=t,this._schedule()}cancel(){this.autoCancelTimer&&clearTimeout(this.autoCancelTimer),this.timer&&clearInterval(this.timer),this.timer=0,this.autoCancelTimer=0}work(){this.last=Date.now(),this.missed=0}_change(e,t=0,r=2){this.interval=e,this.maxOut=r,this.cancelAfter=t,this.restart()}restart(){this.cancel(),this._schedule()}_schedule(){this.cancelAfter>0&&(this.autoCancelTimer=setTimeout(()=>{this.cancel()},this.cancelAfter)),this.timer=setInterval(()=>{if(this.count++,Date.now()-this.last>this.interval&&this.missed++,this.missed>=this.maxOut)try{!0===this.callback(this.missed)&&this.cancel()}catch(e){console.log(e)}},this.interval)}}var Ft,$t=function(s){return s[s.Unset=-1]="Unset",s[s.Consume=0]="Consume",s[s.Fetch=1]="Fetch",s}($t||{}),Ps=function(s){return s.HeartbeatsMissed="heartbeats_missed",s}(Ps||{}),Qr=function(s){return s.DebugEvent="debug",s.Discard="discard",s.Next="next",s}(Qr||{});class ks extends ue{consumer;opts;sub;monitor;pending;inbox;refilling;stack;pong;callback;timeout;cleanupHandler;listeners;statusIterator;constructor(e,t,r=!1){var n;super(),n=this,this.consumer=e,this.opts=this.parseOptions(t,r),this.callback=t.callback||null,this.noIterator="function"==typeof this.callback,this.monitor=null,this.pong=null,this.pending={msgs:0,bytes:0,requests:0},this.refilling=r,this.stack=(new Error).stack.split("\n").slice(1).join("\n"),this.timeout=null,this.inbox=T(e.api.nc.options.inboxPrefix),this.listeners=[];const{max_messages:i,max_bytes:o,idle_heartbeat:c,threshold_bytes:m,threshold_messages:S}=this.opts;this.closed().then(()=>{if(this.cleanupHandler)try{this.cleanupHandler()}catch{}});const{sub:I}=this;I&&I.unsubscribe(),this.sub=e.api.nc.subscribe(this.inbox,{callback:(P,N)=>{if(P)this.stop();else{if(this.monitor?.work(),N.subject===this.inbox){if(vs(N))return;const q=N.headers?.code,Z=N.headers?.description?.toLowerCase()||"unknown",{msgsLeft:xe,bytesLeft:le}=this.parseDiscard(N.headers);if(xe>0||le>0)this.pending.msgs-=xe,this.pending.bytes-=le,this.pending.requests--,this.notify(Qr.Discard,{msgsLeft:xe,bytesLeft:le});else{const Ye=()=>{const We=new Q(Z,`${q}`);return We.stack+=`\n\n${this.stack}`,We};if(400===q){const We=Ye();this._push(()=>{this.stop(We)})}else if(409===q&&"consumer deleted"===Z){const We=Ye();this.stop(We)}else this.notify(Qr.DebugEvent,`${q} ${Z}`)}}else this._push(Nr(N)),this.received++,this.pending.msgs&&this.pending.msgs--,this.pending.bytes&&(this.pending.bytes-=N.size());if(0===this.pending.msgs&&0===this.pending.bytes&&(this.pending.requests=0),this.refilling){if(i&&this.pending.msgs<=S||o&&this.pending.bytes<=m){const q=this.pullOptions();this.pull(q)}}else 0===this.pending.requests&&this._push(()=>{this.stop()})}}}),this.sub.closed.then(()=>{this.sub.draining&&this._push(()=>{this.stop()})}),c&&(this.monitor=new As(c,P=>(this.notify(Ps.HeartbeatsMissed,P),this.resetPending().then(()=>{}).catch(()=>{}),!1),{maxOut:2})),(0,B.Z)(function*(){const P=e.api.nc.status();n.statusIterator=P;var q,N=!1,U=!1;try{for(var xe,Z=(0,fe.Z)(P);N=!(xe=yield Z.next()).done;N=!1)switch(xe.value.type){case qe.Disconnect:n.monitor?.cancel();break;case qe.Reconnect:n.resetPending().then(Ye=>{Ye&&n.monitor?.restart()}).catch(()=>{})}}catch(le){U=!0,q=le}finally{try{N&&null!=Z.return&&(yield Z.return())}finally{if(U)throw q}}})(),this.pull(this.pullOptions())}_push(e){if(this.callback){const t="function"==typeof e?e:null;try{t?t():this.callback(e)}catch(r){this.stop(r)}}else super.push(e)}notify(e,t){this.listeners.length>0&&this.listeners.forEach(r=>{r.done||r.push({type:e,data:t})})}resetPending(){return this.consumer.info().then(e=>(this.pending.msgs=0,this.pending.bytes=0,this.pending.requests=0,this.pull(this.pullOptions()),!0)).catch(e=>("consumer not found"===e.message&&this.stop(e),!1))}pull(e){this.pending.bytes+=e.max_bytes??0,this.pending.msgs+=e.batch??0,this.pending.requests++;const t=this.consumer.api.nc;this._push(()=>{t.publish(`${this.consumer.api.prefix}.CONSUMER.MSG.NEXT.${this.consumer.stream}.${this.consumer.name}`,this.consumer.api.jc.encode(e),{reply:this.inbox}),this.notify(Qr.Next,e)})}pullOptions(){return{batch:this.opts.max_messages-this.pending.msgs,max_bytes:this.opts.max_bytes-this.pending.bytes,idle_heartbeat:Re(this.opts.idle_heartbeat),expires:Re(this.opts.expires)}}parseDiscard(e){const t={msgsLeft:0,bytesLeft:0},r=e?.get(ft.PendingMessagesHdr);r&&(t.msgsLeft=parseInt(r));const n=e?.get(ft.PendingBytesHdr);return n&&(t.bytesLeft=parseInt(n)),t}trackTimeout(e){this.timeout=e}close(){return this.stop(),this.iterClosed}closed(){return this.iterClosed}clearTimers(){this.monitor?.cancel(),this.monitor=null,this.timeout?.cancel(),this.timeout=null}setCleanupHandler(e){this.cleanupHandler=e}stop(e){this.sub?.unsubscribe(),this.clearTimers(),this.statusIterator?.stop(),this._push(()=>{super.stop(e),this.listeners.forEach(t=>{t.stop()})})}parseOptions(e,t=!1){const r=e||{};if(r.max_messages=r.max_messages||0,r.max_bytes=r.max_bytes||0,0!==r.max_messages&&0!==r.max_bytes)throw new Error("only specify one of max_messages or max_bytes");if(0===r.max_messages&&(r.max_messages=100),r.expires=r.expires||3e4,r.expires<1e3)throw new Error("expires should be at least 1000ms");if(r.idle_heartbeat=r.idle_heartbeat||r.expires/2,r.idle_heartbeat=r.idle_heartbeat>3e4?3e4:r.idle_heartbeat,t){const n=Math.round(.75*r.max_messages)||1;r.threshold_messages=r.threshold_messages||n;const i=Math.round(.75*r.max_bytes)||1;r.threshold_bytes=r.threshold_bytes||i}return r}status(){const e=new ue;return this.listeners.push(e),Promise.resolve(e)}}class pn extends ue{src;constructor(){super()}setSource(e){this.src&&(this.src.setCleanupHandler(),this.src.stop()),this.src=e,this.src.setCleanupHandler(()=>{this.close().catch()})}stop(e){this.src?.stop(e),super.stop(e)}close(){return this.stop(),this.iterClosed}status(){return Promise.reject(new Error("ordered consumers don't report consumer status"))}}class mn{api;_info;stream;name;constructor(e,t){this.api=e,this._info=t,this.stream=t.stream_name,this.name=t.name}consume(e={max_messages:100,expires:3e4}){return Promise.resolve(new ks(this,e,!0))}fetch(e={max_messages:100,expires:3e4}){const t=new ks(this,e,!1),n=Ne(Math.round(1.05*t.opts.expires));return t.closed().then(()=>{n.cancel()}),n.catch(()=>{t.close().catch()}),t.trackTimeout(n),Promise.resolve(t)}next(e={expires:3e4}){const t=ce(),r=e;r.max_messages=1;const n=new ks(this,r,!1),i=Math.round(1.05*n.opts.expires);i>=6e4&&(0,B.Z)(function*(){var S,c=!1,m=!1;try{for(var P,I=(0,fe.Z)(yield n.status());c=!(P=yield I.next()).done;c=!1){const N=P.value;if(N.type===Ps.HeartbeatsMissed&&N.data>=2){t.reject(new Error("consumer missed heartbeats"));break}}}catch(N){m=!0,S=N}finally{try{c&&null!=I.return&&(yield I.return())}finally{if(m)throw S}}})().catch(),(0,B.Z)(function*(){var S,c=!1,m=!1;try{for(var P,I=(0,fe.Z)(n);c=!(P=yield I.next()).done;c=!1){t.resolve(P.value);break}}catch(N){m=!0,S=N}finally{try{c&&null!=I.return&&(yield I.return())}finally{if(m)throw S}}})().catch();const o=Ne(i);return n.closed().then(()=>{t.resolve(null),o.cancel()}).catch(c=>{t.reject(c)}),o.catch(c=>{t.resolve(null),n.close().catch()}),n.trackTimeout(o),t}delete(){const{stream_name:e,name:t}=this._info;return this.api.delete(e,t)}info(e=!1){if(e)return Promise.resolve(this._info);const{stream_name:t,name:r}=this._info;return this.api.info(t,r).then(n=>(this._info=n,this._info))}}class Bi{api;consumerOpts;consumer;opts;cursor;stream;namePrefix;serial;currentConsumer;userCallback;iter;type;startSeq;constructor(e,t,r={}){this.api=e,this.stream=t,this.cursor={stream_seq:1,deliver_seq:0},this.namePrefix=Et.next(),this.serial=0,this.currentConsumer=null,this.userCallback=null,this.iter=null,this.type=$t.Unset,this.consumerOpts=r,this.startSeq=this.consumerOpts.opt_start_seq||0,this.cursor.stream_seq=this.startSeq>0?this.startSeq-1:0}getConsumerOpts(e){this.serial++;const r={name:`${this.namePrefix}_${this.serial}`,deliver_policy:Je.StartSequence,opt_start_seq:e=0===e?1:e,ack_policy:tt.None,inactive_threshold:Re(3e5),num_replicas:1};return!0===this.consumerOpts.headers_only&&(r.headers_only=!0),Array.isArray(this.consumerOpts.filterSubjects)&&(r.filter_subjects=this.consumerOpts.filterSubjects),"string"==typeof this.consumerOpts.filterSubjects&&(r.filter_subject=this.consumerOpts.filterSubjects),e===this.startSeq+1&&(r.deliver_policy=this.consumerOpts.deliver_policy||Je.StartSequence,(this.consumerOpts.deliver_policy===Je.LastPerSubject||this.consumerOpts.deliver_policy===Je.New||this.consumerOpts.deliver_policy===Je.Last)&&(delete r.opt_start_seq,r.deliver_policy=this.consumerOpts.deliver_policy),r.deliver_policy===Je.LastPerSubject&&typeof r.filter_subjects>"u"&&typeof r.filter_subject>"u"&&(r.filter_subject=">"),this.consumerOpts.opt_start_time&&(delete r.opt_start_seq,r.deliver_policy=Je.StartTime,r.opt_start_time=this.consumerOpts.opt_start_time),this.consumerOpts.inactive_threshold&&(r.inactive_threshold=Re(this.consumerOpts.inactive_threshold))),r}resetConsumer(e=0){var t=this;return(0,B.Z)(function*(){if(t.consumer)for(;;)try{yield t.delete();break}catch(i){if("TIMEOUT"!==i.message)throw i}e=0===e?1:e,t.cursor.deliver_seq=0;const r=t.getConsumerOpts(e);let n;for(r.max_deliver=1,r.mem_storage=!0;;)try{n=yield t.api.add(t.stream,r);break}catch(i){if("TIMEOUT"!==i.message)throw i}return n})()}internalHandler(e){return t=>{if(this.serial!==e)return;const r=t.info.deliverySequence;r===this.cursor.deliver_seq+1?(this.cursor.deliver_seq=r,this.cursor.stream_seq=t.info.streamSequence,this.userCallback?this.userCallback(t):this.iter?.push(t)):this.reset(this.opts)}}reset(e={max_messages:100,expires:3e4},t=!1){var r=this;return(0,B.Z)(function*(){r.currentConsumer=yield r.resetConsumer(r.cursor.stream_seq+1),null===r.iter&&(r.iter=new pn),r.consumer=new mn(r.api,r.currentConsumer),e.callback=r.internalHandler(r.serial);let i=null;if(r.type===$t.Fetch&&t)i=yield r.consumer.fetch(e);else{if(r.type!==$t.Consume)return Promise.reject("reset called with unset consumer type");i=yield r.consumer.consume(e)}return r.iter.setSource(i),r.iter})()}consume(e={max_messages:100,expires:3e4}){if(this.type===$t.Fetch)return Promise.reject(new Error("ordered consumer initialized as fetch"));if(this.type===$t.Consume)return Promise.reject(new Error("ordered consumer doesn't support concurrent consume"));const{callback:t}=e;return t&&(this.userCallback=t),this.type=$t.Consume,this.opts=e,this.reset(e)}fetch(e={max_messages:100,expires:3e4}){if(this.type===$t.Consume)return Promise.reject(new Error("ordered consumer already initialized as consume"));if(!1===this.iter?.done)return Promise.reject(new Error("ordered consumer doesn't support concurrent fetch"));const{callback:t}=e;return t&&(this.userCallback=t),this.type=$t.Fetch,this.opts=e,this.iter=new pn,this.reset(e,!0)}next(e={expires:3e4}){var t=this;return(0,B.Z)(function*(){const r=ce(),n=e;return n.max_messages=1,n.callback=o=>{t.userCallback=null,r.resolve(o)},(yield t.fetch(n)).iterClosed.then(()=>{r.resolve(null)}).catch(o=>{r.reject(o)}),r})()}delete(){return this.currentConsumer?this.api.delete(this.stream,this.currentConsumer.name).then(e=>Promise.resolve(e)).catch(e=>Promise.reject(e)).finally(()=>{this.currentConsumer=null}):Promise.resolve(!1)}info(e){var t=this;return(0,B.Z)(function*(){return null==t.currentConsumer?(t.currentConsumer=yield t.resetConsumer(t.serial),Promise.resolve(t.currentConsumer)):e&&t.currentConsumer?Promise.resolve(t.currentConsumer):t.api.info(t.stream,t.currentConsumer.name)})()}}function es(s){if(void 0===s)return;const{domain:e}=s;if(void 0===e)return s;const t=Object.assign({},s);if(delete t.domain,""===e)return t;if(t.external)throw new Error("domain and external are both set");return t.external={api:`$JS.${e}.API`},t}const Is="OBJ_";class gn{api;notified;constructor(e){this.api=e,this.notified=!1}checkVersion(){const e=this.api.nc.features.get(oe.JS_SIMPLIFICATION);return e.ok?Promise.resolve():Promise.reject(new Error(`consumers framework is only supported on servers ${e.min} or better`))}get(e,t={}){var r=this;return(0,B.Z)(function*(){return"object"==typeof t?r.ordered(e,t):(yield r.checkVersion(),r.api.info(e,t).then(n=>void 0!==n.config.deliver_subject?Promise.reject(new Error("push consumer not supported")):new mn(r.api,n)).catch(n=>Promise.reject(n)))})()}ordered(e,t){var r=this;return(0,B.Z)(function*(){yield r.checkVersion();const n=r.api;return new js(n.nc,n.opts).info(e).then(o=>Promise.resolve(new Bi(r.api,e,t))).catch(o=>Promise.reject(o))})()}}class ts{api;_info;constructor(e,t){this.api=e,this._info=t}get name(){return this._info.config.name}alternates(){return this.info().then(e=>e.alternates?e.alternates:[])}best(){var e=this;return(0,B.Z)(function*(){if(yield e.info(),e._info.alternates){const t=yield e.api.info(e._info.alternates[0].name);return new ts(e.api,t)}return e})()}info(e=!1,t){return e?Promise.resolve(this._info):this.api.info(this.name,t).then(r=>(this._info=r,this._info))}getConsumer(e){return new gn(new Cs(this.api.nc,this.api.opts)).get(this.name,e)}getMessage(e){return this.api.getMessage(this.name,e)}deleteMessage(e,t){return this.api.deleteMessage(this.name,e,t)}}const rs="KV-Operation",qi=/^[-/=.\w]+$/,Di=/^[-/=.>*\w]+$/,Hi=/^[-\w]+$/;function zi(s){if(s.startsWith(".")||s.endsWith(".")||!qi.test(s))throw new Error(`invalid key: ${s}`)}function Ki(s){if(s.startsWith(".")||s.endsWith(".")||!Di.test(s))throw new Error(`invalid key: ${s}`)}function Zi(s){if(s.startsWith(".")||s.endsWith("."))throw new Error(`invalid key: ${s}`);const e=s.split(".");let t=!1;for(let r=0;r<e.length;r++)switch(e[r]){case"*":t=!0;break;case">":if(r!==e.length-1)throw new Error(`invalid key: ${s}`);t=!0}return t}function ss(s){if(!Hi.test(s))throw new Error(`invalid bucket name: ${s}`)}var s;(s=Ft||(Ft={})).MsgIdHdr="Nats-Msg-Id",s.ExpectedStreamHdr="Nats-Expected-Stream",s.ExpectedLastSeqHdr="Nats-Expected-Last-Sequence",s.ExpectedLastMsgIdHdr="Nats-Expected-Last-Msg-Id",s.ExpectedLastSubjectSequenceHdr="Nats-Expected-Last-Subject-Sequence";class Rr{js;jsm;stream;bucket;direct;codec;prefix;editPrefix;useJsPrefix;_prefixLen;constructor(e,t,r){ss(e),this.js=t,this.jsm=r,this.bucket=e,this.prefix="$KV",this.editPrefix="",this.useJsPrefix=!1,this._prefixLen=0}static create(e,t,r={}){return(0,B.Z)(function*(){ss(t);const n=yield e.jetstreamManager(),i=new Rr(t,e,n);return yield i.init(r),i})()}static bind(e,t,r={}){return(0,B.Z)(function*(){const n=yield e.jetstreamManager(),i=yield n.streams.info(`${wt}${t}`);ss(i.config.name);const o=new Rr(t,e,n);return Object.assign(o,i),o.codec=r.codec||{key:{encode:s=>s,decode:s=>s},value:{encode:s=>s,decode:s=>s}},o.direct=i.config.allow_direct??!1,o.initializePrefixes(i),o})()}init(e={}){var t=this;return(0,B.Z)(function*(){const r=Object.assign(function Li(){return{replicas:1,history:1,timeout:2e3,maxBucketSize:-1,maxValueSize:-1,codec:{key:{encode:s=>s,decode:s=>s},value:{encode:s=>s,decode:s=>s}},storage:an.File}}(),e);t.codec=r.codec;const n={};t.stream=n.name=e.streamName??t.bucketName(),n.retention=on.Limits,n.max_msgs_per_subject=r.history,r.maxBucketSize&&(r.max_bytes=r.maxBucketSize),r.max_bytes&&(n.max_bytes=r.max_bytes),n.max_msg_size=r.maxValueSize,n.storage=r.storage;const i=e.placementCluster??"";if(i&&(e.placement={},e.placement.cluster=i,e.placement.tags=[]),e.placement&&(n.placement=e.placement),e.republish&&(n.republish=e.republish),e.description&&(n.description=e.description),e.mirror){const N=Object.assign({},e.mirror);N.name.startsWith(wt)||(N.name=`${wt}${N.name}`),n.mirror=N,n.mirror_direct=!0}else if(e.sources){const N=e.sources.map(U=>{const q=Object.assign({},U);q.name.startsWith(wt)||(q.name=`${wt}${q.name}`)});n.sources=N}else n.subjects=[t.subjectForBucket()];e.metadata&&(n.metadata=e.metadata);const o=t.js.nc,c=o.getServerVersion(),m=!!c&&de(c,J("2.7.2"))>=0;n.discard=m?Xr.New:Xr.Old;const{ok:S,min:I}=o.features.get(oe.JS_ALLOW_DIRECT);if(!S&&!0===e.allow_direct)return Promise.reject(new Error(`allow_direct is not available on server version ${c?`${c.major}.${c.minor}.${c.micro}`:"unknown"} - requires ${I}`));let P;e.allow_direct="boolean"==typeof e.allow_direct?e.allow_direct:S,n.allow_direct=e.allow_direct,t.direct=n.allow_direct,n.num_replicas=r.replicas,r.ttl&&(n.max_age=Re(r.ttl)),n.allow_rollup_hdrs=!0;try{P=yield t.jsm.streams.info(n.name),!P.config.allow_direct&&!0===t.direct&&(t.direct=!1)}catch(N){if("stream not found"!==N.message)throw N;P=yield t.jsm.streams.add(n)}t.initializePrefixes(P)})()}initializePrefixes(e){this._prefixLen=0,this.prefix=`$KV.${this.bucket}`,this.useJsPrefix="$JS.API"!==this.js.apiPrefix;const{mirror:t}=e.config;if(t){let r=t.name;if(r.startsWith(wt)&&(r=r.substring(3)),t.external&&""!==t.external.api){const n=t.name.substring(3);this.useJsPrefix=!1,this.prefix=`$KV.${n}`,this.editPrefix=`${t.external.api}.$KV.${r}`}else this.editPrefix=this.prefix}}bucketName(){return this.stream??`${wt}${this.bucket}`}subjectForBucket(){return`${this.prefix}.${this.bucket}.>`}subjectForKey(e,t=!1){const r=[];return t?(this.useJsPrefix&&r.push(this.js.apiPrefix),r.push(""!==this.editPrefix?this.editPrefix:this.prefix)):this.prefix&&r.push(this.prefix),r.push(e),r.join(".")}fullKeyName(e){return""!==this.prefix?`${this.prefix}.${e}`:`$KV.${this.bucket}.${e}`}get prefixLen(){return 0===this._prefixLen&&(this._prefixLen=this.prefix.length+1),this._prefixLen}encodeKey(e){const t=[];for(const r of e.split("."))switch(r){case">":case"*":t.push(r);break;default:t.push(this.codec.key.encode(r))}return t.join(".")}decodeKey(e){const t=[];for(const r of e.split("."))switch(r){case">":case"*":t.push(r);break;default:t.push(this.codec.key.decode(r))}return t.join(".")}validateKey=zi;validateSearchKey=Ki;hasWildcards=Zi;close(){return Promise.resolve()}dataLen(e,t){const r=t&&t.get(ft.MessageSizeHdr)||"";return""!==r?parseInt(r,10):e.length}smToEntry(e){return new Wi(this.bucket,this.prefixLen,e)}jmToEntry(e){const t=this.decodeKey(e.subject.substring(this.prefixLen));return new Xi(this.bucket,t,e)}create(e,t){var r=this;return(0,B.Z)(function*(){let n;try{const o=yield r.put(e,t,{previousSeq:0});return Promise.resolve(o)}catch(o){if(n=o,10071!==o?.api_error?.err_code)return Promise.reject(o)}let i=0;try{const o=yield r.get(e);return"DEL"===o?.operation||"PURGE"===o?.operation?(i=null!==o?o.revision:0,r.update(e,t,i)):Promise.reject(n)}catch(o){return Promise.reject(o)}})()}update(e,t,r){if(r<=0)throw new Error("version must be greater than 0");return this.put(e,t,{previousSeq:r})}put(e,t,r={}){var n=this;return(0,B.Z)(function*(){const i=n.encodeKey(e);n.validateKey(i);const o={};if(void 0!==r.previousSeq){const c=me();o.headers=c,c.set(Ft.ExpectedLastSubjectSequenceHdr,`${r.previousSeq}`)}try{return(yield n.js.publish(n.subjectForKey(i,!0),t,o)).seq}catch(c){const m=c;return m.isJetStreamError()?(m.message=m.api_error?.description,m.code=`${m.api_error?.code}`,Promise.reject(m)):Promise.reject(c)}})()}get(e,t){var r=this;return(0,B.Z)(function*(){const n=r.encodeKey(e);r.validateKey(n);let o,i={last_by_subj:r.subjectForKey(n)};t&&t.revision>0&&(i={seq:t.revision});try{o=r.direct?yield r.jsm.direct.getMessage(r.bucketName(),i):yield r.jsm.streams.getMessage(r.bucketName(),i);const c=r.smToEntry(o);return c.key!==n?null:c}catch(c){if(c.code===G.JetStream404NoMessages)return null;throw c}})()}purge(e){return this._deleteOrPurge(e,"PURGE")}delete(e){return this._deleteOrPurge(e,"DEL")}purgeDeletes(e=18e5){var t=this;return(0,B.Z)(function*(){const r=ce(),n=[],i=yield t.watch({key:">",initializedFn:()=>{r.resolve()}});(0,B.Z)(function*(){var P,S=!1,I=!1;try{for(var U,N=(0,fe.Z)(i);S=!(U=yield N.next()).done;S=!1){const q=U.value;("DEL"===q.operation||"PURGE"===q.operation)&&n.push(q)}}catch(q){I=!0,P=q}finally{try{S&&null!=N.return&&(yield N.return())}finally{if(I)throw P}}})().then(),yield r,i.stop();const o=Date.now()-e,c=n.map(S=>{const I=t.subjectForKey(S.key);return S.created.getTime()>=o?t.jsm.streams.purge(t.stream,{filter:I,keep:1}):t.jsm.streams.purge(t.stream,{filter:I,keep:0})}),m=yield Promise.all(c);return m.unshift({success:!0,purged:0}),m.reduce((S,I)=>(S.purged+=I.purged,S))})()}_deleteOrPurge(e,t){var r=this;return(0,B.Z)(function*(){if(!r.hasWildcards(e))return r._doDeleteOrPurge(e,t);const n=yield r.keys(e),i=[];var m,o=!1,c=!1;try{for(var I,S=(0,fe.Z)(n);o=!(I=yield S.next()).done;o=!1)i.push(r._doDeleteOrPurge(I.value,t)),100===i.length&&(yield Promise.all(i),i.length=0)}catch(P){c=!0,m=P}finally{try{o&&null!=S.return&&(yield S.return())}finally{if(c)throw m}}i.length>0&&(yield Promise.all(i))})()}_doDeleteOrPurge(e,t){var r=this;return(0,B.Z)(function*(){const n=r.encodeKey(e);r.validateKey(n);const i=me();i.set(rs,t),"PURGE"===t&&i.set(ft.RollupHdr,ft.RollupValueSubject),yield r.js.publish(r.subjectForKey(n,!0),ye,{headers:i})})()}_buildCC(e,t,r={}){const n=this.encodeKey(e);this.validateSearchKey(e);let i=Je.LastPerSubject;return t===Tt.AllHistory&&(i=Je.All),t===Tt.UpdatesOnly&&(i=Je.New),Object.assign({deliver_policy:i,ack_policy:tt.None,filter_subject:this.fullKeyName(n),flow_control:!0,idle_heartbeat:Re(5e3)},r)}remove(e){return this.purge(e)}history(e={}){var t=this;return(0,B.Z)(function*(){const r=e.key??">",n=new ue,i={};let o;i.headers_only=e.headers_only||!1,o=()=>{n.stop()};let c=0;const m=t._buildCC(r,Tt.AllHistory,i),S=m.filter_subject,I=Gt(m);I.bindStream(t.stream),I.orderedConsumer(),I.callback((N,U)=>{if(N)n.stop(N);else if(U){const q=t.jmToEntry(U);n.push(q),n.received++,(o&&c>0&&n.received>=c||0===U.info.pending)&&(n.push(o),o=void 0)}});const P=yield t.js.subscribe(S,I);if(o){const{info:{last:N}}=P,U=N.num_pending+N.delivered.consumer_seq;if(0===U||n.received>=U)try{o()}catch(q){n.stop(q)}finally{o=void 0}else c=U}return n._data=P,n.iterClosed.then(()=>{P.unsubscribe()}),P.closed.then(()=>{n.stop()}).catch(N=>{n.stop(N)}),n})()}watch(e={}){var t=this;return(0,B.Z)(function*(){const r=e.key??">",n=new ue,i={};i.headers_only=e.headers_only||!1;let o=Tt.LastValue;e.include===Tt.AllHistory?o=Tt.AllHistory:e.include===Tt.UpdatesOnly&&(o=Tt.UpdatesOnly);const c=!0===e.ignoreDeletes;let m=e.initializedFn,S=0;const I=t._buildCC(r,o,i),P=I.filter_subject,N=Gt(I);N.bindStream(t.stream),N.orderedConsumer(),N.callback((q,Z)=>{if(q)n.stop(q);else if(Z){const xe=t.jmToEntry(Z);if(c&&"DEL"===xe.operation)return;n.push(xe),n.received++,m&&(S>0&&n.received>=S||0===Z.info.pending)&&(n.push(m),m=void 0)}});const U=yield t.js.subscribe(P,N);if(m){const{info:{last:q}}=U,Z=q.num_pending+q.delivered.consumer_seq;if(0===Z||n.received>=Z)try{m()}catch(xe){n.stop(xe)}finally{m=void 0}else S=Z}return n._data=U,n.iterClosed.then(()=>{U.unsubscribe()}),U.closed.then(()=>{n.stop()}).catch(q=>{n.stop(q)}),n})()}keys(e=">"){var t=this;return(0,B.Z)(function*(){const r=new ue,n=t._buildCC(e,Tt.LastValue,{headers_only:!0}),i=n.filter_subject,o=Gt(n);o.bindStream(t.stream),o.orderedConsumer();const c=yield t.js.subscribe(i,o);return(0,B.Z)(function*(){var P,S=!1,I=!1;try{for(var U,N=(0,fe.Z)(c);S=!(U=yield N.next()).done;S=!1){const q=U.value;{const Z=q.headers?.get(rs);if("DEL"!==Z&&"PURGE"!==Z){const xe=t.decodeKey(q.subject.substring(t.prefixLen));r.push(xe)}0===q.info.pending&&c.unsubscribe()}}}catch(q){I=!0,P=q}finally{try{S&&null!=N.return&&(yield N.return())}finally{if(I)throw P}}})().then(()=>{r.stop()}).catch(S=>{r.stop(S)}),0===c.info.last.num_pending&&c.unsubscribe(),r})()}purgeBucket(e){return this.jsm.streams.purge(this.bucketName(),e)}destroy(){return this.jsm.streams.delete(this.bucketName())}status(){var e=this;return(0,B.Z)(function*(){const r=e.js.nc.info?.cluster??"",n=e.bucketName(),i=yield e.jsm.streams.info(n);return new yn(i,r)})()}}class yn{si;cluster;constructor(e,t=""){this.si=e,this.cluster=t}get bucket(){return this.si.config.name.startsWith(wt)?this.si.config.name.substring(3):this.si.config.name}get values(){return this.si.state.messages}get history(){return this.si.config.max_msgs_per_subject}get ttl(){return ws(this.si.config.max_age)}get bucket_location(){return this.cluster}get backingStore(){return this.si.config.storage}get storage(){return this.si.config.storage}get replicas(){return this.si.config.num_replicas}get description(){return this.si.config.description??""}get maxBucketSize(){return this.si.config.max_bytes}get maxValueSize(){return this.si.config.max_msg_size}get max_bytes(){return this.si.config.max_bytes}get placement(){return this.si.config.placement||{cluster:"",tags:[]}}get placementCluster(){return this.si.config.placement?.cluster??""}get republish(){return this.si.config.republish??{src:"",dest:""}}get streamInfo(){return this.si}get size(){return this.si.state.bytes}get metadata(){return this.si.config.metadata??{}}}const wn="SHA-256=";class Os{si;backingStore;constructor(e){this.si=e,this.backingStore="JetStream"}get bucket(){return function Ji(s){return s.startsWith(Is)?s.substring(4):s}(this.si.config.name)}get description(){return this.si.config.description??""}get ttl(){return this.si.config.max_age}get storage(){return this.si.config.storage}get replicas(){return this.si.config.num_replicas}get sealed(){return this.si.config.sealed}get size(){return this.si.state.bytes}get streamInfo(){return this.si}get metadata(){return this.si.config.metadata}}class js extends kr{constructor(e,t){super(e,t)}checkStreamConfigVersions(e){const t=this.nc;if(e.metadata){const{min:n,ok:i}=t.features.get(oe.JS_STREAM_CONSUMER_METADATA);if(!i)throw new Error(`stream 'metadata' requires server ${n}`)}if(e.first_seq){const{min:n,ok:i}=t.features.get(oe.JS_STREAM_FIRST_SEQ);if(!i)throw new Error(`stream 'first_seq' requires server ${n}`)}if(e.subject_transform){const{min:n,ok:i}=t.features.get(oe.JS_STREAM_SUBJECT_TRANSFORM);if(!i)throw new Error(`stream 'subject_transform' requires server ${n}`)}if(e.compression){const{min:n,ok:i}=t.features.get(oe.JS_STREAM_COMPRESSION);if(!i)throw new Error(`stream 'compression' requires server ${n}`)}if(e.consumer_limits){const{min:n,ok:i}=t.features.get(oe.JS_DEFAULT_CONSUMER_LIMITS);if(!i)throw new Error(`stream 'consumer_limits' requires server ${n}`)}function r(n,i){if((i.subject_transforms?.length||0)>0){const{min:c,ok:m}=t.features.get(oe.JS_STREAM_SOURCE_SUBJECT_TRANSFORM);if(!m)throw new Error(`${n} 'subject_transforms' requires server ${c}`)}}e.sources&&e.sources.forEach(n=>{r("stream sources",n)}),e.mirror&&r("stream mirror",e.mirror)}add(e={}){var t=this;return(0,B.Z)(function*(){t.checkStreamConfigVersions(e),ht(e.name),e.mirror=es(e.mirror),e.sources=e.sources?.map(es);const n=yield t._request(`${t.prefix}.STREAM.CREATE.${e.name}`,e);return t._fixInfo(n),n})()}delete(e){var t=this;return(0,B.Z)(function*(){return ht(e),(yield t._request(`${t.prefix}.STREAM.DELETE.${e}`)).success})()}update(e,t={}){var r=this;return(0,B.Z)(function*(){if("object"==typeof e){const m=e;e=m.name,t=m,console.trace("\x1b[33m >> streams.update(config: StreamConfig) api changed to streams.update(name: string, config: StreamUpdateConfig) - this shim will be removed - update your code.  \x1b[0m")}r.checkStreamConfigVersions(t),ht(e);const n=yield r.info(e),i=Object.assign(n.config,t);i.mirror=es(i.mirror),i.sources=i.sources?.map(es);const c=yield r._request(`${r.prefix}.STREAM.UPDATE.${e}`,i);return r._fixInfo(c),c})()}info(e,t){var r=this;return(0,B.Z)(function*(){ht(e);const n=`${r.prefix}.STREAM.INFO.${e}`;let o=yield r._request(n,t),{total:c,limit:m}=o,S=o.state.subjects?Object.getOwnPropertyNames(o.state.subjects).length:1;if(c&&c>S){const I=[o],P=t||{};let N=0;for(;c>S;){N++,P.offset=m*N;const q=yield r._request(n,P);c=q.total,I.push(q);const Z=Object.getOwnPropertyNames(q.state.subjects).length;if(S+=Z,Z<m)break}let U={};for(let q=0;q<I.length;q++)o=I[q],o.state.subjects&&(U=Object.assign(U,o.state.subjects));o.offset=0,o.total=0,o.limit=0,o.state.subjects=U}return r._fixInfo(o),o})()}list(e=""){return new Mr(`${this.prefix}.STREAM.LIST`,i=>{const o=i;return o.streams.forEach(c=>{this._fixInfo(c)}),o.streams},this,e?.length?{subject:e}:{})}_fixInfo(e){e.config.sealed=e.config.sealed||!1,e.config.deny_delete=e.config.deny_delete||!1,e.config.deny_purge=e.config.deny_purge||!1,e.config.allow_rollup_hdrs=e.config.allow_rollup_hdrs||!1}purge(e,t){var r=this;return(0,B.Z)(function*(){if(t){const{keep:i,seq:o}=t;if("number"==typeof i&&"number"==typeof o)throw new Error("can specify one of keep or seq")}return ht(e),yield r._request(`${r.prefix}.STREAM.PURGE.${e}`,t)})()}deleteMessage(e,t,r=!0){var n=this;return(0,B.Z)(function*(){ht(e);const i={seq:t};return r||(i.no_erase=!0),(yield n._request(`${n.prefix}.STREAM.MSG.DELETE.${e}`,i)).success})()}getMessage(e,t){var r=this;return(0,B.Z)(function*(){ht(e);const i=yield r._request(`${r.prefix}.STREAM.MSG.GET.${e}`,t);return new Vi(i)})()}find(e){return this.findStream(e)}listKvs(){return new Mr(`${this.prefix}.STREAM.LIST`,r=>{const i=r.streams.filter(m=>m.config.name.startsWith(wt));i.forEach(m=>{this._fixInfo(m)});let o="";return i.length&&(o=this.nc.info?.cluster??""),i.map(m=>new yn(m,o))},this)}listObjectStores(){return new Mr(`${this.prefix}.STREAM.LIST`,r=>{const i=r.streams.filter(c=>c.config.name.startsWith(Is));return i.forEach(c=>{this._fixInfo(c)}),i.map(c=>new Os(c))},this)}names(e=""){return new Mr(`${this.prefix}.STREAM.NAMES`,i=>i.streams,this,e?.length?{subject:e}:{})}get(e){var t=this;return(0,B.Z)(function*(){const r=yield t.info(e);return Promise.resolve(new ts(t,r))})()}}let Vi=(()=>class s{_header;smr;static jc;constructor(t){this.smr=t}get subject(){return this.smr.message.subject}get seq(){return this.smr.message.seq}get timestamp(){return this.smr.message.time}get time(){return new Date(Date.parse(this.timestamp))}get data(){return this.smr.message.data?this._parse(this.smr.message.data):ye}get header(){if(!this._header)if(this.smr.message.hdrs){const t=this._parse(this.smr.message.hdrs);this._header=Ie.decode(t)}else this._header=me();return this._header}_parse(t){const r=atob(t),n=r.length,i=new Uint8Array(n);for(let o=0;o<n;o++)i[o]=r.charCodeAt(o);return i}json(t){return Ge(t).decode(this.data)}string(){return Te.decode(this.data)}})();class Yi{api;constructor(e){this.api=e}get(e){return this.api.info(e).then(t=>new ts(this.api,t))}}class Wi{bucket;sm;prefixLen;constructor(e,t,r){this.bucket=e,this.prefixLen=t,this.sm=r}get key(){return this.sm.subject.substring(this.prefixLen)}get value(){return this.sm.data}get delta(){return 0}get created(){return this.sm.time}get revision(){return this.sm.seq}get operation(){return this.sm.header.get(rs)||"PUT"}get length(){const e=this.sm.header.get(ft.MessageSizeHdr)||"";return""!==e?parseInt(e,10):this.sm.data.length}json(){return this.sm.json()}string(){return this.sm.string()}}class Xi{bucket;key;sm;constructor(e,t,r){this.bucket=e,this.key=t,this.sm=r}get value(){return this.sm.data}get created(){return new Date(ws(this.sm.info.timestampNanos))}get revision(){return this.sm.seq}get operation(){return this.sm.headers?.get(rs)||"PUT"}get delta(){return this.sm.info.pending}get length(){const e=this.sm.headers?.get(ft.MessageSizeHdr)||"";return""!==e?parseInt(e,10):this.sm.data.length}json(){return this.sm.json()}string(){return this.sm.string()}}class Ms{info;hdrs;constructor(e){this.info=e}get name(){return this.info.name}get description(){return this.info.description??""}get headers(){return this.hdrs||(this.hdrs=Ie.fromRecord(this.info.headers||{})),this.hdrs}get options(){return this.info.options}get bucket(){return this.info.bucket}get chunks(){return this.info.chunks}get deleted(){return this.info.deleted??!1}get digest(){return this.info.digest}get mtime(){return this.info.mtime}get nuid(){return this.info.nuid}get size(){return this.info.size}get revision(){return this.info.revision}get metadata(){return this.info.metadata||{}}isLink(){return void 0!==this.info.options?.link}}function xn(s){const e={name:s.name,description:s.description??"",options:s.options,metadata:s.metadata};return s.headers&&(e.headers=s.headers.toRecord()),e}class Ur{jsm;js;stream;name;constructor(e,t,r){this.name=e,this.jsm=t,this.js=r}_checkNotEmpty(e){return e&&0!==e.length?{name:e}:{name:e,error:new Error("name cannot be empty")}}info(e){var t=this;return(0,B.Z)(function*(){const r=yield t.rawInfo(e);return r?new Ms(r):null})()}list(){var e=this;return(0,B.Z)(function*(){const t=[],r=yield e.watch({ignoreDeletes:!0,includeHistory:!0});var o,n=!1,i=!1;try{for(var m,c=(0,fe.Z)(r);n=!(m=yield c.next()).done;n=!1){const S=m.value;if(null===S)break;t.push(S)}}catch(S){i=!0,o=S}finally{try{n&&null!=c.return&&(yield c.return())}finally{if(i)throw o}}return Promise.resolve(t)})()}rawInfo(e){var t=this;return(0,B.Z)(function*(){const{name:r,error:n}=t._checkNotEmpty(e);if(n)return Promise.reject(n);const i=t._metaSubject(r);try{const o=yield t.jsm.streams.getMessage(t.stream,{last_by_subj:i}),m=Ge().decode(o.data);return m.revision=o.seq,m}catch(o){return"404"===o.code?null:Promise.reject(o)}})()}_si(e){var t=this;return(0,B.Z)(function*(){try{return yield t.jsm.streams.info(t.stream,e)}catch(r){return"404"===r.code?null:Promise.reject(r)}})()}seal(){var e=this;return(0,B.Z)(function*(){let t=yield e._si();return null===t?Promise.reject(new Error("object store not found")):(t.config.sealed=!0,t=yield e.jsm.streams.update(e.stream,t.config),Promise.resolve(new Os(t)))})()}status(e){var t=this;return(0,B.Z)(function*(){const r=yield t._si(e);return null===r?Promise.reject(new Error("object store not found")):Promise.resolve(new Os(r))})()}destroy(){return this.jsm.streams.delete(this.stream)}_put(e,t,r){var n=this;return(0,B.Z)(function*(){const i=n.js.getOptions();(r=r||{timeout:i.timeout}).timeout=r.timeout||i.timeout,r.previousRevision=r.previousRevision??void 0;const{timeout:o,previousRevision:c}=r,S=n.js.nc.info?.max_payload||1024;(e=e||{}).options=e.options||{};let I=e.options?.max_chunk_size||131072;I=I>S?S:I,e.options.max_chunk_size=I;const P=yield n.info(e.name),{name:N,error:U}=n._checkNotEmpty(e.name);if(U)return Promise.reject(U);const q=Et.next(),Z=n._chunkSubject(q),xe=n._metaSubject(N),le=Object.assign({bucket:n.name,nuid:q,size:0,chunks:0},xn(e)),Ye=ce(),We=[],At=new Be;try{const Jt=t?t.getReader():null,pr=new fn;for(;;){const{done:is,value:tr}=Jt?yield Jt.read():{done:!0,value:void 0};if(is){if(At.size()>0){const Vt=At.drain();pr.update(Vt),le.chunks++,le.size+=Vt.length,We.push(n.js.publish(Z,Vt,{timeout:o}))}yield Promise.all(We),We.length=0,le.mtime=(new Date).toISOString();const Pt=pr.digest("base64"),mr=Pt.length%3,os=mr>0?"=".repeat(mr):"";le.digest=`${wn}${Pt}${os}`,le.deleted=!1;const gr=me();"number"==typeof c&&gr.set(Ft.ExpectedLastSubjectSequenceHdr,`${c}`),gr.set(ft.RollupHdr,ft.RollupValueSubject);const Br=yield n.js.publish(xe,Ge().encode(le),{headers:gr,timeout:o});if(le.revision=Br.seq,P)try{yield n.jsm.streams.purge(n.stream,{filter:`$O.${n.name}.C.${P.nuid}`})}catch{}Ye.resolve(new Ms(le));break}if(tr)for(At.fill(tr);At.size()>I;){le.chunks++,le.size+=I;const Pt=At.drain(e.options.max_chunk_size);pr.update(Pt),We.push(n.js.publish(Z,Pt,{timeout:o}))}}}catch(Jt){yield n.jsm.streams.purge(n.stream,{filter:Z}),Ye.reject(Jt)}return Ye})()}putBlob(e,t,r){return null===t&&(t=new Uint8Array(0)),this.put(e,function n(i){return new ReadableStream({pull(o){o.enqueue(i),o.close()}})}(t),r)}put(e,t,r){return e?.options?.link?Promise.reject(new Error("link cannot be set when putting the object in bucket")):this._put(e,t,r)}getBlob(e){var t=this;return(0,B.Z)(function*(){function n(){return(n=(0,B.Z)(function*(c){const m=new Be,S=c.getReader();for(;;){const{done:I,value:P}=yield S.read();if(I)return m.drain();P&&P.length&&m.fill(P)}})).apply(this,arguments)}const i=yield t.get(e);if(null===i)return Promise.resolve(null);const o=yield Promise.all([i.error,function r(c){return n.apply(this,arguments)}(i.data)]);return o[0]?Promise.reject(o[0]):Promise.resolve(o[1])})()}get(e){var t=this;return(0,B.Z)(function*(){const r=yield t.rawInfo(e);if(null===r||r.deleted)return Promise.resolve(null);if(r.options&&r.options.link){const P=r.options.link.name||"";if(""===P)throw new Error("link is a bucket");return(r.options.link.bucket!==t.name?yield Ur.create(t.js,r.options.link.bucket):t).get(P)}const n=ce(),i={info:new Ms(r),error:n};if(0===r.size)return i.data=function Qi(){return new ReadableStream({pull(s){s.enqueue(new Uint8Array(0)),s.close()}})}(),n.resolve(null),Promise.resolve(i);let o;const c=Gt();c.orderedConsumer();const m=new fn,S=`$O.${t.name}.C.${r.nuid}`,I=yield t.js.subscribe(S,c);return(0,B.Z)(function*(){var U,P=!1,N=!1;try{for(var Z,q=(0,fe.Z)(I);P=!(Z=yield q.next()).done;P=!1){const xe=Z.value;if(xe.data.length>0&&(m.update(xe.data),o.enqueue(xe.data)),0===xe.info.pending){const le=m.digest("base64"),Ye=le.length%3,We=Ye>0?"=".repeat(Ye):"",At=`${wn}${le}${We}`;At!==r.digest?o.error(new Error(`received a corrupt object, digests do not match received: ${r.digest} calculated ${At}`)):o.close(),I.unsubscribe()}}}catch(xe){N=!0,U=xe}finally{try{P&&null!=q.return&&(yield q.return())}finally{if(N)throw U}}})().then(()=>{n.resolve()}).catch(P=>{o.error(P),n.reject(P)}),i.data=new ReadableStream({start(P){o=P},cancel(){I.unsubscribe()}}),i})()}linkStore(e,t){if(!(t instanceof Ur))return Promise.reject("bucket required");const r=t,{name:n,error:i}=this._checkNotEmpty(e);return i?Promise.reject(i):this._put({name:n,options:{link:{bucket:r.name}}},null)}link(e,t){var r=this;return(0,B.Z)(function*(){const{name:n,error:i}=r._checkNotEmpty(e);if(i)return Promise.reject(i);if(t.deleted)return Promise.reject(new Error("src object is deleted"));if(t.isLink())return Promise.reject(new Error("src object is a link"));const o=yield r.rawInfo(e);if(null!==o&&!o.deleted)return Promise.reject(new Error("an object already exists with that name"));const m={name:n,options:{link:{bucket:t.bucket,name:t.name}}};yield r.js.publish(r._metaSubject(e),JSON.stringify(m));const S=yield r.info(e);return Promise.resolve(S)})()}delete(e){var t=this;return(0,B.Z)(function*(){const r=yield t.rawInfo(e);if(null===r)return Promise.resolve({purged:0,success:!1});r.deleted=!0,r.size=0,r.chunks=0,r.digest="";const n=Ge(),i=me();return i.set(ft.RollupHdr,ft.RollupValueSubject),yield t.js.publish(t._metaSubject(r.name),n.encode(r),{headers:i}),t.jsm.streams.purge(t.stream,{filter:t._chunkSubject(r.nuid)})})()}update(e,t={}){var r=this;return(0,B.Z)(function*(){const n=yield r.rawInfo(e);if(null===n)return Promise.reject(new Error("object not found"));if(n.deleted)return Promise.reject(new Error("cannot update meta for a deleted object"));t.name=t.name??n.name;const{name:i,error:o}=r._checkNotEmpty(t.name);if(o)return Promise.reject(o);if(e!==t.name){const S=yield r.info(t.name);if(S&&!S.deleted)return Promise.reject(new Error("an object already exists with that name"))}t.name=i;const c=Object.assign({},n,xn(t)),m=yield r.js.publish(r._metaSubject(c.name),JSON.stringify(c));return e!==t.name&&(yield r.jsm.streams.purge(r.stream,{filter:r._metaSubject(e)})),Promise.resolve(m)})()}watch(e={}){var t=this;return(0,B.Z)(function*(){e.includeHistory=e.includeHistory??!1,e.ignoreDeletes=e.ignoreDeletes??!1;let r=!1;const n=new ue,i=t._metaSubjectAll();try{yield t.jsm.streams.getMessage(t.stream,{last_by_subj:i})}catch(S){"404"===S.code?(n.push(null),r=!0):n.stop(S)}const o=Ge(),c=Gt();c.orderedConsumer(),e.includeHistory?c.deliverLastPerSubject():(r=!0,c.deliverNew()),c.callback((S,I)=>{if(S)n.stop(S);else if(null!==I){const P=o.decode(I.data);P.deleted&&!0===e.ignoreDeletes||n.push(P),0===I.info?.pending&&!r&&(r=!0,n.push(null))}});const m=yield t.js.subscribe(i,c);return n._data=m,n.iterClosed.then(()=>{m.unsubscribe()}),m.closed.then(()=>{n.stop()}).catch(S=>{n.stop(S)}),n})()}_chunkSubject(e){return`$O.${this.name}.C.${e}`}_metaSubject(e){return`$O.${this.name}.M.${Ir.encode(e)}`}_metaSubjectAll(){return`$O.${this.name}.M.>`}init(e={}){var t=this;return(0,B.Z)(function*(){try{t.stream=function Gi(s){return ss(s),`${Is}${s}`}(t.name)}catch(i){return Promise.reject(i)}const r=e?.ttl||0;delete e.ttl;const n=Object.assign({max_age:r},e);n.name=t.stream,n.allow_direct=!0,n.allow_rollup_hdrs=!0,n.discard=Xr.New,n.subjects=[`$O.${t.name}.C.>`,`$O.${t.name}.M.>`],e.placement&&(n.placement=e.placement),e.metadata&&(n.metadata=e.metadata);try{yield t.jsm.streams.info(n.name)}catch(i){"stream not found"===i.message&&(yield t.jsm.streams.add(n))}})()}static create(e,t,r={}){return(0,B.Z)(function*(){const n=yield e.jetstreamManager(),i=new Ur(t,n,e);return yield i.init(r),Promise.resolve(i)})()}}class eo{js;jsm;constructor(e){this.js=e}kv(e,t={}){const r=this.js,{ok:n,min:i}=r.nc.features.get(oe.JS_KV);return n?t.bindOnly?Rr.bind(this.js,e):Rr.create(this.js,e,t):Promise.reject(new Error(`kv is only supported on servers ${i} or better`))}os(e,t={}){if("function"!=typeof crypto?.subtle?.digest)return Promise.reject(new Error("objectstore: unable to calculate hashes - crypto.subtle.digest with sha256 support is required"));const r=this.js,{ok:n,min:i}=r.nc.features.get(oe.JS_OBJECTSTORE);return n?Ur.create(this.js,e,t):Promise.reject(new Error(`objectstore is only supported on servers ${i} or better`))}}class Ts extends kr{consumers;streams;consumerAPI;streamAPI;constructor(e,t){super(e,t),this.consumerAPI=new Cs(e,t),this.streamAPI=new js(e,t),this.consumers=new gn(this.consumerAPI),this.streams=new Yi(this.streamAPI)}jetstreamManager(){return this.nc.jetstreamManager(this.opts)}get apiPrefix(){return this.prefix}get views(){return new eo(this)}publish(e,t=ye,r){var n=this;return(0,B.Z)(function*(){(r=r||{}).expect=r.expect||{};const i=r?.headers||me();r&&(r.msgID&&i.set(Ft.MsgIdHdr,r.msgID),r.expect.lastMsgID&&i.set(Ft.ExpectedLastMsgIdHdr,r.expect.lastMsgID),r.expect.streamName&&i.set(Ft.ExpectedStreamHdr,r.expect.streamName),"number"==typeof r.expect.lastSequence&&i.set(Ft.ExpectedLastSeqHdr,`${r.expect.lastSequence}`),"number"==typeof r.expect.lastSubjectSequence&&i.set(Ft.ExpectedLastSubjectSequenceHdr,`${r.expect.lastSubjectSequence}`));const o=r.timeout||n.timeout,c={};o&&(c.timeout=o),r&&(c.headers=i);let I,{retries:m,retry_delay:S}=r;m=m||1,S=S||250;for(let N=0;N<m;N++)try{I=yield n.nc.request(e,t,c);break}catch(U){if(!("503"===U.code&&N+1<m))throw U;yield ie(S)}const P=n.parseJsResponse(I);if(""===P.stream)throw Q.errorForCode(G.JetStreamInvalidAck);return P.duplicate=!!P.duplicate&&P.duplicate,P})()}pull(e,t,r=0){var n=this;return(0,B.Z)(function*(){ht(e),lr(t);let i=n.timeout;r>i&&(i=r);const o={batch:1,no_wait:0===(r=r<0?0:Re(r)),expires:r},c=yield n.nc.request(`${n.prefix}.CONSUMER.MSG.NEXT.${e}.${t}`,n.jc.encode(o),{noMux:!0,timeout:i}),m=hr(c);if(m)throw m;return Nr(c)})()}fetch(e,t,r={}){ht(e),lr(t);let n=null;const i=(r.max_bytes??0)>0;let o=0;const c=i?r.max_bytes:0;let m=null;const S={};if(S.batch=r.batch||1,c){const le=this.nc.features.get(oe.JS_PULL_MAX_BYTES);if(!le.ok)throw new Error(`max_bytes is only supported on servers ${le.min} or better`);S.max_bytes=c}S.no_wait=r.no_wait||!1,S.no_wait&&S.expires&&(S.expires=0);const I=r.expires||0;if(I&&(S.expires=Re(I)),0===I&&!1===S.no_wait)throw new Error("expires or no_wait is required");const P=r.idle_heartbeat||0;P&&(S.idle_heartbeat=Re(P),!0===r.delay_heartbeat&&(S.idle_heartbeat=Re(4*P)));const N=new ue,U=S.batch;let q=0;N.protocolFilterFn=(le,Ye=!1)=>!vs(le.msg)||(m?.work(),!1),N.dispatchedFn=le=>{if(le){if(i&&(o+=le.data.length),q++,n&&0===le.info.pending)return;(1===N.getPending()&&0===le.info.pending||U===q||c>0&&o>=c)&&N.stop()}};const Z=T(this.nc.options.inboxPrefix),xe=this.nc.subscribe(Z,{max:r.batch,callback:(le,Ye)=>{null===le&&(le=hr(Ye)),null!==le?(n&&(n.cancel(),n=null),function Yt(s){return"string"==typeof s.code}(le)?N.stop(null===Sn(le)?void 0:le):N.stop(le)):(m?.work(),N.received++,N.push(Nr(Ye)))}});return I&&(n=Ne(I),n.catch(()=>{xe.isClosed()||(xe.drain().catch(()=>{}),n=null),m&&m.cancel()})),(0,B.Z)(function*(){try{P&&(m=new As(P,le=>(N.push(()=>{N.err=new Q(`${yt.IdleHeartbeatMissed}: ${le}`,G.JetStreamIdleHeartBeat)}),!0)))}catch{}yield xe.closed,null!==n&&(n.cancel(),n=null),m&&m.cancel(),N.stop()})().catch(),this.nc.publish(`${this.prefix}.CONSUMER.MSG.NEXT.${e}.${t}`,this.jc.encode(S),{reply:Z}),N}pullSubscribe(e,t=Gt()){var r=this;return(0,B.Z)(function*(){const n=yield r._processOptions(e,t);if(n.ordered)throw new Error("pull subscribers cannot be be ordered");if(n.config.deliver_subject)throw new Error("consumer info specifies deliver_subject - pull consumers cannot have deliver_subject set");const i=n.config.ack_policy;if(i===tt.None||i===tt.All)throw new Error("ack policy for pull consumers must be explicit");const o=r._buildTypedSubscriptionOpts(n),c=new to(r,n.deliver,o);c.info=n;try{yield r._maybeCreateConsumer(n)}catch(m){throw c.unsubscribe(),m}return c})()}subscribe(e,t=Gt()){var r=this;return(0,B.Z)(function*(){const n=yield r._processOptions(e,t);if(!n.isBind&&!n.config.deliver_subject)throw new Error("push consumer requires deliver_subject");const i=r._buildTypedSubscriptionOpts(n),o=new vn(r,n.deliver,i);o.info=n;try{yield r._maybeCreateConsumer(n)}catch(c){throw o.unsubscribe(),c}return o._maybeSetupHbMonitoring(),o})()}_processOptions(e,t=Gt()){var r=this;return(0,B.Z)(function*(){const n=cn(t)?t.getOpts():t;if(n.isBind=!!cn(t)&&t.isBind,n.flow_control={heartbeat_count:0,fc_count:0,consumer_restarts:0},n.ordered){if(n.ordered_consumer_sequence={stream_seq:0,delivery_seq:0},n.config.ack_policy!==tt.NotSet&&n.config.ack_policy!==tt.None)throw new Q("ordered consumer: ack_policy can only be set to 'none'",G.ApiError);if(n.config.durable_name&&n.config.durable_name.length>0)throw new Q("ordered consumer: durable_name cannot be set",G.ApiError);if(n.config.deliver_subject&&n.config.deliver_subject.length>0)throw new Q("ordered consumer: deliver_subject cannot be set",G.ApiError);if(void 0!==n.config.max_deliver&&n.config.max_deliver>1)throw new Q("ordered consumer: max_deliver cannot be set",G.ApiError);if(n.config.deliver_group&&n.config.deliver_group.length>0)throw new Q("ordered consumer: deliver_group cannot be set",G.ApiError);n.config.deliver_subject=T(r.nc.options.inboxPrefix),n.config.ack_policy=tt.None,n.config.max_deliver=1,n.config.flow_control=!0,n.config.idle_heartbeat=n.config.idle_heartbeat||Re(5e3),n.config.ack_wait=Re(792e5),n.config.mem_storage=!0,n.config.num_replicas=1}if(n.config.ack_policy===tt.NotSet&&(n.config.ack_policy=tt.All),n.api=r,n.config=n.config||{},n.stream=n.stream?n.stream:yield r.findStream(e),n.attached=!1,n.config.durable_name)try{const i=yield r.consumerAPI.info(n.stream,n.config.durable_name);if(i){if(i.config.filter_subject&&i.config.filter_subject!==e)throw new Error("subject does not match consumer");const o=n.config.deliver_group??"";if(""===o&&!0===i.push_bound)throw new Error("duplicate subscription");const c=i.config.deliver_group??"";if(o!==c)throw""===c?new Error("durable requires no queue group"):new Error(`durable requires queue group '${c}'`);n.last=i,n.config=i.config,n.attached=!0,n.config.durable_name||(n.name=i.name)}}catch(i){if("404"!==i.code)throw i}return!n.attached&&void 0===n.config.filter_subject&&void 0===n.config.filter_subjects&&(n.config.filter_subject=e),n.deliver=n.config.deliver_subject||T(r.nc.options.inboxPrefix),n})()}_buildTypedSubscriptionOpts(e){const t={};return t.adapter=function ro(s){return s?no:so}(void 0===e.callbackFn),t.ingestionFilterFn=Ts.ingestionFn(e.ordered),t.protocolFilterFn=(r,n=!1)=>{const i=r;return!xs(i.msg)||(n||i.msg.respond(),!1)},!e.mack&&e.config.ack_policy!==tt.None&&(t.dispatchedFn=io),e.callbackFn&&(t.callback=e.callbackFn),t.max=e.max||0,t.queue=e.queue,t}_maybeCreateConsumer(e){var t=this;return(0,B.Z)(function*(){if(e.attached)return;if(e.isBind)throw new Error(`unable to bind - durable consumer ${e.config.durable_name} doesn't exist in ${e.stream}`);e.config=Object.assign({deliver_policy:Je.All,ack_policy:tt.Explicit,ack_wait:Re(3e4),replay_policy:Or.Instant},e.config);const r=yield t.consumerAPI.add(e.stream,e.config);if(Array.isArray(e.config.filter_subjects&&!Array.isArray(r.config.filter_subjects)))throw new Error("jetstream server doesn't support consumers with multiple filter subjects");e.name=r.name,e.config=r.config,e.last=r})()}static ingestionFn(e){return(t,r)=>{const n=r;if(!t)return{ingest:!1,protocol:!1};const i=t;if(hr(i.msg)||n.monitor?.work(),vs(i.msg)){const c=!e||n._checkHbOrderConsumer(i.msg);return e||n.info.flow_control.heartbeat_count++,{ingest:c,protocol:!0}}return xs(i.msg)?(n.info.flow_control.fc_count++,{ingest:!0,protocol:!0}):{ingest:!e||n._checkOrderedConsumer(t),protocol:!1}}}}class vn extends Fi{js;monitor;constructor(e,t,r){super(e.nc,t,r),this.js=e,this.monitor=null,this.sub.closed.then(()=>{this.monitor&&this.monitor.cancel()})}set info(e){this.sub.info=e}get info(){return this.sub.info}_resetOrderedConsumer(e){if(null===this.info||this.sub.isClosed())return;const t=T(this.js.nc.options.inboxPrefix);this.js.nc._resub(this.sub,t);const n=this.info;n.ordered_consumer_sequence.delivery_seq=0,n.flow_control.heartbeat_count=0,n.flow_control.fc_count=0,n.flow_control.consumer_restarts++,n.deliver=t,n.config.deliver_subject=t,n.config.deliver_policy=Je.StartSequence,n.config.opt_start_seq=e;const i={};i.stream_name=this.info.stream,i.config=n.config,this.js._request(`${n.api.prefix}.CONSUMER.CREATE.${n.stream}`,i).then(c=>{const m=c;this.info.config=m.config,this.info.name=m.name}).catch(c=>{const m=new Q(`unable to recreate ordered consumer ${n.stream} at seq ${e}`,G.RequestError,c);this.sub.callback(m,{})})}_maybeSetupHbMonitoring(){const e=this.info?.config?.idle_heartbeat||0;e&&this._setupHbMonitoring(ws(e))}_setupHbMonitoring(e,t=0){const r={cancelAfter:0,maxOut:2};t&&(r.cancelAfter=t);const n=this.sub;this.monitor=new As(e,o=>{const c=function fi(s,e,t){const r=me(s,e),i=new ir({hdr:1,sid:0,size:0},ye,{});return i._headers=r,i._subject=t,i}(409,`${yt.IdleHeartbeatMissed}: ${o}`,this.sub.subject);return this.info?.ordered?!!this.js.nc.protocol.connected&&(this._resetOrderedConsumer((this.info?.ordered_consumer_sequence?.stream_seq||0)+1),!1):(this.sub.callback(null,c),!n.noIterator)},r)}_checkHbOrderConsumer(e){const t=e.headers.get(ft.ConsumerStalledHdr);""!==t&&this.js.nc.publish(t);const r=parseInt(e.headers.get(ft.LastConsumerSeqHdr),10),n=this.info.ordered_consumer_sequence;return this.info.flow_control.heartbeat_count++,r!==n.delivery_seq&&this._resetOrderedConsumer(n.stream_seq+1),!1}_checkOrderedConsumer(e){const t=this.info.ordered_consumer_sequence,r=e.info.streamSequence,n=e.info.deliverySequence;return n!=t.delivery_seq+1?(this._resetOrderedConsumer(t.stream_seq+1),!1):(t.delivery_seq=n,t.stream_seq=r,!0)}destroy(){var e=this;return(0,B.Z)(function*(){e.isClosed()||(yield e.drain());const t=e.sub.info,n=`${t.api.prefix}.CONSUMER.DELETE.${t.stream}.${t.config.durable_name||t.name}`;yield t.api._request(n)})()}consumerInfo(){var e=this;return(0,B.Z)(function*(){const t=e.sub.info,n=`${t.api.prefix}.CONSUMER.INFO.${t.stream}.${t.config.durable_name||t.name}`,i=yield t.api._request(n);return t.last=i,i})()}}class to extends vn{constructor(e,t,r){super(e,t,r)}pull(e={batch:1}){const{stream:t,config:r,name:n}=this.sub.info,i=r.durable_name??n,o={};if(o.batch=e.batch||1,o.no_wait=e.no_wait||!1,(e.max_bytes??0)>0){const S=this.js.nc.features.get(oe.JS_PULL_MAX_BYTES);if(!S.ok)throw new Error(`max_bytes is only supported on servers ${S.min} or better`);o.max_bytes=e.max_bytes}let c=0;e.expires&&e.expires>0&&(c=e.expires,o.expires=Re(c));let m=0;if(e.idle_heartbeat&&e.idle_heartbeat>0&&(m=e.idle_heartbeat,o.idle_heartbeat=Re(m)),m&&0===c)throw new Error("idle_heartbeat requires expires");if(m>c)throw new Error("expires must be greater than idle_heartbeat");if(this.info){this.monitor&&this.monitor.cancel(),c&&m&&(this.monitor?this.monitor._change(m,c):this._setupHbMonitoring(m,c));const S=this.info.api,P=this.sub.subject;S.nc.publish(`${S.prefix}.CONSUMER.MSG.NEXT.${t}.${i}`,S.jc.encode(o),{reply:P})}}}function so(s,e){return s||(s=hr(e))?[s,null]:[null,Nr(e)]}function no(s,e){if(s)return[s,null];const t=hr(e);return null!==t?[Sn(t),null]:[null,Nr(e)]}function Sn(s){if(null!==s)switch(s.code){case G.JetStream404NoMessages:case G.JetStream408RequestTimeout:return null;case G.JetStream409:return function pi(s){if(s.code!==G.JetStream409)return!1;const e=[yt.MaxBatchExceeded,yt.MaxExpiresExceeded,yt.MaxBytesExceeded,yt.MaxMessageSizeExceeded,yt.PushConsumer,yt.IdleHeartbeatMissed,yt.ConsumerDeleted];return di&&e.push(yt.MaxWaitingExceeded),void 0!==e.find(t=>-1!==s.message.indexOf(t))}(s)?s:null;default:return s}return null}function io(s){s&&s.ack()}class oo extends kr{constructor(e,t){super(e,t)}getMessage(e,t){var r=this;return(0,B.Z)(function*(){ht(e);let n=t;const{last_by_subj:i}=n;i&&(n=null);const o=n?r.jc.encode(n):ye,c=r.opts.apiPrefix||"$JS.API",m=i?`${c}.DIRECT.GET.${e}.${i}`:`${c}.DIRECT.GET.${e}`,S=yield r.nc.request(m,o),I=hr(S);if(I)return Promise.reject(I);const P=new ao(S);return Promise.resolve(P)})()}}let ao=(()=>class s{data;header;static jc;constructor(t){if(!t.headers)throw new Error("headers expected");this.data=t.data,this.header=t.headers}get subject(){return this.header.get(jr.Subject)}get seq(){const t=this.header.get(jr.Sequence);return"string"==typeof t?parseInt(t):0}get time(){return new Date(Date.parse(this.timestamp))}get timestamp(){return this.header.get(jr.TimeStamp)}get stream(){return this.header.get(jr.Stream)}json(t){return Ge(t).decode(this.data)}string(){return Te.decode(this.data)}})();class co extends kr{streams;consumers;direct;constructor(e,t){super(e,t),this.streams=new js(e,t),this.consumers=new Cs(e,t),this.direct=new oo(e,t)}getAccountInfo(){var e=this;return(0,B.Z)(function*(){return yield e._request(`${e.prefix}.INFO`)})()}jetstream(){return this.nc.jetstream(this.getOptions())}advisories(){const e=new ue;return this.nc.subscribe("$JS.EVENT.ADVISORY.>",{callback:(t,r)=>{if(t)throw t;try{const n=this.parseJsResponse(r),i=n.type.split(".");e.push({kind:i[i.length-1],data:n})}catch(n){e.stop(n)}}}),e}}class En{msg;constructor(e){this.msg=e}get data(){return this.msg.data}get sid(){return this.msg.sid}get subject(){return this.msg.subject}get reply(){return this.msg.reply||""}get headers(){return this.msg.headers}respond(e,t){return this.msg.respond(e,t)}respondError(e,t,r,n){return(n=n||{}).headers=n.headers||me(),n.headers?.set(j,`${e}`),n.headers?.set(h,t),this.msg.respond(r,n)}json(e){return this.msg.json(e)}string(){return this.msg.string()}}class $r{subject;queue;srv;constructor(e,t="",r=""){""!==t&&function ho(s,e){if(-1!==e.indexOf(" "))throw new Error(`${s} cannot contain spaces: '${e}'`);e.split(".").forEach(r=>{if(">"===r)throw new Error(`${s} name cannot contain internal '>': '${e}'`)})}("service group",t);let n="";if(e instanceof Fr)this.srv=e,n="";else{if(!(e instanceof $r))throw new Error("unknown ServiceGroup type");{const i=e;this.srv=i.srv,""===r&&""!==i.queue&&(r=i.queue),n=i.subject}}this.subject=this.calcSubject(n,t),this.queue=r}calcSubject(e,t=""){return""===t?e:""!==e?`${e}.${t}`:t}addEndpoint(e="",t){const r="function"==typeof(t=t||{subject:e})?{handler:t,subject:e}:t;Pr("endpoint",e);let{subject:n,handler:i,metadata:o,queue:c}=r;return n=n||e,c=c||this.queue,function lo(s,e){if(""===e)throw new Error(`${s} cannot be empty`);if(-1!==e.indexOf(" "))throw new Error(`${s} cannot contain spaces: '${e}'`);const t=e.split(".");t.forEach((r,n)=>{if(">"===r&&n!==t.length-1)throw new Error(`${s} cannot have internal '>': '${e}'`)})}("endpoint subject",n),n=this.calcSubject(this.subject,n),this.srv._addEndpoint({name:e,subject:n,queue:c,handler:i,metadata:o})}addGroup(e="",t=""){return new $r(this,e,t)}}class Fr{nc;_id;config;handlers;internal;_stopped;_done;started;static controlSubject(e,t="",r="",n){const i=n??"$SRV";return""===t&&""===r?`${i}.${e}`:(Pr("control subject name",t),""!==r?(Pr("control subject id",r),`${i}.${e}.${t}.${r}`):`${i}.${e}.${t}`)}constructor(e,t={name:"",version:""}){this.nc=e,this.config=Object.assign({},t),this.config.queue||(this.config.queue="q"),Pr("name",this.config.name),Pr("queue",this.config.queue),J(this.config.version),this._id=Et.next(),this.internal=[],this._done=ce(),this._stopped=!1,this.handlers=[],this.started=(new Date).toISOString(),this.reset(),this.nc.closed().then(()=>{this.close().catch()}).catch(r=>{this.close(r).catch()})}get subjects(){return this.handlers.filter(e=>!1===e.internal).map(e=>e.subject)}get id(){return this._id}get name(){return this.config.name}get description(){return this.config.description??""}get version(){return this.config.version}get metadata(){return this.config.metadata}errorToHeader(e){const t=me();if(e instanceof M){const r=e;t.set(h,r.message),t.set(j,`${r.code}`)}else t.set(h,e.message),t.set(j,"500");return t}setupHandler(e,t=!1){const r=t?"":e.queue?e.queue:this.config.queue,{name:n,subject:i,handler:o}=e,c=e;c.internal=t,t&&this.internal.push(c),c.stats=new fo(n,i,r),c.queue=r;const m=o?(S,I)=>{if(S)return void this.close(S);const P=Date.now();try{o(S,new En(I))}catch(N){c.stats.countError(N),I?.respond(ye,{headers:this.errorToHeader(N)})}finally{c.stats.countLatency(P)}}:void 0;return c.sub=this.nc.subscribe(i,{callback:m,queue:r}),c.sub.closed.then(()=>{this._stopped||this.close(new Error(`required subscription ${e.subject} stopped`)).catch()}).catch(S=>{if(!this._stopped){const I=new Error(`required subscription ${e.subject} errored: ${S.message}`);I.stack=S.stack,this.close(I).catch()}}),c}info(){return{type:bt.INFO,name:this.name,id:this.id,version:this.version,description:this.description,metadata:this.metadata,endpoints:this.endpoints()}}endpoints(){return this.handlers.map(e=>{const{subject:t,metadata:r,name:n,queue:i}=e;return{subject:t,metadata:r,name:n,queue_group:i}})}stats(){var e=this;return(0,B.Z)(function*(){const t=[];for(const r of e.handlers){if("function"==typeof e.config.statsHandler)try{r.stats.data=yield e.config.statsHandler(r)}catch(n){r.stats.countError(n)}t.push(r.stats.stats(r.qi))}return{type:bt.STATS,name:e.name,id:e.id,version:e.version,started:e.started,metadata:e.metadata,endpoints:t}})()}addInternalHandler(e,t){const r=`${e}`.toUpperCase();this._doAddInternalHandler(`${r}-all`,e,t),this._doAddInternalHandler(`${r}-kind`,e,t,this.name),this._doAddInternalHandler(`${r}`,e,t,this.name,this.id)}_doAddInternalHandler(e,t,r,n="",i=""){const o={};o.name=e,o.subject=Fr.controlSubject(t,n,i),o.handler=r,this.setupHandler(o,!0)}start(){const e=Ge(),n=e.encode(this.ping());return this.addInternalHandler(K.PING,(o,c)=>o?(this.close(o).then().catch(),Promise.reject(o)):(c.respond(n),Promise.resolve())),this.addInternalHandler(K.STATS,(o,c)=>o?(this.close(o),Promise.reject(o)):this.stats().then(m=>(c?.respond(e.encode(m)),Promise.resolve()))),this.addInternalHandler(K.INFO,(o,c)=>o?(this.close(o),Promise.reject(o)):(c?.respond(e.encode(this.info())),Promise.resolve())),this.handlers.forEach(o=>{const{subject:c}=o;"string"==typeof c&&null!==o.handler&&this.setupHandler(o)}),Promise.resolve(this)}close(e){if(this._stopped)return this._done;this._stopped=!0;let t=[];return this.nc.isClosed()||(t=this.handlers.concat(this.internal).map(r=>r.sub.drain())),Promise.allSettled(t).then(()=>{this._done.resolve(e||null)}),this._done}get stopped(){return this._done}get isStopped(){return this._stopped}stop(e){return this.close(e)}ping(){return{type:bt.PING,name:this.name,id:this.id,version:this.version,metadata:this.metadata}}reset(){if(this.started=(new Date).toISOString(),this.handlers)for(const e of this.handlers)e.stats.reset(e.qi)}addGroup(e,t){return new $r(this,e,t)}addEndpoint(e,t){return new $r(this).addEndpoint(e,t)}_addEndpoint(e){const t=new ue;t.noIterator="function"==typeof e.handler,t.noIterator||(e.handler=(n,i)=>{n?this.stop(n).catch():t.push(new En(i))},t.iterClosed.then(()=>{this.close().catch()}));const r=this.setupHandler(e,!1);return r.qi=t,this.handlers.push(r),t}}class fo{name;subject;average_processing_time;num_requests;processing_time;num_errors;last_error;data;metadata;queue;constructor(e,t,r=""){this.name=e,this.subject=t,this.average_processing_time=0,this.num_errors=0,this.num_requests=0,this.processing_time=0,this.queue=r}reset(e){this.num_requests=0,this.processing_time=0,this.average_processing_time=0,this.num_errors=0,this.last_error=void 0,this.data=void 0;const t=e;t&&(t.time=0,t.processed=0)}countLatency(e){this.num_requests++,this.processing_time+=Re(Date.now()-e),this.average_processing_time=Math.round(this.processing_time/this.num_requests)}countError(e){this.num_errors++,this.last_error=e.message}_stats(){const{name:e,subject:t,average_processing_time:r,num_errors:n,num_requests:i,processing_time:o,last_error:c,data:m,queue:S}=this;return{name:e,subject:t,average_processing_time:r,num_errors:n,num_requests:i,processing_time:o,last_error:c,data:m,queue_group:S}}stats(e){const t=e;return!1===t?.noIterator&&(this.processing_time=t.time,this.num_requests=t.processed,this.average_processing_time=this.processing_time>0&&this.num_requests>0?this.processing_time/this.num_requests:0),this._stats()}}class po{nc;prefix;opts;constructor(e,t={strategy:rt.JitterTimer,maxWait:2e3},r){this.nc=e,this.prefix=r,this.opts=t}ping(e="",t=""){return this.q(K.PING,e,t)}stats(e="",t=""){return this.q(K.STATS,e,t)}info(e="",t=""){return this.q(K.INFO,e,t)}q(e,t="",r=""){var n=this;return(0,B.Z)(function*(){const i=new ue,o=Ge(),c=Fr.controlSubject(e,t,r,n.prefix),m=yield n.nc.requestMany(c,ye,n.opts);return(0,B.Z)(function*(){var P,S=!1,I=!1;try{for(var U,N=(0,fe.Z)(m);S=!(U=yield N.next()).done;S=!1){const q=U.value;try{const Z=o.decode(q.data);i.push(Z)}catch(Z){i.push(()=>{i.stop(Z)})}}}catch(q){I=!0,P=q}finally{try{S&&null!=N.return&&(yield N.return())}finally{if(I)throw P}}i.push(()=>{i.stop()})})().catch(S=>{i.stop(S)}),i})()}}class Ns{options;protocol;draining;listeners;_services;constructor(e){this.draining=!1,this.options=si(e),this.listeners=[]}static connect(e={}){return new Promise((t,r)=>{const n=new Ns(e);Wr.connect(n.options,n).then(i=>{n.protocol=i,(0,B.Z)(function*(){var m,o=!1,c=!1;try{for(var I,S=(0,fe.Z)(i.status());o=!(I=yield S.next()).done;o=!1){const P=I.value;n.listeners.forEach(N=>{N.push(P)})}}catch(P){c=!0,m=P}finally{try{o&&null!=S.return&&(yield S.return())}finally{if(c)throw m}}})(),t(n)}).catch(i=>{r(i)})})}closed(){return this.protocol.closed}close(){var e=this;return(0,B.Z)(function*(){yield e.protocol.close()})()}_check(e,t,r){if(this.isClosed())throw Q.errorForCode(G.ConnectionClosed);if(t&&this.isDraining()||r&&this.protocol.noMorePublishing)throw Q.errorForCode(G.ConnectionDraining);if(0===(e=e||"").length)throw Q.errorForCode(G.BadSubject)}publish(e,t,r){this._check(e,!1,!0),this.protocol.publish(e,t,r)}subscribe(e,t={}){this._check(e,!0,!1);const r=new tn(this.protocol,e,t);return this.protocol.subscribe(r),r}_resub(e,t,r){this._check(t,!0,!1);const n=e;n.max=r,r&&(n.max=r+n.received),this.protocol.resub(n,t)}requestMany(e,t=ye,r={maxWait:1e3,maxMessages:-1}){try{this._check(e,!0,!0)}catch(c){return Promise.reject(c)}if(r.strategy=r.strategy||rt.Timer,r.maxWait=r.maxWait||1e3,r.maxWait<1)return Promise.reject(new Q("timeout",G.InvalidOption));const n=new ue;function i(c){n.push(()=>{n.stop(c)})}function o(c,m){c||null===m?i(null===c?void 0:c):n.push(m)}if(r.noMux){const c=(new Error).stack;let m="number"==typeof r.maxMessages&&r.maxMessages>0?r.maxMessages:-1;const S=this.subscribe(T(this.options.inboxPrefix),{callback:(U,q)=>{if(0===q?.data?.length&&q?.headers?.status===G.NoResponders&&(U=Q.errorForCode(G.NoResponders)),U)return U.stack+=`\n\n${c}`,void I(U);o(null,q),r.strategy===rt.Count&&(m--,0===m&&I()),r.strategy===rt.JitterTimer&&(N(),P=setTimeout(()=>{I()},300)),r.strategy===rt.SentinelMsg&&q&&0===q.data.length&&I()}});S.closed.then(()=>{i()}).catch(U=>{n.stop(U)});const I=U=>{U&&n.push(()=>{throw U}),N(),S.drain().then(()=>{i()}).catch(q=>{i()})};n.iterClosed.then(()=>{N(),S?.unsubscribe()}).catch(U=>{N(),S?.unsubscribe()});try{this.publish(e,t,{reply:S.getSubject()})}catch(U){I(U)}let P=setTimeout(()=>{I()},r.maxWait);const N=()=>{P&&clearTimeout(P)}}else{const c=r;c.callback=o,n.iterClosed.then(()=>{m.cancel()}).catch(S=>{m.cancel(S)});const m=new li(this.protocol.muxSubscriptions,e,c);this.protocol.request(m);try{this.publish(e,t,{reply:`${this.protocol.muxSubscriptions.baseInbox}${m.token}`,headers:r.headers})}catch(S){m.cancel(S)}}return Promise.resolve(n)}request(e,t,r={timeout:1e3,noMux:!1}){try{this._check(e,!0,!0)}catch(n){return Promise.reject(n)}if(r.timeout=r.timeout||1e3,r.timeout<1)return Promise.reject(new Q("timeout",G.InvalidOption));if(!r.noMux&&r.reply)return Promise.reject(new Q("reply can only be used with noMux",G.InvalidOption));if(r.noMux){const n=r.reply?r.reply:T(this.options.inboxPrefix),i=ce(),o=new Error;return this.subscribe(n,{max:1,timeout:r.timeout,callback:(m,S)=>{m?(m.code!==G.Timeout&&(m.stack+=`\n\n${o.stack}`),i.reject(m)):(m=nr(S))?(m.stack+=`\n\n${o.stack}`,i.reject(m)):i.resolve(S)}}).requestSubject=e,this.protocol.publish(e,t,{reply:n,headers:r.headers}),i}{const n=new sn(this.protocol.muxSubscriptions,e,r);this.protocol.request(n);try{this.publish(e,t,{reply:`${this.protocol.muxSubscriptions.baseInbox}${n.token}`,headers:r.headers})}catch(o){n.cancel(o)}const i=Promise.race([n.timer,n.deferred]);return i.catch(()=>{n.cancel()}),i}}flush(){return this.isClosed()?Promise.reject(Q.errorForCode(G.ConnectionClosed)):this.protocol.flush()}drain(){return this.isClosed()?Promise.reject(Q.errorForCode(G.ConnectionClosed)):this.isDraining()?Promise.reject(Q.errorForCode(G.ConnectionDraining)):(this.draining=!0,this.protocol.drain())}isClosed(){return this.protocol.isClosed()}isDraining(){return this.draining}getServer(){const e=this.protocol.getServer();return e?e.listen:""}status(){const e=new ue;return e.iterClosed.then(()=>{const t=this.listeners.indexOf(e);this.listeners.splice(t,1)}),this.listeners.push(e),e}get info(){return this.protocol.isClosed()?void 0:this.protocol.info}stats(){return{inBytes:this.protocol.inBytes,outBytes:this.protocol.outBytes,inMsgs:this.protocol.inMsgs,outMsgs:this.protocol.outMsgs}}jetstreamManager(e={}){var t=this;return(0,B.Z)(function*(){const r=new co(t,e);try{yield r.getAccountInfo()}catch(n){const i=n;throw i.code===G.NoResponders&&(i.code=G.JetStreamNotEnabled),i}return r})()}jetstream(e={}){return new Ts(this,e)}getServerVersion(){const e=this.info;return e?J(e.version):void 0}rtt(){var e=this;return(0,B.Z)(function*(){if(!e.protocol._closed&&!e.protocol.connected)throw Q.errorForCode(G.Disconnect);const t=Date.now();return yield e.flush(),Date.now()-t})()}get features(){return this.protocol.features}get services(){return this._services||(this._services=new mo(this)),this._services}}class mo{nc;constructor(e){this.nc=e}add(e){try{return new Fr(this.nc,e).start()}catch(t){return Promise.reject(t)}}client(e,t){return new po(this.nc,e,t)}}class xo{version;lang;closeError;connected;done;socket;options;socketClosed;encrypted;peeked;yields;signal;closedNotification;constructor(){this.version="1.18.0",this.lang="nats.ws",this.connected=!1,this.done=!1,this.socketClosed=!1,this.encrypted=!1,this.peeked=!1,this.yields=[],this.signal=ce(),this.closedNotification=ce()}connect(e,t){var r=this;return(0,B.Z)(function*(){const i=ce();if(t.tls)return i.reject(new Q("tls",G.InvalidOption)),i;r.options=t;const o=e.src;if(t.wsFactory){const{socket:c,encrypted:m}=yield t.wsFactory(e.src,t);r.socket=c,r.encrypted=m}else r.encrypted=0===o.indexOf("wss://"),r.socket=new WebSocket(o);return r.socket.binaryType="arraybuffer",r.socket.onopen=()=>{r.isDiscarded()},r.socket.onmessage=c=>{if(r.isDiscarded())return;if(r.yields.push(new Uint8Array(c.data)),r.peeked)return void r.signal.resolve();const m=Be.concat(...r.yields),S=function Sr(s){const e=function er(s){for(let e=0;e<s.length;e++){const t=e+1;if(s.byteLength>t&&s[e]===Xt&&s[t]===Qt)return t+1}return 0}(s);if(e>0){const r=new Uint8Array(s).slice(0,e);return Te.decode(r)}return""}(m);if(""!==S){const I=oi.exec(S);if(!I)return t.debug&&console.error("!!!",pe(m)),void i.reject(new Error("unexpected response from server"));try{(function ni(s,e){const{proto:t,tls_required:r,tls_available:n}=s;if((void 0===t||t<1)&&e.noEcho)throw new Q("noEcho",G.ServerOptionNotAvailable);if(e.tls&&!r&&!n)throw new Q("tls",G.ServerOptionNotAvailable)})(JSON.parse(I[1]),r.options),r.peeked=!0,r.connected=!0,r.signal.resolve(),i.resolve()}catch(P){return void i.reject(P)}}},r.socket.onclose=c=>{if(r.isDiscarded())return;let m;r.socketClosed=!0,r.done||(c.wasClean||(m=new Error(c.reason)),r._closed(m))},r.socket.onerror=c=>{if(r.isDiscarded())return;const S=new Q(c.message,G.Unknown,new Error(c.error));i.reject(S)},i})()}disconnect(){this._closed(void 0,!0)}_closed(e,t=!0){var r=this;return(0,B.Z)(function*(){if(!r.isDiscarded()&&r.connected&&!r.done){if(r.closeError=e,!e)for(;!r.socketClosed&&r.socket.bufferedAmount>0;)yield ie(100);r.done=!0;try{r.socket.close(e?1002:1e3,e?e.message:void 0)}catch{}t&&r.closedNotification.resolve(e)}})()}get isClosed(){return this.done}[Symbol.asyncIterator](){return this.iterate()}iterate(){var e=this;return $e(function*(){for(;;){if(e.isDiscarded())return;0===e.yields.length&&(yield Oe(e.signal));const t=e.yields;e.yields=[];for(let r=0;r<t.length;r++)e.options.debug&&console.info(`> ${pe(t[r])}`),yield t[r];if(e.done)break;0===e.yields.length&&(t.length=0,e.yields=t,e.signal=ce())}})()}isEncrypted(){return this.connected&&this.encrypted}send(e){if(!this.isDiscarded())try{return this.socket.send(e.buffer),void(this.options.debug&&console.info(`< ${pe(e)}`))}catch(t){this.options.debug&&console.error(`!!! ${pe(e)}: ${t}`)}}close(e){return this._closed(e,!1)}closed(){return this.closedNotification}isDiscarded(){return!!this.done&&(this.discard(),!0)}discard(){this.done=!0;try{this.socket?.close()}catch{}}}function vo(s){/^(.*:\/\/)(.*)/.test(s)||(s=`https://${s}`);let t=new URL(s);const r=t.protocol.toLowerCase();let n,i;"https:"!==r&&"http"!==r&&(s=s.replace(/^(.*:\/\/)(.*)/gm,"$2"),t=new URL(`http://${s}`));const o=t.hostname,c=t.pathname,m=t.search||"";switch(r){case"http:":case"ws:":case"nats:":i=t.port||"80",n="ws:";break;default:i=t.port||"443",n="wss:"}return`${n}//${o}:${i}${c}${m}`}ge(6021);let Rs=class{#e;#t;#r;#s=Ge();#n;constructor(e){this.#e=e||{name:""}}connect(e,t,r){var n=this;return(0,B.Z)(function*(){try{n.#t=yield function So(s={}){return function Qe(s){Ae=s}({defaultPort:443,urlParseFn:vo,factory:()=>new xo}),Ns.connect(s)}({servers:e,user:t,pass:r})}catch(i){console.error(i)}n.#r=yield n.#t.jetstream()})()}publish(e,t){var r=this;return(0,B.Z)(function*(){try{const n={data:t};yield r.#r.publish(e,r.#s.encode(n))}catch(n){console.log(n)}})()}unsubscribe(){void 0!==this.#n?this.#n.close():console.error("Should have subscribed first")}subscribe(e=ns.Pull,t,r){return new Ze.Observable(n=>{(e===ns.Pull?this.#o(t):this.#i(t,r)).then(o=>{this.#n=o,n.next(o)})})}#i(e,t){var r=this;return(0,B.Z)(function*(){return t?(yield r.#r.consumers.get(r.#e.name,{filterSubjects:e,inactive_threshold:1e3,deliver_policy:t})).consume():(yield r.#r.consumers.get(r.#e.name,{filterSubjects:e,inactive_threshold:1e3})).consume()})()}#o(e){var t=this;return(0,B.Z)(function*(){return(yield t.#r.consumers.get(t.#e.name,e)).consume()})()}request(e,t){const r=new Ze.Subject;let n;return n=(0,Ze.from)(null!=t&&""!==t&&0!==t&&!1!==t?this.#t.request(`core.${e}`,this.#s.encode({data:t})):this.#t.request(`core.${e}`,this.#s.encode({data:{}}))),n.subscribe(c=>{r.next(this.#s.decode(c.data))}),r.asObservable()}drain(){var e=this;return(0,B.Z)(function*(){yield e.#t.drain()})()}};Rs=(0,d.gn)([(0,Ke.Injectable)({providedIn:"root"})],Rs);var ns=function(s){return s.Pull="pull",s.Push="push",s}(ns||{}),Cn=function(s){return s.None="none",s.All="all",s.Explicit="explicit",s.NotSet="",s}(Cn||{}),An=function(s){return s.Limits="limits",s.Interest="interest",s.Workqueue="workqueue",s}(An||{}),Pn=function(s){return s.All="all",s.Last="last",s.New="new",s.StartSequence="by_start_sequence",s.StartTime="by_start_time",s.LastPerSubject="last_per_subject",s}(Pn||{})},3107:(Zr,vt,ge)=>{ge.r(vt),ge.d(vt,{ForgotPasswordComponent:()=>Vr,ForgotPasswordService:()=>Jr,LoginComponent:()=>nt,LoginService:()=>ir,ResetPasswordComponent:()=>or,ResetPasswordService:()=>Cr});var B=ge(5861),d=ge(5863),Ke=ge(9159),Ze=ge(2285),fe=ge(575),Me=ge(7069),Oe=ge(6345),X=ge(1183),$e=ge(1189),ye=ge(4008),ve=ge(8426),Te=ge(6701),it=ge(25),ct=ge(2182),Ce=ge(6390);class dt{userCode=new Ce.Coding;token="";constructor(x){Object.assign(this,structuredClone(x))}}class Dt{orgNo="";userCode=new Ce.Coding;passwordHash="";constructor(x){Object.assign(this,structuredClone(x))}}class Xe extends Ce.IndexObject{_id=crypto.randomUUID();hospital=new Ce.Coding;userCode=new Ce.Coding;gender=new Ce.Coding;birthDate;eMail="";passwordHash="";passwordTime=new Date("2999-12-31 23:59");period=new Ce.Period({end:new Date("2999-12-31 23:59")});remark="";updatedBy=new Ce.Coding;updatedAt=new Date;static#e=(()=>{Xe.INDEXES.push({name:"UserAccountKey1",key:{"userCode.code":1,"hospital.code":1}}),Xe.INDEXES.push({name:"UserAccountKey2",key:{"hospital.code":1}})})();constructor(x){super(),Object.assign(this,structuredClone(x))}}class St extends Ce.IndexObject{_id=crypto.randomUUID();userCode=new Ce.Coding;appId="";isFavorite=!1;updatedBy=new Ce.Coding;updatedAt=new Date;static#e=(()=>{St.INDEXES.push({name:"UserAppStoreKey1",key:{"userCode.code":1}}),St.INDEXES.push({name:"UserAppStoreKey2",key:{appId:1}})})();constructor(x){super(),Object.assign(this,structuredClone(x))}}class Ht extends Ce.IndexObject{_id=crypto.randomUUID();userCode=new Ce.Coding;appId="";profile={};updatedBy=new Ce.Coding;updatedAt=new Date;static#e=Ht.INDEXES.push({name:"UserProfileKey1",key:{"userCode.code":1,appId:1}});constructor(x){super(),Object.assign(this,structuredClone(x))}}var qe=ge(3171),ut=ge(2998);const G=":";const he=function(b,...x){if(he.translate){const g=he.translate(b,x);b=g[0],x=g[1]}let v=He(b[0],b.raw[0]);for(let g=1;g<b.length;g++)v+=x[g-1]+He(b[g],b.raw[g]);return v},ue=":";function He(b,x){return x.charAt(0)===ue?b.substring(function A(b,x){for(let v=1,g=1;v<b.length;v++,g++)if("\\"===x[g])g++;else if(b[v]===G)return v;throw new Error(`Unterminated $localize metadata block in "${x}".`)}(b,x)+1):b}globalThis.$localize=he;var me=ge(3433);function et(b,x){if(1&b){const v=d.\u0275\u0275getCurrentView();d.\u0275\u0275elementStart(0,"div",7)(1,"span"),d.\u0275\u0275text(2),d.\u0275\u0275pipe(3,"translate"),d.\u0275\u0275elementEnd(),d.\u0275\u0275elementStart(4,"button",8),d.\u0275\u0275listener("click",function(){d.\u0275\u0275restoreView(v);const w=d.\u0275\u0275nextContext();return d.\u0275\u0275resetView(w.onCloseClick())}),d.\u0275\u0275elementEnd()()}2&b&&(d.\u0275\u0275advance(2),d.\u0275\u0275textInterpolate(d.\u0275\u0275pipeBind1(3,1,"\u5fd8\u8a18\u5bc6\u78bc")))}function Ie(b,x){if(1&b){const v=d.\u0275\u0275getCurrentView();d.\u0275\u0275elementStart(0,"button",9),d.\u0275\u0275listener("click",function(){d.\u0275\u0275restoreView(v);const w=d.\u0275\u0275nextContext();return d.\u0275\u0275resetView(w.onCloseClick())}),d.\u0275\u0275pipe(1,"translate"),d.\u0275\u0275elementEnd(),d.\u0275\u0275elementStart(2,"button",10),d.\u0275\u0275listener("click",function(){d.\u0275\u0275restoreView(v);const w=d.\u0275\u0275nextContext();return d.\u0275\u0275resetView(w.onSubmitClick())}),d.\u0275\u0275pipe(3,"translate"),d.\u0275\u0275elementEnd()}2&b&&(d.\u0275\u0275property("label",d.\u0275\u0275pipeBind1(1,2,"\u53d6\u6d88")),d.\u0275\u0275advance(2),d.\u0275\u0275property("label",d.\u0275\u0275pipeBind1(3,4,"\u78ba\u5b9a\u9001\u51fa")))}const st=function(){return{"960px":"75vw"}};function Ge(b,x){if(1&b){const v=d.\u0275\u0275getCurrentView();d.\u0275\u0275elementStart(0,"div",7)(1,"span"),d.\u0275\u0275text(2),d.\u0275\u0275pipe(3,"translate"),d.\u0275\u0275elementEnd(),d.\u0275\u0275elementStart(4,"button",8),d.\u0275\u0275listener("click",function(){d.\u0275\u0275restoreView(v);const w=d.\u0275\u0275nextContext();return d.\u0275\u0275resetView(w.onCloseClick())}),d.\u0275\u0275elementEnd()()}2&b&&(d.\u0275\u0275advance(2),d.\u0275\u0275textInterpolate(d.\u0275\u0275pipeBind1(3,1,"\u91cd\u7f6e\u5bc6\u78bc")))}function nr(b,x){if(1&b){const v=d.\u0275\u0275getCurrentView();d.\u0275\u0275elementStart(0,"button",9),d.\u0275\u0275listener("click",function(){d.\u0275\u0275restoreView(v);const w=d.\u0275\u0275nextContext();return d.\u0275\u0275resetView(w.onCancelClick())}),d.\u0275\u0275pipe(1,"translate"),d.\u0275\u0275elementEnd(),d.\u0275\u0275elementStart(2,"button",10),d.\u0275\u0275listener("click",function(){d.\u0275\u0275restoreView(v);const w=d.\u0275\u0275nextContext();return d.\u0275\u0275resetView(w.onSubmitClick())}),d.\u0275\u0275pipe(3,"translate"),d.\u0275\u0275elementEnd()}2&b&&(d.\u0275\u0275property("label",d.\u0275\u0275pipeBind1(1,2,"\u53d6\u6d88")),d.\u0275\u0275advance(2),d.\u0275\u0275property("label",d.\u0275\u0275pipeBind1(3,4,"\u78ba\u5b9a\u9001\u51fa")))}let ir=(()=>{class b{#e=(0,d.inject)(Ke.JetstreamWsService);getUserToken(v){return this.#e.request("appPortal.userAccount.userToken",v)}getHashPassword(v){const g=new Ze.Z("SHA3-256","TEXT",{encoding:"UTF8"});return g.update(v),g.getHash("HEX")}getUserAccount(v){return this.#e.request("appPortal.userAccount.find",v)}static#t=this.\u0275fac=function(g){return new(g||b)};static#r=this.\u0275prov=d.\u0275\u0275defineInjectable({token:b,factory:b.\u0275fac,providedIn:"root"})}return b})();let gs=(()=>{class b{#e="ws://localhost:8080";#t=(0,d.inject)(Ke.JetstreamWsService);connect(){var v=this;return(0,B.Z)(function*(){yield v.#t.connect(v.#e)})()}disconnect(){var v=this;return(0,B.Z)(function*(){yield v.#t.drain()})()}static#r=this.\u0275fac=function(g){return new(g||b)};static#s=this.\u0275prov=d.\u0275\u0275defineInjectable({token:b,factory:b.\u0275fac,providedIn:"root"})}return b})(),Jr=(()=>{class b{#e=(0,d.inject)(Ke.JetstreamWsService);getUserMail(v,g){return this.#e.request("appPortal.userAccount.userMail",{userCode:v,eMail:g})}pubSendMail(v,g){var w=this;return(0,B.Z)(function*(){yield w.#e.publish("appPortal.userAccount.sendMail",{userCode:v,eMail:g})})()}static#t=this.\u0275fac=function(g){return new(g||b)};static#r=this.\u0275prov=d.\u0275\u0275defineInjectable({token:b,factory:b.\u0275fac,providedIn:"root"})}return b})(),Vr=(()=>{class b{constructor(){this.hideForgot=new d.EventEmitter,this.userCode="",this.eMail="",this.userMail="",this.messageService=(0,d.inject)(it.MessageService),this.#e=(0,d.inject)(Jr),this.#t=(0,d.inject)(me.TranslateService)}#e;#t;onSubmitClick(){this.#e.getUserMail(this.userCode,this.eMail).subscribe(v=>{this.userMail=v,this.userMail!==this.eMail?this.messageService.add({severity:"error",summary:"Error",detail:this.#t.instant("\u5e33\u865f\u6216\u4fe1\u7bb1\u4e0d\u6b63\u78ba")}):(this.#e.pubSendMail(this.userCode,this.userMail),this.messageService.add({severity:"success",summary:"Success",detail:this.#t.instant("\u91cd\u7f6e\u9023\u7d50\u5df2\u767c\u9001\u5230\u4fe1\u7bb1")}),this.hideForgot.emit()),this.userCode="",this.eMail=""})}onCloseClick(){this.userCode="",this.eMail="",this.hideForgot.emit()}static#r=this.\u0275fac=function(g){return new(g||b)};static#s=this.\u0275cmp=d.\u0275\u0275defineComponent({type:b,selectors:[["his-forgot-password"]],inputs:{isVisibleForgot:"isVisibleForgot"},outputs:{hideForgot:"hideForgot"},standalone:!0,features:[d.\u0275\u0275StandaloneFeature],decls:18,vars:15,consts:[["showEffect","fade",1,"profile",3,"visible","modal","breakpoints","visibleChange"],["pTemplate","header"],[1,"profileContent","lg:col-12","mb-2","p-0","flex","justify-content-center"],[1,"fromList","flex","flex-wrap","justify-content-center","w-full"],[1,"fromColumn","flex"],["type","text","pInputText","",3,"ngModel","ngModelChange"],["pTemplate","footer"],[1,"dialog-header"],["pButton","","pRipple","","type","button","icon","pi pi-times",1,"p-button-rounded",3,"click"],["pButton","","pRipple","","type","button",1,"p-button-secondary",3,"label","click"],["pButton","","pRipple","","type","button",3,"label","click"]],template:function(g,w){1&g&&(d.\u0275\u0275elementStart(0,"p-dialog",0),d.\u0275\u0275listener("visibleChange",function(de){return w.isVisibleForgot=de}),d.\u0275\u0275template(1,et,5,3,"ng-template",1),d.\u0275\u0275elementStart(2,"div",2)(3,"div",3)(4,"div",4)(5,"h6"),d.\u0275\u0275text(6),d.\u0275\u0275pipe(7,"translate"),d.\u0275\u0275elementEnd(),d.\u0275\u0275elementStart(8,"input",5),d.\u0275\u0275listener("ngModelChange",function(de){return w.userCode=de}),d.\u0275\u0275elementEnd()(),d.\u0275\u0275elementStart(9,"div",4)(10,"h6"),d.\u0275\u0275text(11),d.\u0275\u0275pipe(12,"translate"),d.\u0275\u0275elementEnd(),d.\u0275\u0275elementStart(13,"input",5),d.\u0275\u0275listener("ngModelChange",function(de){return w.eMail=de}),d.\u0275\u0275elementEnd()(),d.\u0275\u0275elementStart(14,"div"),d.\u0275\u0275text(15),d.\u0275\u0275pipe(16,"translate"),d.\u0275\u0275elementEnd()()(),d.\u0275\u0275template(17,Ie,4,6,"ng-template",6),d.\u0275\u0275elementEnd()),2&g&&(d.\u0275\u0275property("visible",w.isVisibleForgot)("modal",!0)("breakpoints",d.\u0275\u0275pureFunction0(14,st)),d.\u0275\u0275advance(6),d.\u0275\u0275textInterpolate(d.\u0275\u0275pipeBind1(7,8,"\u5e33\u865f")),d.\u0275\u0275advance(2),d.\u0275\u0275property("ngModel",w.userCode),d.\u0275\u0275advance(3),d.\u0275\u0275textInterpolate(d.\u0275\u0275pipeBind1(12,10,"\u96fb\u5b50\u4fe1\u7bb1")),d.\u0275\u0275advance(2),d.\u0275\u0275property("ngModel",w.eMail),d.\u0275\u0275advance(2),d.\u0275\u0275textInterpolate1("\u203b ",d.\u0275\u0275pipeBind1(16,12,"\u8f38\u5165\u9a57\u8b49\u8cc7\u6599\u5c07\u6703\u6536\u5230\u4fee\u6539\u5bc6\u78bc\u78ba\u8a8d\u4fe1"),""))},dependencies:[fe.CommonModule,qe.DialogModule,qe.Dialog,it.PrimeTemplate,ve.FormsModule,ve.DefaultValueAccessor,ve.NgControlStatus,ve.NgModel,$e.ButtonModule,$e.ButtonDirective,ut.InputTextModule,ut.InputText,me.TranslateModule,me.TranslatePipe],styles:["[_nghost-%COMP%]     .p-dialog{width:25vw}[_nghost-%COMP%]     .p-dialog-content{padding:10%}[_nghost-%COMP%]     .p-dialog-header .dialog-header{display:flex;width:100%;justify-content:space-between;align-items:center}[_nghost-%COMP%]     .p-dialog-header-icon.p-dialog-header-close{display:none}.fromList[_ngcontent-%COMP%]{flex-direction:column;gap:8px}.fromList[_ngcontent-%COMP%]   .fromColumn[_ngcontent-%COMP%]{flex-direction:column;gap:4px}"]})}return b})(),Cr=(()=>{class b{#e="ws://localhost:8080";#t=(0,d.inject)(Ke.JetstreamWsService);getUserCode(v){return this.#t.request("appPortal.userAccount.userCode",v)}pubPassword(v,g){var w=this;return(0,B.Z)(function*(){yield w.#t.publish("appPortal.userAccount.modifyPassword",{userCode:v,passwordHash:g})})()}connect(){var v=this;return(0,B.Z)(function*(){yield v.#t.connect(v.#e)})()}disconnect(){var v=this;return(0,B.Z)(function*(){yield v.#t.drain()})()}static#r=this.\u0275fac=function(g){return new(g||b)};static#s=this.\u0275prov=d.\u0275\u0275defineInjectable({token:b,factory:b.\u0275fac,providedIn:"root"})}return b})(),or=(()=>{class b{constructor(){this.hideReset=new d.EventEmitter,this.password="",this.passwordConfirm="",this.userCode="",this.passwordHash="",this.router=(0,d.inject)(Te.Router),this.messageService=(0,d.inject)(it.MessageService),this.loginService=(0,d.inject)(ir),this.#e=(0,d.inject)(Cr),this.#t=(0,d.inject)(me.TranslateService)}#e;#t;ngOnInit(){var v=this;return(0,B.Z)(function*(){v.token&&(yield v.#e.connect(),v.checkUserCode())})()}ngOnDestroy(){var v=this;return(0,B.Z)(function*(){yield v.#e.disconnect()})()}onCloseClick(){this.hideReset.emit(),this.router.navigate(["login"])}checkPassword(){const v=this.loginService.getHashPassword(this.password);return v===this.loginService.getHashPassword(this.passwordConfirm)&&""!==this.password&&(this.passwordHash=v,!0)}onCancelClick(){this.password="",this.passwordConfirm="",this.hideReset.emit(),this.router.navigate(["login"])}onSubmitClick(){this.checkPassword()?(history.replaceState("","","login"),this.isVisibleReset=!1,this.messageService.add({severity:"success",summary:"Success",detail:this.#t.instant("\u91cd\u7f6e\u6210\u529f")}),this.#e.pubPassword(this.userCode,this.passwordHash)):this.messageService.add({severity:"error",summary:"Error",detail:this.#t.instant("\u8acb\u8f38\u5165\u76f8\u540c\u5bc6\u78bc")}),this.password="",this.passwordConfirm=""}checkUserCode(){this.#e.getUserCode(this.token).subscribe(v=>{this.userCode=v,""===this.userCode?(history.replaceState("","","login"),this.messageService.add({severity:"error",summary:"Error",detail:this.#t.instant("\u91cd\u7f6e\u9023\u7d50\u9a57\u8b49\u5931\u6557")})):this.isVisibleReset=!0})}static#r=this.\u0275fac=function(g){return new(g||b)};static#s=this.\u0275cmp=d.\u0275\u0275defineComponent({type:b,selectors:[["his-reset-password"]],inputs:{isVisibleReset:"isVisibleReset",token:"token"},outputs:{hideReset:"hideReset"},standalone:!0,features:[d.\u0275\u0275StandaloneFeature],decls:20,vars:25,consts:[["showEffect","fade",1,"profile",3,"visible","modal","breakpoints","visibleChange"],["pTemplate","header"],[1,"profileContent","lg:col-12","mb-2","p-0","flex","justify-content-center"],[1,"fromList","flex","flex-wrap","justify-content-center","w-full"],[1,"fromColumn","flex"],[3,"ngModel","placeholder","feedback","toggleMask","ngModelChange"],["pTemplate","footer"],[1,"dialog-header"],["pButton","","pRipple","","type","button","icon","pi pi-times",1,"p-button-rounded",3,"click"],["pButton","","pRipple","","type","button",1,"p-button-secondary",3,"label","click"],["pButton","","pRipple","","type","button",3,"label","click"]],template:function(g,w){1&g&&(d.\u0275\u0275elementStart(0,"p-dialog",0),d.\u0275\u0275listener("visibleChange",function(de){return w.isVisibleReset=de}),d.\u0275\u0275template(1,Ge,5,3,"ng-template",1),d.\u0275\u0275elementStart(2,"div",2)(3,"div",3)(4,"div",4)(5,"h6"),d.\u0275\u0275text(6),d.\u0275\u0275pipe(7,"translate"),d.\u0275\u0275elementEnd(),d.\u0275\u0275elementStart(8,"p-password",5),d.\u0275\u0275listener("ngModelChange",function(de){return w.password=de}),d.\u0275\u0275pipe(9,"translate"),d.\u0275\u0275elementEnd()(),d.\u0275\u0275elementStart(10,"div",4)(11,"h6"),d.\u0275\u0275text(12),d.\u0275\u0275pipe(13,"translate"),d.\u0275\u0275elementEnd(),d.\u0275\u0275elementStart(14,"p-password",5),d.\u0275\u0275listener("ngModelChange",function(de){return w.passwordConfirm=de}),d.\u0275\u0275pipe(15,"translate"),d.\u0275\u0275elementEnd()(),d.\u0275\u0275elementStart(16,"div"),d.\u0275\u0275text(17),d.\u0275\u0275pipe(18,"translate"),d.\u0275\u0275elementEnd()()(),d.\u0275\u0275template(19,nr,4,6,"ng-template",6),d.\u0275\u0275elementEnd()),2&g&&(d.\u0275\u0275property("visible",w.isVisibleReset)("modal",!0)("breakpoints",d.\u0275\u0275pureFunction0(24,st)),d.\u0275\u0275advance(6),d.\u0275\u0275textInterpolate(d.\u0275\u0275pipeBind1(7,14,"\u65b0\u5bc6\u78bc")),d.\u0275\u0275advance(2),d.\u0275\u0275property("ngModel",w.password)("placeholder",d.\u0275\u0275pipeBind1(9,16,"\u8acb\u8f38\u5165\u65b0\u5bc6\u78bc"))("feedback",!0)("toggleMask",!0),d.\u0275\u0275advance(4),d.\u0275\u0275textInterpolate(d.\u0275\u0275pipeBind1(13,18,"\u8acb\u518d\u6b21\u8f38\u5165")),d.\u0275\u0275advance(2),d.\u0275\u0275property("ngModel",w.passwordConfirm)("placeholder",d.\u0275\u0275pipeBind1(15,20,"\u8acb\u518d\u6b21\u8f38\u5165"))("feedback",!1)("toggleMask",!0),d.\u0275\u0275advance(3),d.\u0275\u0275textInterpolate1("\u203b ",d.\u0275\u0275pipeBind1(18,22,"\u8acb\u6ce8\u610f\u8f38\u5165\u76f8\u540c\u5bc6\u78bc"),""))},dependencies:[fe.CommonModule,qe.DialogModule,qe.Dialog,it.PrimeTemplate,ve.FormsModule,ve.NgControlStatus,ve.NgModel,$e.ButtonModule,$e.ButtonDirective,ut.InputTextModule,ye.PasswordModule,ye.Password,me.TranslateModule,me.TranslatePipe],styles:["[_nghost-%COMP%]     .p-dialog{width:25vw}[_nghost-%COMP%]     .p-dialog-content{padding:10%}[_nghost-%COMP%]     .p-dialog-header .dialog-header{display:flex;width:100%;justify-content:space-between;align-items:center}[_nghost-%COMP%]     .p-dialog-header-icon.p-dialog-header-close{display:none}[_nghost-%COMP%]     .p-password{width:100%}[_nghost-%COMP%]     .p-input-icon-right>.p-inputtext{width:100%}[_nghost-%COMP%]     .p-input-icon-right>.p-icon-wrapper{right:15px;cursor:pointer}.fromList[_ngcontent-%COMP%]{flex-direction:column;gap:8px}.fromList[_ngcontent-%COMP%]   .fromColumn[_ngcontent-%COMP%]{flex-direction:column;gap:4px}"]})}return b})();var Ar=Object.freeze({__proto__:null,default:["\u7af9\u9298\u91ab\u9662"]});let nt=(()=>{class b{constructor(){this.branchesOption=[],this.password="",this.loginReq=new Dt,this.userToken=new dt,this.isVisibleForgot=!1,this.isVisibleReset=!1,this.userAccount=new Xe,this.messageService=(0,d.inject)(it.MessageService),this.router=(0,d.inject)(Te.Router),this.#e=(0,d.inject)(ir),this.#t=(0,d.inject)(gs),this.#r=(0,d.inject)(ct.SharedService),this.#s=(0,d.inject)(me.TranslateService)}#e;#t;#r;#s;ngOnInit(){var v=this;return(0,B.Z)(function*(){v.branchesOption=Object.values(Ar)[0],yield v.#t.connect(),document.getElementById("theme-css").href="app/styles/theme.css"})()}onLoginClick(){try{this.loginReq.passwordHash=this.#e.getHashPassword(this.password),this.#e.getUserToken(this.loginReq).subscribe(v=>{this.userToken=v,this.checkUserToken(this.userToken)})}catch{this.messageService.add({severity:"error",summary:"Error",detail:this.#s.instant("\u767b\u5165\u5931\u6557")})}}checkUserToken(v){""!==v.token?(this.#r.sharedValue=null,this.#e.getUserAccount(v.userCode.code).subscribe(g=>{this.userAccount=g;const w=this.#r.setValue(this.userAccount);this.router.navigate(["/home"],{state:{token:w}})})):this.messageService.add({severity:"error",summary:"Error",detail:this.#s.instant("\u5e33\u865f\u6216\u5bc6\u78bc\u932f\u8aa4")})}onForgotClick(){this.isVisibleForgot=!0}onHideForgot(){this.isVisibleForgot=!1}onHideReset(){this.isVisibleReset=!1}static#n=this.\u0275fac=function(g){return new(g||b)};static#i=this.\u0275cmp=d.\u0275\u0275defineComponent({type:b,selectors:[["his-login"]],inputs:{token:"token"},standalone:!0,features:[d.\u0275\u0275ProvidersFeature([it.MessageService]),d.\u0275\u0275StandaloneFeature],decls:39,vars:32,consts:[[1,"login-page-container"],[1,"login-container"],[1,"welcome-container"],[1,"welcome-style"],[1,"logo-container"],["src","assets/companyLogo.png","alt","Image"],[1,"title-style"],[1,"form-container"],[1,"input-text"],["htmlFor","branchSelector",1,"input-label"],["id","branchSelector",3,"options","ngModel","placeholder","ngModelChange"],["htmlFor","UserName",1,"input-label"],["pInputText","","id","UserName","type","text",1,"p-inputtext","p-element","p-component",3,"placeholder","ngModel","ngModelChange"],["htmlFor","Password",1,"input-label"],["id","password",1,"p-fluid",3,"placeholder","ngModel","feedback","ngModelChange","keyup.enter"],[1,"button-group"],["styleClass","p-button-link",3,"label","onClick"],["pButton","","pRipple-label","",3,"label","click"],[1,"image-container"],[1,"image-box"],["src","assets/loginImage.png","alt","Image",1,"image-style"],[3,"isVisibleForgot","hideForgot"],[3,"isVisibleReset","token","hideReset"]],template:function(g,w){1&g&&(d.\u0275\u0275elementStart(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),d.\u0275\u0275text(4,"Welcome!"),d.\u0275\u0275elementEnd()(),d.\u0275\u0275elementStart(5,"div",4),d.\u0275\u0275element(6,"img",5),d.\u0275\u0275elementEnd(),d.\u0275\u0275elementStart(7,"div",6),d.\u0275\u0275text(8,"\u96f2\u884c\u81f3\u5584\u91ab\u7642\u7cfb\u7d71"),d.\u0275\u0275elementEnd(),d.\u0275\u0275elementStart(9,"div",7)(10,"div",8)(11,"label",9),d.\u0275\u0275text(12),d.\u0275\u0275pipe(13,"translate"),d.\u0275\u0275elementEnd(),d.\u0275\u0275elementStart(14,"p-dropdown",10),d.\u0275\u0275listener("ngModelChange",function(de){return w.loginReq.orgNo=de}),d.\u0275\u0275pipe(15,"translate"),d.\u0275\u0275elementEnd()(),d.\u0275\u0275elementStart(16,"div",8)(17,"label",11),d.\u0275\u0275text(18),d.\u0275\u0275pipe(19,"translate"),d.\u0275\u0275elementEnd(),d.\u0275\u0275elementStart(20,"input",12),d.\u0275\u0275listener("ngModelChange",function(de){return w.loginReq.userCode.code=de}),d.\u0275\u0275pipe(21,"translate"),d.\u0275\u0275elementEnd()(),d.\u0275\u0275elementStart(22,"div",8)(23,"label",13),d.\u0275\u0275text(24),d.\u0275\u0275pipe(25,"translate"),d.\u0275\u0275elementEnd(),d.\u0275\u0275elementStart(26,"p-password",14),d.\u0275\u0275listener("ngModelChange",function(de){return w.password=de})("keyup.enter",function(){return w.onLoginClick()}),d.\u0275\u0275pipe(27,"translate"),d.\u0275\u0275elementEnd()(),d.\u0275\u0275elementStart(28,"div",15)(29,"p-button",16),d.\u0275\u0275listener("onClick",function(){return w.onForgotClick()}),d.\u0275\u0275pipe(30,"translate"),d.\u0275\u0275elementEnd(),d.\u0275\u0275elementStart(31,"button",17),d.\u0275\u0275listener("click",function(){return w.onLoginClick()}),d.\u0275\u0275pipe(32,"translate"),d.\u0275\u0275elementEnd()()()(),d.\u0275\u0275elementStart(33,"div",18)(34,"div",19),d.\u0275\u0275element(35,"img",20),d.\u0275\u0275elementEnd()()(),d.\u0275\u0275element(36,"p-toast"),d.\u0275\u0275elementStart(37,"his-forgot-password",21),d.\u0275\u0275listener("hideForgot",function(){return w.onHideForgot()}),d.\u0275\u0275elementEnd(),d.\u0275\u0275elementStart(38,"his-reset-password",22),d.\u0275\u0275listener("hideReset",function(){return w.onHideReset()}),d.\u0275\u0275elementEnd()),2&g&&(d.\u0275\u0275advance(12),d.\u0275\u0275textInterpolate(d.\u0275\u0275pipeBind1(13,16,"\u9662\u5340")),d.\u0275\u0275advance(2),d.\u0275\u0275property("options",w.branchesOption)("ngModel",w.loginReq.orgNo)("placeholder",d.\u0275\u0275pipeBind1(15,18,"\u8acb\u9078\u64c7\u9662\u5340")),d.\u0275\u0275advance(4),d.\u0275\u0275textInterpolate(d.\u0275\u0275pipeBind1(19,20,"\u5e33\u865f")),d.\u0275\u0275advance(2),d.\u0275\u0275property("placeholder",d.\u0275\u0275pipeBind1(21,22,"\u8acb\u8f38\u5165\u5e33\u865f"))("ngModel",w.loginReq.userCode.code),d.\u0275\u0275advance(4),d.\u0275\u0275textInterpolate(d.\u0275\u0275pipeBind1(25,24,"\u5bc6\u78bc")),d.\u0275\u0275advance(2),d.\u0275\u0275property("placeholder",d.\u0275\u0275pipeBind1(27,26,"\u8acb\u8f38\u5165\u5bc6\u78bc"))("ngModel",w.password)("feedback",!1),d.\u0275\u0275advance(3),d.\u0275\u0275property("label",d.\u0275\u0275pipeBind1(30,28,"\u5fd8\u8a18\u5bc6\u78bc")),d.\u0275\u0275advance(2),d.\u0275\u0275property("label",d.\u0275\u0275pipeBind1(32,30,"\u767b\u5165")),d.\u0275\u0275advance(6),d.\u0275\u0275property("isVisibleForgot",w.isVisibleForgot),d.\u0275\u0275advance(1),d.\u0275\u0275property("isVisibleReset",w.isVisibleReset)("token",w.token))},dependencies:[fe.CommonModule,$e.ButtonModule,$e.ButtonDirective,$e.Button,ye.PasswordModule,ye.Password,ve.FormsModule,ve.DefaultValueAccessor,ve.NgControlStatus,ve.NgModel,Me.ImageModule,Oe.DropdownModule,Oe.Dropdown,X.ToastModule,X.Toast,Vr,or,ut.InputTextModule,ut.InputText,me.TranslateModule,me.TranslatePipe],styles:["[_nghost-%COMP%]     .p-dropdown-panel .p-dropdown-items .p-dropdown-item{padding:.5rem .75rem}[_nghost-%COMP%]     .p-dropdown, [_nghost-%COMP%]     .p-inputtext{width:100%;background:var(--white)!important}[_nghost-%COMP%]     .button-group{display:flex;gap:var(--spacing-lg)}[_nghost-%COMP%]     .button-group .p-button{max-width:142px;width:calc(50% - 8px)}[_nghost-%COMP%]     .button-group p-button{width:calc(50% - 8px)}[_nghost-%COMP%]     .button-group p-button .p-button{width:100%}[_nghost-%COMP%]     .p-dropdown{border-color:var(--outline);max-height:40px}[_nghost-%COMP%]     .p-dropdown .p-inputtext{padding:10px 16px}input[_ngcontent-%COMP%]:-webkit-autofill{-webkit-box-shadow:0 0 0 40px white inset!important}.login-page-container[_ngcontent-%COMP%]{width:100%;height:100%;display:flex}.login-container[_ngcontent-%COMP%]{width:33%;height:100%;padding:var(--spacing-xxl);display:flex;flex-direction:column;align-items:center;background-color:var(--surface-card)}.welcome-container[_ngcontent-%COMP%]{position:relative;width:100%;display:flex}.welcome-style[_ngcontent-%COMP%]{color:#13141461;font-size:32px;font-style:normal;font-weight:700;line-height:44px;letter-spacing:1.28px}.logo-container[_ngcontent-%COMP%]{width:44.79%;object-fit:cover;padding:var(--spacing-xxl) 0}.logo-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;display:block}.form-container[_ngcontent-%COMP%]{width:52%;min-width:250px;display:flex;flex-direction:column;justify-content:center;gap:var(--spacing-lg)}.title-style[_ngcontent-%COMP%]{font-size:24px;font-style:normal;font-weight:700;line-height:32px;display:flex;justify-content:center;padding-bottom:var(--spacing-xxl)}.input-text[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.input-label[_ngcontent-%COMP%]{color:var(--surface-on-surface);font-size:20px;font-style:normal;font-weight:700;line-height:28px;letter-spacing:.4px}.button-group[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding-top:var(--spacing-lg)}.image-container[_ngcontent-%COMP%]{width:67%;height:100%}.image-box[_ngcontent-%COMP%]{width:100%;height:100%}.image-style[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover;display:block}"]})}return b})()},2285:(Zr,vt,ge)=>{ge.d(vt,{Z:()=>Er});const B="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d="ARRAYBUFFER not supported by this environment",Ke="UINT8ARRAY not supported by this environment";function Ze(E,u,y,_){let A,R,D;const ee=u||[0],z=(y=y||0)>>>3,W=-1===_?3:0;for(A=0;A<E.length;A+=1)D=A+z,R=D>>>2,ee.length<=R&&ee.push(0),ee[R]|=E[A]<<8*(W+_*(D%4));return{value:ee,binLen:8*E.length+y}}function fe(E,u,y){switch(u){case"UTF8":case"UTF16BE":case"UTF16LE":break;default:throw new Error("encoding must be UTF8, UTF16BE, or UTF16LE")}switch(E){case"HEX":return function(_,A,R){return function(D,ee,z,W){let se,$,Y,ae;if(D.length%2!=0)throw new Error("String of HEX type must be in byte increments");const ne=ee||[0],he=(z=z||0)>>>3,ue=-1===W?3:0;for(se=0;se<D.length;se+=2){if($=parseInt(D.substr(se,2),16),isNaN($))throw new Error("String of HEX type contains invalid characters");for(ae=(se>>>1)+he,Y=ae>>>2;ne.length<=Y;)ne.push(0);ne[Y]|=$<<8*(ue+W*(ae%4))}return{value:ne,binLen:4*D.length+z}}(_,A,R,y)};case"TEXT":return function(_,A,R){return function(D,ee,z,W,se){let $,Y,ae,ne,he,ue,He,me,et=0;const Ie=z||[0],st=(W=W||0)>>>3;if("UTF8"===ee)for(He=-1===se?3:0,ae=0;ae<D.length;ae+=1)for($=D.charCodeAt(ae),Y=[],128>$?Y.push($):2048>$?(Y.push(192|$>>>6),Y.push(128|63&$)):55296>$||57344<=$?Y.push(224|$>>>12,128|$>>>6&63,128|63&$):(ae+=1,$=65536+((1023&$)<<10|1023&D.charCodeAt(ae)),Y.push(240|$>>>18,128|$>>>12&63,128|$>>>6&63,128|63&$)),ne=0;ne<Y.length;ne+=1){for(ue=et+st,he=ue>>>2;Ie.length<=he;)Ie.push(0);Ie[he]|=Y[ne]<<8*(He+se*(ue%4)),et+=1}else for(He=-1===se?2:0,me="UTF16LE"===ee&&1!==se||"UTF16LE"!==ee&&1===se,ae=0;ae<D.length;ae+=1){for($=D.charCodeAt(ae),!0===me&&(ne=255&$,$=ne<<8|$>>>8),ue=et+st,he=ue>>>2;Ie.length<=he;)Ie.push(0);Ie[he]|=$<<8*(He+se*(ue%4)),et+=2}return{value:Ie,binLen:8*et+W}}(_,u,A,R,y)};case"B64":return function(_,A,R){return function(D,ee,z,W){let se,$,Y,ae,ne,he,ue,He=0;const me=ee||[0],et=(z=z||0)>>>3,Ie=-1===W?3:0,st=D.indexOf("=");if(-1===D.search(/^[a-zA-Z0-9=+/]+$/))throw new Error("Invalid character in base-64 string");if(D=D.replace(/=/g,""),-1!==st&&st<D.length)throw new Error("Invalid '=' found in base-64 string");for($=0;$<D.length;$+=4){for(ne=D.substr($,4),ae=0,Y=0;Y<ne.length;Y+=1)se=B.indexOf(ne.charAt(Y)),ae|=se<<18-6*Y;for(Y=0;Y<ne.length-1;Y+=1){for(ue=He+et,he=ue>>>2;me.length<=he;)me.push(0);me[he]|=(ae>>>16-8*Y&255)<<8*(Ie+W*(ue%4)),He+=1}}return{value:me,binLen:8*He+z}}(_,A,R,y)};case"BYTES":return function(_,A,R){return function(D,ee,z,W){let se,$,Y,ae;const ne=ee||[0],he=(z=z||0)>>>3,ue=-1===W?3:0;for($=0;$<D.length;$+=1)se=D.charCodeAt($),ae=$+he,Y=ae>>>2,ne.length<=Y&&ne.push(0),ne[Y]|=se<<8*(ue+W*(ae%4));return{value:ne,binLen:8*D.length+z}}(_,A,R,y)};case"ARRAYBUFFER":try{new ArrayBuffer(0)}catch{throw new Error(d)}return function(_,A,R){return ee=A,z=R,W=y,Ze(new Uint8Array(_),ee,z,W);var ee,z,W};case"UINT8ARRAY":try{new Uint8Array(0)}catch{throw new Error(Ke)}return function(_,A,R){return Ze(_,A,R,y)};default:throw new Error("format must be HEX, TEXT, B64, BYTES, ARRAYBUFFER, or UINT8ARRAY")}}function Me(E,u,y,_){switch(E){case"HEX":return function(A){return function(R,D,ee,z){const W="0123456789abcdef";let se,$,Y="";const ae=D/8,ne=-1===ee?3:0;for(se=0;se<ae;se+=1)$=R[se>>>2]>>>8*(ne+ee*(se%4)),Y+=W.charAt($>>>4&15)+W.charAt(15&$);return z.outputUpper?Y.toUpperCase():Y}(A,u,y,_)};case"B64":return function(A){return function(R,D,ee,z){let W,se,$,Y,ae,ne="";const he=D/8,ue=-1===ee?3:0;for(W=0;W<he;W+=3)for(Y=W+1<he?R[W+1>>>2]:0,ae=W+2<he?R[W+2>>>2]:0,$=(R[W>>>2]>>>8*(ue+ee*(W%4))&255)<<16|(Y>>>8*(ue+ee*((W+1)%4))&255)<<8|ae>>>8*(ue+ee*((W+2)%4))&255,se=0;se<4;se+=1)ne+=8*W+6*se<=D?B.charAt($>>>6*(3-se)&63):z.b64Pad;return ne}(A,u,y,_)};case"BYTES":return function(A){return function(R,D,ee){let z,W,se="";const $=D/8,Y=-1===ee?3:0;for(z=0;z<$;z+=1)W=R[z>>>2]>>>8*(Y+ee*(z%4))&255,se+=String.fromCharCode(W);return se}(A,u,y)};case"ARRAYBUFFER":try{new ArrayBuffer(0)}catch{throw new Error(d)}return function(A){return function(R,D,ee){let z;const W=D/8,se=new ArrayBuffer(W),$=new Uint8Array(se),Y=-1===ee?3:0;for(z=0;z<W;z+=1)$[z]=R[z>>>2]>>>8*(Y+ee*(z%4))&255;return se}(A,u,y)};case"UINT8ARRAY":try{new Uint8Array(0)}catch{throw new Error(Ke)}return function(A){return function(R,D,ee){let z;const W=D/8,se=-1===ee?3:0,$=new Uint8Array(W);for(z=0;z<W;z+=1)$[z]=R[z>>>2]>>>8*(se+ee*(z%4))&255;return $}(A,u,y)};default:throw new Error("format must be HEX, B64, BYTES, ARRAYBUFFER, or UINT8ARRAY")}}const Oe=4294967296,X=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],$e=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428],ye=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],ve="Chosen SHA variant is not supported",Te="Cannot set numRounds with MAC";function it(E,u){let y,_;const A=E.binLen>>>3,R=u.binLen>>>3,D=A<<3,ee=4-A<<3;if(A%4!=0){for(y=0;y<R;y+=4)_=A+y>>>2,E.value[_]|=u.value[y>>>2]<<D,E.value.push(0),E.value[_+1]|=u.value[y>>>2]>>>ee;return(E.value.length<<2)-4>=R+A&&E.value.pop(),{value:E.value,binLen:E.binLen+u.binLen}}return{value:E.value.concat(u.value),binLen:E.binLen+u.binLen}}function ct(E){const u={outputUpper:!1,b64Pad:"=",outputLen:-1},y=E||{},_="Output length must be a multiple of 8";if(u.outputUpper=y.outputUpper||!1,y.b64Pad&&(u.b64Pad=y.b64Pad),y.outputLen){if(y.outputLen%8!=0)throw new Error(_);u.outputLen=y.outputLen}else if(y.shakeLen){if(y.shakeLen%8!=0)throw new Error(_);u.outputLen=y.shakeLen}if("boolean"!=typeof u.outputUpper)throw new Error("Invalid outputUpper formatting option");if("string"!=typeof u.b64Pad)throw new Error("Invalid b64Pad formatting option");return u}function Ce(E,u,y,_){const A=E+" must include a value and format";if(!u){if(!_)throw new Error(A);return _}if(void 0===u.value||!u.format)throw new Error(A);return fe(u.format,u.encoding||"UTF8",y)(u.value)}class dt{constructor(u,y,_){const A=_||{};if(this.t=y,this.i=A.encoding||"UTF8",this.numRounds=A.numRounds||1,isNaN(this.numRounds)||this.numRounds!==parseInt(this.numRounds,10)||1>this.numRounds)throw new Error("numRounds must a integer >= 1");this.o=u,this.h=[],this.u=0,this.l=!1,this.A=0,this.H=!1,this.S=[],this.p=[]}update(u){let y,_=0;const A=this.m>>>5,R=this.C(u,this.h,this.u),D=R.binLen,ee=R.value,z=D>>>5;for(y=0;y<z;y+=A)_+this.m<=D&&(this.U=this.v(ee.slice(y,y+A),this.U),_+=this.m);return this.A+=_,this.h=ee.slice(_>>>5),this.u=D%this.m,this.l=!0,this}getHash(u,y){let _,A,R=this.R;const D=ct(y);if(this.K){if(-1===D.outputLen)throw new Error("Output length must be specified in options");R=D.outputLen}const ee=Me(u,R,this.T,D);if(this.H&&this.g)return ee(this.g(D));for(A=this.F(this.h.slice(),this.u,this.A,this.L(this.U),R),_=1;_<this.numRounds;_+=1)this.K&&R%32!=0&&(A[A.length-1]&=16777215>>>24-R%32),A=this.F(A,R,0,this.B(this.o),R);return ee(A)}setHMACKey(u,y,_){if(!this.M)throw new Error("Variant does not support HMAC");if(this.l)throw new Error("Cannot set MAC key after calling update");const A=fe(y,(_||{}).encoding||"UTF8",this.T);this.k(A(u))}k(u){const y=this.m>>>3,_=y/4-1;let A;if(1!==this.numRounds)throw new Error(Te);if(this.H)throw new Error("MAC key already set");for(y<u.binLen/8&&(u.value=this.F(u.value,u.binLen,0,this.B(this.o),this.R));u.value.length<=_;)u.value.push(0);for(A=0;A<=_;A+=1)this.S[A]=909522486^u.value[A],this.p[A]=1549556828^u.value[A];this.U=this.v(this.S,this.U),this.A=this.m,this.H=!0}getHMAC(u,y){const _=ct(y);return Me(u,this.R,this.T,_)(this.Y())}Y(){let u;if(!this.H)throw new Error("Cannot call getHMAC without first setting MAC key");const y=this.F(this.h.slice(),this.u,this.A,this.L(this.U),this.R);return u=this.v(this.p,this.B(this.o)),u=this.F(y,this.R,this.m,u,this.R),u}}function pt(E,u){return E<<u|E>>>32-u}function ot(E,u){return E>>>u|E<<32-u}function qt(E,u){return E>>>u}function Dt(E,u,y){return E^u^y}function Xe(E,u,y){return E&u^~E&y}function St(E,u,y){return E&u^E&y^u&y}function Ht(E){return ot(E,2)^ot(E,13)^ot(E,22)}function Fe(E,u){const y=(65535&E)+(65535&u);return(65535&(E>>>16)+(u>>>16)+(y>>>16))<<16|65535&y}function Et(E,u,y,_){const A=(65535&E)+(65535&u)+(65535&y)+(65535&_);return(65535&(E>>>16)+(u>>>16)+(y>>>16)+(_>>>16)+(A>>>16))<<16|65535&A}function qe(E,u,y,_,A){const R=(65535&E)+(65535&u)+(65535&y)+(65535&_)+(65535&A);return(65535&(E>>>16)+(u>>>16)+(y>>>16)+(_>>>16)+(A>>>16)+(R>>>16))<<16|65535&R}function ut(E){return ot(E,7)^ot(E,18)^qt(E,3)}function G(E){return ot(E,6)^ot(E,11)^ot(E,25)}function Yt(E){return[1732584193,4023233417,2562383102,271733878,3285377520]}function jt(E,u){let y,_,A,R,D,ee,z;const W=[];for(y=u[0],_=u[1],A=u[2],R=u[3],D=u[4],z=0;z<80;z+=1)W[z]=z<16?E[z]:pt(W[z-3]^W[z-8]^W[z-14]^W[z-16],1),ee=z<20?qe(pt(y,5),Xe(_,A,R),D,1518500249,W[z]):z<40?qe(pt(y,5),Dt(_,A,R),D,1859775393,W[z]):z<60?qe(pt(y,5),St(_,A,R),D,2400959708,W[z]):qe(pt(y,5),Dt(_,A,R),D,3395469782,W[z]),D=R,R=A,A=pt(_,30),_=y,y=ee;return u[0]=Fe(y,u[0]),u[1]=Fe(_,u[1]),u[2]=Fe(A,u[2]),u[3]=Fe(R,u[3]),u[4]=Fe(D,u[4]),u}function Wt(E,u,y,_){let A;const R=15+(u+65>>>9<<4),D=u+y;for(;E.length<=R;)E.push(0);for(E[u>>>5]|=128<<24-u%32,E[R]=4294967295&D,E[R-1]=D/Oe|0,A=0;A<E.length;A+=16)_=jt(E.slice(A,A+16),_);return _}let Q=class extends dt{constructor(E,u,y){if("SHA-1"!==E)throw new Error(ve);super(E,u,y);const _=y||{};this.M=!0,this.g=this.Y,this.T=-1,this.C=fe(this.t,this.i,this.T),this.v=jt,this.L=function(A){return A.slice()},this.B=Yt,this.F=Wt,this.U=[1732584193,4023233417,2562383102,271733878,3285377520],this.m=512,this.R=160,this.K=!1,_.hmacKey&&this.k(Ce("hmacKey",_.hmacKey,this.T))}};function Ve(E){let u;return u="SHA-224"==E?$e.slice():ye.slice(),u}function rt(E,u){let y,_,A,R,D,ee,z,W,se,$,Y;const ae=[];for(y=u[0],_=u[1],A=u[2],R=u[3],D=u[4],ee=u[5],z=u[6],W=u[7],Y=0;Y<64;Y+=1)ae[Y]=Y<16?E[Y]:Et(ot(ne=ae[Y-2],17)^ot(ne,19)^qt(ne,10),ae[Y-7],ut(ae[Y-15]),ae[Y-16]),se=qe(W,G(D),Xe(D,ee,z),X[Y],ae[Y]),$=Fe(Ht(y),St(y,_,A)),W=z,z=ee,ee=D,D=Fe(R,se),R=A,A=_,_=y,y=Fe(se,$);var ne;return u[0]=Fe(y,u[0]),u[1]=Fe(_,u[1]),u[2]=Fe(A,u[2]),u[3]=Fe(R,u[3]),u[4]=Fe(D,u[4]),u[5]=Fe(ee,u[5]),u[6]=Fe(z,u[6]),u[7]=Fe(W,u[7]),u}let bt=class extends dt{constructor(E,u,y){if("SHA-224"!==E&&"SHA-256"!==E)throw new Error(ve);super(E,u,y);const _=y||{};this.g=this.Y,this.M=!0,this.T=-1,this.C=fe(this.t,this.i,this.T),this.v=rt,this.L=function(A){return A.slice()},this.B=Ve,this.F=function(A,R,D,ee){return function(z,W,se,$,Y){let ae,ne;const he=15+(W+65>>>9<<4),ue=W+se;for(;z.length<=he;)z.push(0);for(z[W>>>5]|=128<<24-W%32,z[he]=4294967295&ue,z[he-1]=ue/Oe|0,ae=0;ae<z.length;ae+=16)$=rt(z.slice(ae,ae+16),$);return ne="SHA-224"===Y?[$[0],$[1],$[2],$[3],$[4],$[5],$[6]]:$,ne}(A,R,D,ee,E)},this.U=Ve(E),this.m=512,this.R="SHA-224"===E?224:256,this.K=!1,_.hmacKey&&this.k(Ce("hmacKey",_.hmacKey,this.T))}};class h{constructor(u,y){this.N=u,this.I=y}}function j(E,u){let y;return u>32?(y=64-u,new h(E.I<<u|E.N>>>y,E.N<<u|E.I>>>y)):0!==u?(y=32-u,new h(E.N<<u|E.I>>>y,E.I<<u|E.N>>>y)):E}function M(E,u){let y;return u<32?(y=32-u,new h(E.N>>>u|E.I<<y,E.I>>>u|E.N<<y)):(y=64-u,new h(E.I>>>u|E.N<<y,E.N>>>u|E.I<<y))}function T(E,u){return new h(E.N>>>u,E.I>>>u|E.N<<32-u)}function V(E,u,y){return new h(E.N&u.N^E.N&y.N^u.N&y.N,E.I&u.I^E.I&y.I^u.I&y.I)}function K(E){const u=M(E,28),y=M(E,34),_=M(E,39);return new h(u.N^y.N^_.N,u.I^y.I^_.I)}function te(E,u){let y,_;y=(65535&E.I)+(65535&u.I),_=(E.I>>>16)+(u.I>>>16)+(y>>>16);const A=(65535&_)<<16|65535&y;return y=(65535&E.N)+(65535&u.N)+(_>>>16),_=(E.N>>>16)+(u.N>>>16)+(y>>>16),new h((65535&_)<<16|65535&y,A)}function pe(E,u,y,_){let A,R;A=(65535&E.I)+(65535&u.I)+(65535&y.I)+(65535&_.I),R=(E.I>>>16)+(u.I>>>16)+(y.I>>>16)+(_.I>>>16)+(A>>>16);const D=(65535&R)<<16|65535&A;return A=(65535&E.N)+(65535&u.N)+(65535&y.N)+(65535&_.N)+(R>>>16),R=(E.N>>>16)+(u.N>>>16)+(y.N>>>16)+(_.N>>>16)+(A>>>16),new h((65535&R)<<16|65535&A,D)}function Ne(E,u,y,_,A){let R,D;R=(65535&E.I)+(65535&u.I)+(65535&y.I)+(65535&_.I)+(65535&A.I),D=(E.I>>>16)+(u.I>>>16)+(y.I>>>16)+(_.I>>>16)+(A.I>>>16)+(R>>>16);const ee=(65535&D)<<16|65535&R;return R=(65535&E.N)+(65535&u.N)+(65535&y.N)+(65535&_.N)+(65535&A.N)+(D>>>16),D=(E.N>>>16)+(u.N>>>16)+(y.N>>>16)+(_.N>>>16)+(A.N>>>16)+(R>>>16),new h((65535&D)<<16|65535&R,ee)}function ie(E,u){return new h(E.N^u.N,E.I^u.I)}function ce(E){const u=M(E,19),y=M(E,61),_=T(E,6);return new h(u.N^y.N^_.N,u.I^y.I^_.I)}function je(E){const u=M(E,1),y=M(E,8),_=T(E,7);return new h(u.N^y.N^_.N,u.I^y.I^_.I)}function ke(E){const u=M(E,14),y=M(E,18),_=M(E,41);return new h(u.N^y.N^_.N,u.I^y.I^_.I)}const Be=[new h(X[0],3609767458),new h(X[1],602891725),new h(X[2],3964484399),new h(X[3],2173295548),new h(X[4],4081628472),new h(X[5],3053834265),new h(X[6],2937671579),new h(X[7],3664609560),new h(X[8],2734883394),new h(X[9],1164996542),new h(X[10],1323610764),new h(X[11],3590304994),new h(X[12],4068182383),new h(X[13],991336113),new h(X[14],633803317),new h(X[15],3479774868),new h(X[16],2666613458),new h(X[17],944711139),new h(X[18],2341262773),new h(X[19],2007800933),new h(X[20],1495990901),new h(X[21],1856431235),new h(X[22],3175218132),new h(X[23],2198950837),new h(X[24],3999719339),new h(X[25],766784016),new h(X[26],2566594879),new h(X[27],3203337956),new h(X[28],1034457026),new h(X[29],2466948901),new h(X[30],3758326383),new h(X[31],168717936),new h(X[32],1188179964),new h(X[33],1546045734),new h(X[34],1522805485),new h(X[35],2643833823),new h(X[36],2343527390),new h(X[37],1014477480),new h(X[38],1206759142),new h(X[39],344077627),new h(X[40],1290863460),new h(X[41],3158454273),new h(X[42],3505952657),new h(X[43],106217008),new h(X[44],3606008344),new h(X[45],1432725776),new h(X[46],1467031594),new h(X[47],851169720),new h(X[48],3100823752),new h(X[49],1363258195),new h(X[50],3750685593),new h(X[51],3785050280),new h(X[52],3318307427),new h(X[53],3812723403),new h(X[54],2003034995),new h(X[55],3602036899),new h(X[56],1575990012),new h(X[57],1125592928),new h(X[58],2716904306),new h(X[59],442776044),new h(X[60],593698344),new h(X[61],3733110249),new h(X[62],2999351573),new h(X[63],3815920427),new h(3391569614,3928383900),new h(3515267271,566280711),new h(3940187606,3454069534),new h(4118630271,4000239992),new h(116418474,1914138554),new h(174292421,2731055270),new h(289380356,3203993006),new h(460393269,320620315),new h(685471733,587496836),new h(852142971,1086792851),new h(1017036298,365543100),new h(1126000580,2618297676),new h(1288033470,3409855158),new h(1501505948,4234509866),new h(1607167915,987167468),new h(1816402316,1246189591)];function Ae(E){return"SHA-384"===E?[new h(3418070365,$e[0]),new h(1654270250,$e[1]),new h(2438529370,$e[2]),new h(355462360,$e[3]),new h(1731405415,$e[4]),new h(41048885895,$e[5]),new h(3675008525,$e[6]),new h(1203062813,$e[7])]:[new h(ye[0],4089235720),new h(ye[1],2227873595),new h(ye[2],4271175723),new h(ye[3],1595750129),new h(ye[4],2917565137),new h(ye[5],725511199),new h(ye[6],4215389547),new h(ye[7],327033209)]}function Qe(E,u){let y,_,A,R,D,ee,z,W,se,$,Y,ae;const ne=[];for(y=u[0],_=u[1],A=u[2],R=u[3],D=u[4],ee=u[5],z=u[6],W=u[7],Y=0;Y<80;Y+=1)Y<16?(ae=2*Y,ne[Y]=new h(E[ae],E[ae+1])):ne[Y]=pe(ce(ne[Y-2]),ne[Y-7],je(ne[Y-15]),ne[Y-16]),se=Ne(W,ke(D),new h((he=D).N&(ue=ee).N^~he.N&(He=z).N,he.I&ue.I^~he.I&He.I),Be[Y],ne[Y]),$=te(K(y),V(y,_,A)),W=z,z=ee,ee=D,D=te(R,se),R=A,A=_,_=y,y=te(se,$);var he,ue,He;return u[0]=te(y,u[0]),u[1]=te(_,u[1]),u[2]=te(A,u[2]),u[3]=te(R,u[3]),u[4]=te(D,u[4]),u[5]=te(ee,u[5]),u[6]=te(z,u[6]),u[7]=te(W,u[7]),u}let De=class extends dt{constructor(E,u,y){if("SHA-384"!==E&&"SHA-512"!==E)throw new Error(ve);super(E,u,y);const _=y||{};this.g=this.Y,this.M=!0,this.T=-1,this.C=fe(this.t,this.i,this.T),this.v=Qe,this.L=function(A){return A.slice()},this.B=Ae,this.F=function(A,R,D,ee){return function(z,W,se,$,Y){let ae,ne;const he=31+(W+129>>>10<<5),ue=W+se;for(;z.length<=he;)z.push(0);for(z[W>>>5]|=128<<24-W%32,z[he]=4294967295&ue,z[he-1]=ue/Oe|0,ae=0;ae<z.length;ae+=32)$=Qe(z.slice(ae,ae+32),$);return ne="SHA-384"===Y?[$[0].N,$[0].I,$[1].N,$[1].I,$[2].N,$[2].I,$[3].N,$[3].I,$[4].N,$[4].I,$[5].N,$[5].I]:[$[0].N,$[0].I,$[1].N,$[1].I,$[2].N,$[2].I,$[3].N,$[3].I,$[4].N,$[4].I,$[5].N,$[5].I,$[6].N,$[6].I,$[7].N,$[7].I],ne}(A,R,D,ee,E)},this.U=Ae(E),this.m=1024,this.R="SHA-384"===E?384:512,this.K=!1,_.hmacKey&&this.k(Ce("hmacKey",_.hmacKey,this.T))}};const lt=[new h(0,1),new h(0,32898),new h(2147483648,32906),new h(2147483648,2147516416),new h(0,32907),new h(0,2147483649),new h(2147483648,2147516545),new h(2147483648,32777),new h(0,138),new h(0,136),new h(0,2147516425),new h(0,2147483658),new h(0,2147516555),new h(2147483648,139),new h(2147483648,32905),new h(2147483648,32771),new h(2147483648,32770),new h(2147483648,128),new h(0,32778),new h(2147483648,2147483658),new h(2147483648,2147516545),new h(2147483648,32896),new h(0,2147483649),new h(2147483648,2147516424)],vr=[[0,36,3,41,18],[1,44,10,45,2],[62,6,43,15,61],[28,55,25,21,56],[27,20,39,8,14]];function Mt(E){let u;const y=[];for(u=0;u<5;u+=1)y[u]=[new h(0,0),new h(0,0),new h(0,0),new h(0,0),new h(0,0)];return y}function Rt(E){let u;const y=[];for(u=0;u<5;u+=1)y[u]=E[u].slice();return y}function Ct(E,u){let y,_,A,R;const D=[],ee=[];if(null!==E)for(_=0;_<E.length;_+=2)u[(_>>>1)%5][(_>>>1)/5|0]=ie(u[(_>>>1)%5][(_>>>1)/5|0],new h(E[_+1],E[_]));for(y=0;y<24;y+=1){for(R=Mt(),_=0;_<5;_+=1)D[_]=new h((z=u[_][0]).N^(W=u[_][1]).N^(se=u[_][2]).N^($=u[_][3]).N^(Y=u[_][4]).N,z.I^W.I^se.I^$.I^Y.I);for(_=0;_<5;_+=1)ee[_]=ie(D[(_+4)%5],j(D[(_+1)%5],1));for(_=0;_<5;_+=1)for(A=0;A<5;A+=1)u[_][A]=ie(u[_][A],ee[_]);for(_=0;_<5;_+=1)for(A=0;A<5;A+=1)R[A][(2*_+3*A)%5]=j(u[_][A],vr[_][A]);for(_=0;_<5;_+=1)for(A=0;A<5;A+=1)u[_][A]=ie(R[_][A],new h(~R[(_+1)%5][A].N&R[(_+2)%5][A].N,~R[(_+1)%5][A].I&R[(_+2)%5][A].I));u[0][0]=ie(u[0][0],lt[y])}var z,W,se,$,Y;return u}function Xt(E){let u,y,_=0;const A=[0,0],R=[4294967295&E,E/Oe&2097151];for(u=6;u>=0;u--)y=R[u>>2]>>>8*u&255,0===y&&0===_||(A[_+1>>2]|=y<<8*(_+1),_+=1);return _=0!==_?_:1,A[0]|=_,{value:_+1>4?A:[A[0]],binLen:8+8*_}}function Qt(E){return it(Xt(E.binLen),E)}function er(E,u){let y,_=Xt(u);_=it(_,E);const A=u>>>2,R=(A-_.value.length%A)%A;for(y=0;y<R;y++)_.value.push(0);return _.value}let Sr=class extends dt{constructor(E,u,y){let _=6,A=0;super(E,u,y);const R=y||{};if(1!==this.numRounds){if(R.kmacKey||R.hmacKey)throw new Error(Te);if("CSHAKE128"===this.o||"CSHAKE256"===this.o)throw new Error("Cannot set numRounds for CSHAKE variants")}switch(this.T=1,this.C=fe(this.t,this.i,this.T),this.v=Ct,this.L=Rt,this.B=Mt,this.U=Mt(),this.K=!1,E){case"SHA3-224":this.m=A=1152,this.R=224,this.M=!0,this.g=this.Y;break;case"SHA3-256":this.m=A=1088,this.R=256,this.M=!0,this.g=this.Y;break;case"SHA3-384":this.m=A=832,this.R=384,this.M=!0,this.g=this.Y;break;case"SHA3-512":this.m=A=576,this.R=512,this.M=!0,this.g=this.Y;break;case"SHAKE128":_=31,this.m=A=1344,this.R=-1,this.K=!0,this.M=!1,this.g=null;break;case"SHAKE256":_=31,this.m=A=1088,this.R=-1,this.K=!0,this.M=!1,this.g=null;break;case"KMAC128":_=4,this.m=A=1344,this.X(y),this.R=-1,this.K=!0,this.M=!1,this.g=this._;break;case"KMAC256":_=4,this.m=A=1088,this.X(y),this.R=-1,this.K=!0,this.M=!1,this.g=this._;break;case"CSHAKE128":this.m=A=1344,_=this.O(y),this.R=-1,this.K=!0,this.M=!1,this.g=null;break;case"CSHAKE256":this.m=A=1088,_=this.O(y),this.R=-1,this.K=!0,this.M=!1,this.g=null;break;default:throw new Error(ve)}this.F=function(D,ee,z,W,se){return function($,Y,ae,ne,he,ue,He){let me,et,Ie=0;const st=[],Ge=he>>>5,nr=Y>>>5;for(me=0;me<nr&&Y>=he;me+=Ge)ne=Ct($.slice(me,me+Ge),ne),Y-=he;for($=$.slice(me),Y%=he;$.length<Ge;)$.push(0);for(me=Y>>>3,$[me>>2]^=ue<<me%4*8,$[Ge-1]^=2147483648,ne=Ct($,ne);32*st.length<He&&(et=ne[Ie%5][Ie/5|0],st.push(et.I),!(32*st.length>=He));)st.push(et.N),Ie+=1,64*Ie%he==0&&(Ct(null,ne),Ie=0);return st}(D,ee,0,W,A,_,se)},R.hmacKey&&this.k(Ce("hmacKey",R.hmacKey,this.T))}O(E,u){const y=function(A){const R=A||{};return{funcName:Ce("funcName",R.funcName,1,{value:[],binLen:0}),customization:Ce("Customization",R.customization,1,{value:[],binLen:0})}}(E||{});u&&(y.funcName=u);const _=it(Qt(y.funcName),Qt(y.customization));if(0!==y.customization.binLen||0!==y.funcName.binLen){const A=er(_,this.m>>>3);for(let R=0;R<A.length;R+=this.m>>>5)this.U=this.v(A.slice(R,R+(this.m>>>5)),this.U),this.A+=this.m;return 4}return 31}X(E){const u=function(_){const A=_||{};return{kmacKey:Ce("kmacKey",A.kmacKey,1),funcName:{value:[1128353099],binLen:32},customization:Ce("Customization",A.customization,1,{value:[],binLen:0})}}(E||{});this.O(E,u.funcName);const y=er(Qt(u.kmacKey),this.m>>>3);for(let _=0;_<y.length;_+=this.m>>>5)this.U=this.v(y.slice(_,_+(this.m>>>5)),this.U),this.A+=this.m;this.H=!0}_(E){const u=it({value:this.h.slice(),binLen:this.u},function(y){let _,A,R=0;const D=[0,0],ee=[4294967295&y,y/Oe&2097151];for(_=6;_>=0;_--)A=ee[_>>2]>>>8*_&255,0===A&&0===R||(D[R>>2]|=A<<8*R,R+=1);return R=0!==R?R:1,D[R>>2]|=R<<8*R,{value:R+1>4?D:[D[0]],binLen:8+8*R}}(E.outputLen));return this.F(u.value,u.binLen,this.A,this.L(this.U),E.outputLen)}};class Er{constructor(u,y,_){if("SHA-1"==u)this.P=new Q(u,y,_);else if("SHA-224"==u||"SHA-256"==u)this.P=new bt(u,y,_);else if("SHA-384"==u||"SHA-512"==u)this.P=new De(u,y,_);else{if("SHA3-224"!=u&&"SHA3-256"!=u&&"SHA3-384"!=u&&"SHA3-512"!=u&&"SHAKE128"!=u&&"SHAKE256"!=u&&"CSHAKE128"!=u&&"CSHAKE256"!=u&&"KMAC128"!=u&&"KMAC256"!=u)throw new Error(ve);this.P=new Sr(u,y,_)}}update(u){return this.P.update(u),this}getHash(u,y){return this.P.getHash(u,y)}setHMACKey(u,y,_){this.P.setHMACKey(u,y,_)}getHMAC(u,y){return this.P.getHMAC(u,y)}}},6296:(Zr,vt,ge)=>{function B(Ke){var Ze,fe,Me,Oe=2;for(typeof Symbol<"u"&&(fe=Symbol.asyncIterator,Me=Symbol.iterator);Oe--;){if(fe&&null!=(Ze=Ke[fe]))return Ze.call(Ke);if(Me&&null!=(Ze=Ke[Me]))return new d(Ze.call(Ke));fe="@@asyncIterator",Me="@@iterator"}throw new TypeError("Object is not async iterable")}function d(Ke){function Ze(fe){if(Object(fe)!==fe)return Promise.reject(new TypeError(fe+" is not an object."));var Me=fe.done;return Promise.resolve(fe.value).then(function(Oe){return{value:Oe,done:Me}})}return(d=function(Me){this.s=Me,this.n=Me.next}).prototype={s:null,n:null,next:function(){return Ze(this.n.apply(this.s,arguments))},return:function(Me){var Oe=this.s.return;return void 0===Oe?Promise.resolve({value:Me,done:!0}):Ze(Oe.apply(this.s,arguments))},throw:function(Me){var Oe=this.s.return;return void 0===Oe?Promise.reject(Me):Ze(Oe.apply(this.s,arguments))}},new d(Ke)}ge.d(vt,{Z:()=>B})},7582:(Zr,vt,ge)=>{function fe(h,j,M,T){var te,V=arguments.length,K=V<3?j:null===T?T=Object.getOwnPropertyDescriptor(j,M):T;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)K=Reflect.decorate(h,j,M,T);else for(var pe=h.length-1;pe>=0;pe--)(te=h[pe])&&(K=(V<3?te(K):V>3?te(j,M,K):te(j,M))||K);return V>3&&K&&Object.defineProperty(j,M,K),K}function Te(h,j,M,T){return new(M||(M=Promise))(function(K,te){function pe(ce){try{ie(T.next(ce))}catch(je){te(je)}}function Ne(ce){try{ie(T.throw(ce))}catch(je){te(je)}}function ie(ce){ce.done?K(ce.value):function V(K){return K instanceof M?K:new M(function(te){te(K)})}(ce.value).then(pe,Ne)}ie((T=T.apply(h,j||[])).next())})}function Xe(h){return this instanceof Xe?(this.v=h,this):new Xe(h)}function St(h,j,M){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var V,T=M.apply(h,j||[]),K=[];return V={},te("next"),te("throw"),te("return"),V[Symbol.asyncIterator]=function(){return this},V;function te(ke){T[ke]&&(V[ke]=function(Be){return new Promise(function(Ae,Qe){K.push([ke,Be,Ae,Qe])>1||pe(ke,Be)})})}function pe(ke,Be){try{!function Ne(ke){ke.value instanceof Xe?Promise.resolve(ke.value.v).then(ie,ce):je(K[0][2],ke)}(T[ke](Be))}catch(Ae){je(K[0][3],Ae)}}function ie(ke){pe("next",ke)}function ce(ke){pe("throw",ke)}function je(ke,Be){ke(Be),K.shift(),K.length&&pe(K[0][0],K[0][1])}}function Fe(h){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var M,j=h[Symbol.asyncIterator];return j?j.call(h):(h=function dt(h){var j="function"==typeof Symbol&&Symbol.iterator,M=j&&h[j],T=0;if(M)return M.call(h);if(h&&"number"==typeof h.length)return{next:function(){return h&&T>=h.length&&(h=void 0),{value:h&&h[T++],done:!h}}};throw new TypeError(j?"Object is not iterable.":"Symbol.iterator is not defined.")}(h),M={},T("next"),T("throw"),T("return"),M[Symbol.asyncIterator]=function(){return this},M);function T(K){M[K]=h[K]&&function(te){return new Promise(function(pe,Ne){!function V(K,te,pe,Ne){Promise.resolve(Ne).then(function(ie){K({value:ie,done:pe})},te)}(pe,Ne,(te=h[K](te)).done,te.value)})}}}ge.d(vt,{FC:()=>St,KL:()=>Fe,gn:()=>fe,mG:()=>Te,qq:()=>Xe}),"function"==typeof SuppressedError&&SuppressedError}}]);