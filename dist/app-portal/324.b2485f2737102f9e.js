(self.webpackChunkapp_portal=self.webpackChunkapp_portal||[]).push([[324,3395,9191],{9159:(Bt,We,Y)=>{Y.r(We),Y.d(We,{AckPolicy:()=>pi,DeliverPolicy:()=>gi,JSONCodec:()=>Qe,JetstreamWsService:()=>yr,RetentionPolicy:()=>mi,SubscribeType:()=>Dn});var m=Y(5861),s=Y(7582),xe=Y(5863),Se=Y(5126),ce=Y(6296);function we(r,e){this.v=r,this.k=e}function me(r){return new we(r,0)}function W(r){var e,t;function n(o,a){try{var l=r[o](a),_=l.value,v=_ instanceof we;Promise.resolve(v?_.v:_).then(function(A){if(v){var E="return"===o?"return":"next";if(!_.k||A.done)return n(E,A);A=r[E](A).value}i(l.done?"return":"normal",A)},function(A){n("throw",A)})}catch(A){i("throw",A)}}function i(o,a){switch(o){case"return":e.resolve({value:a,done:!0});break;case"throw":e.reject(a);break;default:e.resolve({value:a,done:!1})}(e=e.next)?n(e.key,e.arg):t=null}this._invoke=function(o,a){return new Promise(function(l,_){var v={key:o,arg:a,resolve:l,reject:_,next:null};t?t=t.next=v:(e=t=v,n(o,a))})},"function"!=typeof r.return&&(this.return=void 0)}function Me(r){return function(){return new W(r.apply(this,arguments))}}W.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},W.prototype.next=function(r){return this._invoke("next",r)},W.prototype.throw=function(r){return this._invoke("throw",r)},W.prototype.return=function(r){return this._invoke("return",r)};const pe=new Uint8Array(0),Re=new TextEncoder,Oe=new TextDecoder;function Ve(...r){const e=[];for(let t=0;t<r.length;t++)e.push(Re.encode(r[t]));return 0===e.length?pe:1===e.length?e[0]:function it(...r){let e=0;for(let i=0;i<r.length;i++)e+=r[i].length;const t=new Uint8Array(e);let n=0;for(let i=0;i<r.length;i++)t.set(r[i],n),n+=r[i].length;return t}(...e)}function ze(r){return r&&0!==r.length?Oe.decode(r):""}const Ye="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";const Ke=new class ge{buf;seq;inc;constructor(){this.buf=new Uint8Array(22),this.init()}init(){this.setPre(),this.initSeqAndInc(),this.fillSeq()}initSeqAndInc(){this.seq=Math.floor(0xcfd41b9100000*Math.random()),this.inc=Math.floor(300*Math.random()+33)}setPre(){const e=new Uint8Array(12);!function Ne(r){globalThis?.crypto?.getRandomValues?globalThis.crypto.getRandomValues(r):function ae(r){for(let e=0;e<r.length;e++)r[e]=Math.floor(255*Math.random())}(r)}(e);for(let t=0;t<12;t++)this.buf[t]=Ye.charCodeAt(e[t]%36)}fillSeq(){let e=this.seq;for(let t=21;t>=12;t--)this.buf[t]=Ye.charCodeAt(e%36),e=Math.floor(e/36)}next(){return this.seq+=this.inc,this.seq>0xcfd41b9100000&&(this.setPre(),this.initSeqAndInc()),this.fillSeq(),String.fromCharCode.apply(String,this.buf)}reset(){this.init()}};var Ze=function(r){return r.Disconnect="disconnect",r.Reconnect="reconnect",r.Update="update",r.LDM="ldm",r.Error="error",r}(Ze||{}),pt=function(r){return r.Reconnecting="reconnecting",r.PingTimer="pingTimer",r.StaleConnection="staleConnection",r}(pt||{}),U=function(r){return r.ApiError="BAD API",r.BadAuthentication="BAD_AUTHENTICATION",r.BadCreds="BAD_CREDS",r.BadHeader="BAD_HEADER",r.BadJson="BAD_JSON",r.BadPayload="BAD_PAYLOAD",r.BadSubject="BAD_SUBJECT",r.Cancelled="CANCELLED",r.ConnectionClosed="CONNECTION_CLOSED",r.ConnectionDraining="CONNECTION_DRAINING",r.ConnectionRefused="CONNECTION_REFUSED",r.ConnectionTimeout="CONNECTION_TIMEOUT",r.Disconnect="DISCONNECT",r.InvalidOption="INVALID_OPTION",r.InvalidPayload="INVALID_PAYLOAD",r.MaxPayloadExceeded="MAX_PAYLOAD_EXCEEDED",r.NoResponders="503",r.NotFunction="NOT_FUNC",r.RequestError="REQUEST_ERROR",r.ServerOptionNotAvailable="SERVER_OPT_NA",r.SubClosed="SUB_CLOSED",r.SubDraining="SUB_DRAINING",r.Timeout="TIMEOUT",r.Tls="TLS",r.Unknown="UNKNOWN_ERROR",r.WssRequired="WSS_REQUIRED",r.JetStreamInvalidAck="JESTREAM_INVALID_ACK",r.JetStream404NoMessages="404",r.JetStream408RequestTimeout="408",r.JetStream409MaxAckPendingExceeded="409",r.JetStream409="409",r.JetStreamNotEnabled="503",r.JetStreamIdleHeartBeat="IDLE_HEARTBEAT",r.AuthorizationViolation="AUTHORIZATION_VIOLATION",r.AuthenticationExpired="AUTHENTICATION_EXPIRED",r.ProtocolError="NATS_PROTOCOL_ERR",r.PermissionsViolation="PERMISSIONS_VIOLATION",r.AuthenticationTimeout="AUTHENTICATION_TIMEOUT",r}(U||{});class ne{messages;constructor(){this.messages=new Map,this.messages.set(U.InvalidPayload,"Invalid payload type - payloads can be 'binary', 'string', or 'json'"),this.messages.set(U.BadJson,"Bad JSON"),this.messages.set(U.WssRequired,"TLS is required, therefore a secure websocket connection is also required")}static getMessage(e){return le.getMessage(e)}getMessage(e){return this.messages.get(e)||e}}const le=new ne;class q extends Error{name;message;code;permissionContext;chainedError;api_error;constructor(e,t,n){super(e),this.name="NatsError",this.message=e,this.code=t,this.chainedError=n}static errorForCode(e,t){const n=ne.getMessage(e);return new q(n,e,t)}isAuthError(){return this.code===U.AuthenticationExpired||this.code===U.AuthorizationViolation}isAuthTimeout(){return this.code===U.AuthenticationTimeout}isPermissionError(){return this.code===U.PermissionsViolation}isProtocolError(){return this.code===U.ProtocolError}isJetStreamError(){return void 0!==this.api_error}jsError(){return this.api_error?this.api_error:null}}var fe=function(r){return r[r.Exact=0]="Exact",r[r.CanonicalMIME=1]="CanonicalMIME",r[r.IgnoreCase=2]="IgnoreCase",r}(fe||{}),Ie=function(r){return r.Timer="timer",r.Count="count",r.JitterTimer="jitterTimer",r.SentinelMsg="sentinelMsg",r}(Ie||{}),kt=function(r){return r.STATS="io.nats.micro.v1.stats_response",r.INFO="io.nats.micro.v1.info_response",r.PING="io.nats.micro.v1.ping_response",r}(kt||{});const d="Nats-Service-Error",I="Nats-Service-Error-Code";class j extends Error{code;constructor(e,t){super(t),this.code=e}static isServiceError(e){return null!==j.toServiceError(e)}static toServiceError(e){const t=e?.headers?.get(I)||"";if(""!==t){const n=parseInt(t)||400,i=e?.headers?.get(d)||"";return new j(n,i.length?i:t)}return null}}function T(r=""){if("string"!=typeof(r=r||"_INBOX"))throw new Error("prefix must be a string");return r.split(".").forEach(e=>{if("*"===e||">"===e)throw new Error(`inbox prefixes cannot have wildcards '${r}'`)}),`${r}.${Ke.next()}`}const J="127.0.0.1";var K=function(r){return r.PING="PING",r.STATS="STATS",r.INFO="INFO",r}(K||{});function re(r,...e){for(let t=0;t<e.length;t++){const n=e[t];Object.keys(n).forEach(function(i){r[i]=n[i]})}return r}function _e(r){return Oe.decode(r).replace(/\n/g,"\u240a").replace(/\r/g,"\u240d")}function Le(r){const e=q.errorForCode(U.Timeout);let t,n;const i=new Promise((o,a)=>{t={cancel:()=>{n&&clearTimeout(n)}},n=setTimeout(()=>{a(e)},r)});return Object.assign(i,t)}function se(r=0){return new Promise(e=>{setTimeout(()=>{e()},r)})}function oe(){let r={};const e=new Promise((t,n)=>{r={resolve:t,reject:n}});return Object.assign(e,r)}function Be(r){for(let e=r.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[r[e],r[t]]=[r[t],r[e]]}return r}class He{buffers;byteLength;constructor(){this.buffers=[],this.byteLength=0}static concat(...e){let t=0;for(let o=0;o<e.length;o++)t+=e[o].length;const n=new Uint8Array(t);let i=0;for(let o=0;o<e.length;o++)n.set(e[o],i),i+=e[o].length;return n}static fromAscii(e){return e||(e=""),Re.encode(e)}static toAscii(e){return Oe.decode(e)}reset(){this.buffers.length=0,this.byteLength=0}pack(){if(this.buffers.length>1){const e=new Uint8Array(this.byteLength);let t=0;for(let n=0;n<this.buffers.length;n++)e.set(this.buffers[n],t),t+=this.buffers[n].length;this.buffers.length=0,this.buffers.push(e)}}shift(){if(this.buffers.length){const e=this.buffers.shift();if(e)return this.byteLength-=e.length,e}return new Uint8Array(0)}drain(e){if(this.buffers.length){this.pack();const t=this.buffers.pop();if(t){const n=this.byteLength;(void 0===e||e>n)&&(e=n);const i=t.subarray(0,e);return n>e&&this.buffers.push(t.subarray(e)),this.byteLength=n-e,i}}return new Uint8Array(0)}fill(e,...t){e&&(this.buffers.push(e),this.byteLength+=e.length);for(let n=0;n<t.length;n++)t[n]&&t[n].length&&(this.buffers.push(t[n]),this.byteLength+=t[n].length)}peek(){return this.buffers.length?(this.pack(),this.buffers[0]):new Uint8Array(0)}size(){return this.byteLength}length(){return this.buffers.length}}let Ae;function ut(){return void 0!==Ae&&void 0!==Ae.defaultPort?Ae.defaultPort:4222}function mt(){return void 0!==Ae&&Ae.urlParseFn?Ae.urlParseFn:void 0}function Nt(){return void 0!==Ae&&Ae.dnsResolveFn?Ae.dnsResolveFn:void 0}const vt=He.fromAscii("\r\n"),zt=new Uint8Array(vt)[0],$t=new Uint8Array(vt)[1];const ln=4,w=48,u=65,y=97;function C(r){return void 0!==function F(r){for(let e=0;e<r.length;e++)switch(r[e]){case".":return V(r);case":":return ee(r)}}(r)}function V(r){const e=new Uint8Array(4);for(let t=0;t<4;t++){if(0===r.length)return;if(t>0){if("."!==r[0])return;r=r.substring(1)}const{n,c:i,ok:o}=z(r);if(!o||n>255)return;r=r.substring(i),e[t]=n}return function b(r,e,t,n){const i=new Uint8Array(16);return[0,0,0,0,0,0,0,0,0,0,255,255].forEach((a,l)=>{i[l]=a}),i[12]=r,i[13]=e,i[14]=t,i[15]=n,i}(e[0],e[1],e[2],e[3])}function ee(r){const e=new Uint8Array(16);let t=-1;if(r.length>=2&&":"===r[0]&&":"===r[1]&&(t=0,0===(r=r.substring(2)).length))return e;let n=0;for(;n<16;){const{n:i,c:o,ok:a}=x(r);if(!a||i>65535)return;if(o<r.length&&"."===r[o]){if(t<0&&12!=n||n+4>16)return;const l=V(r);if(void 0===l)return;e[n]=l[12],e[n+1]=l[13],e[n+2]=l[14],e[n+3]=l[15],r="",n+=ln;break}if(e[n]=i>>8,e[n+1]=i,n+=2,0===(r=r.substring(o)).length)break;if(":"!==r[0]||1==r.length)return;if(":"===(r=r.substring(1))[0]){if(t>=0)return;if(t=n,0===(r=r.substring(1)).length)break}}if(0===r.length){if(n<16){if(t<0)return;const i=16-n;for(let o=n-1;o>=t;o--)e[o+i]=e[o];for(let o=t+i-1;o>=t;o--)e[o]=0}else if(t>=0)return;return e}}function z(r){let e=0,t=0;for(e=0;e<r.length&&48<=r.charCodeAt(e)&&r.charCodeAt(e)<=57;e++)if(t=10*t+(r.charCodeAt(e)-w),t>=16777215)return{n:16777215,c:e,ok:!1};return 0===e?{n:0,c:0,ok:!1}:{n:t,c:e,ok:!0}}function x(r){let e=0,t=0;for(t=0;t<r.length;t++){if(48<=r.charCodeAt(t)&&r.charCodeAt(t)<=57)e*=16,e+=r.charCodeAt(t)-w;else if(97<=r.charCodeAt(t)&&r.charCodeAt(t)<=102)e*=16,e+=r.charCodeAt(t)-y+10;else{if(!(65<=r.charCodeAt(t)&&r.charCodeAt(t)<=70))break;e*=16,e+=r.charCodeAt(t)-u+10}if(e>=16777215)return{n:0,c:t,ok:!1}}return 0===t?{n:0,c:t,ok:!1}:{n:e,c:t,ok:!0}}function f(r){return!function G(r){return-1!==r.indexOf(".")||-1===r.indexOf("[")&&-1===r.indexOf("::")&&r.split(":").length<=2}(r)}class D{src;listen;hostname;port;didConnect;reconnects;lastConnect;gossiped;tlsName;resolves;constructor(e,t=!1){this.src=e,this.tlsName="";const n=function O(r){(r=r.trim()).match(/^(.*:\/\/)(.*)/m)&&(r=r.replace(/^(.*:\/\/)(.*)/gm,"$2")),r=function k(r){const t=r.toUpperCase().indexOf("::FFFF:");if(-1!==t&&-1!==r.indexOf(".")){let n=r.substring(t+7);return n=n.replace("[",""),n.replace("]","")}return r}(r),f(r)&&-1===r.indexOf("[")&&(r=`[${r}]`);const e=f(r)?r.match(/(]:)(\d+)/):r.match(/(:)(\d+)/),t=e&&3===e.length&&e[1]&&e[2]?parseInt(e[2]):4222,i=new URL(`${80===t?"https":"http"}://${r}`);i.port=`${t}`;let o=i.hostname;return"["===o.charAt(0)&&(o=o.substring(1,o.length-1)),{listen:i.host,hostname:o,port:t}}(e);this.listen=n.listen,this.hostname=n.hostname,this.port=n.port,this.didConnect=!1,this.reconnects=0,this.lastConnect=0,this.gossiped=t}toString(){return this.listen}resolve(e){var t=this;return(0,m.Z)(function*(){if(!e.fn)return[t];const n=[];if(C(t.hostname))return[t];{const i=yield e.fn(t.hostname);e.debug&&console.log(`resolve ${t.hostname} = ${i.join(",")}`);for(const o of i){const l=new URL(`${80===t.port?"https":"http"}://${f(o)?"["+o+"]":o}`);l.port=`${t.port}`;const _=new D(l.host,!1);_.tlsName=t.hostname,n.push(_)}}return e.randomize&&Be(n),t.resolves=n,n})()}}class te{firstSelect;servers;currentServer;tlsName;randomize;constructor(e=[],t={}){this.firstSelect=!0,this.servers=[],this.tlsName="",this.randomize=t.randomize||!1;const n=mt();e&&(e.forEach(i=>{i=n?n(i):i,this.servers.push(new D(i))}),this.randomize&&(this.servers=Be(this.servers))),0===this.servers.length&&this.addServer(`${J}:${ut()}`,!1),this.currentServer=this.servers[0]}clear(){this.servers.length=0}updateTLSName(){const e=this.getCurrentServer();C(e.hostname)||(this.tlsName=e.hostname,this.servers.forEach(t=>{t.gossiped&&(t.tlsName=this.tlsName)}))}getCurrentServer(){return this.currentServer}addServer(e,t=!1){const n=mt();e=n?n(e):e;const i=new D(e,t);C(i.hostname)&&(i.tlsName=this.tlsName),this.servers.push(i)}selectServer(){if(this.firstSelect)return this.firstSelect=!1,this.currentServer;const e=this.servers.shift();return e&&(this.servers.push(e),this.currentServer=e),e}removeCurrentServer(){this.removeServer(this.currentServer)}removeServer(e){if(e){const t=this.servers.indexOf(e);this.servers.splice(t,1)}}length(){return this.servers.length}next(){return this.servers.length?this.servers[0]:void 0}getServers(){return this.servers}update(e){const t=[];let n=[];const i=mt(),o=new Map;e.connect_urls&&e.connect_urls.length>0&&e.connect_urls.forEach(l=>{l=i?i(l):l;const _=new D(l,!0);o.set(l,_)});const a=[];return this.servers.forEach((l,_)=>{const v=l.listen;l.gossiped&&this.currentServer.listen!==v&&void 0===o.get(v)&&a.push(_),o.delete(v)}),a.reverse(),a.forEach(l=>{const _=this.servers.splice(l,1);n=n.concat(_[0].listen)}),o.forEach((l,_)=>{this.servers.push(l),t.push(_)}),{added:t,deleted:n}}}class he{inflight;processed;received;noIterator;iterClosed;done;signal;yields;filtered;pendingFiltered;ingestionFilterFn;protocolFilterFn;dispatchedFn;ctx;_data;err;time;constructor(){this.inflight=0,this.filtered=0,this.pendingFiltered=0,this.processed=0,this.received=0,this.noIterator=!1,this.done=!1,this.signal=oe(),this.yields=[],this.iterClosed=oe(),this.time=0}[Symbol.asyncIterator](){return this.iterate()}push(e){if(this.done)return;if("function"==typeof e)return this.yields.push(e),void this.signal.resolve();const{ingest:t,protocol:n}=this.ingestionFilterFn?this.ingestionFilterFn(e,this.ctx||this):{ingest:!0,protocol:!1};t&&(n&&(this.filtered++,this.pendingFiltered++),this.yields.push(e),this.signal.resolve())}iterate(){var e=this;return Me(function*(){if(e.noIterator)throw new q("unsupported iterator",U.ApiError);try{for(;;){if(0===e.yields.length&&(yield me(e.signal)),e.err)throw e.err;const t=e.yields;e.inflight=t.length,e.yields=[];for(let n=0;n<t.length;n++)if("function"!=typeof t[n]){if(!e.protocolFilterFn||e.protocolFilterFn(t[n])){e.processed++;const o=Date.now();yield t[n],e.time=Date.now()-o,e.dispatchedFn&&t[n]&&e.dispatchedFn(t[n])}else e.pendingFiltered--;e.inflight--}else{const o=t[n];try{o()}catch(a){throw a}if(e.err)throw e.err}if(e.done)break;0===e.yields.length&&(t.length=0,e.yields=t,e.signal=oe())}}finally{e.stop()}})()}stop(e){this.done||(this.err=e,this.done=!0,this.signal.resolve(),this.iterClosed.resolve())}getProcessed(){return this.noIterator?this.received:this.processed}getPending(){return this.yields.length+this.inflight-this.pendingFiltered}getReceived(){return this.received-this.filtered}}function Xe(r){let n=!0;const i=new Array(r.length);for(let o=0;o<r.length;o++){let a=r.charCodeAt(o);if(58===a||a<33||a>126)throw new q(`'${r[o]}' is not a valid character for a header key`,U.BadHeader);n&&97<=a&&a<=122?a-=32:!n&&65<=a&&a<=90&&(a+=32),i[o]=a,n=45==a}return String.fromCharCode(...i)}function je(r=0,e=""){if(0===r&&""!==e||r>0&&""===e)throw new Error("setting status requires both code and description");return new Ue(r,e)}const at="NATS/1.0";class Ue{_code;headers;_description;constructor(e=0,t=""){this._code=e,this._description=t,this.headers=new Map}[Symbol.iterator](){return this.headers.entries()}size(){return this.headers.size}equals(e){if(e&&this.headers.size===e.headers.size&&this._code===e._code){for(const[t,n]of this.headers){const i=e.values(t);if(n.length!==i.length)return!1;const o=[...n].sort(),a=[...i].sort();for(let l=0;l<o.length;l++)if(o[l]!==a[l])return!1}return!0}return!1}static decode(e){const t=new Ue,i=Oe.decode(e).split("\r\n"),o=i[0];if(o!==at){let a=o.replace(at,"").trim();if(a.length>0){t._code=parseInt(a,10),isNaN(t._code)&&(t._code=0);const l=t._code.toString();a=a.replace(l,""),t._description=a.trim()}}return i.length>=1&&i.slice(1).map(a=>{if(a){const l=a.indexOf(":");if(l>-1){const _=a.slice(0,l),v=a.slice(l+1).trim();t.append(_,v)}}}),t}toString(){if(0===this.headers.size&&0===this._code)return"";let e=at;this._code>0&&""!==this._description&&(e+=` ${this._code} ${this._description}`);for(const[t,n]of this.headers)for(let i=0;i<n.length;i++)e=`${e}\r\n${t}: ${n[i]}`;return`${e}\r\n\r\n`}encode(){return Re.encode(this.toString())}static validHeaderValue(e){if(/[\r\n]/.test(e))throw new q("invalid header value - \\r and \\n are not allowed.",U.BadHeader);return e.trim()}keys(){const e=[];for(const t of this.headers.keys())e.push(t);return e}findKeys(e,t=fe.Exact){const n=this.keys();switch(t){case fe.Exact:return n.filter(i=>i===e);case fe.CanonicalMIME:return e=Xe(e),n.filter(i=>i===e);default:{const i=e.toLowerCase();return n.filter(o=>i===o.toLowerCase())}}}get(e,t=fe.Exact){const n=this.findKeys(e,t);if(n.length){const i=this.headers.get(n[0]);if(i)return Array.isArray(i)?i[0]:i}return""}has(e,t=fe.Exact){return this.findKeys(e,t).length>0}set(e,t,n=fe.Exact){this.delete(e,n),this.append(e,t,n)}append(e,t,n=fe.Exact){const i=Xe(e);n===fe.CanonicalMIME&&(e=i);const o=this.findKeys(e,n);e=o.length>0?o[0]:e;const a=Ue.validHeaderValue(t);let l=this.headers.get(e);l||(l=[],this.headers.set(e,l)),l.push(a)}values(e,t=fe.Exact){const n=[];return this.findKeys(e,t).forEach(o=>{const a=this.headers.get(o);a&&n.push(...a)}),n}delete(e,t=fe.Exact){this.findKeys(e,t).forEach(i=>{this.headers.delete(i)})}get hasError(){return this._code>=300}get status(){return`${this._code} ${this._description}`.trim()}toRecord(){const e={};return this.keys().forEach(t=>{e[t]=this.values(t)}),e}get code(){return this._code}get description(){return this._description}static fromRecord(e){const t=new Ue;for(const n in e)t.headers.set(n,e[n]);return t}}function Qe(r){return{encode(e){try{return void 0===e&&(e=null),Re.encode(JSON.stringify(e))}catch(t){throw q.errorForCode(U.BadJson,t)}},decode(e){try{return JSON.parse(Oe.decode(e),r)}catch(t){throw q.errorForCode(U.BadJson,t)}}}}function kn(r){return r&&0===r.data.length&&503===r.headers?.code?q.errorForCode(U.NoResponders):null}let Nr=(()=>class r{_headers;_msg;_rdata;_reply;_subject;publisher;static jc;constructor(t,n,i){this._msg=t,this._rdata=n,this.publisher=i}get subject(){return this._subject||(this._subject=Oe.decode(this._msg.subject)),this._subject}get reply(){return this._reply||(this._reply=Oe.decode(this._msg.reply)),this._reply}get sid(){return this._msg.sid}get headers(){if(this._msg.hdr>-1&&!this._headers){const t=this._rdata.subarray(0,this._msg.hdr);this._headers=Ue.decode(t)}return this._headers}get data(){return this._rdata?this._msg.hdr>-1?this._rdata.subarray(this._msg.hdr):this._rdata:new Uint8Array(0)}respond(t=pe,n){return!!this.reply&&(this.publisher.publish(this.reply,t,n),!0)}size(){return this._msg.subject.length+(this._msg.reply?.length||0)+(-1===this._msg.size?0:this._msg.size)}json(t){return Qe(t).decode(this.data)}string(){return Oe.decode(this.data)}})();class Ii{baseInbox;reqs;constructor(){this.reqs=new Map}size(){return this.reqs.size}init(e){return this.baseInbox=`${T(e)}.`,this.baseInbox}add(e){isNaN(e.received)||(e.received=0),this.reqs.set(e.token,e)}get(e){return this.reqs.get(e)}cancel(e){this.reqs.delete(e.token)}getToken(e){const t=e.subject||"";return 0===t.indexOf(this.baseInbox)?t.substring(this.baseInbox.length):null}all(){return Array.from(this.reqs.values())}handleError(e,t){if(t&&t.permissionContext){if(e)return this.all().forEach(i=>{i.resolver(t,{})}),!0;const n=t.permissionContext;if("publish"===n.operation){const i=this.all().find(o=>o.requestSubject===n.subject);if(i)return i.resolver(t,{}),!0}}return!1}dispatcher(){return(e,t)=>{const n=this.getToken(t);if(n){const i=this.get(n);i&&(null===e&&t.headers&&(e=kn(t)),i.resolver(e,t))}}}close(){const e=q.errorForCode(U.Timeout);this.reqs.forEach(t=>{t.resolver(e,{})})}}class ji{ph;interval;maxOut;timer;pendings;constructor(e,t,n){this.ph=e,this.interval=t,this.maxOut=n,this.pendings=[]}start(){this.cancel(),this._schedule()}cancel(e){this.timer&&(clearTimeout(this.timer),this.timer=void 0),this._reset(),e&&this.ph.disconnect()}_schedule(){this.timer=setTimeout(()=>{if(this.ph.dispatchStatus({type:pt.PingTimer,data:`${this.pendings.length+1}`}),this.pendings.length===this.maxOut)return void this.cancel(!0);const e=oe();this.ph.flush(e).then(()=>{this._reset()}).catch(()=>{this.cancel()}),this.pendings.push(e),this._schedule()},this.interval)}_reset(){this.pendings=this.pendings.filter(e=>(e.resolve(),!1))}}class Ti extends Error{constructor(e){super(e),this.name="AssertionError"}}const Qn=2**32-2;function Mn(r,e,t=0){const n=e.byteLength-t;return r.byteLength>n&&(r=r.subarray(0,n)),e.set(r,t),r.byteLength}class er{_buf;_off;constructor(e){this._off=0,this._buf=null!=e?new Uint8Array(e):new Uint8Array(0)}bytes(e={copy:!0}){return!1===e.copy?this._buf.subarray(this._off):this._buf.slice(this._off)}empty(){return this._buf.byteLength<=this._off}get length(){return this._buf.byteLength-this._off}get capacity(){return this._buf.buffer.byteLength}truncate(e){if(0!==e){if(e<0||e>this.length)throw Error("bytes.Buffer: truncation out of range");this._reslice(this._off+e)}else this.reset()}reset(){this._reslice(0),this._off=0}_tryGrowByReslice(e){const t=this._buf.byteLength;return e<=this.capacity-t?(this._reslice(t+e),t):-1}_reslice(e){(function Ni(r,e="Assertion failed."){if(!r)throw new Ti(e)})(e<=this._buf.buffer.byteLength),this._buf=new Uint8Array(this._buf.buffer,0,e)}readByte(){const e=new Uint8Array(1);return this.read(e)?e[0]:null}read(e){if(this.empty())return this.reset(),0===e.byteLength?0:null;const t=Mn(this._buf.subarray(this._off),e);return this._off+=t,t}writeByte(e){return this.write(Uint8Array.of(e))}writeString(e){return this.write(Re.encode(e))}write(e){const t=this._grow(e.byteLength);return Mn(e,this._buf,t)}_grow(e){const t=this.length;0===t&&0!==this._off&&this.reset();const n=this._tryGrowByReslice(e);if(n>=0)return n;const i=this.capacity;if(e<=Math.floor(i/2)-t)Mn(this._buf.subarray(this._off),this._buf);else{if(i+e>Qn)throw new Error("The buffer cannot be grown beyond the maximum size.");{const o=new Uint8Array(Math.min(2*i+e,Qn));Mn(this._buf.subarray(this._off),o),this._buf=o}}return this._off=0,this._reslice(Math.min(t+e,Qn)),t}grow(e){if(e<0)throw Error("Buffer._grow: negative count");const t=this._grow(e);this._reslice(t)}readFrom(e){let t=0;const n=new Uint8Array(32768);for(;;){const i=this.capacity-this.length<32768,o=i?n:new Uint8Array(this._buf.buffer,this.length),a=e.read(o);if(null===a)return t;i?this.write(o.subarray(0,a)):this._reslice(this.length+a),t+=a}}}var ht=function(r){return r[r.OK=0]="OK",r[r.ERR=1]="ERR",r[r.MSG=2]="MSG",r[r.INFO=3]="INFO",r[r.PING=4]="PING",r[r.PONG=5]="PONG",r}(ht||{});class Ur{dispatcher;state;as;drop;hdr;ma;argBuf;msgBuf;constructor(e){this.dispatcher=e,this.state=X.OP_START,this.as=0,this.drop=0,this.hdr=0}parse(e){let t;for(t=0;t<e.length;t++){const n=e[t];switch(this.state){case X.OP_START:switch(n){case Q.M:case Q.m:this.state=X.OP_M,this.hdr=-1,this.ma={sid:-1,hdr:-1,size:-1};break;case Q.H:case Q.h:this.state=X.OP_H,this.hdr=0,this.ma={sid:-1,hdr:-1,size:-1};break;case Q.P:case Q.p:this.state=X.OP_P;break;case Q.PLUS:this.state=X.OP_PLUS;break;case Q.MINUS:this.state=X.OP_MINUS;break;case Q.I:case Q.i:this.state=X.OP_I;break;default:throw this.fail(e.subarray(t))}break;case X.OP_H:switch(n){case Q.M:case Q.m:this.state=X.OP_M;break;default:throw this.fail(e.subarray(t))}break;case X.OP_M:switch(n){case Q.S:case Q.s:this.state=X.OP_MS;break;default:throw this.fail(e.subarray(t))}break;case X.OP_MS:switch(n){case Q.G:case Q.g:this.state=X.OP_MSG;break;default:throw this.fail(e.subarray(t))}break;case X.OP_MSG:switch(n){case Q.SPACE:case Q.TAB:this.state=X.OP_MSG_SPC;break;default:throw this.fail(e.subarray(t))}break;case X.OP_MSG_SPC:switch(n){case Q.SPACE:case Q.TAB:continue;default:this.state=X.MSG_ARG,this.as=t}break;case X.MSG_ARG:switch(n){case Q.CR:this.drop=1;break;case Q.NL:{const i=this.argBuf?this.argBuf.bytes():e.subarray(this.as,t-this.drop);this.processMsgArgs(i),this.drop=0,this.as=t+1,this.state=X.MSG_PAYLOAD,t=this.as+this.ma.size-1;break}default:this.argBuf&&this.argBuf.writeByte(n)}break;case X.MSG_PAYLOAD:if(this.msgBuf)if(this.msgBuf.length>=this.ma.size){const i=this.msgBuf.bytes({copy:!1});this.dispatcher.push({kind:ht.MSG,msg:this.ma,data:i}),this.argBuf=void 0,this.msgBuf=void 0,this.state=X.MSG_END}else{let i=this.ma.size-this.msgBuf.length;const o=e.length-t;o<i&&(i=o),i>0?(this.msgBuf.write(e.subarray(t,t+i)),t=t+i-1):this.msgBuf.writeByte(n)}else t-this.as>=this.ma.size&&(this.dispatcher.push({kind:ht.MSG,msg:this.ma,data:e.subarray(this.as,t)}),this.argBuf=void 0,this.msgBuf=void 0,this.state=X.MSG_END);break;case X.MSG_END:if(n!==Q.NL)continue;this.drop=0,this.as=t+1,this.state=X.OP_START;break;case X.OP_PLUS:switch(n){case Q.O:case Q.o:this.state=X.OP_PLUS_O;break;default:throw this.fail(e.subarray(t))}break;case X.OP_PLUS_O:switch(n){case Q.K:case Q.k:this.state=X.OP_PLUS_OK;break;default:throw this.fail(e.subarray(t))}break;case X.OP_PLUS_OK:n===Q.NL&&(this.dispatcher.push({kind:ht.OK}),this.drop=0,this.state=X.OP_START);break;case X.OP_MINUS:switch(n){case Q.E:case Q.e:this.state=X.OP_MINUS_E;break;default:throw this.fail(e.subarray(t))}break;case X.OP_MINUS_E:switch(n){case Q.R:case Q.r:this.state=X.OP_MINUS_ER;break;default:throw this.fail(e.subarray(t))}break;case X.OP_MINUS_ER:switch(n){case Q.R:case Q.r:this.state=X.OP_MINUS_ERR;break;default:throw this.fail(e.subarray(t))}break;case X.OP_MINUS_ERR:switch(n){case Q.SPACE:case Q.TAB:this.state=X.OP_MINUS_ERR_SPC;break;default:throw this.fail(e.subarray(t))}break;case X.OP_MINUS_ERR_SPC:switch(n){case Q.SPACE:case Q.TAB:continue;default:this.state=X.MINUS_ERR_ARG,this.as=t}break;case X.MINUS_ERR_ARG:switch(n){case Q.CR:this.drop=1;break;case Q.NL:{let i;this.argBuf?(i=this.argBuf.bytes(),this.argBuf=void 0):i=e.subarray(this.as,t-this.drop),this.dispatcher.push({kind:ht.ERR,data:i}),this.drop=0,this.as=t+1,this.state=X.OP_START;break}default:this.argBuf&&this.argBuf.write(Uint8Array.of(n))}break;case X.OP_P:switch(n){case Q.I:case Q.i:this.state=X.OP_PI;break;case Q.O:case Q.o:this.state=X.OP_PO;break;default:throw this.fail(e.subarray(t))}break;case X.OP_PO:switch(n){case Q.N:case Q.n:this.state=X.OP_PON;break;default:throw this.fail(e.subarray(t))}break;case X.OP_PON:switch(n){case Q.G:case Q.g:this.state=X.OP_PONG;break;default:throw this.fail(e.subarray(t))}break;case X.OP_PONG:n===Q.NL&&(this.dispatcher.push({kind:ht.PONG}),this.drop=0,this.state=X.OP_START);break;case X.OP_PI:switch(n){case Q.N:case Q.n:this.state=X.OP_PIN;break;default:throw this.fail(e.subarray(t))}break;case X.OP_PIN:switch(n){case Q.G:case Q.g:this.state=X.OP_PING;break;default:throw this.fail(e.subarray(t))}break;case X.OP_PING:n===Q.NL&&(this.dispatcher.push({kind:ht.PING}),this.drop=0,this.state=X.OP_START);break;case X.OP_I:switch(n){case Q.N:case Q.n:this.state=X.OP_IN;break;default:throw this.fail(e.subarray(t))}break;case X.OP_IN:switch(n){case Q.F:case Q.f:this.state=X.OP_INF;break;default:throw this.fail(e.subarray(t))}break;case X.OP_INF:switch(n){case Q.O:case Q.o:this.state=X.OP_INFO;break;default:throw this.fail(e.subarray(t))}break;case X.OP_INFO:switch(n){case Q.SPACE:case Q.TAB:this.state=X.OP_INFO_SPC;break;default:throw this.fail(e.subarray(t))}break;case X.OP_INFO_SPC:switch(n){case Q.SPACE:case Q.TAB:continue;default:this.state=X.INFO_ARG,this.as=t}break;case X.INFO_ARG:switch(n){case Q.CR:this.drop=1;break;case Q.NL:{let i;this.argBuf?(i=this.argBuf.bytes(),this.argBuf=void 0):i=e.subarray(this.as,t-this.drop),this.dispatcher.push({kind:ht.INFO,data:i}),this.drop=0,this.as=t+1,this.state=X.OP_START;break}default:this.argBuf&&this.argBuf.writeByte(n)}break;default:throw this.fail(e.subarray(t))}}(this.state===X.MSG_ARG||this.state===X.MINUS_ERR_ARG||this.state===X.INFO_ARG)&&!this.argBuf&&(this.argBuf=new er(e.subarray(this.as,t-this.drop))),this.state===X.MSG_PAYLOAD&&!this.msgBuf&&(this.argBuf||this.cloneMsgArg(),this.msgBuf=new er(e.subarray(this.as)))}cloneMsgArg(){const e=this.ma.subject.length,n=new Uint8Array(e+(this.ma.reply?this.ma.reply.length:0));n.set(this.ma.subject),this.ma.reply&&n.set(this.ma.reply,e),this.argBuf=new er(n),this.ma.subject=n.subarray(0,e),this.ma.reply&&(this.ma.reply=n.subarray(e))}processMsgArgs(e){if(this.hdr>=0)return this.processHeaderMsgArgs(e);const t=[];let n=-1;for(let i=0;i<e.length;i++)switch(e[i]){case Q.SPACE:case Q.TAB:case Q.CR:case Q.NL:n>=0&&(t.push(e.subarray(n,i)),n=-1);break;default:n<0&&(n=i)}switch(n>=0&&t.push(e.subarray(n)),t.length){case 3:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=void 0,this.ma.size=this.protoParseInt(t[2]);break;case 4:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=t[2],this.ma.size=this.protoParseInt(t[3]);break;default:throw this.fail(e,"processMsgArgs Parse Error")}if(this.ma.sid<0)throw this.fail(e,"processMsgArgs Bad or Missing Sid Error");if(this.ma.size<0)throw this.fail(e,"processMsgArgs Bad or Missing Size Error")}fail(e,t=""){return t=t?`${t} [${this.state}]`:`parse error [${this.state}]`,new Error(`${t}: ${Oe.decode(e)}`)}processHeaderMsgArgs(e){const t=[];let n=-1;for(let i=0;i<e.length;i++)switch(e[i]){case Q.SPACE:case Q.TAB:case Q.CR:case Q.NL:n>=0&&(t.push(e.subarray(n,i)),n=-1);break;default:n<0&&(n=i)}switch(n>=0&&t.push(e.subarray(n)),t.length){case 4:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=void 0,this.ma.hdr=this.protoParseInt(t[2]),this.ma.size=this.protoParseInt(t[3]);break;case 5:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=t[2],this.ma.hdr=this.protoParseInt(t[3]),this.ma.size=this.protoParseInt(t[4]);break;default:throw this.fail(e,"processHeaderMsgArgs Parse Error")}if(this.ma.sid<0)throw this.fail(e,"processHeaderMsgArgs Bad or Missing Sid Error");if(this.ma.hdr<0||this.ma.hdr>this.ma.size)throw this.fail(e,"processHeaderMsgArgs Bad or Missing Header Size Error");if(this.ma.size<0)throw this.fail(e,"processHeaderMsgArgs Bad or Missing Size Error")}protoParseInt(e){if(0===e.length)return-1;let t=0;for(let n=0;n<e.length;n++){if(e[n]<48||e[n]>57)return-1;t=10*t+(e[n]-48)}return t}}var X=function(r){return r[r.OP_START=0]="OP_START",r[r.OP_PLUS=1]="OP_PLUS",r[r.OP_PLUS_O=2]="OP_PLUS_O",r[r.OP_PLUS_OK=3]="OP_PLUS_OK",r[r.OP_MINUS=4]="OP_MINUS",r[r.OP_MINUS_E=5]="OP_MINUS_E",r[r.OP_MINUS_ER=6]="OP_MINUS_ER",r[r.OP_MINUS_ERR=7]="OP_MINUS_ERR",r[r.OP_MINUS_ERR_SPC=8]="OP_MINUS_ERR_SPC",r[r.MINUS_ERR_ARG=9]="MINUS_ERR_ARG",r[r.OP_M=10]="OP_M",r[r.OP_MS=11]="OP_MS",r[r.OP_MSG=12]="OP_MSG",r[r.OP_MSG_SPC=13]="OP_MSG_SPC",r[r.MSG_ARG=14]="MSG_ARG",r[r.MSG_PAYLOAD=15]="MSG_PAYLOAD",r[r.MSG_END=16]="MSG_END",r[r.OP_H=17]="OP_H",r[r.OP_P=18]="OP_P",r[r.OP_PI=19]="OP_PI",r[r.OP_PIN=20]="OP_PIN",r[r.OP_PING=21]="OP_PING",r[r.OP_PO=22]="OP_PO",r[r.OP_PON=23]="OP_PON",r[r.OP_PONG=24]="OP_PONG",r[r.OP_I=25]="OP_I",r[r.OP_IN=26]="OP_IN",r[r.OP_INF=27]="OP_INF",r[r.OP_INFO=28]="OP_INFO",r[r.OP_INFO_SPC=29]="OP_INFO_SPC",r[r.INFO_ARG=30]="INFO_ARG",r}(X||{}),Q=function(r){return r[r.CR="\r".charCodeAt(0)]="CR",r[r.E="E".charCodeAt(0)]="E",r[r.e="e".charCodeAt(0)]="e",r[r.F="F".charCodeAt(0)]="F",r[r.f="f".charCodeAt(0)]="f",r[r.G="G".charCodeAt(0)]="G",r[r.g="g".charCodeAt(0)]="g",r[r.H="H".charCodeAt(0)]="H",r[r.h="h".charCodeAt(0)]="h",r[r.I="I".charCodeAt(0)]="I",r[r.i="i".charCodeAt(0)]="i",r[r.K="K".charCodeAt(0)]="K",r[r.k="k".charCodeAt(0)]="k",r[r.M="M".charCodeAt(0)]="M",r[r.m="m".charCodeAt(0)]="m",r[r.MINUS="-".charCodeAt(0)]="MINUS",r[r.N="N".charCodeAt(0)]="N",r[r.n="n".charCodeAt(0)]="n",r[r.NL="\n".charCodeAt(0)]="NL",r[r.O="O".charCodeAt(0)]="O",r[r.o="o".charCodeAt(0)]="o",r[r.P="P".charCodeAt(0)]="P",r[r.p="p".charCodeAt(0)]="p",r[r.PLUS="+".charCodeAt(0)]="PLUS",r[r.R="R".charCodeAt(0)]="R",r[r.r="r".charCodeAt(0)]="r",r[r.S="S".charCodeAt(0)]="S",r[r.s="s".charCodeAt(0)]="s",r[r.SPACE=" ".charCodeAt(0)]="SPACE",r[r.TAB="\t".charCodeAt(0)]="TAB",r}(Q||{});function Dt(r=""){const e=r.match(/(\d+).(\d+).(\d+)/);if(e)return{major:parseInt(e[1]),minor:parseInt(e[2]),micro:parseInt(e[3])};throw new Error(`'${r}' is not a semver value`)}function tr(r,e){return r.major<e.major?-1:r.major>e.major?1:r.minor<e.minor?-1:r.minor>e.minor?1:r.micro<e.micro?-1:r.micro>e.micro?1:0}var Ce=function(r){return r.JS_KV="js_kv",r.JS_OBJECTSTORE="js_objectstore",r.JS_PULL_MAX_BYTES="js_pull_max_bytes",r.JS_NEW_CONSUMER_CREATE_API="js_new_consumer_create",r.JS_ALLOW_DIRECT="js_allow_direct",r.JS_MULTIPLE_CONSUMER_FILTER="js_multiple_consumer_filter",r.JS_SIMPLIFICATION="js_simplification",r.JS_STREAM_CONSUMER_METADATA="js_stream_consumer_metadata",r.JS_CONSUMER_FILTER_SUBJECTS="js_consumer_filter_subjects",r.JS_STREAM_FIRST_SEQ="js_stream_first_seq",r.JS_STREAM_SUBJECT_TRANSFORM="js_stream_subject_transform",r.JS_STREAM_SOURCE_SUBJECT_TRANSFORM="js_stream_source_subject_transform",r.JS_STREAM_COMPRESSION="js_stream_compression",r.JS_DEFAULT_CONSUMER_LIMITS="js_default_consumer_limits",r}(Ce||{});class Ri{server;features;disabled;constructor(e){this.features=new Map,this.disabled=[],this.update(e)}resetDisabled(){this.disabled.length=0,this.update(this.server)}disable(e){this.disabled.push(e),this.update(this.server)}isDisabled(e){return-1!==this.disabled.indexOf(e)}update(e){"string"==typeof e&&(e=Dt(e)),this.server=e,this.set(Ce.JS_KV,"2.6.2"),this.set(Ce.JS_OBJECTSTORE,"2.6.3"),this.set(Ce.JS_PULL_MAX_BYTES,"2.8.3"),this.set(Ce.JS_NEW_CONSUMER_CREATE_API,"2.9.0"),this.set(Ce.JS_ALLOW_DIRECT,"2.9.0"),this.set(Ce.JS_MULTIPLE_CONSUMER_FILTER,"2.10.0"),this.set(Ce.JS_SIMPLIFICATION,"2.9.4"),this.set(Ce.JS_STREAM_CONSUMER_METADATA,"2.10.0"),this.set(Ce.JS_CONSUMER_FILTER_SUBJECTS,"2.10.0"),this.set(Ce.JS_STREAM_FIRST_SEQ,"2.10.0"),this.set(Ce.JS_STREAM_SUBJECT_TRANSFORM,"2.10.0"),this.set(Ce.JS_STREAM_SOURCE_SUBJECT_TRANSFORM,"2.10.0"),this.set(Ce.JS_STREAM_COMPRESSION,"2.10.0"),this.set(Ce.JS_DEFAULT_CONSUMER_LIMITS,"2.10.0"),this.disabled.forEach(t=>{this.features.delete(t)})}set(e,t){this.features.set(e,{min:t,ok:tr(this.server,Dt(t))>=0})}get(e){return this.features.get(e)||{min:"unknown",ok:!1}}supports(e){return this.get(e)?.ok||!1}require(e){return"string"==typeof e&&(e=Dt(e)),tr(this.server,e)>=0}}!function(r){"use strict";var e=function(c,p){this.hi=0|c,this.lo=0|p},t=function(c){var p,h=new Float64Array(16);if(c)for(p=0;p<c.length;p++)h[p]=c[p];return h},n=function(){throw new Error("no PRNG")},i=new Uint8Array(16),o=new Uint8Array(32);o[0]=9;var a=t(),l=t([1]),_=t([56129,1]),v=t([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),A=t([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),E=t([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),N=t([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),R=t([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function $(c,p){return c<<p|c>>>32-p}function Z(c,p){var h=255&c[p+3];return(h=(h=h<<8|255&c[p+2])<<8|255&c[p+1])<<8|255&c[p+0]}function Ee(c,p){return new e(c[p]<<24|c[p+1]<<16|c[p+2]<<8|c[p+3],c[p+4]<<24|c[p+5]<<16|c[p+6]<<8|c[p+7])}function de(c,p,h){var g;for(g=0;g<4;g++)c[p+g]=255&h,h>>>=8}function et(c,p,h){c[p]=h.hi>>24&255,c[p+1]=h.hi>>16&255,c[p+2]=h.hi>>8&255,c[p+3]=255&h.hi,c[p+4]=h.lo>>24&255,c[p+5]=h.lo>>16&255,c[p+6]=h.lo>>8&255,c[p+7]=255&h.lo}function tt(c,p,h,g,S){var P,B=0;for(P=0;P<S;P++)B|=c[p+P]^h[g+P];return(1&B-1>>>8)-1}function wt(c,p,h,g){return tt(c,p,h,g,16)}function Ut(c,p,h,g){return tt(c,p,h,g,32)}function Xt(c,p,h,g,S){var L,ie,ye,P=new Uint32Array(16),B=new Uint32Array(16),H=new Uint32Array(16),M=new Uint32Array(4);for(L=0;L<4;L++)B[5*L]=Z(g,4*L),B[1+L]=Z(h,4*L),B[6+L]=Z(p,4*L),B[11+L]=Z(h,16+4*L);for(L=0;L<16;L++)H[L]=B[L];for(L=0;L<20;L++){for(ie=0;ie<4;ie++){for(ye=0;ye<4;ye++)M[ye]=B[(5*ie+4*ye)%16];for(M[1]^=$(M[0]+M[3]|0,7),M[2]^=$(M[1]+M[0]|0,9),M[3]^=$(M[2]+M[1]|0,13),M[0]^=$(M[3]+M[2]|0,18),ye=0;ye<4;ye++)P[4*ie+(ie+ye)%4]=M[ye]}for(ye=0;ye<16;ye++)B[ye]=P[ye]}if(S){for(L=0;L<16;L++)B[L]=B[L]+H[L]|0;for(L=0;L<4;L++)B[5*L]=B[5*L]-Z(g,4*L)|0,B[6+L]=B[6+L]-Z(p,4*L)|0;for(L=0;L<4;L++)de(c,4*L,B[5*L]),de(c,16+4*L,B[6+L])}else for(L=0;L<16;L++)de(c,4*L,B[L]+H[L]|0)}function qn(c,p,h,g){return Xt(c,p,h,g,!1),0}function qt(c,p,h,g){return Xt(c,p,h,g,!0),0}var St=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);function Qt(c,p,h,g,S,P,B){var L,ie,H=new Uint8Array(16),M=new Uint8Array(64);if(!S)return 0;for(ie=0;ie<16;ie++)H[ie]=0;for(ie=0;ie<8;ie++)H[ie]=P[ie];for(;S>=64;){for(qn(M,H,B,St),ie=0;ie<64;ie++)c[p+ie]=(h?h[g+ie]:0)^M[ie];for(L=1,ie=8;ie<16;ie++)H[ie]=255&(L=L+(255&H[ie])|0),L>>>=8;S-=64,p+=64,h&&(g+=64)}if(S>0)for(qn(M,H,B,St),ie=0;ie<S;ie++)c[p+ie]=(h?h[g+ie]:0)^M[ie];return 0}function Vn(c,p,h,g,S){return Qt(c,p,null,0,h,g,S)}function en(c,p,h,g,S){var P=new Uint8Array(32);return qt(P,g,S,St),Vn(c,p,h,g.subarray(16),P)}function wn(c,p,h,g,S,P,B){var H=new Uint8Array(32);return qt(H,P,B,St),Qt(c,p,h,g,S,P.subarray(16),H)}function Lt(c,p){var h,g=0;for(h=0;h<17;h++)c[h]=255&(g=g+(c[h]+p[h]|0)|0),g>>>=8}var Co=new Uint32Array([5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,252]);function xr(c,p,h,g,S,P){var B,H,M,L,ie=new Uint32Array(17),ye=new Uint32Array(17),De=new Uint32Array(17),Pt=new Uint32Array(17),on=new Uint32Array(17);for(M=0;M<17;M++)ye[M]=De[M]=0;for(M=0;M<16;M++)ye[M]=P[M];for(ye[3]&=15,ye[4]&=252,ye[7]&=15,ye[8]&=252,ye[11]&=15,ye[12]&=252,ye[15]&=15;S>0;){for(M=0;M<17;M++)Pt[M]=0;for(M=0;M<16&&M<S;++M)Pt[M]=h[g+M];for(Pt[M]=1,g+=M,S-=M,Lt(De,Pt),H=0;H<17;H++)for(ie[H]=0,M=0;M<17;M++)ie[H]=0|ie[H]+De[M]*(M<=H?ye[H-M]:320*ye[H+17-M]|0);for(H=0;H<17;H++)De[H]=ie[H];for(L=0,M=0;M<16;M++)De[M]=255&(L=L+De[M]|0),L>>>=8;for(De[16]=3&(L=L+De[16]|0),L=5*(L>>>2)|0,M=0;M<16;M++)De[M]=255&(L=L+De[M]|0),L>>>=8;De[16]=L=L+De[16]|0}for(M=0;M<17;M++)on[M]=De[M];for(Lt(De,Co),B=0|-(De[16]>>>7),M=0;M<17;M++)De[M]^=B&(on[M]^De[M]);for(M=0;M<16;M++)Pt[M]=P[M+16];for(Pt[16]=0,Lt(De,Pt),M=0;M<16;M++)c[p+M]=De[M];return 0}function _i(c,p,h,g,S,P){var B=new Uint8Array(16);return xr(B,0,h,g,S,P),wt(c,p,B,0)}function vr(c,p,h,g,S){var P;if(h<32)return-1;for(wn(c,0,p,0,h,g,S),xr(c,16,c,32,h-32,c),P=0;P<16;P++)c[P]=0;return 0}function wr(c,p,h,g,S){var P,B=new Uint8Array(32);if(h<32||(en(B,0,32,g,S),0!==_i(p,16,p,32,h-32,B)))return-1;for(wn(c,0,p,0,h,g,S),P=0;P<32;P++)c[P]=0;return 0}function jt(c,p){var h;for(h=0;h<16;h++)c[h]=0|p[h]}function Sn(c){var p,h;for(h=0;h<16;h++)c[h]+=65536,p=Math.floor(c[h]/65536),c[(h+1)*(h<15?1:0)]+=p-1+37*(p-1)*(15===h?1:0),c[h]-=65536*p}function tn(c,p,h){for(var g,S=~(h-1),P=0;P<16;P++)c[P]^=g=S&(c[P]^p[P]),p[P]^=g}function nn(c,p){var h,g,S,P=t(),B=t();for(h=0;h<16;h++)B[h]=p[h];for(Sn(B),Sn(B),Sn(B),g=0;g<2;g++){for(P[0]=B[0]-65517,h=1;h<15;h++)P[h]=B[h]-65535-(P[h-1]>>16&1),P[h-1]&=65535;P[15]=B[15]-32767-(P[14]>>16&1),S=P[15]>>16&1,P[14]&=65535,tn(B,P,1-S)}for(h=0;h<16;h++)c[2*h]=255&B[h],c[2*h+1]=B[h]>>8}function bi(c,p){var h=new Uint8Array(32),g=new Uint8Array(32);return nn(h,c),nn(g,p),Ut(h,0,g,0)}function yi(c){var p=new Uint8Array(32);return nn(p,c),1&p[0]}function Sr(c,p){var h;for(h=0;h<16;h++)c[h]=p[2*h]+(p[2*h+1]<<8);c[15]&=32767}function Ct(c,p,h){var g;for(g=0;g<16;g++)c[g]=p[g]+h[g]|0}function Et(c,p,h){var g;for(g=0;g<16;g++)c[g]=p[g]-h[g]|0}function be(c,p,h){var g,S,P=new Float64Array(31);for(g=0;g<31;g++)P[g]=0;for(g=0;g<16;g++)for(S=0;S<16;S++)P[g+S]+=p[g]*h[S];for(g=0;g<15;g++)P[g]+=38*P[g+16];for(g=0;g<16;g++)c[g]=P[g];Sn(c),Sn(c)}function xt(c,p){be(c,p,p)}function xi(c,p){var g,h=t();for(g=0;g<16;g++)h[g]=p[g];for(g=253;g>=0;g--)xt(h,h),2!==g&&4!==g&&be(h,h,p);for(g=0;g<16;g++)c[g]=h[g]}function vi(c,p){var g,h=t();for(g=0;g<16;g++)h[g]=p[g];for(g=250;g>=0;g--)xt(h,h),1!==g&&be(h,h,p);for(g=0;g<16;g++)c[g]=h[g]}function Hn(c,p,h){var P,B,g=new Uint8Array(32),S=new Float64Array(80),H=t(),M=t(),L=t(),ie=t(),ye=t(),De=t();for(B=0;B<31;B++)g[B]=p[B];for(g[31]=127&p[31]|64,g[0]&=248,Sr(S,h),B=0;B<16;B++)M[B]=S[B],ie[B]=H[B]=L[B]=0;for(H[0]=ie[0]=1,B=254;B>=0;--B)tn(H,M,P=g[B>>>3]>>>(7&B)&1),tn(L,ie,P),Ct(ye,H,L),Et(H,H,L),Ct(L,M,ie),Et(M,M,ie),xt(ie,ye),xt(De,H),be(H,L,H),be(L,M,ye),Ct(ye,H,L),Et(H,H,L),xt(M,H),Et(L,ie,De),be(H,L,_),Ct(H,H,ie),be(L,L,H),be(H,ie,De),be(ie,M,S),xt(M,ye),tn(H,M,P),tn(L,ie,P);for(B=0;B<16;B++)S[B+16]=H[B],S[B+32]=L[B],S[B+48]=M[B],S[B+64]=ie[B];var Pt=S.subarray(32),on=S.subarray(16);return xi(Pt,Pt),be(on,on,Pt),nn(c,on),0}function zn(c,p){return Hn(c,p,o)}function wi(c,p){return n(p,32),zn(c,p)}function Kn(c,p,h){var g=new Uint8Array(32);return Hn(g,h,p),qt(c,i,g,St)}var Si=vr,Eo=wr;function Cn(){var P,B,H,c=0,p=0,h=0,g=0,S=65535;for(H=0;H<arguments.length;H++)c+=(P=arguments[H].lo)&S,p+=P>>>16,h+=(B=arguments[H].hi)&S,g+=B>>>16;return new e((h+=(p+=c>>>16)>>>16)&S|(g+=h>>>16)<<16,c&S|p<<16)}function Ci(c,p){return new e(c.hi>>>p,c.lo>>>p|c.hi<<32-p)}function Zn(){var h,c=0,p=0;for(h=0;h<arguments.length;h++)c^=arguments[h].lo,p^=arguments[h].hi;return new e(p,c)}function At(c,p){var h,g,S=32-p;return p<32?(h=c.hi>>>p|c.lo<<S,g=c.lo>>>p|c.hi<<S):p<64&&(h=c.lo>>>p|c.hi<<S,g=c.hi>>>p|c.lo<<S),new e(h,g)}function Ao(c,p,h){return new e(c.hi&p.hi^~c.hi&h.hi,c.lo&p.lo^~c.lo&h.lo)}function ko(c,p,h){return new e(c.hi&p.hi^c.hi&h.hi^p.hi&h.hi,c.lo&p.lo^c.lo&h.lo^p.lo&h.lo)}function Mo(c){return Zn(At(c,28),At(c,34),At(c,39))}function Io(c){return Zn(At(c,14),At(c,18),At(c,41))}function jo(c){return Zn(At(c,1),At(c,8),Ci(c,7))}function To(c){return Zn(At(c,19),At(c,61),Ci(c,6))}var No=[new e(1116352408,3609767458),new e(1899447441,602891725),new e(3049323471,3964484399),new e(3921009573,2173295548),new e(961987163,4081628472),new e(1508970993,3053834265),new e(2453635748,2937671579),new e(2870763221,3664609560),new e(3624381080,2734883394),new e(310598401,1164996542),new e(607225278,1323610764),new e(1426881987,3590304994),new e(1925078388,4068182383),new e(2162078206,991336113),new e(2614888103,633803317),new e(3248222580,3479774868),new e(3835390401,2666613458),new e(4022224774,944711139),new e(264347078,2341262773),new e(604807628,2007800933),new e(770255983,1495990901),new e(1249150122,1856431235),new e(1555081692,3175218132),new e(1996064986,2198950837),new e(2554220882,3999719339),new e(2821834349,766784016),new e(2952996808,2566594879),new e(3210313671,3203337956),new e(3336571891,1034457026),new e(3584528711,2466948901),new e(113926993,3758326383),new e(338241895,168717936),new e(666307205,1188179964),new e(773529912,1546045734),new e(1294757372,1522805485),new e(1396182291,2643833823),new e(1695183700,2343527390),new e(1986661051,1014477480),new e(2177026350,1206759142),new e(2456956037,344077627),new e(2730485921,1290863460),new e(2820302411,3158454273),new e(3259730800,3505952657),new e(3345764771,106217008),new e(3516065817,3606008344),new e(3600352804,1432725776),new e(4094571909,1467031594),new e(275423344,851169720),new e(430227734,3100823752),new e(506948616,1363258195),new e(659060556,3750685593),new e(883997877,3785050280),new e(958139571,3318307427),new e(1322822218,3812723403),new e(1537002063,2003034995),new e(1747873779,3602036899),new e(1955562222,1575990012),new e(2024104815,1125592928),new e(2227730452,2716904306),new e(2361852424,442776044),new e(2428436474,593698344),new e(2756734187,3733110249),new e(3204031479,2999351573),new e(3329325298,3815920427),new e(3391569614,3928383900),new e(3515267271,566280711),new e(3940187606,3454069534),new e(4118630271,4000239992),new e(116418474,1914138554),new e(174292421,2731055270),new e(289380356,3203993006),new e(460393269,320620315),new e(685471733,587496836),new e(852142971,1086792851),new e(1017036298,365543100),new e(1126000580,2618297676),new e(1288033470,3409855158),new e(1501505948,4234509866),new e(1607167915,987167468),new e(1816402316,1246189591)];function Ei(c,p,h){var H,M,L,g=[],S=[],P=[],B=[];for(M=0;M<8;M++)g[M]=P[M]=Ee(c,8*M);for(var ie=0;h>=128;){for(M=0;M<16;M++)B[M]=Ee(p,8*M+ie);for(M=0;M<80;M++){for(L=0;L<8;L++)S[L]=P[L];for(H=Cn(P[7],Io(P[4]),Ao(P[4],P[5],P[6]),No[M],B[M%16]),S[7]=Cn(H,Mo(P[0]),ko(P[0],P[1],P[2])),S[3]=Cn(S[3],H),L=0;L<8;L++)P[(L+1)%8]=S[L];if(M%16==15)for(L=0;L<16;L++)B[L]=Cn(B[L],B[(L+9)%16],jo(B[(L+1)%16]),To(B[(L+14)%16]))}for(M=0;M<8;M++)P[M]=Cn(P[M],g[M]),g[M]=P[M];ie+=128,h-=128}for(M=0;M<8;M++)et(c,8*M,g[M]);return h}var Fo=new Uint8Array([106,9,230,103,243,188,201,8,187,103,174,133,132,202,167,59,60,110,243,114,254,148,248,43,165,79,245,58,95,29,54,241,81,14,82,127,173,230,130,209,155,5,104,140,43,62,108,31,31,131,217,171,251,65,189,107,91,224,205,25,19,126,33,121]);function Vt(c,p,h){var P,g=new Uint8Array(64),S=new Uint8Array(256),B=h;for(P=0;P<64;P++)g[P]=Fo[P];for(Ei(g,p,h),h%=128,P=0;P<256;P++)S[P]=0;for(P=0;P<h;P++)S[P]=p[B-h+P];for(S[h]=128,S[(h=256-128*(h<112?1:0))-9]=0,et(S,h-8,new e(B/536870912|0,B<<3)),Ei(g,S,h),P=0;P<64;P++)c[P]=g[P];return 0}function Gn(c,p){var h=t(),g=t(),S=t(),P=t(),B=t(),H=t(),M=t(),L=t(),ie=t();Et(h,c[1],c[0]),Et(ie,p[1],p[0]),be(h,h,ie),Ct(g,c[0],c[1]),Ct(ie,p[0],p[1]),be(g,g,ie),be(S,c[3],p[3]),be(S,S,A),be(P,c[2],p[2]),Ct(P,P,P),Et(B,g,h),Et(H,P,S),Ct(M,P,S),Ct(L,g,h),be(c[0],B,H),be(c[1],L,M),be(c[2],M,H),be(c[3],B,L)}function Pi(c,p,h){var g;for(g=0;g<4;g++)tn(c[g],p[g],h)}function Cr(c,p){var h=t(),g=t(),S=t();xi(S,p[2]),be(h,p[0],S),be(g,p[1],S),nn(c,g),c[31]^=yi(h)<<7}function Er(c,p,h){var g,S;for(jt(c[0],a),jt(c[1],l),jt(c[2],l),jt(c[3],a),S=255;S>=0;--S)Pi(c,p,g=h[S/8|0]>>(7&S)&1),Gn(p,c),Gn(c,c),Pi(c,p,g)}function Jn(c,p){var h=[t(),t(),t(),t()];jt(h[0],E),jt(h[1],N),jt(h[2],l),be(h[3],E,N),Er(c,h,p)}function Pr(c,p,h){var P,g=new Uint8Array(64),S=[t(),t(),t(),t()];for(h||n(p,32),Vt(g,p,32),g[0]&=248,g[31]&=127,g[31]|=64,Jn(S,g),Cr(c,S),P=0;P<32;P++)p[P+32]=c[P];return 0}var c,Wn=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function Or(c,p){var h,g,S,P;for(g=63;g>=32;--g){for(h=0,S=g-32,P=g-12;S<P;++S)p[S]+=h-16*p[g]*Wn[S-(g-32)],h=Math.floor((p[S]+128)/256),p[S]-=256*h;p[S]+=h,p[g]=0}for(h=0,S=0;S<32;S++)p[S]+=h-(p[31]>>4)*Wn[S],h=p[S]>>8,p[S]&=255;for(S=0;S<32;S++)p[S]-=h*Wn[S];for(g=0;g<32;g++)p[g+1]+=p[g]>>8,c[g]=255&p[g]}function Ar(c){var h,p=new Float64Array(64);for(h=0;h<64;h++)p[h]=c[h];for(h=0;h<64;h++)c[h]=0;Or(c,p)}function Oi(c,p,h,g){var H,M,S=new Uint8Array(64),P=new Uint8Array(64),B=new Uint8Array(64),L=new Float64Array(64),ie=[t(),t(),t(),t()];Vt(S,g,32),S[0]&=248,S[31]&=127,S[31]|=64;var ye=h+64;for(H=0;H<h;H++)c[64+H]=p[H];for(H=0;H<32;H++)c[32+H]=S[32+H];for(Vt(B,c.subarray(32),h+32),Ar(B),Jn(ie,B),Cr(c,ie),H=32;H<64;H++)c[H]=g[H];for(Vt(P,c,h+64),Ar(P),H=0;H<64;H++)L[H]=0;for(H=0;H<32;H++)L[H]=B[H];for(H=0;H<32;H++)for(M=0;M<32;M++)L[H+M]+=P[H]*S[M];return Or(c.subarray(32),L),ye}function kr(c,p,h,g){var S,P=new Uint8Array(32),B=new Uint8Array(64),H=[t(),t(),t(),t()],M=[t(),t(),t(),t()];if(h<64||function Ro(c,p){var h=t(),g=t(),S=t(),P=t(),B=t(),H=t(),M=t();return jt(c[2],l),Sr(c[1],p),xt(S,c[1]),be(P,S,v),Et(S,S,c[2]),Ct(P,c[2],P),xt(B,P),xt(H,B),be(M,H,B),be(h,M,S),be(h,h,P),vi(h,h),be(h,h,S),be(h,h,P),be(h,h,P),be(c[0],h,P),xt(g,c[0]),be(g,g,P),bi(g,S)&&be(c[0],c[0],R),xt(g,c[0]),be(g,g,P),bi(g,S)?-1:(yi(c[0])===p[31]>>7&&Et(c[0],a,c[0]),be(c[3],c[0],c[1]),0)}(M,g))return-1;for(S=0;S<h;S++)c[S]=p[S];for(S=0;S<32;S++)c[S+32]=g[S];if(Vt(B,c,h),Ar(B),Er(H,M,B),Jn(M,p.subarray(32)),Gn(H,M),Cr(P,H),h-=64,Ut(p,0,P,0)){for(S=0;S<h;S++)c[S]=0;return-1}for(S=0;S<h;S++)c[S]=p[S+64];return h}function ki(c,p){if(32!==c.length)throw new Error("bad key size");if(24!==p.length)throw new Error("bad nonce size")}function _t(){for(var c=0;c<arguments.length;c++)if(!(arguments[c]instanceof Uint8Array))throw new TypeError("unexpected type, use Uint8Array")}function Mi(c){for(var p=0;p<c.length;p++)c[p]=0}r.lowlevel={crypto_core_hsalsa20:qt,crypto_stream_xor:wn,crypto_stream:en,crypto_stream_salsa20_xor:Qt,crypto_stream_salsa20:Vn,crypto_onetimeauth:xr,crypto_onetimeauth_verify:_i,crypto_verify_16:wt,crypto_verify_32:Ut,crypto_secretbox:vr,crypto_secretbox_open:wr,crypto_scalarmult:Hn,crypto_scalarmult_base:zn,crypto_box_beforenm:Kn,crypto_box_afternm:Si,crypto_box:function Po(c,p,h,g,S,P){var B=new Uint8Array(32);return Kn(B,S,P),Si(c,p,h,g,B)},crypto_box_open:function Oo(c,p,h,g,S,P){var B=new Uint8Array(32);return Kn(B,S,P),Eo(c,p,h,g,B)},crypto_box_keypair:wi,crypto_hash:Vt,crypto_sign:Oi,crypto_sign_keypair:Pr,crypto_sign_open:kr,crypto_secretbox_KEYBYTES:32,crypto_secretbox_NONCEBYTES:24,crypto_secretbox_ZEROBYTES:32,crypto_secretbox_BOXZEROBYTES:16,crypto_scalarmult_BYTES:32,crypto_scalarmult_SCALARBYTES:32,crypto_box_PUBLICKEYBYTES:32,crypto_box_SECRETKEYBYTES:32,crypto_box_BEFORENMBYTES:32,crypto_box_NONCEBYTES:24,crypto_box_ZEROBYTES:32,crypto_box_BOXZEROBYTES:16,crypto_sign_BYTES:64,crypto_sign_PUBLICKEYBYTES:32,crypto_sign_SECRETKEYBYTES:64,crypto_sign_SEEDBYTES:32,crypto_hash_BYTES:64,gf:t,D:v,L:Wn,pack25519:nn,unpack25519:Sr,M:be,A:Ct,S:xt,Z:Et,pow2523:vi,add:Gn,set25519:jt,modL:Or,scalarmult:Er,scalarbase:Jn},r.randomBytes=function(c){var p=new Uint8Array(c);return n(p,c),p},r.secretbox=function(c,p,h){_t(c,p,h),ki(h,p);for(var g=new Uint8Array(32+c.length),S=new Uint8Array(g.length),P=0;P<c.length;P++)g[P+32]=c[P];return vr(S,g,g.length,p,h),S.subarray(16)},r.secretbox.open=function(c,p,h){_t(c,p,h),ki(h,p);for(var g=new Uint8Array(16+c.length),S=new Uint8Array(g.length),P=0;P<c.length;P++)g[P+16]=c[P];return g.length<32||0!==wr(S,g,g.length,p,h)?null:S.subarray(32)},r.secretbox.keyLength=32,r.secretbox.nonceLength=24,r.secretbox.overheadLength=16,r.scalarMult=function(c,p){if(_t(c,p),32!==c.length)throw new Error("bad n size");if(32!==p.length)throw new Error("bad p size");var h=new Uint8Array(32);return Hn(h,c,p),h},r.scalarMult.base=function(c){if(_t(c),32!==c.length)throw new Error("bad n size");var p=new Uint8Array(32);return zn(p,c),p},r.scalarMult.scalarLength=32,r.scalarMult.groupElementLength=32,r.box=function(c,p,h,g){var S=r.box.before(h,g);return r.secretbox(c,p,S)},r.box.before=function(c,p){_t(c,p),function Bo(c,p){if(32!==c.length)throw new Error("bad public key size");if(32!==p.length)throw new Error("bad secret key size")}(c,p);var h=new Uint8Array(32);return Kn(h,c,p),h},r.box.after=r.secretbox,r.box.open=function(c,p,h,g){var S=r.box.before(h,g);return r.secretbox.open(c,p,S)},r.box.open.after=r.secretbox.open,r.box.keyPair=function(){var c=new Uint8Array(32),p=new Uint8Array(32);return wi(c,p),{publicKey:c,secretKey:p}},r.box.keyPair.fromSecretKey=function(c){if(_t(c),32!==c.length)throw new Error("bad secret key size");var p=new Uint8Array(32);return zn(p,c),{publicKey:p,secretKey:new Uint8Array(c)}},r.box.publicKeyLength=32,r.box.secretKeyLength=32,r.box.sharedKeyLength=32,r.box.nonceLength=24,r.box.overheadLength=r.secretbox.overheadLength,r.sign=function(c,p){if(_t(c,p),64!==p.length)throw new Error("bad secret key size");var h=new Uint8Array(64+c.length);return Oi(h,c,c.length,p),h},r.sign.open=function(c,p){if(_t(c,p),32!==p.length)throw new Error("bad public key size");var h=new Uint8Array(c.length),g=kr(h,c,c.length,p);if(g<0)return null;for(var S=new Uint8Array(g),P=0;P<S.length;P++)S[P]=h[P];return S},r.sign.detached=function(c,p){for(var h=r.sign(c,p),g=new Uint8Array(64),S=0;S<g.length;S++)g[S]=h[S];return g},r.sign.detached.verify=function(c,p,h){if(_t(c,p,h),64!==p.length)throw new Error("bad signature size");if(32!==h.length)throw new Error("bad public key size");var P,g=new Uint8Array(64+c.length),S=new Uint8Array(64+c.length);for(P=0;P<64;P++)g[P]=p[P];for(P=0;P<c.length;P++)g[P+64]=c[P];return kr(S,g,g.length,h)>=0},r.sign.keyPair=function(){var c=new Uint8Array(32),p=new Uint8Array(64);return Pr(c,p),{publicKey:c,secretKey:p}},r.sign.keyPair.fromSecretKey=function(c){if(_t(c),64!==c.length)throw new Error("bad secret key size");for(var p=new Uint8Array(32),h=0;h<p.length;h++)p[h]=c[32+h];return{publicKey:p,secretKey:new Uint8Array(c)}},r.sign.keyPair.fromSeed=function(c){if(_t(c),32!==c.length)throw new Error("bad seed size");for(var p=new Uint8Array(32),h=new Uint8Array(64),g=0;g<32;g++)h[g]=c[g];return Pr(p,h,!0),{publicKey:p,secretKey:h}},r.sign.publicKeyLength=32,r.sign.secretKeyLength=64,r.sign.seedLength=32,r.sign.signatureLength=64,r.hash=function(c){_t(c);var p=new Uint8Array(64);return Vt(p,c,c.length),p},r.hash.hashLength=64,r.verify=function(c,p){return _t(c,p),0!==c.length&&0!==p.length&&c.length===p.length&&0===tt(c,0,p,0,c.length)},r.setPRNG=function(c){n=c},(c=typeof globalThis<"u"?globalThis.crypto||globalThis.msCrypto:null)&&c.getRandomValues?r.setPRNG(function(h,g){var S,P=new Uint8Array(g);for(S=0;S<g;S+=65536)c.getRandomValues(P.subarray(S,S+Math.min(g-S,65536)));for(S=0;S<g;S++)h[S]=P[S];Mi(P)}):typeof require<"u"&&(c=require("crypto"))&&c.randomBytes&&r.setPRNG(function(h,g){var S,P=c.randomBytes(g);for(S=0;S<g;S++)h[S]=P[S];Mi(P)})}(typeof module<"u"&&module.exports?module.exports:globalThis.nacl=globalThis.nacl||{});const In=typeof module<"u"&&module.exports?module.exports:globalThis.nacl,Ui={fromSeed:In.sign.keyPair.fromSeed,sign:In.sign.detached,verify:In.sign.detached.verify,randomBytes:In.randomBytes};let Lr;new Uint16Array([0,4129,8258,12387,16516,20645,24774,28903,33032,37161,41290,45419,49548,53677,57806,61935,4657,528,12915,8786,21173,17044,29431,25302,37689,33560,45947,41818,54205,50076,62463,58334,9314,13379,1056,5121,25830,29895,17572,21637,42346,46411,34088,38153,58862,62927,50604,54669,13907,9842,5649,1584,30423,26358,22165,18100,46939,42874,38681,34616,63455,59390,55197,51132,18628,22757,26758,30887,2112,6241,10242,14371,51660,55789,59790,63919,35144,39273,43274,47403,23285,19156,31415,27286,6769,2640,14899,10770,56317,52188,64447,60318,39801,35672,47931,43802,27814,31879,19684,23749,11298,15363,3168,7233,60846,64911,52716,56781,44330,48395,36200,40265,32407,28342,24277,20212,15891,11826,7761,3696,65439,61374,57309,53244,48923,44858,40793,36728,37256,33193,45514,41451,53516,49453,61774,57711,4224,161,12482,8419,20484,16421,28742,24679,33721,37784,41979,46042,49981,54044,58239,62302,689,4752,8947,13010,16949,21012,25207,29270,46570,42443,38312,34185,62830,58703,54572,50445,13538,9411,5280,1153,29798,25671,21540,17413,42971,47098,34713,38840,59231,63358,50973,55100,9939,14066,1681,5808,26199,30326,17941,22068,55628,51565,63758,59695,39368,35305,47498,43435,22596,18533,30726,26663,6336,2273,14466,10403,52093,56156,60223,64286,35833,39896,43963,48026,19061,23124,27191,31254,2801,6864,10931,14994,64814,60687,56684,52557,48554,44427,40424,36297,31782,27655,23652,19525,15522,11395,7392,3265,61215,65342,53085,57212,44955,49082,36825,40952,28183,32310,20053,24180,11923,16050,3793,7920]),Error,function Li(r){Lr=r}(Ui);function rs(r){const e=`${J}:${ut()}`;if((r=r||{servers:[e]}).servers=r.servers||[],"string"==typeof r.servers&&(r.servers=[r.servers]),r.servers.length>0&&r.port)throw new q("port and servers options are mutually exclusive",U.InvalidOption);0===r.servers.length&&r.port&&(r.servers=[`${J}:${r.port}`]),r.servers&&0===r.servers.length&&(r.servers=[e]);const t=re({maxPingOut:2,maxReconnectAttempts:10,noRandomize:!1,pedantic:!1,pingInterval:12e4,reconnect:!0,reconnectJitter:100,reconnectJitterTLS:1e3,reconnectTimeWait:2e3,tls:void 0,verbose:!1,waitOnFirstConnect:!1,ignoreAuthErrorAbort:!1},r);if(t.authenticator=function ns(r){const e=[];return"function"==typeof r.authenticator&&e.push(r.authenticator),Array.isArray(r.authenticator)&&e.push(...r.authenticator),r.token&&e.push(function Yi(r){return()=>({auth_token:"function"==typeof r?r():r})}(r.token)),r.user&&e.push(function Wi(r,e){return()=>({user:"function"==typeof r?r():r,pass:"function"==typeof e?e():e})}(r.user,r.pass)),0===e.length?()=>{}:function Gi(r){return e=>{let t={};return r.forEach(n=>{const i=n(e)||{};t=Object.assign(t,i)}),t}}(e)}(t),["reconnectDelayHandler","authenticator"].forEach(n=>{if(t[n]&&"function"!=typeof t[n])throw new q(`${n} option should be a function`,U.NotFunction)}),t.reconnectDelayHandler||(t.reconnectDelayHandler=()=>{let n=t.tls?t.reconnectJitterTLS:t.reconnectJitter;return n&&(n++,n=Math.floor(Math.random()*n)),t.reconnectTimeWait+n}),t.inboxPrefix)try{T(t.inboxPrefix)}catch(n){throw new q(n.message,U.ApiError)}if(t.resolve&&"function"!=typeof Nt())throw new q("'resolve' is not supported on this client",U.InvalidOption);return t}const os=/^INFO\s+([^\r\n]+)\r\n/i,as=Ve("PONG\r\n"),Hr=Ve("PING\r\n");class cs{echo;no_responders;protocol;verbose;pedantic;jwt;nkey;sig;user;pass;auth_token;tls_required;name;lang;version;headers;constructor(e,t,n){this.protocol=1,this.version=e.version,this.lang=e.lang,this.echo=!t.noEcho&&void 0,this.verbose=t.verbose,this.pedantic=t.pedantic,this.tls_required=!!t.tls||void 0,this.name=t.name,re(this,(t&&"function"==typeof t.authenticator?t.authenticator(n):{})||{})}}class zr extends he{sid;queue;draining;max;subject;drained;protocol;timer;info;cleanupFn;closed;requestSubject;constructor(e,t,n={}){super(),re(this,n),this.protocol=e,this.subject=t,this.draining=!1,this.noIterator="function"==typeof n.callback,this.closed=oe(),n.timeout&&(this.timer=Le(n.timeout),this.timer.then(()=>{this.timer=void 0}).catch(i=>{this.stop(i),this.noIterator&&this.callback(i,{})})),this.noIterator||this.iterClosed.then(()=>{this.closed.resolve(),this.unsubscribe()})}setPrePostHandlers(e){if(this.noIterator){const t=this.callback,n=e.ingestionFilterFn?e.ingestionFilterFn:()=>({ingest:!0,protocol:!1}),i=e.protocolFilterFn?e.protocolFilterFn:()=>!0,o=e.dispatchedFn?e.dispatchedFn:()=>{};this.callback=(a,l)=>{const{ingest:_}=n(l);_&&i(l)&&(t(a,l),o(l))}}else this.protocolFilterFn=e.protocolFilterFn,this.dispatchedFn=e.dispatchedFn}callback(e,t){this.cancelTimeout(),e?this.stop(e):this.push(t)}close(){if(!this.isClosed()){this.cancelTimeout();const e=()=>{if(this.stop(),this.cleanupFn)try{this.cleanupFn(this,this.info)}catch{}this.closed.resolve()};this.noIterator?e():this.push(e)}}unsubscribe(e){this.protocol.unsubscribe(this,e)}cancelTimeout(){this.timer&&(this.timer.cancel(),this.timer=void 0)}drain(){return this.protocol.isClosed()?Promise.reject(q.errorForCode(U.ConnectionClosed)):this.isClosed()?Promise.reject(q.errorForCode(U.SubClosed)):(this.drained||(this.draining=!0,this.protocol.unsub(this),this.drained=this.protocol.flush(oe()).then(()=>{this.protocol.subscriptions.cancel(this)}).catch(()=>{this.protocol.subscriptions.cancel(this)})),this.drained)}isDraining(){return this.draining}isClosed(){return this.done}getSubject(){return this.subject}getMax(){return this.max}getID(){return this.sid}}class ls{mux;subs;sidCounter;constructor(){this.sidCounter=0,this.mux=null,this.subs=new Map}size(){return this.subs.size}add(e){return this.sidCounter++,e.sid=this.sidCounter,this.subs.set(e.sid,e),e}setMux(e){return this.mux=e,e}getMux(){return this.mux}get(e){return this.subs.get(e)}resub(e){return this.sidCounter++,this.subs.delete(e.sid),e.sid=this.sidCounter,this.subs.set(e.sid,e),e}all(){return Array.from(this.subs.values())}cancel(e){e&&(e.close(),this.subs.delete(e.sid))}handleError(e){if(e&&e.permissionContext){const t=e.permissionContext,n=this.all();let i;if("subscription"===t.operation&&(i=n.find(o=>o.subject===t.subject)),"publish"===t.operation&&(i=n.find(o=>o.requestSubject===t.subject)),i)return i.callback(e,{}),i.close(),this.subs.delete(i.sid),i!==this.mux}return!1}close(){this.subs.forEach(e=>{e.close()})}}class Nn{connected;connectedOnce;infoReceived;info;muxSubscriptions;options;outbound;pongs;subscriptions;transport;noMorePublishing;connectError;publisher;_closed;closed;listeners;heartbeats;parser;outMsgs;inMsgs;outBytes;inBytes;pendingLimit;lastError;abortReconnect;servers;server;features;connectPromise;constructor(e,t){this._closed=!1,this.connected=!1,this.connectedOnce=!1,this.infoReceived=!1,this.noMorePublishing=!1,this.abortReconnect=!1,this.listeners=[],this.pendingLimit=32768,this.outMsgs=0,this.inMsgs=0,this.outBytes=0,this.inBytes=0,this.options=e,this.publisher=t,this.subscriptions=new ls,this.muxSubscriptions=new Ii,this.outbound=new He,this.pongs=[],this.pendingLimit=e.pendingLimit||this.pendingLimit,this.features=new Ri({major:0,minor:0,micro:0}),this.connectPromise=null,this.servers=new te("string"==typeof e.servers?[e.servers]:e.servers,{randomize:!e.noRandomize}),this.closed=oe(),this.parser=new Ur(this),this.heartbeats=new ji(this,this.options.pingInterval||12e4,this.options.maxPingOut||2)}resetOutbound(){this.outbound.reset();const e=this.pongs;this.pongs=[];const t=q.errorForCode(U.Disconnect);t.stack="",e.forEach(n=>{n.reject(t)}),this.parser=new Ur(this),this.infoReceived=!1}dispatchStatus(e){this.listeners.forEach(t=>{t.push(e)})}status(){const e=new he;return this.listeners.push(e),e}prepare(){var e=this;this.transport&&this.transport.discard(),this.info=void 0,this.resetOutbound();const t=oe();return t.catch(()=>{}),this.pongs.unshift(t),this.connectError=n=>{t.reject(n)},this.transport=function an(){if(!Ae||"function"!=typeof Ae.factory)throw new Error("transport fn is not set");return Ae.factory()}(),this.transport.closed().then(function(){var n=(0,m.Z)(function*(i){e.connected=!1,e.isClosed()||(yield e.disconnected(e.transport.closeError||e.lastError))});return function(i){return n.apply(this,arguments)}}()),t}disconnect(){this.dispatchStatus({type:pt.StaleConnection,data:""}),this.transport.disconnect()}disconnected(e){var t=this;return(0,m.Z)(function*(){t.dispatchStatus({type:Ze.Disconnect,data:t.servers.getCurrentServer().toString()}),t.options.reconnect?yield t.dialLoop().then(()=>{t.dispatchStatus({type:Ze.Reconnect,data:t.servers.getCurrentServer().toString()}),t.lastError?.code===U.AuthenticationExpired&&(t.lastError=void 0)}).catch(n=>{t._close(n)}):yield t._close(e)})()}dial(e){var t=this;return(0,m.Z)(function*(){const n=t.prepare();let i;try{i=Le(t.options.timeout||2e4);const o=t.transport.connect(e,t.options);yield Promise.race([o,i]),(0,m.Z)(function*(){try{var _,a=!1,l=!1;try{for(var A,v=(0,ce.Z)(t.transport);a=!(A=yield v.next()).done;a=!1)t.parser.parse(A.value)}catch(E){l=!0,_=E}finally{try{a&&null!=v.return&&(yield v.return())}finally{if(l)throw _}}}catch(E){console.log("reader closed",E)}})().then()}catch(o){n.reject(o)}try{yield Promise.race([i,n]),i&&i.cancel(),t.connected=!0,t.connectError=void 0,t.sendSubscriptions(),t.connectedOnce=!0,t.server.didConnect=!0,t.server.reconnects=0,t.flushPending(),t.heartbeats.start()}catch(o){throw i&&i.cancel(),yield t.transport.close(o),o}})()}_doDial(e){var t=this;return(0,m.Z)(function*(){const n=yield e.resolve({fn:Nt(),debug:t.options.debug,randomize:!t.options.noRandomize});let i=null;for(const o of n)try{return i=null,t.dispatchStatus({type:pt.Reconnecting,data:o.toString()}),void(yield t.dial(o))}catch(a){i=a}throw i})()}dialLoop(){return null===this.connectPromise&&(this.connectPromise=this.dodialLoop(),this.connectPromise.then(()=>{}).catch(()=>{}).finally(()=>{this.connectPromise=null})),this.connectPromise}dodialLoop(){var e=this;return(0,m.Z)(function*(){let t;for(;;){e._closed&&e.servers.clear();const n=e.options.reconnectDelayHandler?e.options.reconnectDelayHandler():2e3;let i=n;const o=e.selectServer();if(!o||e.abortReconnect)throw t||(e.lastError?e.lastError:q.errorForCode(U.ConnectionRefused));const a=Date.now();if(0===o.lastConnect||o.lastConnect+n<=a){o.lastConnect=Date.now();try{yield e._doDial(o);break}catch(l){if(t=l,!e.connectedOnce){if(e.options.waitOnFirstConnect)continue;e.servers.removeCurrentServer()}o.reconnects++;const _=e.options.maxReconnectAttempts||0;-1!==_&&o.reconnects>=_&&e.servers.removeCurrentServer()}}else i=Math.min(i,o.lastConnect+n-a),yield se(i)}})()}static connect(e,t){return(0,m.Z)(function*(){const n=new Nn(e,t);return yield n.dialLoop(),n})()}static toError(e){const t=e?e.toLowerCase():"";if(-1!==t.indexOf("permissions violation")){const n=new q(e,U.PermissionsViolation),i=e.match(/(Publish|Subscription) to "(\S+)"/);return i&&(n.permissionContext={operation:i[1].toLowerCase(),subject:i[2]}),n}return-1!==t.indexOf("authorization violation")?new q(e,U.AuthorizationViolation):-1!==t.indexOf("user authentication expired")?new q(e,U.AuthenticationExpired):-1!==t.indexOf("authentication timeout")?new q(e,U.AuthenticationTimeout):new q(e,U.ProtocolError)}processMsg(e,t){if(this.inMsgs++,this.inBytes+=t.length,!this.subscriptions.sidCounter)return;const n=this.subscriptions.get(e.sid);n&&(n.received+=1,n.callback&&n.callback(null,new Nr(e,t,this)),void 0!==n.max&&n.received>=n.max&&n.unsubscribe())}processError(e){const t=ze(e),n=Nn.toError(t),i={type:Ze.Error,data:n.code};if(n.isPermissionError()){let o=!1;n.permissionContext&&(i.permissionContext=n.permissionContext,o=this.subscriptions.getMux()?.subject===n.permissionContext.subject),this.subscriptions.handleError(n),this.muxSubscriptions.handleError(o,n),o&&this.subscriptions.setMux(null)}this.dispatchStatus(i),this.handleError(n)}handleError(e){e.isAuthError()?this.handleAuthError(e):(e.isProtocolError()||e.isAuthTimeout())&&(this.lastError=e),e.isPermissionError()||(this.lastError=e)}handleAuthError(e){this.lastError&&e.code===this.lastError.code&&!1===this.options.ignoreAuthErrorAbort&&(this.abortReconnect=!0),this.connectError?this.connectError(e):this.disconnect()}processPing(){this.transport.send(as)}processPong(){const e=this.pongs.shift();e&&e.resolve()}processInfo(e){const t=JSON.parse(ze(e));this.info=t;const n=this.options&&this.options.ignoreClusterUpdates?void 0:this.servers.update(t);if(!this.infoReceived){this.features.update(Dt(t.version)),this.infoReceived=!0,this.transport.isEncrypted()&&this.servers.updateTLSName();const{version:o,lang:a}=this.transport;try{const l=new cs({version:o,lang:a},this.options,t.nonce);t.headers&&(l.headers=!0,l.no_responders=!0);const _=JSON.stringify(l);this.transport.send(Ve(`CONNECT ${_}\r\n`)),this.transport.send(Hr)}catch(l){this._close(l)}}n&&this.dispatchStatus({type:Ze.Update,data:n}),void 0!==t.ldm&&t.ldm&&this.dispatchStatus({type:Ze.LDM,data:this.servers.getCurrentServer().toString()})}push(e){switch(e.kind){case ht.MSG:{const{msg:t,data:n}=e;this.processMsg(t,n);break}case ht.OK:break;case ht.ERR:this.processError(e.data);break;case ht.PING:this.processPing();break;case ht.PONG:this.processPong();break;case ht.INFO:this.processInfo(e.data)}}sendCommand(e,...t){const n=this.outbound.length();let i;i="string"==typeof e?Ve(e):e,this.outbound.fill(i,...t),0===n?queueMicrotask(()=>{this.flushPending()}):this.outbound.size()>=this.pendingLimit&&this.flushPending()}publish(e,t=pe,n){let i;if(t instanceof Uint8Array)i=t;else{if("string"!=typeof t)throw q.errorForCode(U.BadPayload);i=Re.encode(t)}let o=i.length;(n=n||{}).reply=n.reply||"";let _,a=pe,l=0;if(n.headers){if(this.info&&!this.info.headers)throw new q("headers",U.ServerOptionNotAvailable);a=n.headers.encode(),l=a.length,o=i.length+l}if(this.info&&o>this.info.max_payload)throw q.errorForCode(U.MaxPayloadExceeded);this.outBytes+=o,this.outMsgs++,n.headers?(_=n.reply?`HPUB ${e} ${n.reply} ${l} ${o}\r\n`:`HPUB ${e} ${l} ${o}\r\n`,this.sendCommand(_,a,i,vt)):(_=n.reply?`PUB ${e} ${n.reply} ${o}\r\n`:`PUB ${e} ${o}\r\n`,this.sendCommand(_,i,vt))}request(e){return this.initMux(),this.muxSubscriptions.add(e),e}subscribe(e){return this.subscriptions.add(e),this._subunsub(e),e}_sub(e){this.sendCommand(e.queue?`SUB ${e.subject} ${e.queue} ${e.sid}\r\n`:`SUB ${e.subject} ${e.sid}\r\n`)}_subunsub(e){return this._sub(e),e.max&&this.unsubscribe(e,e.max),e}unsubscribe(e,t){this.unsub(e,t),(void 0===e.max||e.received>=e.max)&&this.subscriptions.cancel(e)}unsub(e,t){!e||this.isClosed()||(this.sendCommand(t?`UNSUB ${e.sid} ${t}\r\n`:`UNSUB ${e.sid}\r\n`),e.max=t)}resub(e,t){!e||this.isClosed()||(e.subject=t,this.subscriptions.resub(e),this._sub(e))}flush(e){return e||(e=oe()),this.pongs.push(e),this.outbound.fill(Hr),this.flushPending(),e}sendSubscriptions(){const e=[];this.subscriptions.all().forEach(t=>{e.push(t.queue?`SUB ${t.subject} ${t.queue} ${t.sid}\r\n`:`SUB ${t.subject} ${t.sid}\r\n`)}),e.length&&this.transport.send(Ve(e.join("")))}_close(e){var t=this;return(0,m.Z)(function*(){t._closed||(t.heartbeats.cancel(),t.connectError&&(t.connectError(e),t.connectError=void 0),t.muxSubscriptions.close(),t.subscriptions.close(),t.listeners.forEach(n=>{n.stop()}),t._closed=!0,yield t.transport.close(e),yield t.closed.resolve(e))})()}close(){return this._close()}isClosed(){return this._closed}drain(){var e=this;const t=this.subscriptions.all(),n=[];return t.forEach(i=>{n.push(i.drain())}),Promise.all(n).then((0,m.Z)(function*(){return e.noMorePublishing=!0,yield e.flush(),e.close()})).catch(()=>{})}flushPending(){if(this.infoReceived&&this.connected&&this.outbound.size()){const e=this.outbound.drain();this.transport.send(e)}}initMux(){if(!this.subscriptions.getMux()){const t=this.muxSubscriptions.init(this.options.inboxPrefix),n=new zr(this,`${t}*`);n.callback=this.muxSubscriptions.dispatcher(),this.subscriptions.setMux(n),this.subscribe(n)}}selectServer(){const e=this.servers.selectServer();if(void 0!==e)return this.server=e,this.server}getServer(){return this.server}}class Kr{token;received;ctx;requestSubject;mux;constructor(e,t){this.mux=e,this.requestSubject=t,this.received=0,this.token=Ke.next(),this.ctx=new Error}}class us extends Kr{callback;done;timer;max;opts;constructor(e,t,n={maxWait:1e3}){if(super(e,t),this.opts=n,"function"!=typeof this.opts.callback)throw new Error("callback is required");this.callback=this.opts.callback,this.max="number"==typeof n.maxMessages&&n.maxMessages>0?n.maxMessages:-1,this.done=oe(),this.done.then(()=>{this.callback(null,null)}),this.timer=setTimeout(()=>{this.cancel()},n.maxWait)}cancel(e){e&&this.callback(e,null),clearTimeout(this.timer),this.mux.cancel(this),this.done.resolve()}resolver(e,t){e?(e.stack+=`\n\n${this.ctx.stack}`,this.cancel(e)):(this.callback(null,t),this.opts.strategy===Ie.Count&&(this.max--,0===this.max&&this.cancel()),this.opts.strategy===Ie.JitterTimer&&(clearTimeout(this.timer),this.timer=setTimeout(()=>{this.cancel()},this.opts.jitter||300)),this.opts.strategy===Ie.SentinelMsg&&t&&0===t.data.length&&this.cancel())}}class Zr extends Kr{deferred;timer;constructor(e,t,n={timeout:1e3}){super(e,t),this.deferred=oe(),this.timer=Le(n.timeout)}resolver(e,t){this.timer&&this.timer.cancel(),e?(e.stack+=`\n\n${this.ctx.stack}`,this.deferred.reject(e)):this.deferred.resolve(t),this.cancel()}cancel(e){this.timer&&this.timer.cancel(),this.mux.cancel(this),this.deferred.reject(e||q.errorForCode(U.Cancelled))}}function Gt(r){return rr("durable",r)}function dt(r){return rr("stream",r)}function rr(r,e=""){if(""===e)throw Error(`${r} name required`);return[".","*",">","/","\\"," ","\t","\n","\r"].forEach(n=>{if(-1!==e.indexOf(n)){switch(n){case"\n":n="\\n";break;case"\r":n="\\r";break;case"\t":n="\\t"}throw Error(`invalid ${r} name - ${r} name cannot contain '${n}'`)}}),""}function un(r,e=""){if(""===e)throw Error(`${r} name required`);const t=function hs(r=""){if(""===r)throw Error("name required");const e=/^[-\w]+$/g;if(null===r.match(e))for(const n of r.split(""))if(null===n.match(e))return`cannot contain '${n}'`;return""}(e);if(t.length)throw new Error(`invalid ${r} name - ${r} name ${t}`)}function $e(r){return 1e6*r}function ir(r){return Math.floor(r/1e6)}function sr(r){if(r.data.length>0)return!1;const e=r.headers;return!!e&&e.code>=100&&e.code<200}function or(r){return sr(r)&&"Idle Heartbeat"===r.headers?.description}function Jt(r){if(0!==r.data.length)return null;const e=r.headers;return e?Gr(e.code,e.description):null}var bt=function(r){return r.MaxBatchExceeded="exceeded maxrequestbatch of",r.MaxExpiresExceeded="exceeded maxrequestexpires of",r.MaxBytesExceeded="exceeded maxrequestmaxbytes of",r.MaxMessageSizeExceeded="message size exceeds maxbytes",r.PushConsumer="consumer is push based",r.MaxWaitingExceeded="exceeded maxwaiting",r.IdleHeartbeatMissed="idle heartbeats missed",r.ConsumerDeleted="consumer deleted",r}(bt||{});let fs=!1;function Gr(r,e=""){if(r<300)return null;switch(e=e.toLowerCase(),r){case 404:return new q(e,U.JetStream404NoMessages);case 408:return new q(e,U.JetStream408RequestTimeout);case 409:{const t=e.startsWith(bt.IdleHeartbeatMissed)?U.JetStreamIdleHeartBeat:U.JetStream409;return new q(e,t)}case 503:return q.errorForCode(U.JetStreamNotEnabled,new Error(e));default:return""===e&&(e=U.Unknown),new q(e,`${r}`)}}class hn{nc;opts;prefix;timeout;jc;constructor(e,t){this.nc=e,this.opts=function gs(r){return(r=r||{}).domain&&(r.apiPrefix=`$JS.${r.domain}.API`,delete r.domain),re({apiPrefix:"$JS.API",timeout:5e3},r)}(t),this._parseOpts(),this.prefix=this.opts.apiPrefix,this.timeout=this.opts.timeout,this.jc=Qe()}getOptions(){return Object.assign({},this.opts)}_parseOpts(){let e=this.opts.apiPrefix;if(!e||0===e.length)throw new Error("invalid empty prefix");"."===e[e.length-1]&&(e=e.substr(0,e.length-1)),this.opts.apiPrefix=e}_request(e,t=null,n){var i=this;return(0,m.Z)(function*(){(n=n||{}).timeout=i.timeout;let o=pe;t&&(o=i.jc.encode(t));const a=yield i.nc.request(e,o,n);return i.parseJsResponse(a)})()}findStream(e){var t=this;return(0,m.Z)(function*(){const n={subject:e},o=yield t._request(`${t.prefix}.STREAM.NAMES`,n);if(!o.streams||1!==o.streams.length)throw new Error("no stream matches subject");return o.streams[0]})()}getConnection(){return this.nc}parseJsResponse(e){const t=this.jc.decode(e.data),n=t;if(n.error){const i=Gr(n.error.code,n.error.description);if(null!==i)throw i.api_error=n.error,i}return t}}class _s{static encode(e){if("string"==typeof e)return btoa(e);const t=Array.from(e);return btoa(String.fromCharCode(...t))}static decode(e,t=!1){const n=atob(e);return t?Uint8Array.from(n,i=>i.charCodeAt(0)):n}}class dn{static encode(e){return dn.toB64URLEncoding(_s.encode(e))}static decode(e,t=!1){return dn.decode(dn.fromB64URLEncoding(e),t)}static toB64URLEncoding(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}static fromB64URLEncoding(e){return e.replace(/_/g,"/").replace(/-/g,"+")}}var Jr=function(r){return r.Limits="limits",r.Interest="interest",r.Workqueue="workqueue",r}(Jr||{}),Fn=function(r){return r.Old="old",r.New="new",r}(Fn||{}),Wr=function(r){return r.File="file",r.Memory="memory",r}(Wr||{}),Ge=function(r){return r.All="all",r.Last="last",r.New="new",r.StartSequence="by_start_sequence",r.StartTime="by_start_time",r.LastPerSubject="last_per_subject",r}(Ge||{}),nt=function(r){return r.None="none",r.All="all",r.Explicit="explicit",r.NotSet="",r}(nt||{}),fn=function(r){return r.Instant="instant",r.Original="original",r}(fn||{}),ar=function(r){return r.CreateOrUpdate="",r.Update="update",r.Create="create",r}(ar||{}),ft=function(r){return r.StreamSourceHdr="Nats-Stream-Source",r.LastConsumerSeqHdr="Nats-Last-Consumer",r.LastStreamSeqHdr="Nats-Last-Stream",r.ConsumerStalledHdr="Nats-Consumer-Stalled",r.MessageSizeHdr="Nats-Msg-Size",r.RollupHdr="Nats-Rollup",r.RollupValueSubject="sub",r.RollupValueAll="all",r.PendingMessagesHdr="Nats-Pending-Messages",r.PendingBytesHdr="Nats-Pending-Bytes",r}(ft||{}),Ot=function(r){return r.LastValue="",r.AllHistory="history",r.UpdatesOnly="updates",r}(Ot||{}),pn=function(r){return r.Stream="Nats-Stream",r.Sequence="Nats-Sequence",r.TimeStamp="Nats-Time-Stamp",r.Subject="Nats-Subject",r}(pn||{});const yt="KV_";class ws{config;ordered;mack;stream;callbackFn;max;qname;isBind;filters;constructor(e){this.stream="",this.mack=!1,this.ordered=!1,this.config=function ys(r,e={}){return Object.assign({name:r,deliver_policy:Ge.All,ack_policy:nt.Explicit,ack_wait:$e(3e4),replay_policy:fn.Instant},e)}("",e||{})}getOpts(){const e={};if(e.config=Object.assign({},this.config),e.config.filter_subject&&(this.filterSubject(e.config.filter_subject),e.config.filter_subject=void 0),e.config.filter_subjects&&(e.config.filter_subjects?.forEach(t=>{this.filterSubject(t)}),e.config.filter_subjects=void 0),e.mack=this.mack,e.stream=this.stream,e.callbackFn=this.callbackFn,e.max=this.max,e.queue=this.qname,e.ordered=this.ordered,e.config.ack_policy=e.ordered?nt.None:e.config.ack_policy,e.isBind=e.isBind||!1,this.filters)switch(this.filters.length){case 0:break;case 1:e.config.filter_subject=this.filters[0];break;default:e.config.filter_subjects=this.filters}return e}description(e){return this.config.description=e,this}deliverTo(e){return this.config.deliver_subject=e,this}durable(e){return Gt(e),this.config.durable_name=e,this}startSequence(e){if(e<=0)throw new Error("sequence must be greater than 0");return this.config.deliver_policy=Ge.StartSequence,this.config.opt_start_seq=e,this}startTime(e){return this.config.deliver_policy=Ge.StartTime,this.config.opt_start_time=e.toISOString(),this}deliverAll(){return this.config.deliver_policy=Ge.All,this}deliverLastPerSubject(){return this.config.deliver_policy=Ge.LastPerSubject,this}deliverLast(){return this.config.deliver_policy=Ge.Last,this}deliverNew(){return this.config.deliver_policy=Ge.New,this}startAtTimeDelta(e){return this.startTime(new Date(Date.now()-e)),this}headersOnly(){return this.config.headers_only=!0,this}ackNone(){return this.config.ack_policy=nt.None,this}ackAll(){return this.config.ack_policy=nt.All,this}ackExplicit(){return this.config.ack_policy=nt.Explicit,this}ackWait(e){return this.config.ack_wait=$e(e),this}maxDeliver(e){return this.config.max_deliver=e,this}filterSubject(e){return this.filters=this.filters||[],this.filters.push(e),this}replayInstantly(){return this.config.replay_policy=fn.Instant,this}replayOriginal(){return this.config.replay_policy=fn.Original,this}sample(e){if((e=Math.trunc(e))<0||e>100)throw new Error("value must be between 0-100");return this.config.sample_freq=`${e}%`,this}limit(e){return this.config.rate_limit_bps=e,this}maxWaiting(e){return this.config.max_waiting=e,this}maxAckPending(e){return this.config.max_ack_pending=e,this}idleHeartbeat(e){return this.config.idle_heartbeat=$e(e),this}flowControl(){return this.config.flow_control=!0,this}deliverGroup(e){return this.queue(e),this}manualAck(){return this.mack=!0,this}maxMessages(e){return this.max=e,this}callback(e){return this.callbackFn=e,this}queue(e){return this.qname=e,this.config.deliver_group=e,this}orderedConsumer(){return this.ordered=!0,this}bind(e,t){return this.stream=e,this.config.durable_name=t,this.isBind=!0,this}bindStream(e){return this.stream=e,this}inactiveEphemeralThreshold(e){return this.config.inactive_threshold=$e(e),this}maxPullBatch(e){return this.config.max_batch=e,this}maxPullRequestExpires(e){return this.config.max_expires=$e(e),this}memory(){return this.config.mem_storage=!0,this}numReplicas(e){return this.config.num_replicas=e,this}}function Rt(r){return new ws(r)}function Yr(r){return"function"==typeof r.getOpts}function Xr(r){const e=r.length;let t=r.indexOf("=");return-1===t&&(t=e),[t,t===e?0:4-t%4]}const Qr=[],ei=[],cr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";for(let r=0,e=64;r<e;++r)Qr[r]=cr[r],ei[cr.charCodeAt(r)]=r;const{toUint8Array:Cs,fromUint8Array:Es}=function Ss(r,e,t=!1){function n(a,l){return Math.floor(3*(a+l)/4-l)}function i(a){return r[a>>18&63]+r[a>>12&63]+r[a>>6&63]+r[63&a]}function o(a,l,_){const v=new Array((_-l)/3);for(let A=l,E=0;A<_;A+=3)v[E++]=i((a[A]<<16)+(a[A+1]<<8)+a[A+2]);return v.join("")}return{byteLength:a=>n.apply(null,Xr(a)),toUint8Array(a){const[l,_]=Xr(a),v=new Uint8Array(n(l,_)),A=_?l-4:l;let E,R,N=0;for(R=0;R<A;R+=4)E=e[a.charCodeAt(R)]<<18|e[a.charCodeAt(R+1)]<<12|e[a.charCodeAt(R+2)]<<6|e[a.charCodeAt(R+3)],v[N++]=E>>16&255,v[N++]=E>>8&255,v[N++]=255&E;return 2===_?(E=e[a.charCodeAt(R)]<<2|e[a.charCodeAt(R+1)]>>4,v[N++]=255&E):1===_&&(E=e[a.charCodeAt(R)]<<10|e[a.charCodeAt(R+1)]<<4|e[a.charCodeAt(R+2)]>>2,v[N++]=E>>8&255,v[N++]=255&E),v},fromUint8Array(a){const _=a.length,v=_%3,A=_-v,E=new Array(Math.ceil(A/16383)+(v?1:0));let R,$,N=0;for(let Z=0;Z<A;Z+=16383)R=Z+16383,E[N++]=o(a,Z,R>A?A:R);return 1===v?($=a[A],E[N]=r[$>>2]+r[$<<4&63],t||(E[N]+="==")):2===v&&($=a[A]<<8|255&a[A+1],E[N]=r[$>>10]+r[$>>4&63]+r[$<<2&63],t||(E[N]+="=")),E.join("")}}}(Qr,ei,!0),Ps=new TextDecoder,Os=new TextEncoder;class ti{hashSize=32;_buf;_bufIdx;_count;_K;_H;_finalized;constructor(){this._buf=new Uint8Array(64),this._K=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),this.init()}init(){return this._H=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),this._bufIdx=0,this._count=new Uint32Array(2),this._buf.fill(0),this._finalized=!1,this}update(e,t){if(null===e)throw new TypeError("msg must be a string or Uint8Array.");"string"==typeof e&&(e=function Is(r,e="utf8"){if(/^utf-?8$/i.test(e))return Os.encode(r);if(/^base64$/i.test(e))return Cs(r);if(/^hex(?:adecimal)?$/i.test(e))return function ks(r){const e=r.length;if(e%2||!/^[0-9a-fA-F]+$/.test(r))throw new TypeError("Invalid hex string.");r=r.toLowerCase();const t=new Uint8Array(Math.floor(e/2)),n=e/2;for(let i=0;i<n;++i)t[i]=parseInt(r.substr(2*i,2),16);return t}(r);throw new TypeError("Unsupported string encoding.")}(e,t));for(let i=0,o=e.length;i<o;i++)this._buf[this._bufIdx++]=e[i],64===this._bufIdx&&(this._transform(),this._bufIdx=0);const n=this._count;return(n[0]+=e.length<<3)<e.length<<3&&n[1]++,n[1]+=e.length>>>29,this}digest(e){if(this._finalized)throw new Error("digest has already been called.");this._finalized=!0;const t=this._buf;let n=this._bufIdx;for(t[n++]=128;56!==n;)64===n&&(this._transform(),n=0),t[n++]=0;const i=this._count;t[56]=i[1]>>>24&255,t[57]=i[1]>>>16&255,t[58]=i[1]>>>8&255,t[59]=i[1]>>>0&255,t[60]=i[0]>>>24&255,t[61]=i[0]>>>16&255,t[62]=i[0]>>>8&255,t[63]=i[0]>>>0&255,this._transform();const o=new Uint8Array(32);for(let a=0;a<8;a++)o[0+(a<<2)]=this._H[a]>>>24&255,o[1+(a<<2)]=this._H[a]>>>16&255,o[2+(a<<2)]=this._H[a]>>>8&255,o[3+(a<<2)]=this._H[a]>>>0&255;return this.init(),e?function Ms(r,e="utf8"){if(/^utf-?8$/i.test(e))return Ps.decode(r);if(/^base64$/i.test(e))return Es(r);if(/^hex(?:adecimal)?$/i.test(e))return function As(r){return r.reduce((e,t)=>`${e}${t<16?"0":""}${t.toString(16)}`,"")}(r);throw new TypeError("Unsupported string encoding.")}(o,e):o}_transform(){const e=this._H;let t=e[0],n=e[1],i=e[2],o=e[3],a=e[4],l=e[5],_=e[6],v=e[7];const A=new Uint32Array(16);let E;for(E=0;E<16;E++)A[E]=this._buf[3+(E<<2)]|this._buf[2+(E<<2)]<<8|this._buf[1+(E<<2)]<<16|this._buf[E<<2]<<24;for(E=0;E<64;E++){let N;if(E<16)N=A[E];else{let R=A[E+1&15],$=A[E+14&15];N=A[15&E]=(R>>>7^R>>>18^R>>>3^R<<25^R<<14)+($>>>17^$>>>19^$>>>10^$<<15^$<<13)+A[15&E]+A[E+9&15]|0}N=N+v+(a>>>6^a>>>11^a>>>25^a<<26^a<<21^a<<7)+(_^a&(l^_))+this._K[E]|0,v=_,_=l,l=a,a=o+N,o=i,i=n,n=t,t=N+(n&i^o&(n^i))+(n>>>2^n>>>13^n>>>22^n<<30^n<<19^n<<10)|0}e[0]=e[0]+t|0,e[1]=e[1]+n|0,e[2]=e[2]+i|0,e[3]=e[3]+o|0,e[4]=e[4]+a|0,e[5]=e[5]+l|0,e[6]=e[6]+_|0,e[7]=e[7]+v|0}}class mn{err;offset;pageInfo;subject;jsm;filter;payload;constructor(e,t,n,i){if(!e)throw new Error("subject is required");this.subject=e,this.jsm=n,this.offset=0,this.pageInfo={},this.filter=t,this.payload=i||{}}next(){var e=this;return(0,m.Z)(function*(){if(e.err)return[];if(e.pageInfo&&e.offset>=e.pageInfo.total)return[];const t={offset:e.offset};e.payload&&Object.assign(t,e.payload);try{const n=yield e.jsm._request(e.subject,t,{timeout:e.jsm.timeout});return e.pageInfo=n,e.offset+=e.countResponse(n),e.filter(n)}catch(n){throw e.err=n,n}})()}countResponse(e){switch(e?.type){case"io.nats.jetstream.api.v1.stream_names_response":case"io.nats.jetstream.api.v1.stream_list_response":return e.streams.length;case"io.nats.jetstream.api.v1.consumer_list_response":return e.consumers.length;default:return console.error(`jslister.ts: unknown API response for paged output: ${e?.type}`),e.streams?.length||0}return 0}[Symbol.asyncIterator](){var e=this;return Me(function*(){let t=yield me(e.next());for(;t.length>0;){for(const n of t)yield n;t=yield me(e.next())}})()}}class lr extends hn{constructor(e,t){super(e,t)}add(e,t,n=ar.Create){var i=this;return(0,m.Z)(function*(){if(dt(e),t.deliver_group&&t.flow_control)throw new Error("jetstream flow control is not supported with queue groups");if(t.deliver_group&&t.idle_heartbeat)throw new Error("jetstream idle heartbeat is not supported with queue groups");const o={};o.config=t,o.stream_name=e,o.action=n,o.config.durable_name&&Gt(o.config.durable_name);const a=i.nc;let{min:l,ok:_}=a.features.get(Ce.JS_NEW_CONSUMER_CREATE_API);const v=""===t.name?void 0:t.name;if(v&&!_)throw new Error(`consumer 'name' requires server ${l}`);if(v)try{rr("name",v)}catch(R){const $=R.message,Z=$.indexOf("cannot contain");throw-1!==Z?new Error(`consumer 'name' ${$.substring(Z)}`):R}let A,E="";if(Array.isArray(t.filter_subjects)){const{min:R,ok:$}=a.features.get(Ce.JS_MULTIPLE_CONSUMER_FILTER);if(!$)throw new Error(`consumer 'filter_subjects' requires server ${R}`);_=!1}if(t.metadata){const{min:R,ok:$}=a.features.get(Ce.JS_STREAM_CONSUMER_METADATA);if(!$)throw new Error(`consumer 'metadata' requires server ${R}`)}if(_&&(E=t.name??t.durable_name??""),""!==E){let R=t.filter_subject??void 0;">"===R&&(R=void 0),A=void 0!==R?`${i.prefix}.CONSUMER.CREATE.${e}.${E}.${R}`:`${i.prefix}.CONSUMER.CREATE.${e}.${E}`}else A=t.durable_name?`${i.prefix}.CONSUMER.DURABLE.CREATE.${e}.${t.durable_name}`:`${i.prefix}.CONSUMER.CREATE.${e}`;return yield i._request(A,o)})()}update(e,t,n){var i=this;return(0,m.Z)(function*(){const o=yield i.info(e,t);return i.add(e,Object.assign(o.config,n),ar.Update)})()}info(e,t){var n=this;return(0,m.Z)(function*(){return dt(e),Gt(t),yield n._request(`${n.prefix}.CONSUMER.INFO.${e}.${t}`)})()}delete(e,t){var n=this;return(0,m.Z)(function*(){return dt(e),Gt(t),(yield n._request(`${n.prefix}.CONSUMER.DELETE.${e}.${t}`)).success})()}list(e){return dt(e),new mn(`${this.prefix}.CONSUMER.LIST.${e}`,i=>i.consumers,this)}}const ni=Uint8Array.of(43,65,67,75),js=Uint8Array.of(45,78,65,75),gn=Uint8Array.of(43,87,80,73),Ts=Uint8Array.of(43,78,88,84),Ns=Uint8Array.of(43,84,69,82,77),Fs=Uint8Array.of(32);function _n(r){return new Us(r)}class Us{msg;di;didAck;constructor(e){this.msg=e,this.didAck=!1}get subject(){return this.msg.subject}get sid(){return this.msg.sid}get data(){return this.msg.data}get headers(){return this.msg.headers}get info(){return this.di||(this.di=function Rs(r){const e=r.split(".");if(9===e.length&&e.splice(2,0,"_",""),e.length<11||"$JS"!==e[0]||"ACK"!==e[1])throw new Error("not js message");const t={};return t.domain="_"===e[2]?"":e[2],t.account_hash=e[3],t.stream=e[4],t.consumer=e[5],t.redeliveryCount=parseInt(e[6],10),t.redelivered=t.redeliveryCount>1,t.streamSequence=parseInt(e[7],10),t.deliverySequence=parseInt(e[8],10),t.timestampNanos=parseInt(e[9],10),t.pending=parseInt(e[10],10),t}(this.reply)),this.di}get redelivered(){return this.info.redeliveryCount>1}get reply(){return this.msg.reply||""}get seq(){return this.info.streamSequence}doAck(e){this.didAck||(this.didAck=!this.isWIP(e),this.msg.respond(e))}isWIP(e){return 4===e.length&&e[0]===gn[0]&&e[1]===gn[1]&&e[2]===gn[2]&&e[3]===gn[3]}ackAck(){var e=this;return(0,m.Z)(function*(){if(!e.didAck&&(e.didAck=!0,e.msg.reply)){const n=e.msg.publisher,i=new Zr(n.muxSubscriptions,e.msg.reply);n.request(i);try{n.publish(e.msg.reply,ni,{reply:`${n.muxSubscriptions.baseInbox}${i.token}`})}catch(o){i.cancel(o)}try{return yield Promise.race([i.timer,i.deferred]),!0}catch(o){i.cancel(o)}}return!1})()}ack(){this.doAck(ni)}nak(e){let t=js;e&&(t=function gt(){return{encode:r=>Re.encode(r),decode:r=>Oe.decode(r)}}().encode(`-NAK ${JSON.stringify({delay:$e(e)})}`)),this.doAck(t)}working(){this.doAck(gn)}next(e,t={batch:1}){const n={};n.batch=t.batch||1,n.no_wait=t.no_wait||!1,t.expires&&t.expires>0&&(n.expires=$e(t.expires));const i=Qe().encode(n),o=He.concat(Ts,Fs,i);this.msg.respond(o,e?{reply:e}:void 0)}term(){this.doAck(Ns)}json(){return this.msg.json()}string(){return this.msg.string()}}function Wt(r,e,t=!1){if(!0===t&&!r)throw q.errorForCode(U.ApiError,new Error(`${e} is not a function`));if(r&&"function"!=typeof r)throw q.errorForCode(U.ApiError,new Error(`${e} is not a function`))}class Ls extends he{sub;adapter;subIterDone;constructor(e,t,n){var i;super(),i=this,Wt(n.adapter,"adapter",!0),this.adapter=n.adapter,n.callback&&Wt(n.callback,"callback"),this.noIterator="function"==typeof n.callback,n.ingestionFilterFn&&(Wt(n.ingestionFilterFn,"ingestionFilterFn"),this.ingestionFilterFn=n.ingestionFilterFn),n.protocolFilterFn&&(Wt(n.protocolFilterFn,"protocolFilterFn"),this.protocolFilterFn=n.protocolFilterFn),n.dispatchedFn&&(Wt(n.dispatchedFn,"dispatchedFn"),this.dispatchedFn=n.dispatchedFn),n.cleanupFn&&Wt(n.cleanupFn,"cleanupFn");let o=(A,E)=>{this.callback(A,E)};if(n.callback){const A=n.callback;o=(E,N)=>{const[R,$]=this.adapter(E,N);if(R)return void A(R,null);const{ingest:Z}=this.ingestionFilterFn?this.ingestionFilterFn($,this):{ingest:!0};Z&&(!this.protocolFilterFn||this.protocolFilterFn($))&&(A(R,$),this.dispatchedFn&&$&&this.dispatchedFn($))}}const{max:a,queue:l,timeout:_}=n,v={queue:l,timeout:_,callback:o};var A;a&&a>0&&(v.max=a),this.sub=e.subscribe(t,v),n.cleanupFn&&(this.sub.cleanupFn=n.cleanupFn),this.noIterator||this.iterClosed.then(()=>{this.unsubscribe()}),this.subIterDone=oe(),Promise.all([this.sub.closed,this.iterClosed]).then(()=>{this.subIterDone.resolve()}).catch(()=>{this.subIterDone.resolve()}),(A=(0,m.Z)(function*(E){yield E.closed,i.stop()}),function(E){return A.apply(this,arguments)})(this.sub).then().catch()}unsubscribe(e){this.sub.unsubscribe(e)}drain(){return this.sub.drain()}isDraining(){return this.sub.isDraining()}isClosed(){return this.sub.isClosed()}callback(e,t){this.sub.cancelTimeout();const[n,i]=this.adapter(e,t);n&&this.stop(n),i&&this.push(i)}getSubject(){return this.sub.getSubject()}getReceived(){return this.sub.getReceived()}getProcessed(){return this.sub.getProcessed()}getPending(){return this.sub.getPending()}getID(){return this.sub.getID()}getMax(){return this.sub.getMax()}get closed(){return this.sub.closed}}class ur{interval;maxOut;cancelAfter;timer;autoCancelTimer;last;missed;count;callback;constructor(e,t,n={maxOut:2}){this.interval=e,this.maxOut=n?.maxOut||2,this.cancelAfter=n?.cancelAfter||0,this.last=Date.now(),this.missed=0,this.count=0,this.callback=t,this._schedule()}cancel(){this.autoCancelTimer&&clearTimeout(this.autoCancelTimer),this.timer&&clearInterval(this.timer),this.timer=0,this.autoCancelTimer=0}work(){this.last=Date.now(),this.missed=0}_change(e,t=0,n=2){this.interval=e,this.maxOut=n,this.cancelAfter=t,this.restart()}restart(){this.cancel(),this._schedule()}_schedule(){this.cancelAfter>0&&(this.autoCancelTimer=setTimeout(()=>{this.cancel()},this.cancelAfter)),this.timer=setInterval(()=>{if(this.count++,Date.now()-this.last>this.interval&&this.missed++,this.missed>=this.maxOut)try{!0===this.callback(this.missed)&&this.cancel()}catch(e){console.log(e)}},this.interval)}}var It,Mt=function(r){return r[r.Unset=-1]="Unset",r[r.Consume=0]="Consume",r[r.Fetch=1]="Fetch",r}(Mt||{}),hr=function(r){return r.HeartbeatsMissed="heartbeats_missed",r}(hr||{}),Rn=function(r){return r.DebugEvent="debug",r.Discard="discard",r.Next="next",r}(Rn||{});class dr extends he{consumer;opts;sub;monitor;pending;inbox;refilling;stack;pong;callback;timeout;cleanupHandler;listeners;statusIterator;constructor(e,t,n=!1){var i;super(),i=this,this.consumer=e,this.opts=this.parseOptions(t,n),this.callback=t.callback||null,this.noIterator="function"==typeof this.callback,this.monitor=null,this.pong=null,this.pending={msgs:0,bytes:0,requests:0},this.refilling=n,this.stack=(new Error).stack.split("\n").slice(1).join("\n"),this.timeout=null,this.inbox=T(e.api.nc.options.inboxPrefix),this.listeners=[];const{max_messages:o,max_bytes:a,idle_heartbeat:l,threshold_bytes:_,threshold_messages:v}=this.opts;this.closed().then(()=>{if(this.cleanupHandler)try{this.cleanupHandler()}catch{}});const{sub:A}=this;A&&A.unsubscribe(),this.sub=e.api.nc.subscribe(this.inbox,{callback:(E,N)=>{if(E)this.stop();else{if(this.monitor?.work(),N.subject===this.inbox){if(or(N))return;const $=N.headers?.code,Z=N.headers?.description?.toLowerCase()||"unknown",{msgsLeft:Ee,bytesLeft:de}=this.parseDiscard(N.headers);if(Ee>0||de>0)this.pending.msgs-=Ee,this.pending.bytes-=de,this.pending.requests--,this.notify(Rn.Discard,{msgsLeft:Ee,bytesLeft:de});else{const et=()=>{const tt=new q(Z,`${$}`);return tt.stack+=`\n\n${this.stack}`,tt};if(400===$){const tt=et();this._push(()=>{this.stop(tt)})}else if(409===$&&"consumer deleted"===Z){const tt=et();this.stop(tt)}else this.notify(Rn.DebugEvent,`${$} ${Z}`)}}else this._push(_n(N)),this.received++,this.pending.msgs&&this.pending.msgs--,this.pending.bytes&&(this.pending.bytes-=N.size());if(0===this.pending.msgs&&0===this.pending.bytes&&(this.pending.requests=0),this.refilling){if(o&&this.pending.msgs<=v||a&&this.pending.bytes<=_){const $=this.pullOptions();this.pull($)}}else 0===this.pending.requests&&this._push(()=>{this.stop()})}}}),this.sub.closed.then(()=>{this.sub.draining&&this._push(()=>{this.stop()})}),l&&(this.monitor=new ur(l,E=>(this.notify(hr.HeartbeatsMissed,E),this.resetPending().then(()=>{}).catch(()=>{}),!1),{maxOut:2})),(0,m.Z)(function*(){const E=e.api.nc.status();i.statusIterator=E;var $,N=!1,R=!1;try{for(var Ee,Z=(0,ce.Z)(E);N=!(Ee=yield Z.next()).done;N=!1)switch(Ee.value.type){case Ze.Disconnect:i.monitor?.cancel();break;case Ze.Reconnect:i.resetPending().then(et=>{et&&i.monitor?.restart()}).catch(()=>{})}}catch(de){R=!0,$=de}finally{try{N&&null!=Z.return&&(yield Z.return())}finally{if(R)throw $}}})(),this.pull(this.pullOptions())}_push(e){if(this.callback){const t="function"==typeof e?e:null;try{t?t():this.callback(e)}catch(n){this.stop(n)}}else super.push(e)}notify(e,t){this.listeners.length>0&&this.listeners.forEach(n=>{n.done||n.push({type:e,data:t})})}resetPending(){return this.consumer.info().then(e=>(this.pending.msgs=0,this.pending.bytes=0,this.pending.requests=0,this.pull(this.pullOptions()),!0)).catch(e=>("consumer not found"===e.message&&this.stop(e),!1))}pull(e){this.pending.bytes+=e.max_bytes??0,this.pending.msgs+=e.batch??0,this.pending.requests++;const t=this.consumer.api.nc;this._push(()=>{t.publish(`${this.consumer.api.prefix}.CONSUMER.MSG.NEXT.${this.consumer.stream}.${this.consumer.name}`,this.consumer.api.jc.encode(e),{reply:this.inbox}),this.notify(Rn.Next,e)})}pullOptions(){return{batch:this.opts.max_messages-this.pending.msgs,max_bytes:this.opts.max_bytes-this.pending.bytes,idle_heartbeat:$e(this.opts.idle_heartbeat),expires:$e(this.opts.expires)}}parseDiscard(e){const t={msgsLeft:0,bytesLeft:0},n=e?.get(ft.PendingMessagesHdr);n&&(t.msgsLeft=parseInt(n));const i=e?.get(ft.PendingBytesHdr);return i&&(t.bytesLeft=parseInt(i)),t}trackTimeout(e){this.timeout=e}close(){return this.stop(),this.iterClosed}closed(){return this.iterClosed}clearTimers(){this.monitor?.cancel(),this.monitor=null,this.timeout?.cancel(),this.timeout=null}setCleanupHandler(e){this.cleanupHandler=e}stop(e){this.sub?.unsubscribe(),this.clearTimers(),this.statusIterator?.stop(),this._push(()=>{super.stop(e),this.listeners.forEach(t=>{t.stop()})})}parseOptions(e,t=!1){const n=e||{};if(n.max_messages=n.max_messages||0,n.max_bytes=n.max_bytes||0,0!==n.max_messages&&0!==n.max_bytes)throw new Error("only specify one of max_messages or max_bytes");if(0===n.max_messages&&(n.max_messages=100),n.expires=n.expires||3e4,n.expires<1e3)throw new Error("expires should be at least 1000ms");if(n.idle_heartbeat=n.idle_heartbeat||n.expires/2,n.idle_heartbeat=n.idle_heartbeat>3e4?3e4:n.idle_heartbeat,t){const i=Math.round(.75*n.max_messages)||1;n.threshold_messages=n.threshold_messages||i;const o=Math.round(.75*n.max_bytes)||1;n.threshold_bytes=n.threshold_bytes||o}return n}status(){const e=new he;return this.listeners.push(e),Promise.resolve(e)}}class ri extends he{src;constructor(){super()}setSource(e){this.src&&(this.src.setCleanupHandler(),this.src.stop()),this.src=e,this.src.setCleanupHandler(()=>{this.close().catch()})}stop(e){this.src?.stop(e),super.stop(e)}close(){return this.stop(),this.iterClosed}status(){return Promise.reject(new Error("ordered consumers don't report consumer status"))}}class ii{api;_info;stream;name;constructor(e,t){this.api=e,this._info=t,this.stream=t.stream_name,this.name=t.name}consume(e={max_messages:100,expires:3e4}){return Promise.resolve(new dr(this,e,!0))}fetch(e={max_messages:100,expires:3e4}){const t=new dr(this,e,!1),i=Le(Math.round(1.05*t.opts.expires));return t.closed().then(()=>{i.cancel()}),i.catch(()=>{t.close().catch()}),t.trackTimeout(i),Promise.resolve(t)}next(e={expires:3e4}){const t=oe(),n=e;n.max_messages=1;const i=new dr(this,n,!1),o=Math.round(1.05*i.opts.expires);o>=6e4&&(0,m.Z)(function*(){var v,l=!1,_=!1;try{for(var E,A=(0,ce.Z)(yield i.status());l=!(E=yield A.next()).done;l=!1){const N=E.value;if(N.type===hr.HeartbeatsMissed&&N.data>=2){t.reject(new Error("consumer missed heartbeats"));break}}}catch(N){_=!0,v=N}finally{try{l&&null!=A.return&&(yield A.return())}finally{if(_)throw v}}})().catch(),(0,m.Z)(function*(){var v,l=!1,_=!1;try{for(var E,A=(0,ce.Z)(i);l=!(E=yield A.next()).done;l=!1){t.resolve(E.value);break}}catch(N){_=!0,v=N}finally{try{l&&null!=A.return&&(yield A.return())}finally{if(_)throw v}}})().catch();const a=Le(o);return i.closed().then(()=>{t.resolve(null),a.cancel()}).catch(l=>{t.reject(l)}),a.catch(l=>{t.resolve(null),i.close().catch()}),i.trackTimeout(a),t}delete(){const{stream_name:e,name:t}=this._info;return this.api.delete(e,t)}info(e=!1){if(e)return Promise.resolve(this._info);const{stream_name:t,name:n}=this._info;return this.api.info(t,n).then(i=>(this._info=i,this._info))}}class Bs{api;consumerOpts;consumer;opts;cursor;stream;namePrefix;serial;currentConsumer;userCallback;iter;type;startSeq;constructor(e,t,n={}){this.api=e,this.stream=t,this.cursor={stream_seq:1,deliver_seq:0},this.namePrefix=Ke.next(),this.serial=0,this.currentConsumer=null,this.userCallback=null,this.iter=null,this.type=Mt.Unset,this.consumerOpts=n,this.startSeq=this.consumerOpts.opt_start_seq||0,this.cursor.stream_seq=this.startSeq>0?this.startSeq-1:0}getConsumerOpts(e){this.serial++;const n={name:`${this.namePrefix}_${this.serial}`,deliver_policy:Ge.StartSequence,opt_start_seq:e=0===e?1:e,ack_policy:nt.None,inactive_threshold:$e(3e5),num_replicas:1};return!0===this.consumerOpts.headers_only&&(n.headers_only=!0),Array.isArray(this.consumerOpts.filterSubjects)&&(n.filter_subjects=this.consumerOpts.filterSubjects),"string"==typeof this.consumerOpts.filterSubjects&&(n.filter_subject=this.consumerOpts.filterSubjects),e===this.startSeq+1&&(n.deliver_policy=this.consumerOpts.deliver_policy||Ge.StartSequence,(this.consumerOpts.deliver_policy===Ge.LastPerSubject||this.consumerOpts.deliver_policy===Ge.New||this.consumerOpts.deliver_policy===Ge.Last)&&(delete n.opt_start_seq,n.deliver_policy=this.consumerOpts.deliver_policy),n.deliver_policy===Ge.LastPerSubject&&typeof n.filter_subjects>"u"&&typeof n.filter_subject>"u"&&(n.filter_subject=">"),this.consumerOpts.opt_start_time&&(delete n.opt_start_seq,n.deliver_policy=Ge.StartTime,n.opt_start_time=this.consumerOpts.opt_start_time),this.consumerOpts.inactive_threshold&&(n.inactive_threshold=$e(this.consumerOpts.inactive_threshold))),n}resetConsumer(e=0){var t=this;return(0,m.Z)(function*(){if(t.consumer)for(;;)try{yield t.delete();break}catch(o){if("TIMEOUT"!==o.message)throw o}e=0===e?1:e,t.cursor.deliver_seq=0;const n=t.getConsumerOpts(e);let i;for(n.max_deliver=1,n.mem_storage=!0;;)try{i=yield t.api.add(t.stream,n);break}catch(o){if("TIMEOUT"!==o.message)throw o}return i})()}internalHandler(e){return t=>{if(this.serial!==e)return;const n=t.info.deliverySequence;n===this.cursor.deliver_seq+1?(this.cursor.deliver_seq=n,this.cursor.stream_seq=t.info.streamSequence,this.userCallback?this.userCallback(t):this.iter?.push(t)):this.reset(this.opts)}}reset(e={max_messages:100,expires:3e4},t=!1){var n=this;return(0,m.Z)(function*(){n.currentConsumer=yield n.resetConsumer(n.cursor.stream_seq+1),null===n.iter&&(n.iter=new ri),n.consumer=new ii(n.api,n.currentConsumer),e.callback=n.internalHandler(n.serial);let o=null;if(n.type===Mt.Fetch&&t)o=yield n.consumer.fetch(e);else{if(n.type!==Mt.Consume)return Promise.reject("reset called with unset consumer type");o=yield n.consumer.consume(e)}return n.iter.setSource(o),n.iter})()}consume(e={max_messages:100,expires:3e4}){if(this.type===Mt.Fetch)return Promise.reject(new Error("ordered consumer initialized as fetch"));if(this.type===Mt.Consume)return Promise.reject(new Error("ordered consumer doesn't support concurrent consume"));const{callback:t}=e;return t&&(this.userCallback=t),this.type=Mt.Consume,this.opts=e,this.reset(e)}fetch(e={max_messages:100,expires:3e4}){if(this.type===Mt.Consume)return Promise.reject(new Error("ordered consumer already initialized as consume"));if(!1===this.iter?.done)return Promise.reject(new Error("ordered consumer doesn't support concurrent fetch"));const{callback:t}=e;return t&&(this.userCallback=t),this.type=Mt.Fetch,this.opts=e,this.iter=new ri,this.reset(e,!0)}next(e={expires:3e4}){var t=this;return(0,m.Z)(function*(){const n=oe(),i=e;return i.max_messages=1,i.callback=a=>{t.userCallback=null,n.resolve(a)},(yield t.fetch(i)).iterClosed.then(()=>{n.resolve(null)}).catch(a=>{n.reject(a)}),n})()}delete(){return this.currentConsumer?this.api.delete(this.stream,this.currentConsumer.name).then(e=>Promise.resolve(e)).catch(e=>Promise.reject(e)).finally(()=>{this.currentConsumer=null}):Promise.resolve(!1)}info(e){var t=this;return(0,m.Z)(function*(){return null==t.currentConsumer?(t.currentConsumer=yield t.resetConsumer(t.serial),Promise.resolve(t.currentConsumer)):e&&t.currentConsumer?Promise.resolve(t.currentConsumer):t.api.info(t.stream,t.currentConsumer.name)})()}}function Un(r){if(void 0===r)return;const{domain:e}=r;if(void 0===e)return r;const t=Object.assign({},r);if(delete t.domain,""===e)return t;if(t.external)throw new Error("domain and external are both set");return t.external={api:`$JS.${e}.API`},t}const fr="OBJ_";class si{api;notified;constructor(e){this.api=e,this.notified=!1}checkVersion(){const e=this.api.nc.features.get(Ce.JS_SIMPLIFICATION);return e.ok?Promise.resolve():Promise.reject(new Error(`consumers framework is only supported on servers ${e.min} or better`))}get(e,t={}){var n=this;return(0,m.Z)(function*(){return"object"==typeof t?n.ordered(e,t):(yield n.checkVersion(),n.api.info(e,t).then(i=>void 0!==i.config.deliver_subject?Promise.reject(new Error("push consumer not supported")):new ii(n.api,i)).catch(i=>Promise.reject(i)))})()}ordered(e,t){var n=this;return(0,m.Z)(function*(){yield n.checkVersion();const i=n.api;return new mr(i.nc,i.opts).info(e).then(a=>Promise.resolve(new Bs(n.api,e,t))).catch(a=>Promise.reject(a))})()}}class Ln{api;_info;constructor(e,t){this.api=e,this._info=t}get name(){return this._info.config.name}alternates(){return this.info().then(e=>e.alternates?e.alternates:[])}best(){var e=this;return(0,m.Z)(function*(){if(yield e.info(),e._info.alternates){const t=yield e.api.info(e._info.alternates[0].name);return new Ln(e.api,t)}return e})()}info(e=!1,t){return e?Promise.resolve(this._info):this.api.info(this.name,t).then(n=>(this._info=n,this._info))}getConsumer(e){return new si(new lr(this.api.nc,this.api.opts)).get(this.name,e)}getMessage(e){return this.api.getMessage(this.name,e)}deleteMessage(e,t){return this.api.deleteMessage(this.name,e,t)}}const Bn="KV-Operation",Ds=/^[-/=.\w]+$/,qs=/^[-/=.>*\w]+$/,Vs=/^[-\w]+$/;function Hs(r){if(r.startsWith(".")||r.endsWith(".")||!Ds.test(r))throw new Error(`invalid key: ${r}`)}function zs(r){if(r.startsWith(".")||r.endsWith(".")||!qs.test(r))throw new Error(`invalid key: ${r}`)}function Ks(r){if(r.startsWith(".")||r.endsWith("."))throw new Error(`invalid key: ${r}`);const e=r.split(".");let t=!1;for(let n=0;n<e.length;n++)switch(e[n]){case"*":t=!0;break;case">":if(n!==e.length-1)throw new Error(`invalid key: ${r}`);t=!0}return t}function $n(r){if(!Vs.test(r))throw new Error(`invalid bucket name: ${r}`)}var r;(r=It||(It={})).MsgIdHdr="Nats-Msg-Id",r.ExpectedStreamHdr="Nats-Expected-Stream",r.ExpectedLastSeqHdr="Nats-Expected-Last-Sequence",r.ExpectedLastMsgIdHdr="Nats-Expected-Last-Msg-Id",r.ExpectedLastSubjectSequenceHdr="Nats-Expected-Last-Subject-Sequence";class bn{js;jsm;stream;bucket;direct;codec;prefix;editPrefix;useJsPrefix;_prefixLen;constructor(e,t,n){$n(e),this.js=t,this.jsm=n,this.bucket=e,this.prefix="$KV",this.editPrefix="",this.useJsPrefix=!1,this._prefixLen=0}static create(e,t,n={}){return(0,m.Z)(function*(){$n(t);const i=yield e.jetstreamManager(),o=new bn(t,e,i);return yield o.init(n),o})()}static bind(e,t,n={}){return(0,m.Z)(function*(){const i=yield e.jetstreamManager(),o=yield i.streams.info(`${yt}${t}`);$n(o.config.name);const a=new bn(t,e,i);return Object.assign(a,o),a.codec=n.codec||{key:{encode:r=>r,decode:r=>r},value:{encode:r=>r,decode:r=>r}},a.direct=o.config.allow_direct??!1,a.initializePrefixes(o),a})()}init(e={}){var t=this;return(0,m.Z)(function*(){const n=Object.assign(function $s(){return{replicas:1,history:1,timeout:2e3,maxBucketSize:-1,maxValueSize:-1,codec:{key:{encode:r=>r,decode:r=>r},value:{encode:r=>r,decode:r=>r}},storage:Wr.File}}(),e);t.codec=n.codec;const i={};t.stream=i.name=e.streamName??t.bucketName(),i.retention=Jr.Limits,i.max_msgs_per_subject=n.history,n.maxBucketSize&&(n.max_bytes=n.maxBucketSize),n.max_bytes&&(i.max_bytes=n.max_bytes),i.max_msg_size=n.maxValueSize,i.storage=n.storage;const o=e.placementCluster??"";if(o&&(e.placement={},e.placement.cluster=o,e.placement.tags=[]),e.placement&&(i.placement=e.placement),e.republish&&(i.republish=e.republish),e.description&&(i.description=e.description),e.mirror){const N=Object.assign({},e.mirror);N.name.startsWith(yt)||(N.name=`${yt}${N.name}`),i.mirror=N,i.mirror_direct=!0}else if(e.sources){const N=e.sources.map(R=>{const $=Object.assign({},R);$.name.startsWith(yt)||($.name=`${yt}${$.name}`)});i.sources=N}else i.subjects=[t.subjectForBucket()];e.metadata&&(i.metadata=e.metadata);const a=t.js.nc,l=a.getServerVersion(),_=!!l&&tr(l,Dt("2.7.2"))>=0;i.discard=_?Fn.New:Fn.Old;const{ok:v,min:A}=a.features.get(Ce.JS_ALLOW_DIRECT);if(!v&&!0===e.allow_direct)return Promise.reject(new Error(`allow_direct is not available on server version ${l?`${l.major}.${l.minor}.${l.micro}`:"unknown"} - requires ${A}`));let E;e.allow_direct="boolean"==typeof e.allow_direct?e.allow_direct:v,i.allow_direct=e.allow_direct,t.direct=i.allow_direct,i.num_replicas=n.replicas,n.ttl&&(i.max_age=$e(n.ttl)),i.allow_rollup_hdrs=!0;try{E=yield t.jsm.streams.info(i.name),!E.config.allow_direct&&!0===t.direct&&(t.direct=!1)}catch(N){if("stream not found"!==N.message)throw N;E=yield t.jsm.streams.add(i)}t.initializePrefixes(E)})()}initializePrefixes(e){this._prefixLen=0,this.prefix=`$KV.${this.bucket}`,this.useJsPrefix="$JS.API"!==this.js.apiPrefix;const{mirror:t}=e.config;if(t){let n=t.name;if(n.startsWith(yt)&&(n=n.substring(3)),t.external&&""!==t.external.api){const i=t.name.substring(3);this.useJsPrefix=!1,this.prefix=`$KV.${i}`,this.editPrefix=`${t.external.api}.$KV.${n}`}else this.editPrefix=this.prefix}}bucketName(){return this.stream??`${yt}${this.bucket}`}subjectForBucket(){return`${this.prefix}.${this.bucket}.>`}subjectForKey(e,t=!1){const n=[];return t?(this.useJsPrefix&&n.push(this.js.apiPrefix),n.push(""!==this.editPrefix?this.editPrefix:this.prefix)):this.prefix&&n.push(this.prefix),n.push(e),n.join(".")}fullKeyName(e){return""!==this.prefix?`${this.prefix}.${e}`:`$KV.${this.bucket}.${e}`}get prefixLen(){return 0===this._prefixLen&&(this._prefixLen=this.prefix.length+1),this._prefixLen}encodeKey(e){const t=[];for(const n of e.split("."))switch(n){case">":case"*":t.push(n);break;default:t.push(this.codec.key.encode(n))}return t.join(".")}decodeKey(e){const t=[];for(const n of e.split("."))switch(n){case">":case"*":t.push(n);break;default:t.push(this.codec.key.decode(n))}return t.join(".")}validateKey=Hs;validateSearchKey=zs;hasWildcards=Ks;close(){return Promise.resolve()}dataLen(e,t){const n=t&&t.get(ft.MessageSizeHdr)||"";return""!==n?parseInt(n,10):e.length}smToEntry(e){return new Ys(this.bucket,this.prefixLen,e)}jmToEntry(e){const t=this.decodeKey(e.subject.substring(this.prefixLen));return new Xs(this.bucket,t,e)}create(e,t){var n=this;return(0,m.Z)(function*(){let i;try{const a=yield n.put(e,t,{previousSeq:0});return Promise.resolve(a)}catch(a){if(i=a,10071!==a?.api_error?.err_code)return Promise.reject(a)}let o=0;try{const a=yield n.get(e);return"DEL"===a?.operation||"PURGE"===a?.operation?(o=null!==a?a.revision:0,n.update(e,t,o)):Promise.reject(i)}catch(a){return Promise.reject(a)}})()}update(e,t,n){if(n<=0)throw new Error("version must be greater than 0");return this.put(e,t,{previousSeq:n})}put(e,t,n={}){var i=this;return(0,m.Z)(function*(){const o=i.encodeKey(e);i.validateKey(o);const a={};if(void 0!==n.previousSeq){const l=je();a.headers=l,l.set(It.ExpectedLastSubjectSequenceHdr,`${n.previousSeq}`)}try{return(yield i.js.publish(i.subjectForKey(o,!0),t,a)).seq}catch(l){const _=l;return _.isJetStreamError()?(_.message=_.api_error?.description,_.code=`${_.api_error?.code}`,Promise.reject(_)):Promise.reject(l)}})()}get(e,t){var n=this;return(0,m.Z)(function*(){const i=n.encodeKey(e);n.validateKey(i);let a,o={last_by_subj:n.subjectForKey(i)};t&&t.revision>0&&(o={seq:t.revision});try{a=n.direct?yield n.jsm.direct.getMessage(n.bucketName(),o):yield n.jsm.streams.getMessage(n.bucketName(),o);const l=n.smToEntry(a);return l.key!==i?null:l}catch(l){if(l.code===U.JetStream404NoMessages)return null;throw l}})()}purge(e){return this._deleteOrPurge(e,"PURGE")}delete(e){return this._deleteOrPurge(e,"DEL")}purgeDeletes(e=18e5){var t=this;return(0,m.Z)(function*(){const n=oe(),i=[],o=yield t.watch({key:">",initializedFn:()=>{n.resolve()}});(0,m.Z)(function*(){var E,v=!1,A=!1;try{for(var R,N=(0,ce.Z)(o);v=!(R=yield N.next()).done;v=!1){const $=R.value;("DEL"===$.operation||"PURGE"===$.operation)&&i.push($)}}catch($){A=!0,E=$}finally{try{v&&null!=N.return&&(yield N.return())}finally{if(A)throw E}}})().then(),yield n,o.stop();const a=Date.now()-e,l=i.map(v=>{const A=t.subjectForKey(v.key);return v.created.getTime()>=a?t.jsm.streams.purge(t.stream,{filter:A,keep:1}):t.jsm.streams.purge(t.stream,{filter:A,keep:0})}),_=yield Promise.all(l);return _.unshift({success:!0,purged:0}),_.reduce((v,A)=>(v.purged+=A.purged,v))})()}_deleteOrPurge(e,t){var n=this;return(0,m.Z)(function*(){if(!n.hasWildcards(e))return n._doDeleteOrPurge(e,t);const i=yield n.keys(e),o=[];var _,a=!1,l=!1;try{for(var A,v=(0,ce.Z)(i);a=!(A=yield v.next()).done;a=!1)o.push(n._doDeleteOrPurge(A.value,t)),100===o.length&&(yield Promise.all(o),o.length=0)}catch(E){l=!0,_=E}finally{try{a&&null!=v.return&&(yield v.return())}finally{if(l)throw _}}o.length>0&&(yield Promise.all(o))})()}_doDeleteOrPurge(e,t){var n=this;return(0,m.Z)(function*(){const i=n.encodeKey(e);n.validateKey(i);const o=je();o.set(Bn,t),"PURGE"===t&&o.set(ft.RollupHdr,ft.RollupValueSubject),yield n.js.publish(n.subjectForKey(i,!0),pe,{headers:o})})()}_buildCC(e,t,n={}){const i=this.encodeKey(e);this.validateSearchKey(e);let o=Ge.LastPerSubject;return t===Ot.AllHistory&&(o=Ge.All),t===Ot.UpdatesOnly&&(o=Ge.New),Object.assign({deliver_policy:o,ack_policy:nt.None,filter_subject:this.fullKeyName(i),flow_control:!0,idle_heartbeat:$e(5e3)},n)}remove(e){return this.purge(e)}history(e={}){var t=this;return(0,m.Z)(function*(){const n=e.key??">",i=new he,o={};let a;o.headers_only=e.headers_only||!1,a=()=>{i.stop()};let l=0;const _=t._buildCC(n,Ot.AllHistory,o),v=_.filter_subject,A=Rt(_);A.bindStream(t.stream),A.orderedConsumer(),A.callback((N,R)=>{if(N)i.stop(N);else if(R){const $=t.jmToEntry(R);i.push($),i.received++,(a&&l>0&&i.received>=l||0===R.info.pending)&&(i.push(a),a=void 0)}});const E=yield t.js.subscribe(v,A);if(a){const{info:{last:N}}=E,R=N.num_pending+N.delivered.consumer_seq;if(0===R||i.received>=R)try{a()}catch($){i.stop($)}finally{a=void 0}else l=R}return i._data=E,i.iterClosed.then(()=>{E.unsubscribe()}),E.closed.then(()=>{i.stop()}).catch(N=>{i.stop(N)}),i})()}watch(e={}){var t=this;return(0,m.Z)(function*(){const n=e.key??">",i=new he,o={};o.headers_only=e.headers_only||!1;let a=Ot.LastValue;e.include===Ot.AllHistory?a=Ot.AllHistory:e.include===Ot.UpdatesOnly&&(a=Ot.UpdatesOnly);const l=!0===e.ignoreDeletes;let _=e.initializedFn,v=0;const A=t._buildCC(n,a,o),E=A.filter_subject,N=Rt(A);N.bindStream(t.stream),N.orderedConsumer(),N.callback(($,Z)=>{if($)i.stop($);else if(Z){const Ee=t.jmToEntry(Z);if(l&&"DEL"===Ee.operation)return;i.push(Ee),i.received++,_&&(v>0&&i.received>=v||0===Z.info.pending)&&(i.push(_),_=void 0)}});const R=yield t.js.subscribe(E,N);if(_){const{info:{last:$}}=R,Z=$.num_pending+$.delivered.consumer_seq;if(0===Z||i.received>=Z)try{_()}catch(Ee){i.stop(Ee)}finally{_=void 0}else v=Z}return i._data=R,i.iterClosed.then(()=>{R.unsubscribe()}),R.closed.then(()=>{i.stop()}).catch($=>{i.stop($)}),i})()}keys(e=">"){var t=this;return(0,m.Z)(function*(){const n=new he,i=t._buildCC(e,Ot.LastValue,{headers_only:!0}),o=i.filter_subject,a=Rt(i);a.bindStream(t.stream),a.orderedConsumer();const l=yield t.js.subscribe(o,a);return(0,m.Z)(function*(){var E,v=!1,A=!1;try{for(var R,N=(0,ce.Z)(l);v=!(R=yield N.next()).done;v=!1){const $=R.value;{const Z=$.headers?.get(Bn);if("DEL"!==Z&&"PURGE"!==Z){const Ee=t.decodeKey($.subject.substring(t.prefixLen));n.push(Ee)}0===$.info.pending&&l.unsubscribe()}}}catch($){A=!0,E=$}finally{try{v&&null!=N.return&&(yield N.return())}finally{if(A)throw E}}})().then(()=>{n.stop()}).catch(v=>{n.stop(v)}),0===l.info.last.num_pending&&l.unsubscribe(),n})()}purgeBucket(e){return this.jsm.streams.purge(this.bucketName(),e)}destroy(){return this.jsm.streams.delete(this.bucketName())}status(){var e=this;return(0,m.Z)(function*(){const n=e.js.nc.info?.cluster??"",i=e.bucketName(),o=yield e.jsm.streams.info(i);return new ci(o,n)})()}}class ci{si;cluster;constructor(e,t=""){this.si=e,this.cluster=t}get bucket(){return this.si.config.name.startsWith(yt)?this.si.config.name.substring(3):this.si.config.name}get values(){return this.si.state.messages}get history(){return this.si.config.max_msgs_per_subject}get ttl(){return ir(this.si.config.max_age)}get bucket_location(){return this.cluster}get backingStore(){return this.si.config.storage}get storage(){return this.si.config.storage}get replicas(){return this.si.config.num_replicas}get description(){return this.si.config.description??""}get maxBucketSize(){return this.si.config.max_bytes}get maxValueSize(){return this.si.config.max_msg_size}get max_bytes(){return this.si.config.max_bytes}get placement(){return this.si.config.placement||{cluster:"",tags:[]}}get placementCluster(){return this.si.config.placement?.cluster??""}get republish(){return this.si.config.republish??{src:"",dest:""}}get streamInfo(){return this.si}get size(){return this.si.state.bytes}get metadata(){return this.si.config.metadata??{}}}const li="SHA-256=";class pr{si;backingStore;constructor(e){this.si=e,this.backingStore="JetStream"}get bucket(){return function Gs(r){return r.startsWith(fr)?r.substring(4):r}(this.si.config.name)}get description(){return this.si.config.description??""}get ttl(){return this.si.config.max_age}get storage(){return this.si.config.storage}get replicas(){return this.si.config.num_replicas}get sealed(){return this.si.config.sealed}get size(){return this.si.state.bytes}get streamInfo(){return this.si}get metadata(){return this.si.config.metadata}}class mr extends hn{constructor(e,t){super(e,t)}checkStreamConfigVersions(e){const t=this.nc;if(e.metadata){const{min:i,ok:o}=t.features.get(Ce.JS_STREAM_CONSUMER_METADATA);if(!o)throw new Error(`stream 'metadata' requires server ${i}`)}if(e.first_seq){const{min:i,ok:o}=t.features.get(Ce.JS_STREAM_FIRST_SEQ);if(!o)throw new Error(`stream 'first_seq' requires server ${i}`)}if(e.subject_transform){const{min:i,ok:o}=t.features.get(Ce.JS_STREAM_SUBJECT_TRANSFORM);if(!o)throw new Error(`stream 'subject_transform' requires server ${i}`)}if(e.compression){const{min:i,ok:o}=t.features.get(Ce.JS_STREAM_COMPRESSION);if(!o)throw new Error(`stream 'compression' requires server ${i}`)}if(e.consumer_limits){const{min:i,ok:o}=t.features.get(Ce.JS_DEFAULT_CONSUMER_LIMITS);if(!o)throw new Error(`stream 'consumer_limits' requires server ${i}`)}function n(i,o){if((o.subject_transforms?.length||0)>0){const{min:l,ok:_}=t.features.get(Ce.JS_STREAM_SOURCE_SUBJECT_TRANSFORM);if(!_)throw new Error(`${i} 'subject_transforms' requires server ${l}`)}}e.sources&&e.sources.forEach(i=>{n("stream sources",i)}),e.mirror&&n("stream mirror",e.mirror)}add(e={}){var t=this;return(0,m.Z)(function*(){t.checkStreamConfigVersions(e),dt(e.name),e.mirror=Un(e.mirror),e.sources=e.sources?.map(Un);const i=yield t._request(`${t.prefix}.STREAM.CREATE.${e.name}`,e);return t._fixInfo(i),i})()}delete(e){var t=this;return(0,m.Z)(function*(){return dt(e),(yield t._request(`${t.prefix}.STREAM.DELETE.${e}`)).success})()}update(e,t={}){var n=this;return(0,m.Z)(function*(){if("object"==typeof e){const _=e;e=_.name,t=_,console.trace("\x1b[33m >> streams.update(config: StreamConfig) api changed to streams.update(name: string, config: StreamUpdateConfig) - this shim will be removed - update your code.  \x1b[0m")}n.checkStreamConfigVersions(t),dt(e);const i=yield n.info(e),o=Object.assign(i.config,t);o.mirror=Un(o.mirror),o.sources=o.sources?.map(Un);const l=yield n._request(`${n.prefix}.STREAM.UPDATE.${e}`,o);return n._fixInfo(l),l})()}info(e,t){var n=this;return(0,m.Z)(function*(){dt(e);const i=`${n.prefix}.STREAM.INFO.${e}`;let a=yield n._request(i,t),{total:l,limit:_}=a,v=a.state.subjects?Object.getOwnPropertyNames(a.state.subjects).length:1;if(l&&l>v){const A=[a],E=t||{};let N=0;for(;l>v;){N++,E.offset=_*N;const $=yield n._request(i,E);l=$.total,A.push($);const Z=Object.getOwnPropertyNames($.state.subjects).length;if(v+=Z,Z<_)break}let R={};for(let $=0;$<A.length;$++)a=A[$],a.state.subjects&&(R=Object.assign(R,a.state.subjects));a.offset=0,a.total=0,a.limit=0,a.state.subjects=R}return n._fixInfo(a),a})()}list(e=""){return new mn(`${this.prefix}.STREAM.LIST`,o=>{const a=o;return a.streams.forEach(l=>{this._fixInfo(l)}),a.streams},this,e?.length?{subject:e}:{})}_fixInfo(e){e.config.sealed=e.config.sealed||!1,e.config.deny_delete=e.config.deny_delete||!1,e.config.deny_purge=e.config.deny_purge||!1,e.config.allow_rollup_hdrs=e.config.allow_rollup_hdrs||!1}purge(e,t){var n=this;return(0,m.Z)(function*(){if(t){const{keep:o,seq:a}=t;if("number"==typeof o&&"number"==typeof a)throw new Error("can specify one of keep or seq")}return dt(e),yield n._request(`${n.prefix}.STREAM.PURGE.${e}`,t)})()}deleteMessage(e,t,n=!0){var i=this;return(0,m.Z)(function*(){dt(e);const o={seq:t};return n||(o.no_erase=!0),(yield i._request(`${i.prefix}.STREAM.MSG.DELETE.${e}`,o)).success})()}getMessage(e,t){var n=this;return(0,m.Z)(function*(){dt(e);const o=yield n._request(`${n.prefix}.STREAM.MSG.GET.${e}`,t);return new Js(o)})()}find(e){return this.findStream(e)}listKvs(){return new mn(`${this.prefix}.STREAM.LIST`,n=>{const o=n.streams.filter(_=>_.config.name.startsWith(yt));o.forEach(_=>{this._fixInfo(_)});let a="";return o.length&&(a=this.nc.info?.cluster??""),o.map(_=>new ci(_,a))},this)}listObjectStores(){return new mn(`${this.prefix}.STREAM.LIST`,n=>{const o=n.streams.filter(l=>l.config.name.startsWith(fr));return o.forEach(l=>{this._fixInfo(l)}),o.map(l=>new pr(l))},this)}names(e=""){return new mn(`${this.prefix}.STREAM.NAMES`,o=>o.streams,this,e?.length?{subject:e}:{})}get(e){var t=this;return(0,m.Z)(function*(){const n=yield t.info(e);return Promise.resolve(new Ln(t,n))})()}}let Js=(()=>class r{_header;smr;static jc;constructor(t){this.smr=t}get subject(){return this.smr.message.subject}get seq(){return this.smr.message.seq}get timestamp(){return this.smr.message.time}get time(){return new Date(Date.parse(this.timestamp))}get data(){return this.smr.message.data?this._parse(this.smr.message.data):pe}get header(){if(!this._header)if(this.smr.message.hdrs){const t=this._parse(this.smr.message.hdrs);this._header=Ue.decode(t)}else this._header=je();return this._header}_parse(t){const n=atob(t),i=n.length,o=new Uint8Array(i);for(let a=0;a<i;a++)o[a]=n.charCodeAt(a);return o}json(t){return Qe(t).decode(this.data)}string(){return Oe.decode(this.data)}})();class Ws{api;constructor(e){this.api=e}get(e){return this.api.info(e).then(t=>new Ln(this.api,t))}}class Ys{bucket;sm;prefixLen;constructor(e,t,n){this.bucket=e,this.prefixLen=t,this.sm=n}get key(){return this.sm.subject.substring(this.prefixLen)}get value(){return this.sm.data}get delta(){return 0}get created(){return this.sm.time}get revision(){return this.sm.seq}get operation(){return this.sm.header.get(Bn)||"PUT"}get length(){const e=this.sm.header.get(ft.MessageSizeHdr)||"";return""!==e?parseInt(e,10):this.sm.data.length}json(){return this.sm.json()}string(){return this.sm.string()}}class Xs{bucket;key;sm;constructor(e,t,n){this.bucket=e,this.key=t,this.sm=n}get value(){return this.sm.data}get created(){return new Date(ir(this.sm.info.timestampNanos))}get revision(){return this.sm.seq}get operation(){return this.sm.headers?.get(Bn)||"PUT"}get delta(){return this.sm.info.pending}get length(){const e=this.sm.headers?.get(ft.MessageSizeHdr)||"";return""!==e?parseInt(e,10):this.sm.data.length}json(){return this.sm.json()}string(){return this.sm.string()}}class gr{info;hdrs;constructor(e){this.info=e}get name(){return this.info.name}get description(){return this.info.description??""}get headers(){return this.hdrs||(this.hdrs=Ue.fromRecord(this.info.headers||{})),this.hdrs}get options(){return this.info.options}get bucket(){return this.info.bucket}get chunks(){return this.info.chunks}get deleted(){return this.info.deleted??!1}get digest(){return this.info.digest}get mtime(){return this.info.mtime}get nuid(){return this.info.nuid}get size(){return this.info.size}get revision(){return this.info.revision}get metadata(){return this.info.metadata||{}}isLink(){return void 0!==this.info.options?.link}}function ui(r){const e={name:r.name,description:r.description??"",options:r.options,metadata:r.metadata};return r.headers&&(e.headers=r.headers.toRecord()),e}class yn{jsm;js;stream;name;constructor(e,t,n){this.name=e,this.jsm=t,this.js=n}_checkNotEmpty(e){return e&&0!==e.length?{name:e}:{name:e,error:new Error("name cannot be empty")}}info(e){var t=this;return(0,m.Z)(function*(){const n=yield t.rawInfo(e);return n?new gr(n):null})()}list(){var e=this;return(0,m.Z)(function*(){const t=[],n=yield e.watch({ignoreDeletes:!0,includeHistory:!0});var a,i=!1,o=!1;try{for(var _,l=(0,ce.Z)(n);i=!(_=yield l.next()).done;i=!1){const v=_.value;if(null===v)break;t.push(v)}}catch(v){o=!0,a=v}finally{try{i&&null!=l.return&&(yield l.return())}finally{if(o)throw a}}return Promise.resolve(t)})()}rawInfo(e){var t=this;return(0,m.Z)(function*(){const{name:n,error:i}=t._checkNotEmpty(e);if(i)return Promise.reject(i);const o=t._metaSubject(n);try{const a=yield t.jsm.streams.getMessage(t.stream,{last_by_subj:o}),_=Qe().decode(a.data);return _.revision=a.seq,_}catch(a){return"404"===a.code?null:Promise.reject(a)}})()}_si(e){var t=this;return(0,m.Z)(function*(){try{return yield t.jsm.streams.info(t.stream,e)}catch(n){return"404"===n.code?null:Promise.reject(n)}})()}seal(){var e=this;return(0,m.Z)(function*(){let t=yield e._si();return null===t?Promise.reject(new Error("object store not found")):(t.config.sealed=!0,t=yield e.jsm.streams.update(e.stream,t.config),Promise.resolve(new pr(t)))})()}status(e){var t=this;return(0,m.Z)(function*(){const n=yield t._si(e);return null===n?Promise.reject(new Error("object store not found")):Promise.resolve(new pr(n))})()}destroy(){return this.jsm.streams.delete(this.stream)}_put(e,t,n){var i=this;return(0,m.Z)(function*(){const o=i.js.getOptions();(n=n||{timeout:o.timeout}).timeout=n.timeout||o.timeout,n.previousRevision=n.previousRevision??void 0;const{timeout:a,previousRevision:l}=n,v=i.js.nc.info?.max_payload||1024;(e=e||{}).options=e.options||{};let A=e.options?.max_chunk_size||131072;A=A>v?v:A,e.options.max_chunk_size=A;const E=yield i.info(e.name),{name:N,error:R}=i._checkNotEmpty(e.name);if(R)return Promise.reject(R);const $=Ke.next(),Z=i._chunkSubject($),Ee=i._metaSubject(N),de=Object.assign({bucket:i.name,nuid:$,size:0,chunks:0},ui(e)),et=oe(),tt=[],wt=new He;try{const Ut=t?t.getReader():null,Xt=new ti;for(;;){const{done:qn,value:qt}=Ut?yield Ut.read():{done:!0,value:void 0};if(qn){if(wt.size()>0){const Lt=wt.drain();Xt.update(Lt),de.chunks++,de.size+=Lt.length,tt.push(i.js.publish(Z,Lt,{timeout:a}))}yield Promise.all(tt),tt.length=0,de.mtime=(new Date).toISOString();const St=Xt.digest("base64"),Qt=St.length%3,Vn=Qt>0?"=".repeat(Qt):"";de.digest=`${li}${St}${Vn}`,de.deleted=!1;const en=je();"number"==typeof l&&en.set(It.ExpectedLastSubjectSequenceHdr,`${l}`),en.set(ft.RollupHdr,ft.RollupValueSubject);const wn=yield i.js.publish(Ee,Qe().encode(de),{headers:en,timeout:a});if(de.revision=wn.seq,E)try{yield i.jsm.streams.purge(i.stream,{filter:`$O.${i.name}.C.${E.nuid}`})}catch{}et.resolve(new gr(de));break}if(qt)for(wt.fill(qt);wt.size()>A;){de.chunks++,de.size+=A;const St=wt.drain(e.options.max_chunk_size);Xt.update(St),tt.push(i.js.publish(Z,St,{timeout:a}))}}}catch(Ut){yield i.jsm.streams.purge(i.stream,{filter:Z}),et.reject(Ut)}return et})()}putBlob(e,t,n){return null===t&&(t=new Uint8Array(0)),this.put(e,function i(o){return new ReadableStream({pull(a){a.enqueue(o),a.close()}})}(t),n)}put(e,t,n){return e?.options?.link?Promise.reject(new Error("link cannot be set when putting the object in bucket")):this._put(e,t,n)}getBlob(e){var t=this;return(0,m.Z)(function*(){function i(){return(i=(0,m.Z)(function*(l){const _=new He,v=l.getReader();for(;;){const{done:A,value:E}=yield v.read();if(A)return _.drain();E&&E.length&&_.fill(E)}})).apply(this,arguments)}const o=yield t.get(e);if(null===o)return Promise.resolve(null);const a=yield Promise.all([o.error,function n(l){return i.apply(this,arguments)}(o.data)]);return a[0]?Promise.reject(a[0]):Promise.resolve(a[1])})()}get(e){var t=this;return(0,m.Z)(function*(){const n=yield t.rawInfo(e);if(null===n||n.deleted)return Promise.resolve(null);if(n.options&&n.options.link){const E=n.options.link.name||"";if(""===E)throw new Error("link is a bucket");return(n.options.link.bucket!==t.name?yield yn.create(t.js,n.options.link.bucket):t).get(E)}const i=oe(),o={info:new gr(n),error:i};if(0===n.size)return o.data=function Qs(){return new ReadableStream({pull(r){r.enqueue(new Uint8Array(0)),r.close()}})}(),i.resolve(null),Promise.resolve(o);let a;const l=Rt();l.orderedConsumer();const _=new ti,v=`$O.${t.name}.C.${n.nuid}`,A=yield t.js.subscribe(v,l);return(0,m.Z)(function*(){var R,E=!1,N=!1;try{for(var Z,$=(0,ce.Z)(A);E=!(Z=yield $.next()).done;E=!1){const Ee=Z.value;if(Ee.data.length>0&&(_.update(Ee.data),a.enqueue(Ee.data)),0===Ee.info.pending){const de=_.digest("base64"),et=de.length%3,tt=et>0?"=".repeat(et):"",wt=`${li}${de}${tt}`;wt!==n.digest?a.error(new Error(`received a corrupt object, digests do not match received: ${n.digest} calculated ${wt}`)):a.close(),A.unsubscribe()}}}catch(Ee){N=!0,R=Ee}finally{try{E&&null!=$.return&&(yield $.return())}finally{if(N)throw R}}})().then(()=>{i.resolve()}).catch(E=>{a.error(E),i.reject(E)}),o.data=new ReadableStream({start(E){a=E},cancel(){A.unsubscribe()}}),o})()}linkStore(e,t){if(!(t instanceof yn))return Promise.reject("bucket required");const n=t,{name:i,error:o}=this._checkNotEmpty(e);return o?Promise.reject(o):this._put({name:i,options:{link:{bucket:n.name}}},null)}link(e,t){var n=this;return(0,m.Z)(function*(){const{name:i,error:o}=n._checkNotEmpty(e);if(o)return Promise.reject(o);if(t.deleted)return Promise.reject(new Error("src object is deleted"));if(t.isLink())return Promise.reject(new Error("src object is a link"));const a=yield n.rawInfo(e);if(null!==a&&!a.deleted)return Promise.reject(new Error("an object already exists with that name"));const _={name:i,options:{link:{bucket:t.bucket,name:t.name}}};yield n.js.publish(n._metaSubject(e),JSON.stringify(_));const v=yield n.info(e);return Promise.resolve(v)})()}delete(e){var t=this;return(0,m.Z)(function*(){const n=yield t.rawInfo(e);if(null===n)return Promise.resolve({purged:0,success:!1});n.deleted=!0,n.size=0,n.chunks=0,n.digest="";const i=Qe(),o=je();return o.set(ft.RollupHdr,ft.RollupValueSubject),yield t.js.publish(t._metaSubject(n.name),i.encode(n),{headers:o}),t.jsm.streams.purge(t.stream,{filter:t._chunkSubject(n.nuid)})})()}update(e,t={}){var n=this;return(0,m.Z)(function*(){const i=yield n.rawInfo(e);if(null===i)return Promise.reject(new Error("object not found"));if(i.deleted)return Promise.reject(new Error("cannot update meta for a deleted object"));t.name=t.name??i.name;const{name:o,error:a}=n._checkNotEmpty(t.name);if(a)return Promise.reject(a);if(e!==t.name){const v=yield n.info(t.name);if(v&&!v.deleted)return Promise.reject(new Error("an object already exists with that name"))}t.name=o;const l=Object.assign({},i,ui(t)),_=yield n.js.publish(n._metaSubject(l.name),JSON.stringify(l));return e!==t.name&&(yield n.jsm.streams.purge(n.stream,{filter:n._metaSubject(e)})),Promise.resolve(_)})()}watch(e={}){var t=this;return(0,m.Z)(function*(){e.includeHistory=e.includeHistory??!1,e.ignoreDeletes=e.ignoreDeletes??!1;let n=!1;const i=new he,o=t._metaSubjectAll();try{yield t.jsm.streams.getMessage(t.stream,{last_by_subj:o})}catch(v){"404"===v.code?(i.push(null),n=!0):i.stop(v)}const a=Qe(),l=Rt();l.orderedConsumer(),e.includeHistory?l.deliverLastPerSubject():(n=!0,l.deliverNew()),l.callback((v,A)=>{if(v)i.stop(v);else if(null!==A){const E=a.decode(A.data);E.deleted&&!0===e.ignoreDeletes||i.push(E),0===A.info?.pending&&!n&&(n=!0,i.push(null))}});const _=yield t.js.subscribe(o,l);return i._data=_,i.iterClosed.then(()=>{_.unsubscribe()}),_.closed.then(()=>{i.stop()}).catch(v=>{i.stop(v)}),i})()}_chunkSubject(e){return`$O.${this.name}.C.${e}`}_metaSubject(e){return`$O.${this.name}.M.${dn.encode(e)}`}_metaSubjectAll(){return`$O.${this.name}.M.>`}init(e={}){var t=this;return(0,m.Z)(function*(){try{t.stream=function Zs(r){return $n(r),`${fr}${r}`}(t.name)}catch(o){return Promise.reject(o)}const n=e?.ttl||0;delete e.ttl;const i=Object.assign({max_age:n},e);i.name=t.stream,i.allow_direct=!0,i.allow_rollup_hdrs=!0,i.discard=Fn.New,i.subjects=[`$O.${t.name}.C.>`,`$O.${t.name}.M.>`],e.placement&&(i.placement=e.placement),e.metadata&&(i.metadata=e.metadata);try{yield t.jsm.streams.info(i.name)}catch(o){"stream not found"===o.message&&(yield t.jsm.streams.add(i))}})()}static create(e,t,n={}){return(0,m.Z)(function*(){const i=yield e.jetstreamManager(),o=new yn(t,i,e);return yield o.init(n),Promise.resolve(o)})()}}class eo{js;jsm;constructor(e){this.js=e}kv(e,t={}){const n=this.js,{ok:i,min:o}=n.nc.features.get(Ce.JS_KV);return i?t.bindOnly?bn.bind(this.js,e):bn.create(this.js,e,t):Promise.reject(new Error(`kv is only supported on servers ${o} or better`))}os(e,t={}){if("function"!=typeof crypto?.subtle?.digest)return Promise.reject(new Error("objectstore: unable to calculate hashes - crypto.subtle.digest with sha256 support is required"));const n=this.js,{ok:i,min:o}=n.nc.features.get(Ce.JS_OBJECTSTORE);return i?yn.create(this.js,e,t):Promise.reject(new Error(`objectstore is only supported on servers ${o} or better`))}}class _r extends hn{consumers;streams;consumerAPI;streamAPI;constructor(e,t){super(e,t),this.consumerAPI=new lr(e,t),this.streamAPI=new mr(e,t),this.consumers=new si(this.consumerAPI),this.streams=new Ws(this.streamAPI)}jetstreamManager(){return this.nc.jetstreamManager(this.opts)}get apiPrefix(){return this.prefix}get views(){return new eo(this)}publish(e,t=pe,n){var i=this;return(0,m.Z)(function*(){(n=n||{}).expect=n.expect||{};const o=n?.headers||je();n&&(n.msgID&&o.set(It.MsgIdHdr,n.msgID),n.expect.lastMsgID&&o.set(It.ExpectedLastMsgIdHdr,n.expect.lastMsgID),n.expect.streamName&&o.set(It.ExpectedStreamHdr,n.expect.streamName),"number"==typeof n.expect.lastSequence&&o.set(It.ExpectedLastSeqHdr,`${n.expect.lastSequence}`),"number"==typeof n.expect.lastSubjectSequence&&o.set(It.ExpectedLastSubjectSequenceHdr,`${n.expect.lastSubjectSequence}`));const a=n.timeout||i.timeout,l={};a&&(l.timeout=a),n&&(l.headers=o);let A,{retries:_,retry_delay:v}=n;_=_||1,v=v||250;for(let N=0;N<_;N++)try{A=yield i.nc.request(e,t,l);break}catch(R){if(!("503"===R.code&&N+1<_))throw R;yield se(v)}const E=i.parseJsResponse(A);if(""===E.stream)throw q.errorForCode(U.JetStreamInvalidAck);return E.duplicate=!!E.duplicate&&E.duplicate,E})()}pull(e,t,n=0){var i=this;return(0,m.Z)(function*(){dt(e),Gt(t);let o=i.timeout;n>o&&(o=n);const a={batch:1,no_wait:0===(n=n<0?0:$e(n)),expires:n},l=yield i.nc.request(`${i.prefix}.CONSUMER.MSG.NEXT.${e}.${t}`,i.jc.encode(a),{noMux:!0,timeout:o}),_=Jt(l);if(_)throw _;return _n(l)})()}fetch(e,t,n={}){dt(e),Gt(t);let i=null;const o=(n.max_bytes??0)>0;let a=0;const l=o?n.max_bytes:0;let _=null;const v={};if(v.batch=n.batch||1,l){const de=this.nc.features.get(Ce.JS_PULL_MAX_BYTES);if(!de.ok)throw new Error(`max_bytes is only supported on servers ${de.min} or better`);v.max_bytes=l}v.no_wait=n.no_wait||!1,v.no_wait&&v.expires&&(v.expires=0);const A=n.expires||0;if(A&&(v.expires=$e(A)),0===A&&!1===v.no_wait)throw new Error("expires or no_wait is required");const E=n.idle_heartbeat||0;E&&(v.idle_heartbeat=$e(E),!0===n.delay_heartbeat&&(v.idle_heartbeat=$e(4*E)));const N=new he,R=v.batch;let $=0;N.protocolFilterFn=(de,et=!1)=>!or(de.msg)||(_?.work(),!1),N.dispatchedFn=de=>{if(de){if(o&&(a+=de.data.length),$++,i&&0===de.info.pending)return;(1===N.getPending()&&0===de.info.pending||R===$||l>0&&a>=l)&&N.stop()}};const Z=T(this.nc.options.inboxPrefix),Ee=this.nc.subscribe(Z,{max:n.batch,callback:(de,et)=>{null===de&&(de=Jt(et)),null!==de?(i&&(i.cancel(),i=null),function rt(r){return"string"==typeof r.code}(de)?N.stop(null===di(de)?void 0:de):N.stop(de)):(_?.work(),N.received++,N.push(_n(et)))}});return A&&(i=Le(A),i.catch(()=>{Ee.isClosed()||(Ee.drain().catch(()=>{}),i=null),_&&_.cancel()})),(0,m.Z)(function*(){try{E&&(_=new ur(E,de=>(N.push(()=>{N.err=new q(`${bt.IdleHeartbeatMissed}: ${de}`,U.JetStreamIdleHeartBeat)}),!0)))}catch{}yield Ee.closed,null!==i&&(i.cancel(),i=null),_&&_.cancel(),N.stop()})().catch(),this.nc.publish(`${this.prefix}.CONSUMER.MSG.NEXT.${e}.${t}`,this.jc.encode(v),{reply:Z}),N}pullSubscribe(e,t=Rt()){var n=this;return(0,m.Z)(function*(){const i=yield n._processOptions(e,t);if(i.ordered)throw new Error("pull subscribers cannot be be ordered");if(i.config.deliver_subject)throw new Error("consumer info specifies deliver_subject - pull consumers cannot have deliver_subject set");const o=i.config.ack_policy;if(o===nt.None||o===nt.All)throw new Error("ack policy for pull consumers must be explicit");const a=n._buildTypedSubscriptionOpts(i),l=new to(n,i.deliver,a);l.info=i;try{yield n._maybeCreateConsumer(i)}catch(_){throw l.unsubscribe(),_}return l})()}subscribe(e,t=Rt()){var n=this;return(0,m.Z)(function*(){const i=yield n._processOptions(e,t);if(!i.isBind&&!i.config.deliver_subject)throw new Error("push consumer requires deliver_subject");const o=n._buildTypedSubscriptionOpts(i),a=new hi(n,i.deliver,o);a.info=i;try{yield n._maybeCreateConsumer(i)}catch(l){throw a.unsubscribe(),l}return a._maybeSetupHbMonitoring(),a})()}_processOptions(e,t=Rt()){var n=this;return(0,m.Z)(function*(){const i=Yr(t)?t.getOpts():t;if(i.isBind=!!Yr(t)&&t.isBind,i.flow_control={heartbeat_count:0,fc_count:0,consumer_restarts:0},i.ordered){if(i.ordered_consumer_sequence={stream_seq:0,delivery_seq:0},i.config.ack_policy!==nt.NotSet&&i.config.ack_policy!==nt.None)throw new q("ordered consumer: ack_policy can only be set to 'none'",U.ApiError);if(i.config.durable_name&&i.config.durable_name.length>0)throw new q("ordered consumer: durable_name cannot be set",U.ApiError);if(i.config.deliver_subject&&i.config.deliver_subject.length>0)throw new q("ordered consumer: deliver_subject cannot be set",U.ApiError);if(void 0!==i.config.max_deliver&&i.config.max_deliver>1)throw new q("ordered consumer: max_deliver cannot be set",U.ApiError);if(i.config.deliver_group&&i.config.deliver_group.length>0)throw new q("ordered consumer: deliver_group cannot be set",U.ApiError);i.config.deliver_subject=T(n.nc.options.inboxPrefix),i.config.ack_policy=nt.None,i.config.max_deliver=1,i.config.flow_control=!0,i.config.idle_heartbeat=i.config.idle_heartbeat||$e(5e3),i.config.ack_wait=$e(792e5),i.config.mem_storage=!0,i.config.num_replicas=1}if(i.config.ack_policy===nt.NotSet&&(i.config.ack_policy=nt.All),i.api=n,i.config=i.config||{},i.stream=i.stream?i.stream:yield n.findStream(e),i.attached=!1,i.config.durable_name)try{const o=yield n.consumerAPI.info(i.stream,i.config.durable_name);if(o){if(o.config.filter_subject&&o.config.filter_subject!==e)throw new Error("subject does not match consumer");const a=i.config.deliver_group??"";if(""===a&&!0===o.push_bound)throw new Error("duplicate subscription");const l=o.config.deliver_group??"";if(a!==l)throw""===l?new Error("durable requires no queue group"):new Error(`durable requires queue group '${l}'`);i.last=o,i.config=o.config,i.attached=!0,i.config.durable_name||(i.name=o.name)}}catch(o){if("404"!==o.code)throw o}return!i.attached&&void 0===i.config.filter_subject&&void 0===i.config.filter_subjects&&(i.config.filter_subject=e),i.deliver=i.config.deliver_subject||T(n.nc.options.inboxPrefix),i})()}_buildTypedSubscriptionOpts(e){const t={};return t.adapter=function no(r){return r?io:ro}(void 0===e.callbackFn),t.ingestionFilterFn=_r.ingestionFn(e.ordered),t.protocolFilterFn=(n,i=!1)=>{const o=n;return!sr(o.msg)||(i||o.msg.respond(),!1)},!e.mack&&e.config.ack_policy!==nt.None&&(t.dispatchedFn=so),e.callbackFn&&(t.callback=e.callbackFn),t.max=e.max||0,t.queue=e.queue,t}_maybeCreateConsumer(e){var t=this;return(0,m.Z)(function*(){if(e.attached)return;if(e.isBind)throw new Error(`unable to bind - durable consumer ${e.config.durable_name} doesn't exist in ${e.stream}`);e.config=Object.assign({deliver_policy:Ge.All,ack_policy:nt.Explicit,ack_wait:$e(3e4),replay_policy:fn.Instant},e.config);const n=yield t.consumerAPI.add(e.stream,e.config);if(Array.isArray(e.config.filter_subjects&&!Array.isArray(n.config.filter_subjects)))throw new Error("jetstream server doesn't support consumers with multiple filter subjects");e.name=n.name,e.config=n.config,e.last=n})()}static ingestionFn(e){return(t,n)=>{const i=n;if(!t)return{ingest:!1,protocol:!1};const o=t;if(Jt(o.msg)||i.monitor?.work(),or(o.msg)){const l=!e||i._checkHbOrderConsumer(o.msg);return e||i.info.flow_control.heartbeat_count++,{ingest:l,protocol:!0}}return sr(o.msg)?(i.info.flow_control.fc_count++,{ingest:!0,protocol:!0}):{ingest:!e||i._checkOrderedConsumer(t),protocol:!1}}}}class hi extends Ls{js;monitor;constructor(e,t,n){super(e.nc,t,n),this.js=e,this.monitor=null,this.sub.closed.then(()=>{this.monitor&&this.monitor.cancel()})}set info(e){this.sub.info=e}get info(){return this.sub.info}_resetOrderedConsumer(e){if(null===this.info||this.sub.isClosed())return;const t=T(this.js.nc.options.inboxPrefix);this.js.nc._resub(this.sub,t);const i=this.info;i.ordered_consumer_sequence.delivery_seq=0,i.flow_control.heartbeat_count=0,i.flow_control.fc_count=0,i.flow_control.consumer_restarts++,i.deliver=t,i.config.deliver_subject=t,i.config.deliver_policy=Ge.StartSequence,i.config.opt_start_seq=e;const o={};o.stream_name=this.info.stream,o.config=i.config,this.js._request(`${i.api.prefix}.CONSUMER.CREATE.${i.stream}`,o).then(l=>{const _=l;this.info.config=_.config,this.info.name=_.name}).catch(l=>{const _=new q(`unable to recreate ordered consumer ${i.stream} at seq ${e}`,U.RequestError,l);this.sub.callback(_,{})})}_maybeSetupHbMonitoring(){const e=this.info?.config?.idle_heartbeat||0;e&&this._setupHbMonitoring(ir(e))}_setupHbMonitoring(e,t=0){const n={cancelAfter:0,maxOut:2};t&&(n.cancelAfter=t);const i=this.sub;this.monitor=new ur(e,a=>{const l=function ds(r,e,t){const n=je(r,e),o=new Nr({hdr:1,sid:0,size:0},pe,{});return o._headers=n,o._subject=t,o}(409,`${bt.IdleHeartbeatMissed}: ${a}`,this.sub.subject);return this.info?.ordered?!!this.js.nc.protocol.connected&&(this._resetOrderedConsumer((this.info?.ordered_consumer_sequence?.stream_seq||0)+1),!1):(this.sub.callback(null,l),!i.noIterator)},n)}_checkHbOrderConsumer(e){const t=e.headers.get(ft.ConsumerStalledHdr);""!==t&&this.js.nc.publish(t);const n=parseInt(e.headers.get(ft.LastConsumerSeqHdr),10),i=this.info.ordered_consumer_sequence;return this.info.flow_control.heartbeat_count++,n!==i.delivery_seq&&this._resetOrderedConsumer(i.stream_seq+1),!1}_checkOrderedConsumer(e){const t=this.info.ordered_consumer_sequence,n=e.info.streamSequence,i=e.info.deliverySequence;return i!=t.delivery_seq+1?(this._resetOrderedConsumer(t.stream_seq+1),!1):(t.delivery_seq=i,t.stream_seq=n,!0)}destroy(){var e=this;return(0,m.Z)(function*(){e.isClosed()||(yield e.drain());const t=e.sub.info,i=`${t.api.prefix}.CONSUMER.DELETE.${t.stream}.${t.config.durable_name||t.name}`;yield t.api._request(i)})()}consumerInfo(){var e=this;return(0,m.Z)(function*(){const t=e.sub.info,i=`${t.api.prefix}.CONSUMER.INFO.${t.stream}.${t.config.durable_name||t.name}`,o=yield t.api._request(i);return t.last=o,o})()}}class to extends hi{constructor(e,t,n){super(e,t,n)}pull(e={batch:1}){const{stream:t,config:n,name:i}=this.sub.info,o=n.durable_name??i,a={};if(a.batch=e.batch||1,a.no_wait=e.no_wait||!1,(e.max_bytes??0)>0){const v=this.js.nc.features.get(Ce.JS_PULL_MAX_BYTES);if(!v.ok)throw new Error(`max_bytes is only supported on servers ${v.min} or better`);a.max_bytes=e.max_bytes}let l=0;e.expires&&e.expires>0&&(l=e.expires,a.expires=$e(l));let _=0;if(e.idle_heartbeat&&e.idle_heartbeat>0&&(_=e.idle_heartbeat,a.idle_heartbeat=$e(_)),_&&0===l)throw new Error("idle_heartbeat requires expires");if(_>l)throw new Error("expires must be greater than idle_heartbeat");if(this.info){this.monitor&&this.monitor.cancel(),l&&_&&(this.monitor?this.monitor._change(_,l):this._setupHbMonitoring(_,l));const v=this.info.api,E=this.sub.subject;v.nc.publish(`${v.prefix}.CONSUMER.MSG.NEXT.${t}.${o}`,v.jc.encode(a),{reply:E})}}}function ro(r,e){return r||(r=Jt(e))?[r,null]:[null,_n(e)]}function io(r,e){if(r)return[r,null];const t=Jt(e);return null!==t?[di(t),null]:[null,_n(e)]}function di(r){if(null!==r)switch(r.code){case U.JetStream404NoMessages:case U.JetStream408RequestTimeout:return null;case U.JetStream409:return function ps(r){if(r.code!==U.JetStream409)return!1;const e=[bt.MaxBatchExceeded,bt.MaxExpiresExceeded,bt.MaxBytesExceeded,bt.MaxMessageSizeExceeded,bt.PushConsumer,bt.IdleHeartbeatMissed,bt.ConsumerDeleted];return fs&&e.push(bt.MaxWaitingExceeded),void 0!==e.find(t=>-1!==r.message.indexOf(t))}(r)?r:null;default:return r}return null}function so(r){r&&r.ack()}class oo extends hn{constructor(e,t){super(e,t)}getMessage(e,t){var n=this;return(0,m.Z)(function*(){dt(e);let i=t;const{last_by_subj:o}=i;o&&(i=null);const a=i?n.jc.encode(i):pe,l=n.opts.apiPrefix||"$JS.API",_=o?`${l}.DIRECT.GET.${e}.${o}`:`${l}.DIRECT.GET.${e}`,v=yield n.nc.request(_,a),A=Jt(v);if(A)return Promise.reject(A);const E=new ao(v);return Promise.resolve(E)})()}}let ao=(()=>class r{data;header;static jc;constructor(t){if(!t.headers)throw new Error("headers expected");this.data=t.data,this.header=t.headers}get subject(){return this.header.get(pn.Subject)}get seq(){const t=this.header.get(pn.Sequence);return"string"==typeof t?parseInt(t):0}get time(){return new Date(Date.parse(this.timestamp))}get timestamp(){return this.header.get(pn.TimeStamp)}get stream(){return this.header.get(pn.Stream)}json(t){return Qe(t).decode(this.data)}string(){return Oe.decode(this.data)}})();class co extends hn{streams;consumers;direct;constructor(e,t){super(e,t),this.streams=new mr(e,t),this.consumers=new lr(e,t),this.direct=new oo(e,t)}getAccountInfo(){var e=this;return(0,m.Z)(function*(){return yield e._request(`${e.prefix}.INFO`)})()}jetstream(){return this.nc.jetstream(this.getOptions())}advisories(){const e=new he;return this.nc.subscribe("$JS.EVENT.ADVISORY.>",{callback:(t,n)=>{if(t)throw t;try{const i=this.parseJsResponse(n),o=i.type.split(".");e.push({kind:o[o.length-1],data:i})}catch(i){e.stop(i)}}}),e}}class fi{msg;constructor(e){this.msg=e}get data(){return this.msg.data}get sid(){return this.msg.sid}get subject(){return this.msg.subject}get reply(){return this.msg.reply||""}get headers(){return this.msg.headers}respond(e,t){return this.msg.respond(e,t)}respondError(e,t,n,i){return(i=i||{}).headers=i.headers||je(),i.headers?.set(I,`${e}`),i.headers?.set(d,t),this.msg.respond(n,i)}json(e){return this.msg.json(e)}string(){return this.msg.string()}}class xn{subject;queue;srv;constructor(e,t="",n=""){""!==t&&function ho(r,e){if(-1!==e.indexOf(" "))throw new Error(`${r} cannot contain spaces: '${e}'`);e.split(".").forEach(n=>{if(">"===n)throw new Error(`${r} name cannot contain internal '>': '${e}'`)})}("service group",t);let i="";if(e instanceof vn)this.srv=e,i="";else{if(!(e instanceof xn))throw new Error("unknown ServiceGroup type");{const o=e;this.srv=o.srv,""===n&&""!==o.queue&&(n=o.queue),i=o.subject}}this.subject=this.calcSubject(i,t),this.queue=n}calcSubject(e,t=""){return""===t?e:""!==e?`${e}.${t}`:t}addEndpoint(e="",t){const n="function"==typeof(t=t||{subject:e})?{handler:t,subject:e}:t;un("endpoint",e);let{subject:i,handler:o,metadata:a,queue:l}=n;return i=i||e,l=l||this.queue,function uo(r,e){if(""===e)throw new Error(`${r} cannot be empty`);if(-1!==e.indexOf(" "))throw new Error(`${r} cannot contain spaces: '${e}'`);const t=e.split(".");t.forEach((n,i)=>{if(">"===n&&i!==t.length-1)throw new Error(`${r} cannot have internal '>': '${e}'`)})}("endpoint subject",i),i=this.calcSubject(this.subject,i),this.srv._addEndpoint({name:e,subject:i,queue:l,handler:o,metadata:a})}addGroup(e="",t=""){return new xn(this,e,t)}}class vn{nc;_id;config;handlers;internal;_stopped;_done;started;static controlSubject(e,t="",n="",i){const o=i??"$SRV";return""===t&&""===n?`${o}.${e}`:(un("control subject name",t),""!==n?(un("control subject id",n),`${o}.${e}.${t}.${n}`):`${o}.${e}.${t}`)}constructor(e,t={name:"",version:""}){this.nc=e,this.config=Object.assign({},t),this.config.queue||(this.config.queue="q"),un("name",this.config.name),un("queue",this.config.queue),Dt(this.config.version),this._id=Ke.next(),this.internal=[],this._done=oe(),this._stopped=!1,this.handlers=[],this.started=(new Date).toISOString(),this.reset(),this.nc.closed().then(()=>{this.close().catch()}).catch(n=>{this.close(n).catch()})}get subjects(){return this.handlers.filter(e=>!1===e.internal).map(e=>e.subject)}get id(){return this._id}get name(){return this.config.name}get description(){return this.config.description??""}get version(){return this.config.version}get metadata(){return this.config.metadata}errorToHeader(e){const t=je();if(e instanceof j){const n=e;t.set(d,n.message),t.set(I,`${n.code}`)}else t.set(d,e.message),t.set(I,"500");return t}setupHandler(e,t=!1){const n=t?"":e.queue?e.queue:this.config.queue,{name:i,subject:o,handler:a}=e,l=e;l.internal=t,t&&this.internal.push(l),l.stats=new fo(i,o,n),l.queue=n;const _=a?(v,A)=>{if(v)return void this.close(v);const E=Date.now();try{a(v,new fi(A))}catch(N){l.stats.countError(N),A?.respond(pe,{headers:this.errorToHeader(N)})}finally{l.stats.countLatency(E)}}:void 0;return l.sub=this.nc.subscribe(o,{callback:_,queue:n}),l.sub.closed.then(()=>{this._stopped||this.close(new Error(`required subscription ${e.subject} stopped`)).catch()}).catch(v=>{if(!this._stopped){const A=new Error(`required subscription ${e.subject} errored: ${v.message}`);A.stack=v.stack,this.close(A).catch()}}),l}info(){return{type:kt.INFO,name:this.name,id:this.id,version:this.version,description:this.description,metadata:this.metadata,endpoints:this.endpoints()}}endpoints(){return this.handlers.map(e=>{const{subject:t,metadata:n,name:i,queue:o}=e;return{subject:t,metadata:n,name:i,queue_group:o}})}stats(){var e=this;return(0,m.Z)(function*(){const t=[];for(const n of e.handlers){if("function"==typeof e.config.statsHandler)try{n.stats.data=yield e.config.statsHandler(n)}catch(i){n.stats.countError(i)}t.push(n.stats.stats(n.qi))}return{type:kt.STATS,name:e.name,id:e.id,version:e.version,started:e.started,metadata:e.metadata,endpoints:t}})()}addInternalHandler(e,t){const n=`${e}`.toUpperCase();this._doAddInternalHandler(`${n}-all`,e,t),this._doAddInternalHandler(`${n}-kind`,e,t,this.name),this._doAddInternalHandler(`${n}`,e,t,this.name,this.id)}_doAddInternalHandler(e,t,n,i="",o=""){const a={};a.name=e,a.subject=vn.controlSubject(t,i,o),a.handler=n,this.setupHandler(a,!0)}start(){const e=Qe(),i=e.encode(this.ping());return this.addInternalHandler(K.PING,(a,l)=>a?(this.close(a).then().catch(),Promise.reject(a)):(l.respond(i),Promise.resolve())),this.addInternalHandler(K.STATS,(a,l)=>a?(this.close(a),Promise.reject(a)):this.stats().then(_=>(l?.respond(e.encode(_)),Promise.resolve()))),this.addInternalHandler(K.INFO,(a,l)=>a?(this.close(a),Promise.reject(a)):(l?.respond(e.encode(this.info())),Promise.resolve())),this.handlers.forEach(a=>{const{subject:l}=a;"string"==typeof l&&null!==a.handler&&this.setupHandler(a)}),Promise.resolve(this)}close(e){if(this._stopped)return this._done;this._stopped=!0;let t=[];return this.nc.isClosed()||(t=this.handlers.concat(this.internal).map(n=>n.sub.drain())),Promise.allSettled(t).then(()=>{this._done.resolve(e||null)}),this._done}get stopped(){return this._done}get isStopped(){return this._stopped}stop(e){return this.close(e)}ping(){return{type:kt.PING,name:this.name,id:this.id,version:this.version,metadata:this.metadata}}reset(){if(this.started=(new Date).toISOString(),this.handlers)for(const e of this.handlers)e.stats.reset(e.qi)}addGroup(e,t){return new xn(this,e,t)}addEndpoint(e,t){return new xn(this).addEndpoint(e,t)}_addEndpoint(e){const t=new he;t.noIterator="function"==typeof e.handler,t.noIterator||(e.handler=(i,o)=>{i?this.stop(i).catch():t.push(new fi(o))},t.iterClosed.then(()=>{this.close().catch()}));const n=this.setupHandler(e,!1);return n.qi=t,this.handlers.push(n),t}}class fo{name;subject;average_processing_time;num_requests;processing_time;num_errors;last_error;data;metadata;queue;constructor(e,t,n=""){this.name=e,this.subject=t,this.average_processing_time=0,this.num_errors=0,this.num_requests=0,this.processing_time=0,this.queue=n}reset(e){this.num_requests=0,this.processing_time=0,this.average_processing_time=0,this.num_errors=0,this.last_error=void 0,this.data=void 0;const t=e;t&&(t.time=0,t.processed=0)}countLatency(e){this.num_requests++,this.processing_time+=$e(Date.now()-e),this.average_processing_time=Math.round(this.processing_time/this.num_requests)}countError(e){this.num_errors++,this.last_error=e.message}_stats(){const{name:e,subject:t,average_processing_time:n,num_errors:i,num_requests:o,processing_time:a,last_error:l,data:_,queue:v}=this;return{name:e,subject:t,average_processing_time:n,num_errors:i,num_requests:o,processing_time:a,last_error:l,data:_,queue_group:v}}stats(e){const t=e;return!1===t?.noIterator&&(this.processing_time=t.time,this.num_requests=t.processed,this.average_processing_time=this.processing_time>0&&this.num_requests>0?this.processing_time/this.num_requests:0),this._stats()}}class po{nc;prefix;opts;constructor(e,t={strategy:Ie.JitterTimer,maxWait:2e3},n){this.nc=e,this.prefix=n,this.opts=t}ping(e="",t=""){return this.q(K.PING,e,t)}stats(e="",t=""){return this.q(K.STATS,e,t)}info(e="",t=""){return this.q(K.INFO,e,t)}q(e,t="",n=""){var i=this;return(0,m.Z)(function*(){const o=new he,a=Qe(),l=vn.controlSubject(e,t,n,i.prefix),_=yield i.nc.requestMany(l,pe,i.opts);return(0,m.Z)(function*(){var E,v=!1,A=!1;try{for(var R,N=(0,ce.Z)(_);v=!(R=yield N.next()).done;v=!1){const $=R.value;try{const Z=a.decode($.data);o.push(Z)}catch(Z){o.push(()=>{o.stop(Z)})}}}catch($){A=!0,E=$}finally{try{v&&null!=N.return&&(yield N.return())}finally{if(A)throw E}}o.push(()=>{o.stop()})})().catch(v=>{o.stop(v)}),o})()}}class br{options;protocol;draining;listeners;_services;constructor(e){this.draining=!1,this.options=rs(e),this.listeners=[]}static connect(e={}){return new Promise((t,n)=>{const i=new br(e);Nn.connect(i.options,i).then(o=>{i.protocol=o,(0,m.Z)(function*(){var _,a=!1,l=!1;try{for(var A,v=(0,ce.Z)(o.status());a=!(A=yield v.next()).done;a=!1){const E=A.value;i.listeners.forEach(N=>{N.push(E)})}}catch(E){l=!0,_=E}finally{try{a&&null!=v.return&&(yield v.return())}finally{if(l)throw _}}})(),t(i)}).catch(o=>{n(o)})})}closed(){return this.protocol.closed}close(){var e=this;return(0,m.Z)(function*(){yield e.protocol.close()})()}_check(e,t,n){if(this.isClosed())throw q.errorForCode(U.ConnectionClosed);if(t&&this.isDraining()||n&&this.protocol.noMorePublishing)throw q.errorForCode(U.ConnectionDraining);if(0===(e=e||"").length)throw q.errorForCode(U.BadSubject)}publish(e,t,n){this._check(e,!1,!0),this.protocol.publish(e,t,n)}subscribe(e,t={}){this._check(e,!0,!1);const n=new zr(this.protocol,e,t);return this.protocol.subscribe(n),n}_resub(e,t,n){this._check(t,!0,!1);const i=e;i.max=n,n&&(i.max=n+i.received),this.protocol.resub(i,t)}requestMany(e,t=pe,n={maxWait:1e3,maxMessages:-1}){try{this._check(e,!0,!0)}catch(l){return Promise.reject(l)}if(n.strategy=n.strategy||Ie.Timer,n.maxWait=n.maxWait||1e3,n.maxWait<1)return Promise.reject(new q("timeout",U.InvalidOption));const i=new he;function o(l){i.push(()=>{i.stop(l)})}function a(l,_){l||null===_?o(null===l?void 0:l):i.push(_)}if(n.noMux){const l=(new Error).stack;let _="number"==typeof n.maxMessages&&n.maxMessages>0?n.maxMessages:-1;const v=this.subscribe(T(this.options.inboxPrefix),{callback:(R,$)=>{if(0===$?.data?.length&&$?.headers?.status===U.NoResponders&&(R=q.errorForCode(U.NoResponders)),R)return R.stack+=`\n\n${l}`,void A(R);a(null,$),n.strategy===Ie.Count&&(_--,0===_&&A()),n.strategy===Ie.JitterTimer&&(N(),E=setTimeout(()=>{A()},300)),n.strategy===Ie.SentinelMsg&&$&&0===$.data.length&&A()}});v.closed.then(()=>{o()}).catch(R=>{i.stop(R)});const A=R=>{R&&i.push(()=>{throw R}),N(),v.drain().then(()=>{o()}).catch($=>{o()})};i.iterClosed.then(()=>{N(),v?.unsubscribe()}).catch(R=>{N(),v?.unsubscribe()});try{this.publish(e,t,{reply:v.getSubject()})}catch(R){A(R)}let E=setTimeout(()=>{A()},n.maxWait);const N=()=>{E&&clearTimeout(E)}}else{const l=n;l.callback=a,i.iterClosed.then(()=>{_.cancel()}).catch(v=>{_.cancel(v)});const _=new us(this.protocol.muxSubscriptions,e,l);this.protocol.request(_);try{this.publish(e,t,{reply:`${this.protocol.muxSubscriptions.baseInbox}${_.token}`,headers:n.headers})}catch(v){_.cancel(v)}}return Promise.resolve(i)}request(e,t,n={timeout:1e3,noMux:!1}){try{this._check(e,!0,!0)}catch(i){return Promise.reject(i)}if(n.timeout=n.timeout||1e3,n.timeout<1)return Promise.reject(new q("timeout",U.InvalidOption));if(!n.noMux&&n.reply)return Promise.reject(new q("reply can only be used with noMux",U.InvalidOption));if(n.noMux){const i=n.reply?n.reply:T(this.options.inboxPrefix),o=oe(),a=new Error;return this.subscribe(i,{max:1,timeout:n.timeout,callback:(_,v)=>{_?(_.code!==U.Timeout&&(_.stack+=`\n\n${a.stack}`),o.reject(_)):(_=kn(v))?(_.stack+=`\n\n${a.stack}`,o.reject(_)):o.resolve(v)}}).requestSubject=e,this.protocol.publish(e,t,{reply:i,headers:n.headers}),o}{const i=new Zr(this.protocol.muxSubscriptions,e,n);this.protocol.request(i);try{this.publish(e,t,{reply:`${this.protocol.muxSubscriptions.baseInbox}${i.token}`,headers:n.headers})}catch(a){i.cancel(a)}const o=Promise.race([i.timer,i.deferred]);return o.catch(()=>{i.cancel()}),o}}flush(){return this.isClosed()?Promise.reject(q.errorForCode(U.ConnectionClosed)):this.protocol.flush()}drain(){return this.isClosed()?Promise.reject(q.errorForCode(U.ConnectionClosed)):this.isDraining()?Promise.reject(q.errorForCode(U.ConnectionDraining)):(this.draining=!0,this.protocol.drain())}isClosed(){return this.protocol.isClosed()}isDraining(){return this.draining}getServer(){const e=this.protocol.getServer();return e?e.listen:""}status(){const e=new he;return e.iterClosed.then(()=>{const t=this.listeners.indexOf(e);this.listeners.splice(t,1)}),this.listeners.push(e),e}get info(){return this.protocol.isClosed()?void 0:this.protocol.info}stats(){return{inBytes:this.protocol.inBytes,outBytes:this.protocol.outBytes,inMsgs:this.protocol.inMsgs,outMsgs:this.protocol.outMsgs}}jetstreamManager(e={}){var t=this;return(0,m.Z)(function*(){const n=new co(t,e);try{yield n.getAccountInfo()}catch(i){const o=i;throw o.code===U.NoResponders&&(o.code=U.JetStreamNotEnabled),o}return n})()}jetstream(e={}){return new _r(this,e)}getServerVersion(){const e=this.info;return e?Dt(e.version):void 0}rtt(){var e=this;return(0,m.Z)(function*(){if(!e.protocol._closed&&!e.protocol.connected)throw q.errorForCode(U.Disconnect);const t=Date.now();return yield e.flush(),Date.now()-t})()}get features(){return this.protocol.features}get services(){return this._services||(this._services=new mo(this)),this._services}}class mo{nc;constructor(e){this.nc=e}add(e){try{return new vn(this.nc,e).start()}catch(t){return Promise.reject(t)}}client(e,t){return new po(this.nc,e,t)}}class vo{version;lang;closeError;connected;done;socket;options;socketClosed;encrypted;peeked;yields;signal;closedNotification;constructor(){this.version="1.18.0",this.lang="nats.ws",this.connected=!1,this.done=!1,this.socketClosed=!1,this.encrypted=!1,this.peeked=!1,this.yields=[],this.signal=oe(),this.closedNotification=oe()}connect(e,t){var n=this;return(0,m.Z)(function*(){const o=oe();if(t.tls)return o.reject(new q("tls",U.InvalidOption)),o;n.options=t;const a=e.src;if(t.wsFactory){const{socket:l,encrypted:_}=yield t.wsFactory(e.src,t);n.socket=l,n.encrypted=_}else n.encrypted=0===a.indexOf("wss://"),n.socket=new WebSocket(a);return n.socket.binaryType="arraybuffer",n.socket.onopen=()=>{n.isDiscarded()},n.socket.onmessage=l=>{if(n.isDiscarded())return;if(n.yields.push(new Uint8Array(l.data)),n.peeked)return void n.signal.resolve();const _=He.concat(...n.yields),v=function cn(r){const e=function Kt(r){for(let e=0;e<r.length;e++){const t=e+1;if(r.byteLength>t&&r[e]===zt&&r[t]===$t)return t+1}return 0}(r);if(e>0){const n=new Uint8Array(r).slice(0,e);return Oe.decode(n)}return""}(_);if(""!==v){const A=os.exec(v);if(!A)return t.debug&&console.error("!!!",_e(_)),void o.reject(new Error("unexpected response from server"));try{(function is(r,e){const{proto:t,tls_required:n,tls_available:i}=r;if((void 0===t||t<1)&&e.noEcho)throw new q("noEcho",U.ServerOptionNotAvailable);if(e.tls&&!n&&!i)throw new q("tls",U.ServerOptionNotAvailable)})(JSON.parse(A[1]),n.options),n.peeked=!0,n.connected=!0,n.signal.resolve(),o.resolve()}catch(E){return void o.reject(E)}}},n.socket.onclose=l=>{if(n.isDiscarded())return;let _;n.socketClosed=!0,n.done||(l.wasClean||(_=new Error(l.reason)),n._closed(_))},n.socket.onerror=l=>{if(n.isDiscarded())return;const v=new q(l.message,U.Unknown,new Error(l.error));o.reject(v)},o})()}disconnect(){this._closed(void 0,!0)}_closed(e,t=!0){var n=this;return(0,m.Z)(function*(){if(!n.isDiscarded()&&n.connected&&!n.done){if(n.closeError=e,!e)for(;!n.socketClosed&&n.socket.bufferedAmount>0;)yield se(100);n.done=!0;try{n.socket.close(e?1002:1e3,e?e.message:void 0)}catch{}t&&n.closedNotification.resolve(e)}})()}get isClosed(){return this.done}[Symbol.asyncIterator](){return this.iterate()}iterate(){var e=this;return Me(function*(){for(;;){if(e.isDiscarded())return;0===e.yields.length&&(yield me(e.signal));const t=e.yields;e.yields=[];for(let n=0;n<t.length;n++)e.options.debug&&console.info(`> ${_e(t[n])}`),yield t[n];if(e.done)break;0===e.yields.length&&(t.length=0,e.yields=t,e.signal=oe())}})()}isEncrypted(){return this.connected&&this.encrypted}send(e){if(!this.isDiscarded())try{return this.socket.send(e.buffer),void(this.options.debug&&console.info(`< ${_e(e)}`))}catch(t){this.options.debug&&console.error(`!!! ${_e(e)}: ${t}`)}}close(e){return this._closed(e,!1)}closed(){return this.closedNotification}isDiscarded(){return!!this.done&&(this.discard(),!0)}discard(){this.done=!0;try{this.socket?.close()}catch{}}}function wo(r){/^(.*:\/\/)(.*)/.test(r)||(r=`https://${r}`);let t=new URL(r);const n=t.protocol.toLowerCase();let i,o;"https:"!==n&&"http"!==n&&(r=r.replace(/^(.*:\/\/)(.*)/gm,"$2"),t=new URL(`http://${r}`));const a=t.hostname,l=t.pathname,_=t.search||"";switch(n){case"http:":case"ws:":case"nats:":o=t.port||"80",i="ws:";break;default:o=t.port||"443",i="wss:"}return`${i}//${a}:${o}${l}${_}`}Y(6021);let yr=class{#e;#t;#n;#r=Qe();#i;constructor(e){this.#e=e||{name:""}}connect(e,t,n){var i=this;return(0,m.Z)(function*(){try{i.#t=yield function So(r={}){return function st(r){Ae=r}({defaultPort:443,urlParseFn:wo,factory:()=>new vo}),br.connect(r)}({servers:e,user:t,pass:n})}catch(o){console.error(o)}i.#n=yield i.#t.jetstream()})()}publish(e,t){var n=this;return(0,m.Z)(function*(){try{const i={data:t};yield n.#n.publish(e,n.#r.encode(i))}catch(i){console.log(i)}})()}unsubscribe(){void 0!==this.#i?this.#i.close():console.error("Should have subscribed first")}subscribe(e=Dn.Pull,t,n){return new Se.Observable(i=>{(e===Dn.Pull?this.#o(t):this.#s(t,n)).then(a=>{this.#i=a,i.next(a)})})}#s(e,t){var n=this;return(0,m.Z)(function*(){return t?(yield n.#n.consumers.get(n.#e.name,{filterSubjects:e,inactive_threshold:1e3,deliver_policy:t})).consume():(yield n.#n.consumers.get(n.#e.name,{filterSubjects:e,inactive_threshold:1e3})).consume()})()}#o(e){var t=this;return(0,m.Z)(function*(){return(yield t.#n.consumers.get(t.#e.name,e)).consume()})()}request(e,t){const n=new Se.Subject;let i;return i=(0,Se.from)(null!=t&&""!==t&&0!==t&&!1!==t?this.#t.request(`core.${e}`,this.#r.encode({data:t})):this.#t.request(`core.${e}`,this.#r.encode({data:{}}))),i.subscribe(l=>{n.next(this.#r.decode(l.data))}),n.asObservable()}drain(){var e=this;return(0,m.Z)(function*(){yield e.#t.drain()})()}};yr=(0,s.gn)([(0,xe.Injectable)({providedIn:"root"})],yr);var Dn=function(r){return r.Pull="pull",r.Push="push",r}(Dn||{}),pi=function(r){return r.None="none",r.All="all",r.Explicit="explicit",r.NotSet="",r}(pi||{}),mi=function(r){return r.Limits="limits",r.Interest="interest",r.Workqueue="workqueue",r}(mi||{}),gi=function(r){return r.All="all",r.Last="last",r.New="new",r.StartSequence="by_start_sequence",r.StartTime="by_start_time",r.LastPerSubject="last_per_subject",r}(gi||{})},324:(Bt,We,Y)=>{Y.r(We),Y.d(We,{NavigationViewComponent:()=>z});var m=Y(5861),s=Y(5863),xe=Y(575),Se=Y(1189),ce=Y(6701),we=Y(5126),me=Y(5617);let W=(()=>{class x{constructor(){this.isCollapsed=(0,s.signal)(!0),this.router=(0,s.inject)(ce.Router),this.event$=this.router.events.pipe((0,we.filter)(f=>f instanceof ce.NavigationEnd)),this.routerSignal=(0,me.toSignal)(this.event$),this.isShowBody=(0,s.computed)(()=>{if(!(this.routerSignal()&&this.routerSignal()instanceof ce.NavigationEnd))return!1;let f=this.routerSignal();return console.log("is the view?","/appStore"!==f.urlAfterRedirects&&"/home"!==f.urlAfterRedirects&&"/news"!==f.urlAfterRedirects),"/appStore"!==f.urlAfterRedirects&&"/home"!==f.urlAfterRedirects&&"/news"!==f.urlAfterRedirects})}onCollapsClick(){this.isCollapsed.set(!this.isCollapsed())}static#e=this.\u0275fac=function(k){return new(k||x)};static#t=this.\u0275prov=s.\u0275\u0275defineInjectable({token:x,factory:x.\u0275fac,providedIn:"root"})}return x})();var Me=Y(6107),pe=Y(7842),Re=Y(8093),Oe=Y(3171),it=Y(2175),Ve=Y(7069),ze=Y(4009),Ye=Y(2998),Je=Y(6827),qe=Y(8426),lt=Y(743),ue=Y(4008);let ve=(()=>{class x{constructor(){this.isDockVisible=(0,s.signal)(!0)}setDockVisible(f){this.isDockVisible.set(f)}getDockVisible(){return this.isDockVisible()}static#e=this.\u0275fac=function(k){return new(k||x)};static#t=this.\u0275prov=s.\u0275\u0275defineInjectable({token:x,factory:x.\u0275fac,providedIn:"root"})}return x})();var ae=Y(9191),Ne=Y(6488),ge=Y(2285),Ke=Y(6753);let Ze=(()=>{class x{#e=(0,s.inject)(Ke.JetstreamWsService);getHashPassword(f){const k=new ge.Z("SHA3-256","TEXT",{encoding:"UTF8"});return k.update(f),k.getHash("HEX")}getAuth(f){var k=this;return(0,m.Z)(function*(){return yield(0,we.lastValueFrom)(k.#e.request("auth.request",f))})()}static#t=this.\u0275fac=function(k){return new(k||x)};static#n=this.\u0275prov=s.\u0275\u0275defineInjectable({token:x,factory:x.\u0275fac,providedIn:"root"})}return x})();var pt=Y(6409),U=Y(25);const rt=function(){return{width:"24px",height:"24px"}};function ne(x,G){if(1&x&&(s.\u0275\u0275elementStart(0,"div",44),s.\u0275\u0275element(1,"p-avatar",7),s.\u0275\u0275text(2),s.\u0275\u0275elementEnd()),2&x){const f=s.\u0275\u0275nextContext();s.\u0275\u0275advance(1),s.\u0275\u0275styleMap(s.\u0275\u0275pureFunction0(3,rt)),s.\u0275\u0275advance(1),s.\u0275\u0275textInterpolate1(" ",f.userAccountService.userAccount().userCode.display," ")}}function le(x,G){if(1&x&&(s.\u0275\u0275elementStart(0,"div",47),s.\u0275\u0275text(1),s.\u0275\u0275elementEnd()),2&x){const f=G.$implicit;s.\u0275\u0275advance(1),s.\u0275\u0275textInterpolate1(" ",f.label," ")}}function q(x,G){if(1&x){const f=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"p-listbox",45),s.\u0275\u0275listener("onClick",function(O){s.\u0275\u0275restoreView(f);const D=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(D.onUserDialogListClick(O))}),s.\u0275\u0275template(1,le,2,1,"ng-template",46),s.\u0275\u0275elementEnd()}if(2&x){const f=s.\u0275\u0275nextContext();s.\u0275\u0275property("options",f.userDialogList)}}function fe(x,G){1&x&&(s.\u0275\u0275elementStart(0,"div",44),s.\u0275\u0275namespaceSVG(),s.\u0275\u0275elementStart(1,"svg",48)(2,"g",49),s.\u0275\u0275element(3,"path",50),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(4,"defs")(5,"clipPath",51),s.\u0275\u0275element(6,"rect",52),s.\u0275\u0275elementEnd()()(),s.\u0275\u0275namespaceHTML(),s.\u0275\u0275elementStart(7,"h6"),s.\u0275\u0275text(8,"\u7a0b\u5f0f\u96c6"),s.\u0275\u0275elementEnd()())}function Ie(x,G){if(1&x){const f=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"div",58)(1,"div",59),s.\u0275\u0275listener("click",function(){s.\u0275\u0275restoreView(f);const O=s.\u0275\u0275nextContext().$implicit,D=s.\u0275\u0275nextContext(2);return s.\u0275\u0275resetView(D.onNavAppClick(O.url))}),s.\u0275\u0275elementStart(2,"div",60)(3,"span",61),s.\u0275\u0275text(4),s.\u0275\u0275elementEnd()(),s.\u0275\u0275text(5),s.\u0275\u0275elementEnd()()}if(2&x){const f=s.\u0275\u0275nextContext().$implicit;s.\u0275\u0275advance(4),s.\u0275\u0275textInterpolate1(" ",f.icon," "),s.\u0275\u0275advance(1),s.\u0275\u0275textInterpolate1(" ",f.title," ")}}function kt(x,G){if(1&x&&(s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275template(1,Ie,6,2,"div",57),s.\u0275\u0275elementContainerEnd()),2&x){const f=G.$implicit;s.\u0275\u0275advance(1),s.\u0275\u0275property("ngIf",!0===f.isFavorite)}}function d(x,G){if(1&x){const f=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"div",58)(1,"span",62)(2,"div",59),s.\u0275\u0275listener("click",function(){s.\u0275\u0275restoreView(f);const O=s.\u0275\u0275nextContext().$implicit,D=s.\u0275\u0275nextContext(2);return s.\u0275\u0275resetView(D.onNavAppClick(O.url))}),s.\u0275\u0275elementStart(3,"div",60)(4,"span",61),s.\u0275\u0275text(5),s.\u0275\u0275elementEnd()(),s.\u0275\u0275text(6),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(7,"button",63),s.\u0275\u0275listener("click",function(){s.\u0275\u0275restoreView(f);const O=s.\u0275\u0275nextContext().$implicit,D=s.\u0275\u0275nextContext(2);return s.\u0275\u0275resetView(D.onCloseApp(O.appId))}),s.\u0275\u0275elementEnd()()()}if(2&x){const f=s.\u0275\u0275nextContext().$implicit;s.\u0275\u0275advance(5),s.\u0275\u0275textInterpolate1(" ",f.icon," "),s.\u0275\u0275advance(1),s.\u0275\u0275textInterpolate1(" ",f.title," ")}}function I(x,G){if(1&x&&(s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275template(1,d,8,2,"div",57),s.\u0275\u0275elementContainerEnd()),2&x){const f=G.$implicit;s.\u0275\u0275advance(1),s.\u0275\u0275property("ngIf",!0===f.isOpen)}}function j(x,G){if(1&x){const f=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"div",53),s.\u0275\u0275text(1," \u67e5\u770b\u5168\u90e8 "),s.\u0275\u0275elementStart(2,"button",54),s.\u0275\u0275listener("click",function(){s.\u0275\u0275restoreView(f);const O=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(O.onAppStoreClick())}),s.\u0275\u0275elementEnd()(),s.\u0275\u0275element(3,"p-divider"),s.\u0275\u0275elementStart(4,"div",55),s.\u0275\u0275text(5,"\u6211\u7684\u6700\u611b"),s.\u0275\u0275elementEnd(),s.\u0275\u0275template(6,kt,2,1,"ng-container",56),s.\u0275\u0275element(7,"p-divider"),s.\u0275\u0275elementStart(8,"div",55),s.\u0275\u0275text(9,"\u5df2\u958b\u555f"),s.\u0275\u0275elementEnd(),s.\u0275\u0275template(10,I,2,1,"ng-container",56)}if(2&x){const f=s.\u0275\u0275nextContext();s.\u0275\u0275advance(6),s.\u0275\u0275property("ngForOf",f.appStoreService.myAppStores()),s.\u0275\u0275advance(4),s.\u0275\u0275property("ngForOf",f.appStoreService.myAppStores())}}function T(x,G){if(1&x){const f=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"div",64)(1,"h5",65),s.\u0275\u0275text(2,"\u500b\u4eba\u8a2d\u5b9a"),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(3,"p-avatar",66),s.\u0275\u0275listener("click",function(){s.\u0275\u0275restoreView(f);const O=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(O.onCancelSaveClick())}),s.\u0275\u0275elementEnd()()}}function J(x,G){if(1&x){const f=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"button",67),s.\u0275\u0275listener("click",function(){s.\u0275\u0275restoreView(f);const O=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(O.onCancelSaveClick())}),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(1,"button",68),s.\u0275\u0275listener("click",function(){s.\u0275\u0275restoreView(f);const O=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(O.onProfileSaveClick())}),s.\u0275\u0275elementEnd()}}const K=function(x){return{"collapsed-active":x}},re=function(x){return{"collapsed-inactive":x}},_e=function(){return{width:"240px"}},Le=function(){return{"960px":"75vw"}},se=function(){return{width:"160px",height:"160px"}},oe=function(x){return{active:x}};let Be=(()=>{class x{constructor(){this.isUserDialogVisible=!1,this.isUserProfileVisible=!1,this.isAppListDialogVisible=!1,this.isDockVisible=!0,this.isRestDisabled=!0,this.enteredPassword="",this.resetPassword="",this.resetPasswordVerify="",this.themeOptions=[],this.editableUserImage=(0,s.signal)(""),this.preview="",this.selectedTheme="light",this.selectedScale=16,this.activeScaleButton=16,this.navigationService=(0,s.inject)(W),this.navigationViewService=(0,s.inject)(ve),this.userAccountService=(0,s.inject)(Ne.Ng),this.userProfileService=(0,s.inject)(Ne.iw),this.appStoreService=(0,s.inject)(ae.AppStoreService),this.newsService=(0,s.inject)(pt.NewsService),this.#e=(0,s.inject)(ce.Router),this.#t=(0,s.inject)(Ze)}#e;#t;ngOnInit(){this.userDialogList=[{label:$localize``,code:"PROFILE"},{label:$localize``,code:"HELP"}],this.themeOptions=[{name:$localize``,value:"light"},{name:$localize``,value:"dark"}],this.editableUserInfo=Object.assign({},this.userAccountService.userAccount()),this.editableUserImage.set(this.userAccountService.userImage().image),this.isDockVisible=!0,this.selectedTheme="dark"}onHomeIconClick(){this.navigationService.isCollapsed.set(!0),this.#e.navigate(["/home"])}onUserIconClick(){this.isUserDialogVisible=!this.isUserDialogVisible}onUserDialogListClick(f){this.isUserDialogVisible=!this.isUserDialogVisible,"PROFILE"===f.option.code&&(this.isUserProfileVisible=!0)}onNewsIconClick(){this.#e.navigate(["/news"])}onAppListIconClick(){this.isAppListDialogVisible=!this.isAppListDialogVisible}onAppStoreClick(){this.#e.navigate(["/appStore"])}onNavAppClick(f){this.#e.navigate([f])}onCloseApp(f){this.appStoreService.setAppClose(f)}onLogoutIconClick(){this.#e.navigate(["/login"])}onSelectFile(f){if(this.selectedFiles=f.files,this.selectedFiles){const k=this.selectedFiles.item(0);if(k){this.preview="",this.currentFile=k;const O=new FileReader;O.readAsDataURL(this.currentFile),O.onload=D=>{this.preview=D.target.result,this.editableUserImage.set(this.preview)}}}}verityPassword(){const f=this.userAccountService.userAccount().passwordHash;this.#t.getHashPassword(this.enteredPassword)===f?this.isRestDisabled=!1:alert($localize``)}verityResetPassword(){const f=this.#t.getHashPassword(this.resetPassword),k=this.#t.getHashPassword(this.resetPasswordVerify);""!==this.enteredPassword&&f===k&&""!==this.resetPassword&&(this.editableUserInfo.passwordHash=f,alert($localize``)),this.enteredPassword="",this.resetPassword="",this.resetPasswordVerify="",this.isRestDisabled=!0}onCancelSaveClick(){this.isUserProfileVisible=!this.isUserProfileVisible,this.editableUserInfo=Object.assign({},this.userAccountService.userAccount()),this.editableUserImage.set(this.userAccountService.userImage().image),this.verityResetPassword(),this.isDockVisible=!0,this.selectedScale=16,this.activeScaleButton=16,this.selectedTheme="dark",this.onScaleChange(this.selectedScale)}onProfileSaveClick(){this.verityResetPassword(),this.isUserProfileVisible=!this.isUserProfileVisible,this.userAccountService.userAccount.set(this.editableUserInfo),this.userAccountService.userImage.set({_id:this.userAccountService.userImage()._id,userCode:this.userAccountService.userImage().userCode,image:this.editableUserImage()}),this.editableUserInfo=Object.assign({},this.userAccountService.userAccount())}onThemeChange(){document.getElementById("theme-css").href="light"===this.selectedTheme?"app/styles/theme.css":"app/styles/theme-dark.css"}onScaleChange(f){document.documentElement.style.fontSize=f+"px",this.selectedScale=f,this.activeScaleButton=f}isScaleActive(f){return this.activeScaleButton===f}onDockVisible(){this.navigationViewService.setDockVisible(this.isDockVisible)}static#n=this.\u0275fac=function(k){return new(k||x)};static#r=this.\u0275cmp=s.\u0275\u0275defineComponent({type:x,selectors:[["his-footer"]],standalone:!0,features:[s.\u0275\u0275StandaloneFeature],decls:83,vars:52,consts:[[1,"navigation-footer"],[1,"logo"],["src","assets/companyLogo.png","alt","Image",1,"logo-style"],[3,"ngClass"],[1,"wrapNavitem",3,"ngClass"],["pButton","","pRipple","","type","button","icon","pi pi-home",1,"p-button-rounded","p-button-text","p-button-icon-only",3,"click"],["pButton","","pRipple","","type","button",1,"p-button-rounded","p-button-text","p-button-icon-only",3,"click"],["image","assets/user.png","shape","circle"],["header","Header",1,"userSetting",3,"visible","visibleChange"],["pTemplate","header"],["pTemplate","content"],["pButton","","pRipple","","type","button","icon","pi pi-bell",1,"p-button-rounded","p-button-text",3,"click"],[1,"badge-container"],["severity","danger",1,"badge-style",3,"value"],[1,"pi","pi-th-large"],["header","Header",1,"appList",3,"visible","visibleChange"],["pButton","","pRipple","","type","button","icon","pi pi-sign-out ",1,"p-button-rounded","p-button-text",3,"click"],["showEffect","fade",1,"profile",3,"visible","closable","modal","breakpoints","visibleChange"],[1,"profileContent","lg:col-12","mb-2","p-0","flex"],[1,"ImgBox"],[1,"Img"],["shape","circle",3,"image"],[1,"pencil"],["type","file","accept","image/*",2,"display","none",3,"change"],["icon","pi pi-pencil","shape","circle"],[1,"content"],[1,"formBox","flex","flex-wrap"],[1,"formList","flex","flex-wrap"],[1,"fromColumn"],["type","text","pInputText","",3,"ngModel","disabled","ngModelChange"],["type","text","pInputText","",3,"ngModel","ngModelChange"],[1,"fulid"],[3,"ngModel","feedback","toggleMask","ngModelChange","keydown.enter"],["placeholder","\u8acb\u8f38\u5165\u65b0\u5bc6\u78bc",3,"ngModel","feedback","toggleMask","disabled","ngModelChange"],["placeholder","\u8acb\u518d\u6b21\u8f38\u5165\u65b0\u5bc6\u78bc",3,"ngModel","feedback","toggleMask","disabled","ngModelChange"],[1,"typeBox","flex"],[1,"typeForm"],["optionLabel","name","optionValue","value",3,"options","ngModel","ngModelChange","onOptionClick"],[1,"typeForm","flex","column"],[3,"ngModel","ngModelChange","onChange"],["pButton","","pRipple","","type","button","label","A","id","small-font",1,"p-button-outlined","p-button-hover-outlined",3,"ngClass","click"],["pButton","","pRipple","","type","button","label","A","id","medium-font",1,"p-button-outlined","p-button-hover-outlined","active",3,"ngClass","click"],["pButton","","pRipple","","type","button","label","A","id","large-font",1,"p-button-outlined","p-button-hover-outlined",3,"ngClass","click"],["pTemplate","footer"],[1,"dialog-header"],["optionLabel","label",3,"options","onClick"],["pTemplate","item"],[1,"labellist"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none"],["clip-path","url(#clip0_2927_3142)"],["d","M4 8H8V4H4V8ZM10 20H14V16H10V20ZM4 20H8V16H4V20ZM4 14H8V10H4V14ZM10 14H14V10H10V14ZM16 4V8H20V4H16ZM10 8H14V4H10V8ZM16 14H20V10H16V14ZM16 20H20V16H16V20Z","fill","white"],["id","clip0_2927_3142"],["width","24","height","24","fill","white"],[1,"see-all-style"],["pButton","","pRipple","","type","button","icon","pi pi-angle-right",1,"p-button-text",3,"click"],[1,"title-style","label-m"],[4,"ngFor","ngForOf"],["class","dialog-content-title",4,"ngIf"],[1,"dialog-content-title"],[1,"app-container",3,"click"],[1,"p-image","p-component"],[1,"material-symbols-outlined","icon-style"],[1,"flex","opend","w-full"],["pButton","","pRipple","","type","button","icon","pi pi-times",1,"p-button-text",3,"click"],[1,"flex","justify-content-between","align-items-start","flex-wrap",2,"width","100%"],[1,"titel-m"],["icon","pi pi-times","shape","circle",3,"click"],["pButton","","pRipple","","type","button","label","\u53d6\u6d88",1,"p-button-secondary",3,"click"],["pButton","","pRipple","","type","button","label","\u78ba\u5b9a",3,"click"]],template:function(k,O){1&k&&(s.\u0275\u0275elementStart(0,"ul",0)(1,"li",1),s.\u0275\u0275element(2,"img",2),s.\u0275\u0275elementStart(3,"div",3),s.\u0275\u0275text(4," \u96f2\u884c\u81f3\u5584 "),s.\u0275\u0275elementEnd()(),s.\u0275\u0275element(5,"hr"),s.\u0275\u0275elementStart(6,"div",4)(7,"li")(8,"button",5),s.\u0275\u0275listener("click",function(){return O.onHomeIconClick()}),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(9,"li")(10,"button",6),s.\u0275\u0275listener("click",function(){return O.onUserIconClick()}),s.\u0275\u0275element(11,"p-avatar",7),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(12,"p-dialog",8),s.\u0275\u0275listener("visibleChange",function(te){return O.isUserDialogVisible=te}),s.\u0275\u0275template(13,ne,3,4,"ng-template",9),s.\u0275\u0275template(14,q,2,1,"ng-template",10),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(15,"li")(16,"button",11),s.\u0275\u0275listener("click",function(){return O.onNewsIconClick()}),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(17,"div",12),s.\u0275\u0275element(18,"p-badge",13),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(19,"li")(20,"button",6),s.\u0275\u0275listener("click",function(){return O.onAppListIconClick()}),s.\u0275\u0275element(21,"i",14),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(22,"p-dialog",15),s.\u0275\u0275listener("visibleChange",function(te){return O.isAppListDialogVisible=te}),s.\u0275\u0275template(23,fe,9,0,"ng-template",9),s.\u0275\u0275template(24,j,11,2,"ng-template",10),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(25,"li")(26,"button",16),s.\u0275\u0275listener("click",function(){return O.onLogoutIconClick()}),s.\u0275\u0275elementEnd()()()(),s.\u0275\u0275elementStart(27,"p-dialog",17),s.\u0275\u0275listener("visibleChange",function(te){return O.isUserProfileVisible=te}),s.\u0275\u0275template(28,T,4,0,"ng-template",9),s.\u0275\u0275elementStart(29,"div",18)(30,"div",19)(31,"div",20),s.\u0275\u0275element(32,"p-avatar",21),s.\u0275\u0275elementStart(33,"label",22)(34,"input",23),s.\u0275\u0275listener("change",function(te){return O.onSelectFile(te.target)}),s.\u0275\u0275elementEnd(),s.\u0275\u0275element(35,"p-avatar",24),s.\u0275\u0275elementEnd()()(),s.\u0275\u0275elementStart(36,"div",25)(37,"div",26)(38,"div",27)(39,"div",28)(40,"h6"),s.\u0275\u0275text(41,"\u59d3\u540d"),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(42,"input",29),s.\u0275\u0275listener("ngModelChange",function(te){return O.userAccountService.userAccount().userCode.display=te}),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(43,"div",28)(44,"h6"),s.\u0275\u0275text(45,"\u5e33\u865f"),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(46,"input",29),s.\u0275\u0275listener("ngModelChange",function(te){return O.userAccountService.userAccount().userCode.code=te}),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(47,"div",28)(48,"h6"),s.\u0275\u0275text(49,"\u96fb\u5b50\u4fe1\u7bb1"),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(50,"input",30),s.\u0275\u0275listener("ngModelChange",function(te){return O.editableUserInfo.eMail=te}),s.\u0275\u0275elementEnd()()(),s.\u0275\u0275elementStart(51,"div",27)(52,"div",28)(53,"h6"),s.\u0275\u0275text(54,"\u539f\u672c\u5bc6\u78bc"),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(55,"span",31)(56,"p-password",32),s.\u0275\u0275listener("ngModelChange",function(te){return O.enteredPassword=te})("keydown.enter",function(){return O.verityPassword()}),s.\u0275\u0275elementEnd()()(),s.\u0275\u0275elementStart(57,"div",28)(58,"h6"),s.\u0275\u0275text(59,"\u65b0\u5bc6\u78bc"),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(60,"span",31)(61,"p-password",33),s.\u0275\u0275listener("ngModelChange",function(te){return O.resetPassword=te}),s.\u0275\u0275elementEnd()()(),s.\u0275\u0275elementStart(62,"div",28)(63,"h6"),s.\u0275\u0275text(64,"\u518d\u6b21\u8f38\u5165\u5bc6\u78bc"),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(65,"span",31)(66,"p-password",34),s.\u0275\u0275listener("ngModelChange",function(te){return O.resetPasswordVerify=te}),s.\u0275\u0275elementEnd()()()()(),s.\u0275\u0275elementStart(67,"div",35)(68,"div",36)(69,"h6"),s.\u0275\u0275text(70,"\u8272\u5f69\u4e3b\u984c"),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(71,"p-selectButton",37),s.\u0275\u0275listener("ngModelChange",function(te){return O.selectedTheme=te})("onOptionClick",function(){return O.onThemeChange()}),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(72,"div",38)(73,"h6"),s.\u0275\u0275text(74,"Dock\u986f\u793a"),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(75,"p-inputSwitch",39),s.\u0275\u0275listener("ngModelChange",function(te){return O.isDockVisible=te})("onChange",function(){return O.onDockVisible()}),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(76,"div",36)(77,"h6"),s.\u0275\u0275text(78,"\u5b57\u9ad4\u5927\u5c0f"),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(79,"button",40),s.\u0275\u0275listener("click",function(){return O.onScaleChange(14)}),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(80,"button",41),s.\u0275\u0275listener("click",function(){return O.onScaleChange(16)}),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(81,"button",42),s.\u0275\u0275listener("click",function(){return O.onScaleChange(18)}),s.\u0275\u0275elementEnd()()()()(),s.\u0275\u0275template(82,J,2,0,"ng-template",43),s.\u0275\u0275elementEnd()),2&k&&(s.\u0275\u0275advance(3),s.\u0275\u0275property("ngClass",s.\u0275\u0275pureFunction1(38,K,O.navigationService.isCollapsed())),s.\u0275\u0275advance(3),s.\u0275\u0275property("ngClass",s.\u0275\u0275pureFunction1(40,re,!O.navigationService.isCollapsed())),s.\u0275\u0275advance(5),s.\u0275\u0275styleMap(s.\u0275\u0275pureFunction0(42,rt)),s.\u0275\u0275advance(1),s.\u0275\u0275property("visible",O.isUserDialogVisible),s.\u0275\u0275advance(6),s.\u0275\u0275propertyInterpolate("value",O.newsService.normalNews().length+O.newsService.toDoList().length),s.\u0275\u0275advance(4),s.\u0275\u0275styleMap(s.\u0275\u0275pureFunction0(43,_e)),s.\u0275\u0275property("visible",O.isAppListDialogVisible),s.\u0275\u0275advance(5),s.\u0275\u0275property("visible",O.isUserProfileVisible)("closable",!1)("modal",!0)("breakpoints",s.\u0275\u0275pureFunction0(44,Le)),s.\u0275\u0275advance(5),s.\u0275\u0275styleMap(s.\u0275\u0275pureFunction0(45,se)),s.\u0275\u0275propertyInterpolate("image",O.editableUserImage()),s.\u0275\u0275advance(10),s.\u0275\u0275property("ngModel",O.userAccountService.userAccount().userCode.display)("disabled",!0),s.\u0275\u0275advance(4),s.\u0275\u0275property("ngModel",O.userAccountService.userAccount().userCode.code)("disabled",!0),s.\u0275\u0275advance(4),s.\u0275\u0275property("ngModel",O.editableUserInfo.eMail),s.\u0275\u0275advance(6),s.\u0275\u0275property("ngModel",O.enteredPassword)("feedback",!1)("toggleMask",!0),s.\u0275\u0275advance(5),s.\u0275\u0275property("ngModel",O.resetPassword)("feedback",!0)("toggleMask",!0)("disabled",O.isRestDisabled),s.\u0275\u0275advance(5),s.\u0275\u0275property("ngModel",O.resetPasswordVerify)("feedback",!1)("toggleMask",!0)("disabled",O.isRestDisabled),s.\u0275\u0275advance(5),s.\u0275\u0275property("options",O.themeOptions)("ngModel",O.selectedTheme),s.\u0275\u0275advance(4),s.\u0275\u0275property("ngModel",O.isDockVisible),s.\u0275\u0275advance(4),s.\u0275\u0275property("ngClass",s.\u0275\u0275pureFunction1(46,oe,O.isScaleActive(14))),s.\u0275\u0275advance(1),s.\u0275\u0275property("ngClass",s.\u0275\u0275pureFunction1(48,oe,O.isScaleActive(16))),s.\u0275\u0275advance(1),s.\u0275\u0275property("ngClass",s.\u0275\u0275pureFunction1(50,oe,O.isScaleActive(18))))},dependencies:[xe.CommonModule,xe.NgClass,xe.NgForOf,xe.NgIf,Me.AvatarModule,Me.Avatar,pe.DividerModule,pe.Divider,ce.RouterModule,Se.ButtonModule,Se.ButtonDirective,U.PrimeTemplate,Oe.DialogModule,Oe.Dialog,it.BadgeModule,it.Badge,Ve.ImageModule,ze.ListboxModule,ze.Listbox,Ye.InputTextModule,Ye.InputText,Je.InputSwitchModule,Je.InputSwitch,qe.FormsModule,qe.DefaultValueAccessor,qe.NgControlStatus,qe.NgModel,lt.SelectButtonModule,lt.SelectButton,ue.PasswordModule,ue.Password,Re.FileUploadModule],styles:[".navigation-footer[_ngcontent-%COMP%]{width:100%;margin:0;padding:0;list-style-type:none;display:flex;flex-direction:column;align-items:center;justify-content:flex-end;gap:6px}.navigation-footer[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;margin-bottom:4px}.navigation-footer[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]   .collapsed-active[_ngcontent-%COMP%]{display:none}.navigation-footer[_ngcontent-%COMP%]   .wrapNavitem[_ngcontent-%COMP%]{width:100%;display:flex;flex-wrap:wrap;flex-direction:column;justify-content:center;align-items:center;transition:all .3s;gap:5px}.navigation-footer[_ngcontent-%COMP%]   .wrapNavitem.collapsed-inactive[_ngcontent-%COMP%]{flex-direction:row}.navigation-footer[_ngcontent-%COMP%]   hr[_ngcontent-%COMP%]{position:relative;width:100%;margin:0}.navigation-footer[_ngcontent-%COMP%]   hr[_ngcontent-%COMP%]:after{position:absolute;width:100%;height:.5px;background-color:var(--outline-variant);left:50%;top:50%;transform:translate(-50%,-50%)}.navigation-footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:transparent;border:none}.logo-container[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center}.logo-style[_ngcontent-%COMP%]{width:34px;height:24px}.badge-container[_ngcontent-%COMP%]{position:relative;display:inline-block}.badge-style[_ngcontent-%COMP%]{font-size:12px;min-width:1rem;height:1rem;line-height:.5rem;position:absolute;top:-28px;right:-2px;pointer-events:none}.dialog-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:4px}.dialog-content-title[_ngcontent-%COMP%]{padding:4px var(--spacing-md)}.see-all-style[_ngcontent-%COMP%]{cursor:pointer;display:flex;justify-content:space-between;align-items:center;padding:0 var(--spacing-md) 2px}.see-all-style[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:2rem;height:2rem;margin:0}.title-style[_ngcontent-%COMP%]{padding:var(--spacing-sm) var(--spacing-md);line-height:24px;letter-spacing:.16px}.app-container[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;align-items:center;gap:4px;cursor:pointer}.profileContent[_ngcontent-%COMP%]{gap:var(--spacing-xxl)}.profileContent[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{margin:0 0 8px;font-weight:700}.profileContent[_ngcontent-%COMP%]   .ImgBox[_ngcontent-%COMP%]{width:20%;min-width:160px}.profileContent[_ngcontent-%COMP%]   .ImgBox[_ngcontent-%COMP%]   .Img[_ngcontent-%COMP%]{position:relative}.profileContent[_ngcontent-%COMP%]   .ImgBox[_ngcontent-%COMP%]   .Img[_ngcontent-%COMP%]   .p-button[_ngcontent-%COMP%]{position:absolute;right:3px;bottom:3px;padding:4px}.profileContent[_ngcontent-%COMP%]   .ImgBox[_ngcontent-%COMP%]   .Img[_ngcontent-%COMP%]   .p-button[_ngcontent-%COMP%]:hover{background-color:var(--primary-300)}.profileContent[_ngcontent-%COMP%]   .ImgBox[_ngcontent-%COMP%]   .Img[_ngcontent-%COMP%]   .pencil[_ngcontent-%COMP%]{position:absolute;right:3px;bottom:3px;padding:4px}.profileContent[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{flex:1}.profileContent[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .formBox[_ngcontent-%COMP%]{column-gap:32px}.profileContent[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .formBox[_ngcontent-%COMP%]   .formList[_ngcontent-%COMP%]{width:calc(50% - 16px);display:flex;flex-direction:column}.profileContent[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .formBox[_ngcontent-%COMP%]   .formList[_ngcontent-%COMP%]   .fromColumn[_ngcontent-%COMP%]{margin-bottom:var(--spacing-xl)}.profileContent[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .formBox[_ngcontent-%COMP%]   .formList[_ngcontent-%COMP%]   .fromColumn[_ngcontent-%COMP%]   .fulid[_ngcontent-%COMP%]{width:100%}.profileContent[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .typeBox[_ngcontent-%COMP%]{border-top:1px solid var(--outline-variant);padding-top:var(--spacing-xl);justify-content:space-between;padding-right:30px}.profileContent[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .typeBox[_ngcontent-%COMP%]   .typeForm.column[_ngcontent-%COMP%]{gap:10px;flex-direction:column}.profileContent[_ngcontent-%COMP%]   .p-button.p-button-outlined.p-button-hover-outlined[_ngcontent-%COMP%]{margin:0 1px}.profileContent[_ngcontent-%COMP%]   .p-button.p-button-outlined.p-button-hover-outlined.active[_ngcontent-%COMP%]{box-shadow:inset 0 0 0 1px}.opend[_ngcontent-%COMP%]{justify-content:space-between}[_nghost-%COMP%]     .p-button{min-width:0}[_nghost-%COMP%]     .p-dialog{position:absolute;border-radius:4px;border:1px solid var(--outline-variant);font-size:1.125rem;box-shadow:0 2px 1px -1px #00000005,0 1px 1px #00000024,0 1px 3px #0000001f}[_nghost-%COMP%]     .p-dialog .p-dialog-header{background-color:var(--primary-main);color:var(--white);font-size:18px;font-style:normal;font-weight:700;line-height:26px;letter-spacing:.36px}[_nghost-%COMP%]     .p-dialog .p-dialog-content{display:flex;flex-direction:column;padding:4px 0;gap:0}[_nghost-%COMP%]     .p-dialog .p-dialog-footer{display:flex;align-items:center;padding:4px 12px}[_nghost-%COMP%]     #large-font .p-button-label{font-size:20px}[_nghost-%COMP%]     #medium-font .p-button-label{font-size:18px}[_nghost-%COMP%]     #small-font .p-button-label{font-size:16px}[_nghost-%COMP%]     .appList .p-dialog{left:45px;bottom:20px}[_nghost-%COMP%]     .appList .p-dialog .p-dialog-footer{justify-content:space-between}[_nghost-%COMP%]     .appList .p-dialog .p-dialog-footer button{width:2rem;height:2rem;margin:0}[_nghost-%COMP%]     .userSetting{min-width:180px}[_nghost-%COMP%]     .userSetting .p-dialog{bottom:100px}[_nghost-%COMP%]     .userSetting .p-dialog-content{padding:0}[_nghost-%COMP%]     .userSetting .p-dialog-content .p-listbox{border:none}[_nghost-%COMP%]     .userSetting .p-dialog-content .p-listbox .p-listbox-list .p-listbox-item{padding:4px 12px;min-height:40px}[_nghost-%COMP%]     .userSetting .p-dialog{left:45px;bottom:110px}[_nghost-%COMP%]     .profile .p-dialog{width:800px}[_nghost-%COMP%]     .profile .p-dialog .p-dialog-content{padding:20px 12px}[_nghost-%COMP%]     .profile .p-dialog .p-dialog-content .fromColumn .fulid{display:block;width:100%}[_nghost-%COMP%]     .profile .p-dialog .p-dialog-content .fromColumn .fulid .p-password{width:100%}[_nghost-%COMP%]     .profile .p-dialog .p-dialog-content .fromColumn .fulid .p-password .p-disabled{pointer-events:none;opacity:1;background-color:#1314141f;border-color:var(--outline-variant)}[_nghost-%COMP%]     .profile .p-dialog .p-dialog-content .fromColumn .fulid .p-password .p-disabled+.p-icon-wrapper{pointer-events:none}[_nghost-%COMP%]     .profile .p-dialog .p-dialog-content .fromColumn .fulid .p-input-icon-right>.p-icon-wrapper{right:15px;cursor:pointer}[_nghost-%COMP%]     .profile .p-dialog .p-dialog-footer{padding:16px 12px;justify-content:flex-end}[_nghost-%COMP%]     .profile .p-dialog .p-dialog-footer button{min-width:88px}[_nghost-%COMP%]     .p-divider.p-divider-horizontal{margin:0}[_nghost-%COMP%]     .p-image.p-component{display:block;width:30px;height:30px;background-color:var(--primary-main);border-radius:8px;overflow:hidden;padding:8px;position:relative;background:linear-gradient(0deg,rgba(0,0,0,.2) 0%,rgba(0,0,0,0) 100%),var(--primary-main);box-shadow:0 2px 1px -1px #00000005,0 1px 1px #00000024,0 1px 3px #0000001f}[_nghost-%COMP%]     .p-image.p-component img{display:block;width:100%;height:100%}[_nghost-%COMP%]     .p-badge{min-width:1rem!important;height:1rem;line-height:16px;font-size:10px;padding:0}[_nghost-%COMP%]     p-avatar{height:24px}[_nghost-%COMP%]     .p-avatar.p-avatar-circle{background-color:var(--primary-main)}[_nghost-%COMP%]     .p-avatar.p-avatar-circle .pi-pencil{color:var(--white)}[_nghost-%COMP%]     .p-avatar.p-avatar-circle:hover{background-color:var(--primary-300);cursor:pointer}[_nghost-%COMP%]     .formBox .p-inputtext{width:100%}[_nghost-%COMP%]     .opend .p-button.p-button-icon-only .pi{font-size:1rem}.icon-style[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;justify-content:center;align-items:center;color:var(--surface-a);font-size:18px}"]})}return x})();var Fe=Y(9159);let Ae=(()=>{class x{#e="ws://localhost:8080";#t=(0,s.inject)(Fe.JetstreamWsService);connect(){var f=this;return(0,m.Z)(function*(){console.log("connected"),yield f.#t.connect(f.#e)})()}disconnect(){var f=this;return(0,m.Z)(function*(){yield f.#t.drain()})()}static#n=this.\u0275fac=function(k){return new(k||x)};static#r=this.\u0275prov=s.\u0275\u0275defineInjectable({token:x,factory:x.\u0275fac,providedIn:"root"})}return x})();function st(x,G){if(1&x&&(s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275elementStart(1,"div",3)(2,"span",4),s.\u0275\u0275text(3),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(4,"div")(5,"div"),s.\u0275\u0275text(6),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementContainerEnd()),2&x){const f=s.\u0275\u0275nextContext();s.\u0275\u0275advance(3),s.\u0275\u0275textInterpolate1(" ",f.appInfo().icon," "),s.\u0275\u0275advance(3),s.\u0275\u0275textInterpolate(f.appInfo().title)}}function ut(x,G){if(1&x){const f=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275elementStart(1,"button",5),s.\u0275\u0275listener("click",function(){s.\u0275\u0275restoreView(f);const O=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(O.changeCollapsed())}),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementContainerEnd()}if(2&x){const f=s.\u0275\u0275nextContext();s.\u0275\u0275advance(1),s.\u0275\u0275propertyInterpolate("icon",f.collapsedButtonIcon())}}const mt=function(x){return{"collapsed-inactive":x}};let an=(()=>{class x{constructor(){this.appInfo=(0,s.signal)({}),this.navigationService=(0,s.inject)(W),this.collapsedButtonIcon=(0,s.computed)(()=>!this.navigationService.isCollapsed()&&this.navigationService.isShowBody()?(console.log("pi pi-angle-double-left"),"pi pi-angle-double-left"):"pi pi-angle-double-right"),this.appStoreService=(0,s.inject)(ae.AppStoreService),this.wsNatsService=(0,s.inject)(Ae)}ngOnInit(){var f=this;return(0,m.Z)(function*(){console.log("in NAV"),yield f.wsNatsService.connect(),yield f.appStoreService.initAppStore(),console.log(f.appStoreService.myAppStores()),console.log("in nav bottom")})()}changeCollapsed(){this.navigationService.onCollapsClick()}static#e=this.\u0275fac=function(k){return new(k||x)};static#t=this.\u0275cmp=s.\u0275\u0275defineComponent({type:x,selectors:[["his-navigation"]],standalone:!0,features:[s.\u0275\u0275StandaloneFeature],decls:5,vars:5,consts:[[1,"navigation-container"],[1,"navigation-header",3,"ngClass"],[4,"ngIf"],[1,"m-1"],[1,"material-symbols-outlined"],["pButton","","pRipple","","type","button",1,"p-button-rounded","p-button-text",3,"icon","click"]],template:function(k,O){1&k&&(s.\u0275\u0275elementStart(0,"div",0)(1,"div",1),s.\u0275\u0275template(2,st,7,2,"ng-container",2),s.\u0275\u0275template(3,ut,2,1,"ng-container",2),s.\u0275\u0275elementEnd(),s.\u0275\u0275element(4,"his-footer"),s.\u0275\u0275elementEnd()),2&k&&(s.\u0275\u0275advance(1),s.\u0275\u0275property("ngClass",s.\u0275\u0275pureFunction1(3,mt,!O.navigationService.isCollapsed())),s.\u0275\u0275advance(1),s.\u0275\u0275property("ngIf",O.navigationService.isCollapsed),s.\u0275\u0275advance(1),s.\u0275\u0275property("ngIf",O.navigationService.isShowBody()))},dependencies:[xe.CommonModule,xe.NgClass,xe.NgIf,Se.ButtonModule,Se.ButtonDirective,Be],styles:["[_nghost-%COMP%]     .navigation-header .p-button.p-button-icon-only.p-button-rounded.p-button-text{color:var(--primary-main)}[_nghost-%COMP%]     .appList .p-dialog-content .p-button.p-button-icon-only .pi, [_nghost-%COMP%]     .navigation-footer .p-button.p-button-icon-only .pi{font-size:1.2rem}.layout-sidebar[_ngcontent-%COMP%]{position:fixed;display:flex;justify-content:center;width:60px;height:100%;z-index:999;overflow-y:auto;-webkit-user-select:none;user-select:none;top:0;left:0;transition:transform .2s,left .2s;background-color:var(--surface-overlay);border-right:1px solid var(--outline-variant);padding:.5rem 0rem;border-radius:0;box-shadow:none}.layout-sidebar.collapsed-inactive[_ngcontent-%COMP%]{width:200px}.layout-content[_ngcontent-%COMP%]{margin-left:60px;height:100%}.layout-content.collapsed-inactive[_ngcontent-%COMP%]{margin-left:200px}.systemTitle[_ngcontent-%COMP%]{font-size:20px;font-style:normal;font-weight:500;line-height:100%}.navigation-container[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;flex-direction:column;justify-content:space-between;gap:2px;padding-bottom:10px}.navigation-body[_ngcontent-%COMP%]{flex:1}.navigation-header[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center}.navigation-header.collapsed-inactive[_ngcontent-%COMP%]{justify-content:space-between}"]})}return x})();var Nt=Y(2182),ot=Y(7724);const vt=(0,ot.trigger)("slideDown",[(0,ot.state)("void",(0,ot.style)({top:"0",transform:"translate(-50%,-50%)",opacity:0})),(0,ot.state)("*",(0,ot.style)({transform:"translate(-50%,-100%)",opacity:1})),(0,ot.transition)("void <=> *",[(0,ot.animate)("0.4s ease-out")])]);function zt(x,G){if(1&x&&(s.\u0275\u0275elementStart(0,"div",13)(1,"p",14),s.\u0275\u0275text(2),s.\u0275\u0275elementEnd()()),2&x){const f=s.\u0275\u0275nextContext(2).$implicit;s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate1(" ",f.title," ")}}function $t(x,G){1&x&&s.\u0275\u0275element(0,"div",15)}function Kt(x,G){if(1&x){const f=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"button",8),s.\u0275\u0275listener("mouseover",function(){s.\u0275\u0275restoreView(f);const O=s.\u0275\u0275nextContext().$implicit,D=s.\u0275\u0275nextContext(2);return D.hoveredAppId=O.appId,s.\u0275\u0275resetView(D.onMouseOver(O.appId))})("mouseout",function(){s.\u0275\u0275restoreView(f);const O=s.\u0275\u0275nextContext(3);return O.hoveredItemIndex=null,s.\u0275\u0275resetView(O.onMouseLeave())})("click",function(){s.\u0275\u0275restoreView(f);const O=s.\u0275\u0275nextContext().$implicit,D=s.\u0275\u0275nextContext(2);return s.\u0275\u0275resetView(D.onIconClick(O.url))}),s.\u0275\u0275template(1,zt,3,1,"div",9),s.\u0275\u0275elementStart(2,"div",10)(3,"span",11),s.\u0275\u0275text(4),s.\u0275\u0275elementEnd()(),s.\u0275\u0275template(5,$t,1,0,"div",12),s.\u0275\u0275elementEnd()}if(2&x){const f=s.\u0275\u0275nextContext().$implicit,k=s.\u0275\u0275nextContext(2);s.\u0275\u0275styleProp("transform",k.getTransform(f.appId)),s.\u0275\u0275advance(1),s.\u0275\u0275property("ngIf",k.hoveredAppId==f.appId),s.\u0275\u0275advance(3),s.\u0275\u0275textInterpolate1(" ",f.icon," "),s.\u0275\u0275advance(1),s.\u0275\u0275property("ngIf",f.isOpen)}}function cn(x,G){if(1&x){const f=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"div",16)(1,"button",17),s.\u0275\u0275listener("click",function(){s.\u0275\u0275restoreView(f);const O=s.\u0275\u0275nextContext().$implicit,D=s.\u0275\u0275nextContext(2);return s.\u0275\u0275resetView(D.onCancelClick(O.appId))}),s.\u0275\u0275elementEnd()()}}function ln(x,G){if(1&x&&(s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275elementStart(1,"div",5),s.\u0275\u0275template(2,Kt,6,5,"button",6),s.\u0275\u0275template(3,cn,2,0,"div",7),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementContainerEnd()),2&x){const f=G.$implicit;s.\u0275\u0275advance(2),s.\u0275\u0275property("ngIf",1==f.isFavorite),s.\u0275\u0275advance(1),s.\u0275\u0275property("ngIf",f.isOpen)}}function w(x,G){if(1&x&&(s.\u0275\u0275elementStart(0,"div",13)(1,"p",14),s.\u0275\u0275text(2),s.\u0275\u0275elementEnd()()),2&x){const f=s.\u0275\u0275nextContext(2).$implicit;s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate1(" ",f.title," ")}}function u(x,G){1&x&&s.\u0275\u0275element(0,"div",15)}function y(x,G){if(1&x){const f=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"div",16)(1,"button",17),s.\u0275\u0275listener("click",function(){s.\u0275\u0275restoreView(f);const O=s.\u0275\u0275nextContext(2).$implicit,D=s.\u0275\u0275nextContext(2);return s.\u0275\u0275resetView(D.onCancelClick(O.appId))}),s.\u0275\u0275elementEnd()()}}function b(x,G){if(1&x){const f=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementStart(0,"div",5)(1,"button",8),s.\u0275\u0275listener("mouseover",function(){s.\u0275\u0275restoreView(f);const O=s.\u0275\u0275nextContext().$implicit,D=s.\u0275\u0275nextContext(2);return D.hoveredAppId=O.appId,s.\u0275\u0275resetView(D.onMouseOver(O.appId))})("mouseout",function(){s.\u0275\u0275restoreView(f);const O=s.\u0275\u0275nextContext(3);return O.hoveredItemIndex=null,s.\u0275\u0275resetView(O.onMouseLeave())})("click",function(){s.\u0275\u0275restoreView(f);const O=s.\u0275\u0275nextContext().$implicit,D=s.\u0275\u0275nextContext(2);return s.\u0275\u0275resetView(D.onIconClick(O.url))}),s.\u0275\u0275template(2,w,3,1,"div",9),s.\u0275\u0275elementStart(3,"div",10)(4,"span",11),s.\u0275\u0275text(5),s.\u0275\u0275elementEnd()(),s.\u0275\u0275template(6,u,1,0,"div",12),s.\u0275\u0275elementEnd(),s.\u0275\u0275template(7,y,2,0,"div",7),s.\u0275\u0275elementEnd()}if(2&x){const f=s.\u0275\u0275nextContext().$implicit,k=s.\u0275\u0275nextContext(2);s.\u0275\u0275advance(1),s.\u0275\u0275styleProp("transform",k.getTransform(f.appId)),s.\u0275\u0275advance(1),s.\u0275\u0275property("ngIf",k.hoveredAppId==f.appId),s.\u0275\u0275advance(3),s.\u0275\u0275textInterpolate1(" ",f.icon," "),s.\u0275\u0275advance(1),s.\u0275\u0275property("ngIf",f.isOpen),s.\u0275\u0275advance(1),s.\u0275\u0275property("ngIf",f.isOpen)}}function C(x,G){if(1&x&&(s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275template(1,b,8,6,"div",18),s.\u0275\u0275elementContainerEnd()),2&x){const f=G.$implicit;s.\u0275\u0275advance(1),s.\u0275\u0275property("ngIf",!1===f.isFavorite&&!0===f.isOpen)}}function F(x,G){if(1&x){const f=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275elementStart(1,"div",1),s.\u0275\u0275listener("mouseenter",function(){s.\u0275\u0275restoreView(f);const O=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(O.onMouseOverDock())})("mouseleave",function(){s.\u0275\u0275restoreView(f);const O=s.\u0275\u0275nextContext();return s.\u0275\u0275resetView(O.onMouseLeaveDock())}),s.\u0275\u0275elementStart(2,"div",2),s.\u0275\u0275template(3,ln,4,2,"ng-container",3),s.\u0275\u0275element(4,"p-divider",4),s.\u0275\u0275template(5,C,2,1,"ng-container",3),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementContainerEnd()}if(2&x){const f=s.\u0275\u0275nextContext();s.\u0275\u0275advance(1),s.\u0275\u0275property("@slideDown",void 0),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngForOf",f.appStoreService.myAppStores()),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngForOf",f.appStoreService.myAppStores())}}let V=(()=>{class x{constructor(){this.hoveredItemIndex=null,this.hoveredAppId=null,this.focusedIndex="",this.isShiftKeyPressed=!0,this.isDockDisplay=!0,this.isCursorOnDock=!1,this.appStoreService=(0,s.inject)(ae.AppStoreService),this.navigationViewService=(0,s.inject)(ve),this.#e=(0,s.inject)(ce.Router)}#e;handleKeyDownEvent(f){f.shiftKey&&"Tab"===f.key&&(f.preventDefault(),this.isDockDisplay=!1!==this.navigationViewService.getDockVisible()),("F5"===f.key||f.metaKey&&"r"===f.key||"Tab"===f.key)&&f.preventDefault()}handleKeyUpEvent(f){"Shift"===f.key&&(this.isDockDisplay=!1)}handleMouseMove(f){this.isCursorOnDock||(this.isDockDisplay=f.clientY<20&&1==this.navigationViewService.getDockVisible())}onMouseOver(f){this.focusedIndex=f}onMouseLeave(){this.focusedIndex="",this.hoveredAppId=null}onMouseOverDock(){this.isCursorOnDock=!0}onMouseLeaveDock(){this.isCursorOnDock=!1}onIconClick(f){this.#e.navigate([f])}onCancelClick(f){this.appStoreService.setAppClose(f)}getTransform(f){return f===this.focusedIndex?"scale(1.15)":"scale(1) translateY(0px)"}static#t=this.\u0275fac=function(k){return new(k||x)};static#n=this.\u0275cmp=s.\u0275\u0275defineComponent({type:x,selectors:[["his-dock"]],hostBindings:function(k,O){1&k&&s.\u0275\u0275listener("keydown",function(te){return O.handleKeyDownEvent(te)},!1,s.\u0275\u0275resolveWindow)("keyup",function(te){return O.handleKeyUpEvent(te)},!1,s.\u0275\u0275resolveWindow)("mousemove",function(te){return O.handleMouseMove(te)},!1,s.\u0275\u0275resolveWindow)},standalone:!0,features:[s.\u0275\u0275StandaloneFeature],decls:1,vars:1,consts:[[4,"ngIf"],[1,"dock-container",3,"mouseenter","mouseleave"],[1,"dock"],[4,"ngFor","ngForOf"],["layout","vertical"],[1,"button-box"],["class","app-icon-style",3,"transform","mouseover","mouseout","click",4,"ngIf"],["class","cancel-ico",4,"ngIf"],[1,"app-icon-style",3,"mouseover","mouseout","click"],["class","systemBox",4,"ngIf"],[1,"p-image","p-component"],[1,"material-symbols-outlined","icon-style"],["class","active",4,"ngIf"],[1,"systemBox"],[1,"name"],[1,"active"],[1,"cancel-ico"],["pButton","","pRipple","","type","button","icon","pi pi-times",1,"p-button-rounded","p-button-danger",3,"click"],["class","button-box",4,"ngIf"]],template:function(k,O){1&k&&s.\u0275\u0275template(0,F,6,3,"ng-container",0),2&k&&s.\u0275\u0275property("ngIf",O.isDockDisplay)},dependencies:[xe.CommonModule,xe.NgForOf,xe.NgIf,Se.ButtonModule,Se.ButtonDirective,pe.DividerModule,pe.Divider,Ve.ImageModule],styles:['[_nghost-%COMP%]     .p-image.p-component{display:block;width:48px;height:48px;background-color:var(--primary-main);border-radius:12px;overflow:hidden;padding:8px;position:relative;background:linear-gradient(0deg,rgba(0,0,0,.2) 0%,rgba(0,0,0,0) 100%),var(--primary-main);box-shadow:0 2px 1px -1px #00000005,0 1px 1px #00000024,0 1px 3px #0000001f}[_nghost-%COMP%]     .p-image.p-component img{display:block;width:100%;height:100%}.icon-style[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;justify-content:center;align-items:center;color:var(--surface-a);font-size:48px}.dock-container[_ngcontent-%COMP%]{width:auto;height:72px;border-radius:16px;display:flex;justify-content:center;position:absolute;top:87px;left:50%;transform:translate(-50%,-50%);z-index:99}.dock-container[_ngcontent-%COMP%]   .dock[_ngcontent-%COMP%]{padding:8px 16px;width:auto;height:100%;display:flex;align-items:center;justify-content:center;backdrop-filter:blur(15px);-webkit-backdrop-filter:blur(15px);border:1px solid rgba(255,255,255,.2);gap:16px;border-radius:20px;background-color:#0000001a;box-shadow:0 4px 15px #00000040}.dock-container[_ngcontent-%COMP%]   .dock[_ngcontent-%COMP%]   .app-icon-style[_ngcontent-%COMP%]{list-style:none;display:flex;align-items:center;justify-content:center;width:100%;height:100%;vertical-align:bottom;transition:.2s;transform-origin:50% 100%;border:none;background-color:transparent}.dock-container[_ngcontent-%COMP%]   .dock[_ngcontent-%COMP%]   .app-icon-style[_ngcontent-%COMP%]   .systemBox[_ngcontent-%COMP%]{bottom:-40px;position:absolute;white-space:nowrap;background:rgba(0,0,0,.5);height:10px;padding:10px 15px;backdrop-filter:blur(13px);-webkit-backdrop-filter:blur(13px);display:flex;align-items:center;justify-content:center;border-radius:5px}.dock-container[_ngcontent-%COMP%]   .dock[_ngcontent-%COMP%]   .app-icon-style[_ngcontent-%COMP%]   .systemBox[_ngcontent-%COMP%]:before{content:"";position:absolute;top:-10px;width:0;height:0;border-left:10px solid transparent;border-right:10px solid transparent;border-bottom:10px solid rgba(0,0,0,.5)}.dock-container[_ngcontent-%COMP%]   .dock[_ngcontent-%COMP%]   .app-icon-style[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-size:12px;color:#ffffffe6}.dock-container[_ngcontent-%COMP%]   .dock[_ngcontent-%COMP%]   .app-icon-style[_ngcontent-%COMP%]   .active[_ngcontent-%COMP%]:after{position:absolute;content:"";bottom:-10px;left:50%;transform:translate(-50%);width:5px;height:5px;border-radius:50%;background-color:#000c}.dock-container[_ngcontent-%COMP%]   .dock[_ngcontent-%COMP%]   .app-icon-style[_ngcontent-%COMP%]   .ico[_ngcontent-%COMP%]{width:40px;height:40px;object-fit:cover;transition:.2s}.dock-container[_ngcontent-%COMP%]   .dock[_ngcontent-%COMP%]   .button-box[_ngcontent-%COMP%]{position:relative;transition:all .3s}.dock-container[_ngcontent-%COMP%]   .dock[_ngcontent-%COMP%]   .button-box[_ngcontent-%COMP%]:hover{margin:0 13px}.dock-container[_ngcontent-%COMP%]   .dock[_ngcontent-%COMP%]   .button-box[_ngcontent-%COMP%]   .cancel-ico[_ngcontent-%COMP%]{width:18px;height:18px;position:absolute;top:-12px;right:-8px}[_nghost-%COMP%]     .p-divider.p-divider-vertical{padding:12px 0;margin:0}[_nghost-%COMP%]     .p-button.p-button-icon-only .pi{font-size:1px}[_nghost-%COMP%]     .cancel-ico .p-button.p-button-icon-only{width:18px;height:18px}[_nghost-%COMP%]     .cancel-ico .p-button.p-button-icon-only .pi{font-size:1px}'],data:{animation:[vt]}})}return x})();const ee=function(x){return{"collapsed-inactive":x}};let z=(()=>{class x{constructor(){this.navigationService=(0,s.inject)(W),this.navigationViewService=(0,s.inject)(ve),this.newsService=(0,s.inject)(pt.NewsService),this.userAccountService=(0,s.inject)(Ne.Ng),this.#e=(0,s.inject)(Nt.SharedService),this.#t=(0,s.inject)(Ae)}#e;#t;ngOnInit(){var f=this;return(0,m.Z)(function*(){yield f.#t.connect(),f.userAccountService.userAccount.set(f.#e.getValue(window.history.state.token)),f.userAccountService.getUserImage(f.userAccountService.userAccount().userCode.code),yield f.newsService.connect(),yield f.newsService.subMyNews(f.userAccountService.userAccount().userCode),f.newsService.getInitNews(f.userAccountService.userAccount().userCode).subscribe(k=>{f.newsService.upsertAllNews(f.newsService.formatNews(k))})})()}static#n=this.\u0275fac=function(k){return new(k||x)};static#r=this.\u0275cmp=s.\u0275\u0275defineComponent({type:x,selectors:[["app-navigation-view"]],standalone:!0,features:[s.\u0275\u0275ProvidersFeature([ve]),s.\u0275\u0275StandaloneFeature],decls:5,vars:6,consts:[[1,"layout-sidebar",3,"ngClass"],[3,"setCollapsed"],[1,"layout-content",3,"ngClass"]],template:function(k,O){1&k&&(s.\u0275\u0275elementStart(0,"div",0)(1,"his-navigation",1),s.\u0275\u0275listener("setCollapsed",function(){return O.navigationService.onCollapsClick()}),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(2,"div",2),s.\u0275\u0275element(3,"router-outlet"),s.\u0275\u0275elementEnd(),s.\u0275\u0275element(4,"his-dock")),2&k&&(s.\u0275\u0275property("ngClass",s.\u0275\u0275pureFunction1(2,ee,!O.navigationService.isCollapsed())),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngClass",s.\u0275\u0275pureFunction1(4,ee,!O.navigationService.isCollapsed())))},dependencies:[xe.CommonModule,xe.NgClass,an,ce.RouterOutlet,V],styles:[".layout-sidebar[_ngcontent-%COMP%]{position:fixed;display:flex;justify-content:center;width:60px;height:100%;z-index:999;overflow-y:auto;-webkit-user-select:none;user-select:none;top:0;left:0;transition:transform .2s,left .2s;background-color:var(--surface-overlay);border-right:1px solid var(--outline-variant);padding:.5rem 0rem;border-radius:0;box-shadow:none}.layout-sidebar.collapsed-inactive[_ngcontent-%COMP%]{width:200px}.layout-content[_ngcontent-%COMP%]{margin-left:60px;height:100%}.layout-content.collapsed-inactive[_ngcontent-%COMP%]{margin-left:200px}"]})}return x})()},9191:(Bt,We,Y)=>{Y.r(We),Y.d(We,{AppStoreComponent:()=>pt,AppStoreService:()=>ge});var m=Y(5861),s=Y(5863),xe=Y(6701),Se=Y(9159),ce=Y(2182),we=Y(575),me=Y(8426),W=Y(743),Me=Y(1189),pe=Y(2998),Re=Y(7842),Oe=Y(6107),it=Y(6984),Ve=Y(3433),ze=Y(6488),Ye=Y(25);function Je(U,rt){if(1&U&&(s.\u0275\u0275elementStart(0,"span"),s.\u0275\u0275text(1),s.\u0275\u0275elementEnd()),2&U){const ne=rt.$implicit;s.\u0275\u0275classMap(ne.icon),s.\u0275\u0275advance(1),s.\u0275\u0275textInterpolate1(" ",ne.label," ")}}function qe(U,rt){if(1&U){const ne=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275elementStart(1,"his-card-list",19),s.\u0275\u0275listener("setChange",function(q){s.\u0275\u0275restoreView(ne);const fe=s.\u0275\u0275nextContext(2);return s.\u0275\u0275resetView(fe.appStoreService.onFavoriteClick(q))})("clickCard",function(q){s.\u0275\u0275restoreView(ne);const fe=s.\u0275\u0275nextContext(2);return s.\u0275\u0275resetView(fe.appStoreService.onNavAppClick(q))}),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementContainerEnd()}if(2&U){const ne=rt.$implicit;s.\u0275\u0275advance(1),s.\u0275\u0275property("myAppStore",ne)}}function lt(U,rt){if(1&U&&(s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275elementStart(1,"div",15),s.\u0275\u0275element(2,"p-divider",16),s.\u0275\u0275elementStart(3,"div",17),s.\u0275\u0275template(4,qe,2,1,"ng-container",18),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementContainerEnd()),2&U){const ne=s.\u0275\u0275nextContext();s.\u0275\u0275advance(4),s.\u0275\u0275property("ngForOf",ne.appStoreService.myAppStores())}}function ue(U,rt){if(1&U){const ne=s.\u0275\u0275getCurrentView();s.\u0275\u0275elementContainerStart(0),s.\u0275\u0275elementStart(1,"his-card-list",22),s.\u0275\u0275listener("setChange",function(q){s.\u0275\u0275restoreView(ne);const fe=s.\u0275\u0275nextContext(2);return s.\u0275\u0275resetView(fe.appStoreService.onFavoriteClick(q))})("clickCard",function(q){s.\u0275\u0275restoreView(ne);const fe=s.\u0275\u0275nextContext(2);return s.\u0275\u0275resetView(fe.appStoreService.onNavAppClick(q))}),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementContainerEnd()}if(2&U){const ne=rt.$implicit;s.\u0275\u0275advance(1),s.\u0275\u0275property("myAppStore",ne)("isListView",!0)}}function ve(U,rt){if(1&U&&(s.\u0275\u0275elementStart(0,"div",20),s.\u0275\u0275element(1,"p-divider",16),s.\u0275\u0275elementStart(2,"div",21),s.\u0275\u0275template(3,ue,2,2,"ng-container",18),s.\u0275\u0275elementEnd()()),2&U){const ne=s.\u0275\u0275nextContext();s.\u0275\u0275advance(3),s.\u0275\u0275property("ngForOf",ne.appStoreService.myAppStores())}}let Ne=(()=>{class U{#e="ws://localhost:8080";#t=(0,s.inject)(Se.JetstreamWsService);connect(){var ne=this;return(0,m.Z)(function*(){console.log("connected"),yield ne.#t.connect(ne.#e)})()}disconnect(){var ne=this;return(0,m.Z)(function*(){yield ne.#t.drain()})()}static#n=this.\u0275fac=function(le){return new(le||U)};static#r=this.\u0275prov=s.\u0275\u0275defineInjectable({token:U,factory:U.\u0275fac,providedIn:"root"})}return U})(),ge=(()=>{class U{constructor(){this.myAppStores=(0,s.signal)([]),this.userAppStores=(0,s.signal)([]),this.appOpenedIndex=[],this.#e=(0,s.inject)(xe.Router),this.#t=(0,s.inject)(Se.JetstreamWsService),this.#n=(0,s.inject)(ce.SharedService),this.#r=(0,s.inject)(Ne)}#e;#t;#n;#r;convertToExtended(ne){return ne.map(le=>({...le,isOpen:!1}))}getAppStoreList(ne){var le=this;return(0,m.Z)(function*(){le.#t.request("UserAppStore.myAppStore",ne).subscribe(q=>{le.myAppStores.set(le.convertToExtended(q))})})()}getUserStoreList(ne){var le=this;return(0,m.Z)(function*(){le.#t.request("UserAppStore.list",ne).subscribe(q=>{le.userAppStores.set(q)})})()}getAppStoresByKeyword(ne){return ne?this.myAppStores().filter(le=>le.title.includes(ne)):this.myAppStores()}getAppStore(ne){return this.myAppStores().filter(q=>q.url===ne)[0]}pubUserAppStoreFavorite(ne){var le=this;return(0,m.Z)(function*(){yield le.#t.publish("UserAppStore.update.isFavorite",ne)})()}initAppStore(){var ne=this;return(0,m.Z)(function*(){const le=yield ne.#n.getValue(history.state.token);console.log("get token",le),yield ne.getAppStoreList(le.userCode.code),yield ne.getUserStoreList(le.userCode.code)})()}onFavoriteClick(ne){this.myAppStores.update(le=>(console.log("userAppStores",this.userAppStores()),le.map(q=>{if(q.appId===ne){q.isFavorite=!q.isFavorite;const fe=this.userAppStores().find(Ie=>Ie.appId===ne);console.log("appId",ne),console.log("userAppStoreID",fe?.appId),fe&&(fe.isFavorite=q.isFavorite,this.pubUserAppStoreFavorite(fe))}return q})))}onNavAppClick(ne){this.#e.navigate([ne])}setAppClose(ne){if(this.myAppStores.update(le=>le.map(q=>(q.appId===ne&&(q.isOpen=!1),q))),console.log(this.appOpenedIndex),this.appOpenedIndex.length>1){const le=this.appOpenedIndex.findIndex(q=>q.appId===ne);this.appOpenedIndex.splice(le,1),console.log(le),console.log(this.appOpenedIndex[this.appOpenedIndex.length-1]),this.#e.navigate([this.appOpenedIndex[this.appOpenedIndex.length-1].url])}else this.appOpenedIndex.splice(1,1),this.#e.navigateByUrl("/home")}setAppOpen(ne){const le=this.myAppStores().filter(fe=>fe.appId===ne)[0];le&&(this.myAppStores.update(fe=>fe.map(Ie=>(Ie.appId===ne&&(Ie.isOpen=!0),Ie))),this.appOpenedIndex.find(fe=>((fe,Ie)=>fe.url===Ie.url)(fe,le))||this.appOpenedIndex.push(le))}static#i=this.\u0275fac=function(le){return new(le||U)};static#s=this.\u0275prov=s.\u0275\u0275defineInjectable({token:U,factory:U.\u0275fac,providedIn:"root"})}return U})();var Ze=Object.freeze({__proto__:null,default:[{icon:"material-symbols-outlined",label:"grid_view",value:"grid"},{icon:"material-symbols-outlined",label:"view_agenda",value:"list"}]});let pt=(()=>{class U{constructor(){this.isGridView=(0,s.signal)(!0),this.Options=[],this.value="grid",this.appStoreService=(0,s.inject)(ge),this.userAccountService=(0,s.inject)(ze.Ng),this.#e=(0,s.inject)(ce.SharedService),this.#t=(0,s.inject)(Ve.TranslateService)}#e;#t;ngOnInit(){var ne=this;return(0,m.Z)(function*(){ne.#t.setDefaultLang("zh-Hant"),ne.Options=Object.values(Ze)[0]})()}onBackClick(){window.history.back()}onSelectedChange(){this.isGridView.set("grid"===this.value)}static#n=this.\u0275fac=function(le){return new(le||U)};static#r=this.\u0275cmp=s.\u0275\u0275defineComponent({type:U,selectors:[["his-app-store"]],standalone:!0,features:[s.\u0275\u0275StandaloneFeature],decls:21,vars:9,consts:[[1,"content-container"],[1,"top-bar-container"],["styleClass","mr-2","size","xlarge","shape","circle",3,"image"],[1,"title"],[1,"toolbar-container"],[1,"icon-container","title-box"],["pButton","","pRipple","","type","button","icon","pi pi-angle-left",1,"p-button-rounded","p-button-secondary","p-button-outlined",3,"click"],[1,"icon-container"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["type","text","pInputText","","placeholder","\u67e5\u8a62"],["optionLabel","name","optionValue","value",3,"options","ngModel","ngModelChange","onOptionClick"],["pTemplate",""],[4,"ngIf","ngIfElse"],["listView",""],[1,"appstore-container"],[1,"first-class"],[1,"flex","flex-wrap","card-content"],[4,"ngFor","ngForOf"],[1,"grid-style",3,"myAppStore","setChange","clickCard"],[1,"appstore-container","listView"],[1,"flex","flex-wrap","list-content"],[1,"list-style",3,"myAppStore","isListView","setChange","clickCard"]],template:function(le,q){if(1&le&&(s.\u0275\u0275elementStart(0,"div",0)(1,"div",1),s.\u0275\u0275element(2,"p-avatar",2),s.\u0275\u0275elementStart(3,"div",3),s.\u0275\u0275text(4),s.\u0275\u0275pipe(5,"translate"),s.\u0275\u0275elementEnd()(),s.\u0275\u0275elementStart(6,"div",4)(7,"div",5)(8,"button",6),s.\u0275\u0275listener("click",function(){return q.onBackClick()}),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(9,"div")(10,"h3"),s.\u0275\u0275text(11,"\u7a0b\u5f0f\u96c6"),s.\u0275\u0275elementEnd()()(),s.\u0275\u0275elementStart(12,"div",7)(13,"span",8),s.\u0275\u0275element(14,"i",9)(15,"input",10),s.\u0275\u0275elementEnd(),s.\u0275\u0275elementStart(16,"p-selectButton",11),s.\u0275\u0275listener("ngModelChange",function(Ie){return q.value=Ie})("onOptionClick",function(){return q.onSelectedChange()}),s.\u0275\u0275template(17,Je,2,3,"ng-template",12),s.\u0275\u0275elementEnd()()(),s.\u0275\u0275template(18,lt,5,1,"ng-container",13),s.\u0275\u0275template(19,ve,4,1,"ng-template",null,14,s.\u0275\u0275templateRefExtractor),s.\u0275\u0275elementEnd()),2&le){const fe=s.\u0275\u0275reference(20);s.\u0275\u0275advance(2),s.\u0275\u0275propertyInterpolate("image",q.userAccountService.userImage().image),s.\u0275\u0275advance(2),s.\u0275\u0275textInterpolate2(" ",q.userAccountService.userAccount().userCode.display,",",s.\u0275\u0275pipeBind1(5,7,"\u6b61\u8fce\u56de\u4f86")," "),s.\u0275\u0275advance(12),s.\u0275\u0275property("options",q.Options)("ngModel",q.value),s.\u0275\u0275advance(2),s.\u0275\u0275property("ngIf",q.isGridView())("ngIfElse",fe)}},dependencies:[we.CommonModule,we.NgForOf,we.NgIf,Me.ButtonModule,Me.ButtonDirective,Ye.PrimeTemplate,Re.DividerModule,Re.Divider,W.SelectButtonModule,W.SelectButton,me.FormsModule,me.NgControlStatus,me.NgModel,pe.InputTextModule,pe.InputText,Oe.AvatarModule,Oe.Avatar,it.D,Ve.TranslateModule,Ve.TranslatePipe],styles:["[_nghost-%COMP%]     .grid-style{margin:6px;width:calc(20% - 12px);max-width:320px}[_nghost-%COMP%]     .grid-style.second-class .p-image.p-component{background:linear-gradient(0deg,rgba(0,0,0,.2) 0%,rgba(0,0,0,0) 100%),var(--tertiary-main)}[_nghost-%COMP%]     .grid-style.third-class .p-image.p-component{background:linear-gradient(0deg,rgba(0,0,0,.2) 0%,rgba(0,0,0,0) 100%),var(--indigo-500)}[_nghost-%COMP%]     .grid-style.fourth-class .p-image.p-component{background:linear-gradient(0deg,rgba(0,0,0,.2) 0%,rgba(0,0,0,0) 100%),var(--orange-500)}[_nghost-%COMP%]     .list-style .p-image.p-component{width:56px;height:56px}[_nghost-%COMP%]     .p-selectbutton .p-button{border-radius:0}[_nghost-%COMP%]     .p-selectbutton .p-button:first-child{border-radius:6px 0 0 6px}[_nghost-%COMP%]     .p-selectbutton .p-button:last-child{border-radius:0 6px 6px 0}.content-container[_ngcontent-%COMP%]{padding:32px;height:100%;display:flex;flex-direction:column;background-color:var(--surface-ground);overflow:auto}.appstore-container[_ngcontent-%COMP%]{padding:var(--spacing-xs) var(--spacing-lg)}.appstore-container.listView[_ngcontent-%COMP%]{width:100%;margin:0 auto}.appstore-container[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]{width:95%;margin:0 auto;transform:translate(-6px);padding-bottom:var(--spacing-md)}.appstore-container[_ngcontent-%COMP%]   .list-content[_ngcontent-%COMP%]{gap:12px}.top-bar-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center}.icon-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:8px}.icon-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.5rem;font-style:normal;font-weight:700;line-height:2rem;letter-spacing:.03rem;color:var(--surface-on-surface)}.list-style[_ngcontent-%COMP%]{cursor:pointer;width:100%}[_nghost-%COMP%]     .p-buttonset .p-button-icon-only{justify-content:center;width:2rem;height:2rem}[_nghost-%COMP%]     .p-buttonset .p-button-icon-only .p-button-icon{font-size:1rem;padding-left:3px}[_nghost-%COMP%]     .p-divider.p-divider-horizontal{margin:12px 0}[_nghost-%COMP%]     .first-class .p-divider-solid.p-divider-horizontal:before{border-color:var(--primary-main);border-width:4px}[_nghost-%COMP%]     .second-class .p-divider-solid.p-divider-horizontal:before{border-color:var(--tertiary-main);border-width:4px}[_nghost-%COMP%]     .third-class .p-divider-solid.p-divider-horizontal:before{border-color:var(--indigo-500);border-width:4px}[_nghost-%COMP%]     .fourth-class .p-divider-solid.p-divider-horizontal:before{border-color:var(--orange-500);border-width:4px}.title[_ngcontent-%COMP%]{padding-left:24px;font-size:28px;font-weight:700;line-height:40px;letter-spacing:1.12px;color:var(--primary-main)}.toolbar-container[_ngcontent-%COMP%]{padding:var(--spacing-xs) var(--spacing-lg);display:flex;justify-content:space-between;width:100%;margin:var(--spacing-lg) 0 var(--spacing-sm)}"]})}return U})()},6488:(Bt,We,Y)=>{Y.d(We,{Ng:()=>ce,iw:()=>we});var m=Y(5863),s=Y(9159),xe=Y(6390);let ce=(()=>{class me{constructor(){this.#e=(0,m.inject)(s.JetstreamWsService),this.userAccount=(0,m.signal)({}),this.userImage=(0,m.signal)({})}#e;getUserImage(Me){this.#e.request("UserImage.GetUserImage",Me).subscribe(pe=>{this.userImage.set(pe),console.log("get image",pe)})}static#t=this.\u0275fac=function(pe){return new(pe||me)};static#n=this.\u0275prov=m.\u0275\u0275defineInjectable({token:me,factory:me.\u0275fac,providedIn:"root"})}return me})(),we=(()=>{class me{#e;constructor(){this.#e=(0,m.inject)(s.JetstreamWsService),this.userProfile=(0,m.signal)({}),this.userProfile.set({_id:"jidweqjiefwi",userCode:{code:"Neo",display:"alphaTeam-001"},appId:"web-client",profile:{isDockVisible:!0},updatedBy:new xe.Coding,updatedAt:new Date})}static#t=this.\u0275fac=function(pe){return new(pe||me)};static#n=this.\u0275prov=m.\u0275\u0275defineInjectable({token:me,factory:me.\u0275fac,providedIn:"root"})}return me})()},6984:(Bt,We,Y)=>{Y.d(We,{D:()=>lt});var m=Y(5863),s=Y(575),xe=Y(1189),Se=Y(7069),ce=Y(6701);function we(ue,ve){if(1&ue&&(m.\u0275\u0275elementContainerStart(0),m.\u0275\u0275elementContainer(1,5),m.\u0275\u0275elementContainerEnd()),2&ue){const ae=m.\u0275\u0275nextContext(2);m.\u0275\u0275advance(1),m.\u0275\u0275property("ngTemplateOutlet",ae.footerTemplate)}}function me(ue,ve){if(1&ue){const ae=m.\u0275\u0275getCurrentView();m.\u0275\u0275elementContainerStart(0),m.\u0275\u0275elementStart(1,"div",4),m.\u0275\u0275listener("click",function(){m.\u0275\u0275restoreView(ae);const ge=m.\u0275\u0275nextContext();return m.\u0275\u0275resetView(ge.directToApp(ge.myAppStore.url))}),m.\u0275\u0275elementContainer(2,5)(3,5),m.\u0275\u0275template(4,we,2,1,"ng-container",0),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementContainerEnd()}if(2&ue){const ae=m.\u0275\u0275nextContext(),Ne=m.\u0275\u0275reference(3),ge=m.\u0275\u0275reference(5);m.\u0275\u0275advance(2),m.\u0275\u0275property("ngTemplateOutlet",Ne),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngTemplateOutlet",ge),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",ae.footerTemplate)}}function W(ue,ve){if(1&ue){const ae=m.\u0275\u0275getCurrentView();m.\u0275\u0275elementContainerStart(0),m.\u0275\u0275elementStart(1,"div",6),m.\u0275\u0275listener("click",function(){m.\u0275\u0275restoreView(ae);const ge=m.\u0275\u0275nextContext();return m.\u0275\u0275resetView(ge.directToApp(ge.myAppStore.url))}),m.\u0275\u0275elementContainer(2,5),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementContainerEnd()}if(2&ue){m.\u0275\u0275nextContext();const ae=m.\u0275\u0275reference(7);m.\u0275\u0275advance(2),m.\u0275\u0275property("ngTemplateOutlet",ae)}}function Me(ue,ve){if(1&ue&&(m.\u0275\u0275elementStart(0,"div",7)(1,"div",8)(2,"span",9),m.\u0275\u0275text(3),m.\u0275\u0275elementEnd()()()),2&ue){const ae=m.\u0275\u0275nextContext();m.\u0275\u0275advance(3),m.\u0275\u0275textInterpolate1(" ",ae.myAppStore.icon," ")}}function pe(ue,ve){1&ue&&(m.\u0275\u0275elementContainerStart(0),m.\u0275\u0275element(1,"span",15),m.\u0275\u0275elementContainerEnd())}function Re(ue,ve){1&ue&&(m.\u0275\u0275elementContainerStart(0),m.\u0275\u0275element(1,"span",16),m.\u0275\u0275elementContainerEnd())}function Oe(ue,ve){if(1&ue){const ae=m.\u0275\u0275getCurrentView();m.\u0275\u0275elementStart(0,"div",10)(1,"div",11)(2,"span",12),m.\u0275\u0275text(3),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(4,"button",13),m.\u0275\u0275listener("click",function(ge){m.\u0275\u0275restoreView(ae);const Ke=m.\u0275\u0275nextContext();return Ke.changeFavorite(Ke.myAppStore.appId),m.\u0275\u0275resetView(ge.stopPropagation())}),m.\u0275\u0275template(5,pe,2,0,"ng-container",0),m.\u0275\u0275template(6,Re,2,0,"ng-container",0),m.\u0275\u0275elementEnd()(),m.\u0275\u0275elementStart(7,"h5",14),m.\u0275\u0275text(8),m.\u0275\u0275elementEnd()()}if(2&ue){const ae=m.\u0275\u0275nextContext();m.\u0275\u0275advance(3),m.\u0275\u0275textInterpolate(ae.myAppStore.versionNo),m.\u0275\u0275advance(2),m.\u0275\u0275property("ngIf",1==ae.myAppStore.isFavorite),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",!0!==ae.myAppStore.isFavorite),m.\u0275\u0275advance(2),m.\u0275\u0275textInterpolate(ae.myAppStore.title)}}function it(ue,ve){1&ue&&(m.\u0275\u0275elementContainerStart(0),m.\u0275\u0275element(1,"span",15),m.\u0275\u0275elementContainerEnd())}function Ve(ue,ve){1&ue&&(m.\u0275\u0275elementContainerStart(0),m.\u0275\u0275element(1,"span",16),m.\u0275\u0275elementContainerEnd())}function ze(ue,ve){1&ue&&(m.\u0275\u0275elementStart(0,"span"),m.\u0275\u0275text(1,"\u3001"),m.\u0275\u0275elementEnd())}function Ye(ue,ve){if(1&ue&&(m.\u0275\u0275elementContainerStart(0),m.\u0275\u0275text(1),m.\u0275\u0275template(2,ze,2,0,"span",0),m.\u0275\u0275elementContainerEnd()),2&ue){const ae=ve.$implicit,Ne=ve.last;m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate1(" ",ae.title,""),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",!Ne)}}function Je(ue,ve){if(1&ue){const ae=m.\u0275\u0275getCurrentView();m.\u0275\u0275elementStart(0,"div",17)(1,"button",13),m.\u0275\u0275listener("click",function(ge){m.\u0275\u0275restoreView(ae);const Ke=m.\u0275\u0275nextContext();return Ke.changeFavorite(Ke.myAppStore.appId),m.\u0275\u0275resetView(ge.stopPropagation())}),m.\u0275\u0275template(2,it,2,0,"ng-container",0),m.\u0275\u0275template(3,Ve,2,0,"ng-container",0),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(4,"div",8)(5,"span",9),m.\u0275\u0275text(6),m.\u0275\u0275elementEnd()(),m.\u0275\u0275elementStart(7,"div",14),m.\u0275\u0275text(8),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(9,"div",18),m.\u0275\u0275template(10,Ye,3,2,"ng-container",19),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(11,"div",20),m.\u0275\u0275text(12),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(13,"div",20),m.\u0275\u0275text(14),m.\u0275\u0275elementEnd()()}if(2&ue){const ae=m.\u0275\u0275nextContext();m.\u0275\u0275advance(2),m.\u0275\u0275property("ngIf",1==ae.myAppStore.isFavorite),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",!0!==ae.myAppStore.isFavorite),m.\u0275\u0275advance(3),m.\u0275\u0275textInterpolate1(" ",ae.myAppStore.icon," "),m.\u0275\u0275advance(2),m.\u0275\u0275textInterpolate(ae.myAppStore.title),m.\u0275\u0275advance(2),m.\u0275\u0275property("ngForOf",ae.myAppStore.appPages),m.\u0275\u0275advance(2),m.\u0275\u0275textInterpolate1("\u7dad\u8b77\u4eba\u54e1\uff1a",ae.myAppStore.home.maintainer.display,""),m.\u0275\u0275advance(2),m.\u0275\u0275textInterpolate(ae.myAppStore.versionNo)}}let lt=(()=>{class ue{constructor(){this.setChange=new m.EventEmitter,this.clickCard=new m.EventEmitter}directToApp(ae){console.log("in component directToApp",ae),this.clickCard.emit(ae)}changeFavorite(ae){this.setChange.emit(ae)}static#e=this.\u0275fac=function(Ne){return new(Ne||ue)};static#t=this.\u0275cmp=m.\u0275\u0275defineComponent({type:ue,selectors:[["his-card-list"]],inputs:{myAppStore:"myAppStore",isListView:"isListView",headerTemplate:"headerTemplate",bodyTemplate:"bodyTemplate",footerTemplate:"footerTemplate"},outputs:{setChange:"setChange",clickCard:"clickCard"},standalone:!0,features:[m.\u0275\u0275StandaloneFeature],decls:8,vars:2,consts:[[4,"ngIf"],["gridViewHeader",""],["gridViewBody",""],["listViewHeader",""],[1,"p-card","p-commponent","app-grid-card",3,"click"],[3,"ngTemplateOutlet"],[1,"p-card","p-commponent","app-list-card",3,"click"],[1,"grid-header-container"],[1,"p-image","p-component"],[1,"material-symbols-outlined","icon-style"],[1,"grid-body-container"],[1,"btnBox"],[1,"subtitle","caption-s"],[3,"click"],[1,"title","label-l"],[1,"pi","pi-star-fill","selected"],[1,"pi","pi-star"],[1,"list-header-container"],[1,"content","caption-l"],[4,"ngFor","ngForOf"],[1,"subtitle","caption-m"]],template:function(Ne,ge){1&Ne&&(m.\u0275\u0275template(0,me,5,3,"ng-container",0),m.\u0275\u0275template(1,W,3,1,"ng-container",0),m.\u0275\u0275template(2,Me,4,1,"ng-template",null,1,m.\u0275\u0275templateRefExtractor),m.\u0275\u0275template(4,Oe,9,4,"ng-template",null,2,m.\u0275\u0275templateRefExtractor),m.\u0275\u0275template(6,Je,15,7,"ng-template",null,3,m.\u0275\u0275templateRefExtractor)),2&Ne&&(m.\u0275\u0275property("ngIf",!ge.isListView),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",ge.isListView))},dependencies:[s.CommonModule,s.NgForOf,s.NgIf,s.NgTemplateOutlet,Se.ImageModule,xe.ButtonModule,ce.RouterModule],styles:[".app-grid-card[_ngcontent-%COMP%]{display:flex;padding:var(--spacing-md) var(--spacing-sm);gap:8px;border-radius:12px;height:100px;cursor:pointer}.app-list-card[_ngcontent-%COMP%]{display:flex;padding:4px 12px;flex-direction:row;gap:8px;border-radius:12px}.grid-header-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:flex-start}.list-header-container[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;flex-direction:row;align-items:center;padding:var(--spacing-xs) var(--spacing-xxl);gap:var(--spacing-sm)}.list-header-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{color:var(--surface-on-surface)}.list-header-container[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{padding-left:5px;flex:1}.list-header-container[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{transition:all .3s}.list-header-container[_ngcontent-%COMP%]   .pi.selected[_ngcontent-%COMP%]{color:var(--yellow-500)}.grid-body-container[_ngcontent-%COMP%]{display:flex;flex:1;flex-direction:column}.grid-body-container[_ngcontent-%COMP%]   .btnBox[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:flex-end;align-items:center;gap:var(--spacing-sm)}.grid-body-container[_ngcontent-%COMP%]   .btnBox[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{transition:all .3s}.grid-body-container[_ngcontent-%COMP%]   .btnBox[_ngcontent-%COMP%]   .pi.selected[_ngcontent-%COMP%]{color:var(--yellow-500)}button[_ngcontent-%COMP%]{cursor:pointer;background-color:transparent;border:none}.icon-style[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;justify-content:center;align-items:center;color:var(--surface-a);font-size:48px}[_nghost-%COMP%]     .p-button{padding:0;color:var(--surface-on-surface)}[_nghost-%COMP%]     .body-container .p-button.p-button-icon-only{height:2rem}[_nghost-%COMP%]     .body-container .p-button.p-button-icon-only .pi{font-size:.7rem}[_nghost-%COMP%]     .p-image.p-component{display:block;width:72px;height:72px;background-color:var(--primary-main);border-radius:18px;overflow:hidden;padding:8px;position:relative;background:linear-gradient(0deg,rgba(0,0,0,.2) 0%,rgba(0,0,0,0) 100%),var(--primary-main);box-shadow:0 2px 1px -1px #00000005,0 1px 1px #00000024,0 1px 3px #0000001f}[_nghost-%COMP%]     .p-image.p-component img{display:block;width:100%;height:100%}[_nghost-%COMP%]     .app-grid-card .p-button{height:2rem}[_nghost-%COMP%]     .app-grid-card.p-card{transition:all .3s}[_nghost-%COMP%]     .app-grid-card.p-card:hover{transform:translateY(-3px);border-bottom:3px solid var(--primary-main)}[_nghost-%COMP%]     .app-list-card.p-card{transition:all .3s}"]})}return ue})()},2285:(Bt,We,Y)=>{Y.d(We,{Z:()=>ln});const m="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s="ARRAYBUFFER not supported by this environment",xe="UINT8ARRAY not supported by this environment";function Se(w,u,y,b){let C,F,V;const ee=u||[0],z=(y=y||0)>>>3,x=-1===b?3:0;for(C=0;C<w.length;C+=1)V=C+z,F=V>>>2,ee.length<=F&&ee.push(0),ee[F]|=w[C]<<8*(x+b*(V%4));return{value:ee,binLen:8*w.length+y}}function ce(w,u,y){switch(u){case"UTF8":case"UTF16BE":case"UTF16LE":break;default:throw new Error("encoding must be UTF8, UTF16BE, or UTF16LE")}switch(w){case"HEX":return function(b,C,F){return function(V,ee,z,x){let G,f,k,O;if(V.length%2!=0)throw new Error("String of HEX type must be in byte increments");const D=ee||[0],te=(z=z||0)>>>3,he=-1===x?3:0;for(G=0;G<V.length;G+=2){if(f=parseInt(V.substr(G,2),16),isNaN(f))throw new Error("String of HEX type contains invalid characters");for(O=(G>>>1)+te,k=O>>>2;D.length<=k;)D.push(0);D[k]|=f<<8*(he+x*(O%4))}return{value:D,binLen:4*V.length+z}}(b,C,F,y)};case"TEXT":return function(b,C,F){return function(V,ee,z,x,G){let f,k,O,D,te,he,Xe,je,at=0;const Ue=z||[0],gt=(x=x||0)>>>3;if("UTF8"===ee)for(Xe=-1===G?3:0,O=0;O<V.length;O+=1)for(f=V.charCodeAt(O),k=[],128>f?k.push(f):2048>f?(k.push(192|f>>>6),k.push(128|63&f)):55296>f||57344<=f?k.push(224|f>>>12,128|f>>>6&63,128|63&f):(O+=1,f=65536+((1023&f)<<10|1023&V.charCodeAt(O)),k.push(240|f>>>18,128|f>>>12&63,128|f>>>6&63,128|63&f)),D=0;D<k.length;D+=1){for(he=at+gt,te=he>>>2;Ue.length<=te;)Ue.push(0);Ue[te]|=k[D]<<8*(Xe+G*(he%4)),at+=1}else for(Xe=-1===G?2:0,je="UTF16LE"===ee&&1!==G||"UTF16LE"!==ee&&1===G,O=0;O<V.length;O+=1){for(f=V.charCodeAt(O),!0===je&&(D=255&f,f=D<<8|f>>>8),he=at+gt,te=he>>>2;Ue.length<=te;)Ue.push(0);Ue[te]|=f<<8*(Xe+G*(he%4)),at+=2}return{value:Ue,binLen:8*at+x}}(b,u,C,F,y)};case"B64":return function(b,C,F){return function(V,ee,z,x){let G,f,k,O,D,te,he,Xe=0;const je=ee||[0],at=(z=z||0)>>>3,Ue=-1===x?3:0,gt=V.indexOf("=");if(-1===V.search(/^[a-zA-Z0-9=+/]+$/))throw new Error("Invalid character in base-64 string");if(V=V.replace(/=/g,""),-1!==gt&&gt<V.length)throw new Error("Invalid '=' found in base-64 string");for(f=0;f<V.length;f+=4){for(D=V.substr(f,4),O=0,k=0;k<D.length;k+=1)G=m.indexOf(D.charAt(k)),O|=G<<18-6*k;for(k=0;k<D.length-1;k+=1){for(he=Xe+at,te=he>>>2;je.length<=te;)je.push(0);je[te]|=(O>>>16-8*k&255)<<8*(Ue+x*(he%4)),Xe+=1}}return{value:je,binLen:8*Xe+z}}(b,C,F,y)};case"BYTES":return function(b,C,F){return function(V,ee,z,x){let G,f,k,O;const D=ee||[0],te=(z=z||0)>>>3,he=-1===x?3:0;for(f=0;f<V.length;f+=1)G=V.charCodeAt(f),O=f+te,k=O>>>2,D.length<=k&&D.push(0),D[k]|=G<<8*(he+x*(O%4));return{value:D,binLen:8*V.length+z}}(b,C,F,y)};case"ARRAYBUFFER":try{new ArrayBuffer(0)}catch{throw new Error(s)}return function(b,C,F){return ee=C,z=F,x=y,Se(new Uint8Array(b),ee,z,x);var ee,z,x};case"UINT8ARRAY":try{new Uint8Array(0)}catch{throw new Error(xe)}return function(b,C,F){return Se(b,C,F,y)};default:throw new Error("format must be HEX, TEXT, B64, BYTES, ARRAYBUFFER, or UINT8ARRAY")}}function we(w,u,y,b){switch(w){case"HEX":return function(C){return function(F,V,ee,z){const x="0123456789abcdef";let G,f,k="";const O=V/8,D=-1===ee?3:0;for(G=0;G<O;G+=1)f=F[G>>>2]>>>8*(D+ee*(G%4)),k+=x.charAt(f>>>4&15)+x.charAt(15&f);return z.outputUpper?k.toUpperCase():k}(C,u,y,b)};case"B64":return function(C){return function(F,V,ee,z){let x,G,f,k,O,D="";const te=V/8,he=-1===ee?3:0;for(x=0;x<te;x+=3)for(k=x+1<te?F[x+1>>>2]:0,O=x+2<te?F[x+2>>>2]:0,f=(F[x>>>2]>>>8*(he+ee*(x%4))&255)<<16|(k>>>8*(he+ee*((x+1)%4))&255)<<8|O>>>8*(he+ee*((x+2)%4))&255,G=0;G<4;G+=1)D+=8*x+6*G<=V?m.charAt(f>>>6*(3-G)&63):z.b64Pad;return D}(C,u,y,b)};case"BYTES":return function(C){return function(F,V,ee){let z,x,G="";const f=V/8,k=-1===ee?3:0;for(z=0;z<f;z+=1)x=F[z>>>2]>>>8*(k+ee*(z%4))&255,G+=String.fromCharCode(x);return G}(C,u,y)};case"ARRAYBUFFER":try{new ArrayBuffer(0)}catch{throw new Error(s)}return function(C){return function(F,V,ee){let z;const x=V/8,G=new ArrayBuffer(x),f=new Uint8Array(G),k=-1===ee?3:0;for(z=0;z<x;z+=1)f[z]=F[z>>>2]>>>8*(k+ee*(z%4))&255;return G}(C,u,y)};case"UINT8ARRAY":try{new Uint8Array(0)}catch{throw new Error(xe)}return function(C){return function(F,V,ee){let z;const x=V/8,G=-1===ee?3:0,f=new Uint8Array(x);for(z=0;z<x;z+=1)f[z]=F[z>>>2]>>>8*(G+ee*(z%4))&255;return f}(C,u,y)};default:throw new Error("format must be HEX, B64, BYTES, ARRAYBUFFER, or UINT8ARRAY")}}const me=4294967296,W=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],Me=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428],pe=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],Re="Chosen SHA variant is not supported",Oe="Cannot set numRounds with MAC";function it(w,u){let y,b;const C=w.binLen>>>3,F=u.binLen>>>3,V=C<<3,ee=4-C<<3;if(C%4!=0){for(y=0;y<F;y+=4)b=C+y>>>2,w.value[b]|=u.value[y>>>2]<<V,w.value.push(0),w.value[b+1]|=u.value[y>>>2]>>>ee;return(w.value.length<<2)-4>=F+C&&w.value.pop(),{value:w.value,binLen:w.binLen+u.binLen}}return{value:w.value.concat(u.value),binLen:w.binLen+u.binLen}}function Ve(w){const u={outputUpper:!1,b64Pad:"=",outputLen:-1},y=w||{},b="Output length must be a multiple of 8";if(u.outputUpper=y.outputUpper||!1,y.b64Pad&&(u.b64Pad=y.b64Pad),y.outputLen){if(y.outputLen%8!=0)throw new Error(b);u.outputLen=y.outputLen}else if(y.shakeLen){if(y.shakeLen%8!=0)throw new Error(b);u.outputLen=y.shakeLen}if("boolean"!=typeof u.outputUpper)throw new Error("Invalid outputUpper formatting option");if("string"!=typeof u.b64Pad)throw new Error("Invalid b64Pad formatting option");return u}function ze(w,u,y,b){const C=w+" must include a value and format";if(!u){if(!b)throw new Error(C);return b}if(void 0===u.value||!u.format)throw new Error(C);return ce(u.format,u.encoding||"UTF8",y)(u.value)}class Ye{constructor(u,y,b){const C=b||{};if(this.t=y,this.i=C.encoding||"UTF8",this.numRounds=C.numRounds||1,isNaN(this.numRounds)||this.numRounds!==parseInt(this.numRounds,10)||1>this.numRounds)throw new Error("numRounds must a integer >= 1");this.o=u,this.h=[],this.u=0,this.l=!1,this.A=0,this.H=!1,this.S=[],this.p=[]}update(u){let y,b=0;const C=this.m>>>5,F=this.C(u,this.h,this.u),V=F.binLen,ee=F.value,z=V>>>5;for(y=0;y<z;y+=C)b+this.m<=V&&(this.U=this.v(ee.slice(y,y+C),this.U),b+=this.m);return this.A+=b,this.h=ee.slice(b>>>5),this.u=V%this.m,this.l=!0,this}getHash(u,y){let b,C,F=this.R;const V=Ve(y);if(this.K){if(-1===V.outputLen)throw new Error("Output length must be specified in options");F=V.outputLen}const ee=we(u,F,this.T,V);if(this.H&&this.g)return ee(this.g(V));for(C=this.F(this.h.slice(),this.u,this.A,this.L(this.U),F),b=1;b<this.numRounds;b+=1)this.K&&F%32!=0&&(C[C.length-1]&=16777215>>>24-F%32),C=this.F(C,F,0,this.B(this.o),F);return ee(C)}setHMACKey(u,y,b){if(!this.M)throw new Error("Variant does not support HMAC");if(this.l)throw new Error("Cannot set MAC key after calling update");const C=ce(y,(b||{}).encoding||"UTF8",this.T);this.k(C(u))}k(u){const y=this.m>>>3,b=y/4-1;let C;if(1!==this.numRounds)throw new Error(Oe);if(this.H)throw new Error("MAC key already set");for(y<u.binLen/8&&(u.value=this.F(u.value,u.binLen,0,this.B(this.o),this.R));u.value.length<=b;)u.value.push(0);for(C=0;C<=b;C+=1)this.S[C]=909522486^u.value[C],this.p[C]=1549556828^u.value[C];this.U=this.v(this.S,this.U),this.A=this.m,this.H=!0}getHMAC(u,y){const b=Ve(y);return we(u,this.R,this.T,b)(this.Y())}Y(){let u;if(!this.H)throw new Error("Cannot call getHMAC without first setting MAC key");const y=this.F(this.h.slice(),this.u,this.A,this.L(this.U),this.R);return u=this.v(this.p,this.B(this.o)),u=this.F(y,this.R,this.m,u,this.R),u}}function Je(w,u){return w<<u|w>>>32-u}function qe(w,u){return w>>>u|w<<32-u}function lt(w,u){return w>>>u}function ue(w,u,y){return w^u^y}function ve(w,u,y){return w&u^~w&y}function ae(w,u,y){return w&u^w&y^u&y}function Ne(w){return qe(w,2)^qe(w,13)^qe(w,22)}function ge(w,u){const y=(65535&w)+(65535&u);return(65535&(w>>>16)+(u>>>16)+(y>>>16))<<16|65535&y}function Ke(w,u,y,b){const C=(65535&w)+(65535&u)+(65535&y)+(65535&b);return(65535&(w>>>16)+(u>>>16)+(y>>>16)+(b>>>16)+(C>>>16))<<16|65535&C}function Ze(w,u,y,b,C){const F=(65535&w)+(65535&u)+(65535&y)+(65535&b)+(65535&C);return(65535&(w>>>16)+(u>>>16)+(y>>>16)+(b>>>16)+(C>>>16)+(F>>>16))<<16|65535&F}function pt(w){return qe(w,7)^qe(w,18)^lt(w,3)}function U(w){return qe(w,6)^qe(w,11)^qe(w,25)}function rt(w){return[1732584193,4023233417,2562383102,271733878,3285377520]}function ne(w,u){let y,b,C,F,V,ee,z;const x=[];for(y=u[0],b=u[1],C=u[2],F=u[3],V=u[4],z=0;z<80;z+=1)x[z]=z<16?w[z]:Je(x[z-3]^x[z-8]^x[z-14]^x[z-16],1),ee=z<20?Ze(Je(y,5),ve(b,C,F),V,1518500249,x[z]):z<40?Ze(Je(y,5),ue(b,C,F),V,1859775393,x[z]):z<60?Ze(Je(y,5),ae(b,C,F),V,2400959708,x[z]):Ze(Je(y,5),ue(b,C,F),V,3395469782,x[z]),V=F,F=C,C=Je(b,30),b=y,y=ee;return u[0]=ge(y,u[0]),u[1]=ge(b,u[1]),u[2]=ge(C,u[2]),u[3]=ge(F,u[3]),u[4]=ge(V,u[4]),u}function le(w,u,y,b){let C;const F=15+(u+65>>>9<<4),V=u+y;for(;w.length<=F;)w.push(0);for(w[u>>>5]|=128<<24-u%32,w[F]=4294967295&V,w[F-1]=V/me|0,C=0;C<w.length;C+=16)b=ne(w.slice(C,C+16),b);return b}let q=class extends Ye{constructor(w,u,y){if("SHA-1"!==w)throw new Error(Re);super(w,u,y);const b=y||{};this.M=!0,this.g=this.Y,this.T=-1,this.C=ce(this.t,this.i,this.T),this.v=ne,this.L=function(C){return C.slice()},this.B=rt,this.F=le,this.U=[1732584193,4023233417,2562383102,271733878,3285377520],this.m=512,this.R=160,this.K=!1,b.hmacKey&&this.k(ze("hmacKey",b.hmacKey,this.T))}};function fe(w){let u;return u="SHA-224"==w?Me.slice():pe.slice(),u}function Ie(w,u){let y,b,C,F,V,ee,z,x,G,f,k;const O=[];for(y=u[0],b=u[1],C=u[2],F=u[3],V=u[4],ee=u[5],z=u[6],x=u[7],k=0;k<64;k+=1)O[k]=k<16?w[k]:Ke(qe(D=O[k-2],17)^qe(D,19)^lt(D,10),O[k-7],pt(O[k-15]),O[k-16]),G=Ze(x,U(V),ve(V,ee,z),W[k],O[k]),f=ge(Ne(y),ae(y,b,C)),x=z,z=ee,ee=V,V=ge(F,G),F=C,C=b,b=y,y=ge(G,f);var D;return u[0]=ge(y,u[0]),u[1]=ge(b,u[1]),u[2]=ge(C,u[2]),u[3]=ge(F,u[3]),u[4]=ge(V,u[4]),u[5]=ge(ee,u[5]),u[6]=ge(z,u[6]),u[7]=ge(x,u[7]),u}let kt=class extends Ye{constructor(w,u,y){if("SHA-224"!==w&&"SHA-256"!==w)throw new Error(Re);super(w,u,y);const b=y||{};this.g=this.Y,this.M=!0,this.T=-1,this.C=ce(this.t,this.i,this.T),this.v=Ie,this.L=function(C){return C.slice()},this.B=fe,this.F=function(C,F,V,ee){return function(z,x,G,f,k){let O,D;const te=15+(x+65>>>9<<4),he=x+G;for(;z.length<=te;)z.push(0);for(z[x>>>5]|=128<<24-x%32,z[te]=4294967295&he,z[te-1]=he/me|0,O=0;O<z.length;O+=16)f=Ie(z.slice(O,O+16),f);return D="SHA-224"===k?[f[0],f[1],f[2],f[3],f[4],f[5],f[6]]:f,D}(C,F,V,ee,w)},this.U=fe(w),this.m=512,this.R="SHA-224"===w?224:256,this.K=!1,b.hmacKey&&this.k(ze("hmacKey",b.hmacKey,this.T))}};class d{constructor(u,y){this.N=u,this.I=y}}function I(w,u){let y;return u>32?(y=64-u,new d(w.I<<u|w.N>>>y,w.N<<u|w.I>>>y)):0!==u?(y=32-u,new d(w.N<<u|w.I>>>y,w.I<<u|w.N>>>y)):w}function j(w,u){let y;return u<32?(y=32-u,new d(w.N>>>u|w.I<<y,w.I>>>u|w.N<<y)):(y=64-u,new d(w.I>>>u|w.N<<y,w.N>>>u|w.I<<y))}function T(w,u){return new d(w.N>>>u,w.I>>>u|w.N<<32-u)}function J(w,u,y){return new d(w.N&u.N^w.N&y.N^u.N&y.N,w.I&u.I^w.I&y.I^u.I&y.I)}function K(w){const u=j(w,28),y=j(w,34),b=j(w,39);return new d(u.N^y.N^b.N,u.I^y.I^b.I)}function re(w,u){let y,b;y=(65535&w.I)+(65535&u.I),b=(w.I>>>16)+(u.I>>>16)+(y>>>16);const C=(65535&b)<<16|65535&y;return y=(65535&w.N)+(65535&u.N)+(b>>>16),b=(w.N>>>16)+(u.N>>>16)+(y>>>16),new d((65535&b)<<16|65535&y,C)}function _e(w,u,y,b){let C,F;C=(65535&w.I)+(65535&u.I)+(65535&y.I)+(65535&b.I),F=(w.I>>>16)+(u.I>>>16)+(y.I>>>16)+(b.I>>>16)+(C>>>16);const V=(65535&F)<<16|65535&C;return C=(65535&w.N)+(65535&u.N)+(65535&y.N)+(65535&b.N)+(F>>>16),F=(w.N>>>16)+(u.N>>>16)+(y.N>>>16)+(b.N>>>16)+(C>>>16),new d((65535&F)<<16|65535&C,V)}function Le(w,u,y,b,C){let F,V;F=(65535&w.I)+(65535&u.I)+(65535&y.I)+(65535&b.I)+(65535&C.I),V=(w.I>>>16)+(u.I>>>16)+(y.I>>>16)+(b.I>>>16)+(C.I>>>16)+(F>>>16);const ee=(65535&V)<<16|65535&F;return F=(65535&w.N)+(65535&u.N)+(65535&y.N)+(65535&b.N)+(65535&C.N)+(V>>>16),V=(w.N>>>16)+(u.N>>>16)+(y.N>>>16)+(b.N>>>16)+(C.N>>>16)+(F>>>16),new d((65535&V)<<16|65535&F,ee)}function se(w,u){return new d(w.N^u.N,w.I^u.I)}function oe(w){const u=j(w,19),y=j(w,61),b=T(w,6);return new d(u.N^y.N^b.N,u.I^y.I^b.I)}function Be(w){const u=j(w,1),y=j(w,8),b=T(w,7);return new d(u.N^y.N^b.N,u.I^y.I^b.I)}function Fe(w){const u=j(w,14),y=j(w,18),b=j(w,41);return new d(u.N^y.N^b.N,u.I^y.I^b.I)}const He=[new d(W[0],3609767458),new d(W[1],602891725),new d(W[2],3964484399),new d(W[3],2173295548),new d(W[4],4081628472),new d(W[5],3053834265),new d(W[6],2937671579),new d(W[7],3664609560),new d(W[8],2734883394),new d(W[9],1164996542),new d(W[10],1323610764),new d(W[11],3590304994),new d(W[12],4068182383),new d(W[13],991336113),new d(W[14],633803317),new d(W[15],3479774868),new d(W[16],2666613458),new d(W[17],944711139),new d(W[18],2341262773),new d(W[19],2007800933),new d(W[20],1495990901),new d(W[21],1856431235),new d(W[22],3175218132),new d(W[23],2198950837),new d(W[24],3999719339),new d(W[25],766784016),new d(W[26],2566594879),new d(W[27],3203337956),new d(W[28],1034457026),new d(W[29],2466948901),new d(W[30],3758326383),new d(W[31],168717936),new d(W[32],1188179964),new d(W[33],1546045734),new d(W[34],1522805485),new d(W[35],2643833823),new d(W[36],2343527390),new d(W[37],1014477480),new d(W[38],1206759142),new d(W[39],344077627),new d(W[40],1290863460),new d(W[41],3158454273),new d(W[42],3505952657),new d(W[43],106217008),new d(W[44],3606008344),new d(W[45],1432725776),new d(W[46],1467031594),new d(W[47],851169720),new d(W[48],3100823752),new d(W[49],1363258195),new d(W[50],3750685593),new d(W[51],3785050280),new d(W[52],3318307427),new d(W[53],3812723403),new d(W[54],2003034995),new d(W[55],3602036899),new d(W[56],1575990012),new d(W[57],1125592928),new d(W[58],2716904306),new d(W[59],442776044),new d(W[60],593698344),new d(W[61],3733110249),new d(W[62],2999351573),new d(W[63],3815920427),new d(3391569614,3928383900),new d(3515267271,566280711),new d(3940187606,3454069534),new d(4118630271,4000239992),new d(116418474,1914138554),new d(174292421,2731055270),new d(289380356,3203993006),new d(460393269,320620315),new d(685471733,587496836),new d(852142971,1086792851),new d(1017036298,365543100),new d(1126000580,2618297676),new d(1288033470,3409855158),new d(1501505948,4234509866),new d(1607167915,987167468),new d(1816402316,1246189591)];function Ae(w){return"SHA-384"===w?[new d(3418070365,Me[0]),new d(1654270250,Me[1]),new d(2438529370,Me[2]),new d(355462360,Me[3]),new d(1731405415,Me[4]),new d(41048885895,Me[5]),new d(3675008525,Me[6]),new d(1203062813,Me[7])]:[new d(pe[0],4089235720),new d(pe[1],2227873595),new d(pe[2],4271175723),new d(pe[3],1595750129),new d(pe[4],2917565137),new d(pe[5],725511199),new d(pe[6],4215389547),new d(pe[7],327033209)]}function st(w,u){let y,b,C,F,V,ee,z,x,G,f,k,O;const D=[];for(y=u[0],b=u[1],C=u[2],F=u[3],V=u[4],ee=u[5],z=u[6],x=u[7],k=0;k<80;k+=1)k<16?(O=2*k,D[k]=new d(w[O],w[O+1])):D[k]=_e(oe(D[k-2]),D[k-7],Be(D[k-15]),D[k-16]),G=Le(x,Fe(V),new d((te=V).N&(he=ee).N^~te.N&(Xe=z).N,te.I&he.I^~te.I&Xe.I),He[k],D[k]),f=re(K(y),J(y,b,C)),x=z,z=ee,ee=V,V=re(F,G),F=C,C=b,b=y,y=re(G,f);var te,he,Xe;return u[0]=re(y,u[0]),u[1]=re(b,u[1]),u[2]=re(C,u[2]),u[3]=re(F,u[3]),u[4]=re(V,u[4]),u[5]=re(ee,u[5]),u[6]=re(z,u[6]),u[7]=re(x,u[7]),u}let ut=class extends Ye{constructor(w,u,y){if("SHA-384"!==w&&"SHA-512"!==w)throw new Error(Re);super(w,u,y);const b=y||{};this.g=this.Y,this.M=!0,this.T=-1,this.C=ce(this.t,this.i,this.T),this.v=st,this.L=function(C){return C.slice()},this.B=Ae,this.F=function(C,F,V,ee){return function(z,x,G,f,k){let O,D;const te=31+(x+129>>>10<<5),he=x+G;for(;z.length<=te;)z.push(0);for(z[x>>>5]|=128<<24-x%32,z[te]=4294967295&he,z[te-1]=he/me|0,O=0;O<z.length;O+=32)f=st(z.slice(O,O+32),f);return D="SHA-384"===k?[f[0].N,f[0].I,f[1].N,f[1].I,f[2].N,f[2].I,f[3].N,f[3].I,f[4].N,f[4].I,f[5].N,f[5].I]:[f[0].N,f[0].I,f[1].N,f[1].I,f[2].N,f[2].I,f[3].N,f[3].I,f[4].N,f[4].I,f[5].N,f[5].I,f[6].N,f[6].I,f[7].N,f[7].I],D}(C,F,V,ee,w)},this.U=Ae(w),this.m=1024,this.R="SHA-384"===w?384:512,this.K=!1,b.hmacKey&&this.k(ze("hmacKey",b.hmacKey,this.T))}};const mt=[new d(0,1),new d(0,32898),new d(2147483648,32906),new d(2147483648,2147516416),new d(0,32907),new d(0,2147483649),new d(2147483648,2147516545),new d(2147483648,32777),new d(0,138),new d(0,136),new d(0,2147516425),new d(0,2147483658),new d(0,2147516555),new d(2147483648,139),new d(2147483648,32905),new d(2147483648,32771),new d(2147483648,32770),new d(2147483648,128),new d(0,32778),new d(2147483648,2147483658),new d(2147483648,2147516545),new d(2147483648,32896),new d(0,2147483649),new d(2147483648,2147516424)],an=[[0,36,3,41,18],[1,44,10,45,2],[62,6,43,15,61],[28,55,25,21,56],[27,20,39,8,14]];function Nt(w){let u;const y=[];for(u=0;u<5;u+=1)y[u]=[new d(0,0),new d(0,0),new d(0,0),new d(0,0),new d(0,0)];return y}function ot(w){let u;const y=[];for(u=0;u<5;u+=1)y[u]=w[u].slice();return y}function vt(w,u){let y,b,C,F;const V=[],ee=[];if(null!==w)for(b=0;b<w.length;b+=2)u[(b>>>1)%5][(b>>>1)/5|0]=se(u[(b>>>1)%5][(b>>>1)/5|0],new d(w[b+1],w[b]));for(y=0;y<24;y+=1){for(F=Nt(),b=0;b<5;b+=1)V[b]=new d((z=u[b][0]).N^(x=u[b][1]).N^(G=u[b][2]).N^(f=u[b][3]).N^(k=u[b][4]).N,z.I^x.I^G.I^f.I^k.I);for(b=0;b<5;b+=1)ee[b]=se(V[(b+4)%5],I(V[(b+1)%5],1));for(b=0;b<5;b+=1)for(C=0;C<5;C+=1)u[b][C]=se(u[b][C],ee[b]);for(b=0;b<5;b+=1)for(C=0;C<5;C+=1)F[C][(2*b+3*C)%5]=I(u[b][C],an[b][C]);for(b=0;b<5;b+=1)for(C=0;C<5;C+=1)u[b][C]=se(F[b][C],new d(~F[(b+1)%5][C].N&F[(b+2)%5][C].N,~F[(b+1)%5][C].I&F[(b+2)%5][C].I));u[0][0]=se(u[0][0],mt[y])}var z,x,G,f,k;return u}function zt(w){let u,y,b=0;const C=[0,0],F=[4294967295&w,w/me&2097151];for(u=6;u>=0;u--)y=F[u>>2]>>>8*u&255,0===y&&0===b||(C[b+1>>2]|=y<<8*(b+1),b+=1);return b=0!==b?b:1,C[0]|=b,{value:b+1>4?C:[C[0]],binLen:8+8*b}}function $t(w){return it(zt(w.binLen),w)}function Kt(w,u){let y,b=zt(u);b=it(b,w);const C=u>>>2,F=(C-b.value.length%C)%C;for(y=0;y<F;y++)b.value.push(0);return b.value}let cn=class extends Ye{constructor(w,u,y){let b=6,C=0;super(w,u,y);const F=y||{};if(1!==this.numRounds){if(F.kmacKey||F.hmacKey)throw new Error(Oe);if("CSHAKE128"===this.o||"CSHAKE256"===this.o)throw new Error("Cannot set numRounds for CSHAKE variants")}switch(this.T=1,this.C=ce(this.t,this.i,this.T),this.v=vt,this.L=ot,this.B=Nt,this.U=Nt(),this.K=!1,w){case"SHA3-224":this.m=C=1152,this.R=224,this.M=!0,this.g=this.Y;break;case"SHA3-256":this.m=C=1088,this.R=256,this.M=!0,this.g=this.Y;break;case"SHA3-384":this.m=C=832,this.R=384,this.M=!0,this.g=this.Y;break;case"SHA3-512":this.m=C=576,this.R=512,this.M=!0,this.g=this.Y;break;case"SHAKE128":b=31,this.m=C=1344,this.R=-1,this.K=!0,this.M=!1,this.g=null;break;case"SHAKE256":b=31,this.m=C=1088,this.R=-1,this.K=!0,this.M=!1,this.g=null;break;case"KMAC128":b=4,this.m=C=1344,this.X(y),this.R=-1,this.K=!0,this.M=!1,this.g=this._;break;case"KMAC256":b=4,this.m=C=1088,this.X(y),this.R=-1,this.K=!0,this.M=!1,this.g=this._;break;case"CSHAKE128":this.m=C=1344,b=this.O(y),this.R=-1,this.K=!0,this.M=!1,this.g=null;break;case"CSHAKE256":this.m=C=1088,b=this.O(y),this.R=-1,this.K=!0,this.M=!1,this.g=null;break;default:throw new Error(Re)}this.F=function(V,ee,z,x,G){return function(f,k,O,D,te,he,Xe){let je,at,Ue=0;const gt=[],Qe=te>>>5,kn=k>>>5;for(je=0;je<kn&&k>=te;je+=Qe)D=vt(f.slice(je,je+Qe),D),k-=te;for(f=f.slice(je),k%=te;f.length<Qe;)f.push(0);for(je=k>>>3,f[je>>2]^=he<<je%4*8,f[Qe-1]^=2147483648,D=vt(f,D);32*gt.length<Xe&&(at=D[Ue%5][Ue/5|0],gt.push(at.I),!(32*gt.length>=Xe));)gt.push(at.N),Ue+=1,64*Ue%te==0&&(vt(null,D),Ue=0);return gt}(V,ee,0,x,C,b,G)},F.hmacKey&&this.k(ze("hmacKey",F.hmacKey,this.T))}O(w,u){const y=function(C){const F=C||{};return{funcName:ze("funcName",F.funcName,1,{value:[],binLen:0}),customization:ze("Customization",F.customization,1,{value:[],binLen:0})}}(w||{});u&&(y.funcName=u);const b=it($t(y.funcName),$t(y.customization));if(0!==y.customization.binLen||0!==y.funcName.binLen){const C=Kt(b,this.m>>>3);for(let F=0;F<C.length;F+=this.m>>>5)this.U=this.v(C.slice(F,F+(this.m>>>5)),this.U),this.A+=this.m;return 4}return 31}X(w){const u=function(b){const C=b||{};return{kmacKey:ze("kmacKey",C.kmacKey,1),funcName:{value:[1128353099],binLen:32},customization:ze("Customization",C.customization,1,{value:[],binLen:0})}}(w||{});this.O(w,u.funcName);const y=Kt($t(u.kmacKey),this.m>>>3);for(let b=0;b<y.length;b+=this.m>>>5)this.U=this.v(y.slice(b,b+(this.m>>>5)),this.U),this.A+=this.m;this.H=!0}_(w){const u=it({value:this.h.slice(),binLen:this.u},function(y){let b,C,F=0;const V=[0,0],ee=[4294967295&y,y/me&2097151];for(b=6;b>=0;b--)C=ee[b>>2]>>>8*b&255,0===C&&0===F||(V[F>>2]|=C<<8*F,F+=1);return F=0!==F?F:1,V[F>>2]|=F<<8*F,{value:F+1>4?V:[V[0]],binLen:8+8*F}}(w.outputLen));return this.F(u.value,u.binLen,this.A,this.L(this.U),w.outputLen)}};class ln{constructor(u,y,b){if("SHA-1"==u)this.P=new q(u,y,b);else if("SHA-224"==u||"SHA-256"==u)this.P=new kt(u,y,b);else if("SHA-384"==u||"SHA-512"==u)this.P=new ut(u,y,b);else{if("SHA3-224"!=u&&"SHA3-256"!=u&&"SHA3-384"!=u&&"SHA3-512"!=u&&"SHAKE128"!=u&&"SHAKE256"!=u&&"CSHAKE128"!=u&&"CSHAKE256"!=u&&"KMAC128"!=u&&"KMAC256"!=u)throw new Error(Re);this.P=new cn(u,y,b)}}update(u){return this.P.update(u),this}getHash(u,y){return this.P.getHash(u,y)}setHMACKey(u,y,b){this.P.setHMACKey(u,y,b)}getHMAC(u,y){return this.P.getHMAC(u,y)}}},6296:(Bt,We,Y)=>{function m(xe){var Se,ce,we,me=2;for(typeof Symbol<"u"&&(ce=Symbol.asyncIterator,we=Symbol.iterator);me--;){if(ce&&null!=(Se=xe[ce]))return Se.call(xe);if(we&&null!=(Se=xe[we]))return new s(Se.call(xe));ce="@@asyncIterator",we="@@iterator"}throw new TypeError("Object is not async iterable")}function s(xe){function Se(ce){if(Object(ce)!==ce)return Promise.reject(new TypeError(ce+" is not an object."));var we=ce.done;return Promise.resolve(ce.value).then(function(me){return{value:me,done:we}})}return(s=function(we){this.s=we,this.n=we.next}).prototype={s:null,n:null,next:function(){return Se(this.n.apply(this.s,arguments))},return:function(we){var me=this.s.return;return void 0===me?Promise.resolve({value:we,done:!0}):Se(me.apply(this.s,arguments))},throw:function(we){var me=this.s.return;return void 0===me?Promise.reject(we):Se(me.apply(this.s,arguments))}},new s(xe)}Y.d(We,{Z:()=>m})},7582:(Bt,We,Y)=>{function ce(d,I,j,T){var re,J=arguments.length,K=J<3?I:null===T?T=Object.getOwnPropertyDescriptor(I,j):T;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)K=Reflect.decorate(d,I,j,T);else for(var _e=d.length-1;_e>=0;_e--)(re=d[_e])&&(K=(J<3?re(K):J>3?re(I,j,K):re(I,j))||K);return J>3&&K&&Object.defineProperty(I,j,K),K}function Oe(d,I,j,T){return new(j||(j=Promise))(function(K,re){function _e(oe){try{se(T.next(oe))}catch(Be){re(Be)}}function Le(oe){try{se(T.throw(oe))}catch(Be){re(Be)}}function se(oe){oe.done?K(oe.value):function J(K){return K instanceof j?K:new j(function(re){re(K)})}(oe.value).then(_e,Le)}se((T=T.apply(d,I||[])).next())})}function ve(d){return this instanceof ve?(this.v=d,this):new ve(d)}function ae(d,I,j){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var J,T=j.apply(d,I||[]),K=[];return J={},re("next"),re("throw"),re("return"),J[Symbol.asyncIterator]=function(){return this},J;function re(Fe){T[Fe]&&(J[Fe]=function(He){return new Promise(function(Ae,st){K.push([Fe,He,Ae,st])>1||_e(Fe,He)})})}function _e(Fe,He){try{!function Le(Fe){Fe.value instanceof ve?Promise.resolve(Fe.value.v).then(se,oe):Be(K[0][2],Fe)}(T[Fe](He))}catch(Ae){Be(K[0][3],Ae)}}function se(Fe){_e("next",Fe)}function oe(Fe){_e("throw",Fe)}function Be(Fe,He){Fe(He),K.shift(),K.length&&_e(K[0][0],K[0][1])}}function ge(d){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var j,I=d[Symbol.asyncIterator];return I?I.call(d):(d=function Ye(d){var I="function"==typeof Symbol&&Symbol.iterator,j=I&&d[I],T=0;if(j)return j.call(d);if(d&&"number"==typeof d.length)return{next:function(){return d&&T>=d.length&&(d=void 0),{value:d&&d[T++],done:!d}}};throw new TypeError(I?"Object is not iterable.":"Symbol.iterator is not defined.")}(d),j={},T("next"),T("throw"),T("return"),j[Symbol.asyncIterator]=function(){return this},j);function T(K){j[K]=d[K]&&function(re){return new Promise(function(_e,Le){!function J(K,re,_e,Le){Promise.resolve(Le).then(function(se){K({value:se,done:_e})},re)}(_e,Le,(re=d[K](re)).done,re.value)})}}}Y.d(We,{FC:()=>ae,KL:()=>ge,gn:()=>ce,mG:()=>Oe,qq:()=>ve}),"function"==typeof SuppressedError&&SuppressedError}}]);