(self.webpackChunkapp_portal=self.webpackChunkapp_portal||[]).push([[4864,3395,3894],{9159:(rr,$e,J)=>{J.r($e),J.d($e,{AckPolicy:()=>Ws,DeliverPolicy:()=>Xs,JSONCodec:()=>ke,JetstreamWsService:()=>Wr,RetentionPolicy:()=>Ys,SubscribeType:()=>mr});var O=J(5861),Ee=J(7582),h=J(5863),ue=J(5126),z=J(6296);function ne(s,e){this.v=s,this.k=e}function W(s){return new ne(s,0)}function Pe(s){var e,t;function r(i,o){try{var c=s[i](o),d=c.value,p=d instanceof ne;Promise.resolve(p?d.v:d).then(function(g){if(p){var b="return"===i?"return":"next";if(!d.k||g.done)return r(b,g);g=s[b](g).value}n(c.done?"return":"normal",g)},function(g){r("throw",g)})}catch(g){n("throw",g)}}function n(i,o){switch(i){case"return":e.resolve({value:o,done:!0});break;case"throw":e.reject(o);break;default:e.resolve({value:o,done:!1})}(e=e.next)?r(e.key,e.arg):t=null}this._invoke=function(i,o){return new Promise(function(c,d){var p={key:i,arg:o,resolve:c,reject:d,next:null};t?t=t.next=p:(e=t=p,r(i,o))})},"function"!=typeof s.return&&(this.return=void 0)}function ge(s){return function(){return new Pe(s.apply(this,arguments))}}Pe.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},Pe.prototype.next=function(s){return this._invoke("next",s)},Pe.prototype.throw=function(s){return this._invoke("throw",s)},Pe.prototype.return=function(s){return this._invoke("return",s)};const se=new Uint8Array(0),ye=new TextEncoder,le=new TextDecoder;function je(...s){const e=[];for(let t=0;t<s.length;t++)e.push(ye.encode(s[t]));return 0===e.length?se:1===e.length?e[0]:function lt(...s){let e=0;for(let n=0;n<s.length;n++)e+=s[n].length;const t=new Uint8Array(e);let r=0;for(let n=0;n<s.length;n++)t.set(s[n],r),r+=s[n].length;return t}(...e)}function ht(s){return s&&0!==s.length?le.decode(s):""}const Le="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";const qe=new class mt{buf;seq;inc;constructor(){this.buf=new Uint8Array(22),this.init()}init(){this.setPre(),this.initSeqAndInc(),this.fillSeq()}initSeqAndInc(){this.seq=Math.floor(0xcfd41b9100000*Math.random()),this.inc=Math.floor(300*Math.random()+33)}setPre(){const e=new Uint8Array(12);!function pt(s){globalThis?.crypto?.getRandomValues?globalThis.crypto.getRandomValues(s):function dt(s){for(let e=0;e<s.length;e++)s[e]=Math.floor(255*Math.random())}(s)}(e);for(let t=0;t<12;t++)this.buf[t]=Le.charCodeAt(e[t]%36)}fillSeq(){let e=this.seq;for(let t=21;t>=12;t--)this.buf[t]=Le.charCodeAt(e%36),e=Math.floor(e/36)}next(){return this.seq+=this.inc,this.seq>0xcfd41b9100000&&(this.setPre(),this.initSeqAndInc()),this.fillSeq(),String.fromCharCode.apply(String,this.buf)}reset(){this.init()}};var Ie=function(s){return s.Disconnect="disconnect",s.Reconnect="reconnect",s.Update="update",s.LDM="ldm",s.Error="error",s}(Ie||{}),Xe=function(s){return s.Reconnecting="reconnecting",s.PingTimer="pingTimer",s.StaleConnection="staleConnection",s}(Xe||{}),L=function(s){return s.ApiError="BAD API",s.BadAuthentication="BAD_AUTHENTICATION",s.BadCreds="BAD_CREDS",s.BadHeader="BAD_HEADER",s.BadJson="BAD_JSON",s.BadPayload="BAD_PAYLOAD",s.BadSubject="BAD_SUBJECT",s.Cancelled="CANCELLED",s.ConnectionClosed="CONNECTION_CLOSED",s.ConnectionDraining="CONNECTION_DRAINING",s.ConnectionRefused="CONNECTION_REFUSED",s.ConnectionTimeout="CONNECTION_TIMEOUT",s.Disconnect="DISCONNECT",s.InvalidOption="INVALID_OPTION",s.InvalidPayload="INVALID_PAYLOAD",s.MaxPayloadExceeded="MAX_PAYLOAD_EXCEEDED",s.NoResponders="503",s.NotFunction="NOT_FUNC",s.RequestError="REQUEST_ERROR",s.ServerOptionNotAvailable="SERVER_OPT_NA",s.SubClosed="SUB_CLOSED",s.SubDraining="SUB_DRAINING",s.Timeout="TIMEOUT",s.Tls="TLS",s.Unknown="UNKNOWN_ERROR",s.WssRequired="WSS_REQUIRED",s.JetStreamInvalidAck="JESTREAM_INVALID_ACK",s.JetStream404NoMessages="404",s.JetStream408RequestTimeout="408",s.JetStream409MaxAckPendingExceeded="409",s.JetStream409="409",s.JetStreamNotEnabled="503",s.JetStreamIdleHeartBeat="IDLE_HEARTBEAT",s.AuthorizationViolation="AUTHORIZATION_VIOLATION",s.AuthenticationExpired="AUTHENTICATION_EXPIRED",s.ProtocolError="NATS_PROTOCOL_ERR",s.PermissionsViolation="PERMISSIONS_VIOLATION",s.AuthenticationTimeout="AUTHENTICATION_TIMEOUT",s}(L||{});class bt{messages;constructor(){this.messages=new Map,this.messages.set(L.InvalidPayload,"Invalid payload type - payloads can be 'binary', 'string', or 'json'"),this.messages.set(L.BadJson,"Bad JSON"),this.messages.set(L.WssRequired,"TLS is required, therefore a secure websocket connection is also required")}static getMessage(e){return Nt.getMessage(e)}getMessage(e){return this.messages.get(e)||e}}const Nt=new bt;class B extends Error{name;message;code;permissionContext;chainedError;api_error;constructor(e,t,r){super(e),this.name="NatsError",this.message=e,this.code=t,this.chainedError=r}static errorForCode(e,t){const r=bt.getMessage(e);return new B(r,e,t)}isAuthError(){return this.code===L.AuthenticationExpired||this.code===L.AuthorizationViolation}isAuthTimeout(){return this.code===L.AuthenticationTimeout}isPermissionError(){return this.code===L.PermissionsViolation}isProtocolError(){return this.code===L.ProtocolError}isJetStreamError(){return void 0!==this.api_error}jsError(){return this.api_error?this.api_error:null}}var be=function(s){return s[s.Exact=0]="Exact",s[s.CanonicalMIME=1]="CanonicalMIME",s[s.IgnoreCase=2]="IgnoreCase",s}(be||{}),Ce=function(s){return s.Timer="timer",s.Count="count",s.JitterTimer="jitterTimer",s.SentinelMsg="sentinelMsg",s}(Ce||{}),it=function(s){return s.STATS="io.nats.micro.v1.stats_response",s.INFO="io.nats.micro.v1.info_response",s.PING="io.nats.micro.v1.ping_response",s}(it||{});const y="Nats-Service-Error",w="Nats-Service-Error-Code";class E extends Error{code;constructor(e,t){super(t),this.code=e}static isServiceError(e){return null!==E.toServiceError(e)}static toServiceError(e){const t=e?.headers?.get(w)||"";if(""!==t){const r=parseInt(t)||400,n=e?.headers?.get(y)||"";return new E(r,n.length?n:t)}return null}}function v(s=""){if("string"!=typeof(s=s||"_INBOX"))throw new Error("prefix must be a string");return s.split(".").forEach(e=>{if("*"===e||">"===e)throw new Error(`inbox prefixes cannot have wildcards '${s}'`)}),`${s}.${qe.next()}`}const U="127.0.0.1";var R=function(s){return s.PING="PING",s.STATS="STATS",s.INFO="INFO",s}(R||{});function A(s,...e){for(let t=0;t<e.length;t++){const r=e[t];Object.keys(r).forEach(function(n){s[n]=r[n]})}return s}function H(s){return le.decode(s).replace(/\n/g,"\u240a").replace(/\r/g,"\u240d")}function $(s){const e=B.errorForCode(L.Timeout);let t,r;const n=new Promise((i,o)=>{t={cancel:()=>{r&&clearTimeout(r)}},r=setTimeout(()=>{o(e)},s)});return Object.assign(n,t)}function T(s=0){return new Promise(e=>{setTimeout(()=>{e()},s)})}function I(){let s={};const e=new Promise((t,r)=>{s={resolve:t,reject:r}});return Object.assign(e,s)}function Z(s){for(let e=s.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[s[e],s[t]]=[s[t],s[e]]}return s}class oe{buffers;byteLength;constructor(){this.buffers=[],this.byteLength=0}static concat(...e){let t=0;for(let i=0;i<e.length;i++)t+=e[i].length;const r=new Uint8Array(t);let n=0;for(let i=0;i<e.length;i++)r.set(e[i],n),n+=e[i].length;return r}static fromAscii(e){return e||(e=""),ye.encode(e)}static toAscii(e){return le.decode(e)}reset(){this.buffers.length=0,this.byteLength=0}pack(){if(this.buffers.length>1){const e=new Uint8Array(this.byteLength);let t=0;for(let r=0;r<this.buffers.length;r++)e.set(this.buffers[r],t),t+=this.buffers[r].length;this.buffers.length=0,this.buffers.push(e)}}shift(){if(this.buffers.length){const e=this.buffers.shift();if(e)return this.byteLength-=e.length,e}return new Uint8Array(0)}drain(e){if(this.buffers.length){this.pack();const t=this.buffers.pop();if(t){const r=this.byteLength;(void 0===e||e>r)&&(e=r);const n=t.subarray(0,e);return r>e&&this.buffers.push(t.subarray(e)),this.byteLength=r-e,n}}return new Uint8Array(0)}fill(e,...t){e&&(this.buffers.push(e),this.byteLength+=e.length);for(let r=0;r<t.length;r++)t[r]&&t[r].length&&(this.buffers.push(t[r]),this.byteLength+=t[r].length)}peek(){return this.buffers.length?(this.pack(),this.buffers[0]):new Uint8Array(0)}size(){return this.byteLength}length(){return this.buffers.length}}let ie;function xe(){return void 0!==ie&&void 0!==ie.defaultPort?ie.defaultPort:4222}function Me(){return void 0!==ie&&ie.urlParseFn?ie.urlParseFn:void 0}function hs(){return void 0!==ie&&ie.dnsResolveFn?ie.dnsResolveFn:void 0}const sr=oe.fromAscii("\r\n"),pn=new Uint8Array(sr)[0],mn=new Uint8Array(sr)[1];const gn=4,fs=48,yn=65,xn=97;function Or(s){return void 0!==function vn(s){for(let e=0;e<s.length;e++)switch(s[e]){case".":return ds(s);case":":return Sn(s)}}(s)}function ds(s){const e=new Uint8Array(4);for(let t=0;t<4;t++){if(0===s.length)return;if(t>0){if("."!==s[0])return;s=s.substring(1)}const{n:r,c:n,ok:i}=En(s);if(!i||r>255)return;s=s.substring(n),e[t]=r}return function wn(s,e,t,r){const n=new Uint8Array(16);return[0,0,0,0,0,0,0,0,0,0,255,255].forEach((o,c)=>{n[c]=o}),n[12]=s,n[13]=e,n[14]=t,n[15]=r,n}(e[0],e[1],e[2],e[3])}function Sn(s){const e=new Uint8Array(16);let t=-1;if(s.length>=2&&":"===s[0]&&":"===s[1]&&(t=0,0===(s=s.substring(2)).length))return e;let r=0;for(;r<16;){const{n,c:i,ok:o}=Pn(s);if(!o||n>65535)return;if(i<s.length&&"."===s[i]){if(t<0&&12!=r||r+4>16)return;const c=ds(s);if(void 0===c)return;e[r]=c[12],e[r+1]=c[13],e[r+2]=c[14],e[r+3]=c[15],s="",r+=gn;break}if(e[r]=n>>8,e[r+1]=n,r+=2,0===(s=s.substring(i)).length)break;if(":"!==s[0]||1==s.length)return;if(":"===(s=s.substring(1))[0]){if(t>=0)return;if(t=r,0===(s=s.substring(1)).length)break}}if(0===s.length){if(r<16){if(t<0)return;const n=16-r;for(let i=r-1;i>=t;i--)e[i+n]=e[i];for(let i=t+n-1;i>=t;i--)e[i]=0}else if(t>=0)return;return e}}function En(s){let e=0,t=0;for(e=0;e<s.length&&48<=s.charCodeAt(e)&&s.charCodeAt(e)<=57;e++)if(t=10*t+(s.charCodeAt(e)-fs),t>=16777215)return{n:16777215,c:e,ok:!1};return 0===e?{n:0,c:0,ok:!1}:{n:t,c:e,ok:!0}}function Pn(s){let e=0,t=0;for(t=0;t<s.length;t++){if(48<=s.charCodeAt(t)&&s.charCodeAt(t)<=57)e*=16,e+=s.charCodeAt(t)-fs;else if(97<=s.charCodeAt(t)&&s.charCodeAt(t)<=102)e*=16,e+=s.charCodeAt(t)-xn+10;else{if(!(65<=s.charCodeAt(t)&&s.charCodeAt(t)<=70))break;e*=16,e+=s.charCodeAt(t)-yn+10}if(e>=16777215)return{n:0,c:t,ok:!1}}return 0===t?{n:0,c:t,ok:!1}:{n:e,c:t,ok:!0}}function kr(s){return!function Cn(s){return-1!==s.indexOf(".")||-1===s.indexOf("[")&&-1===s.indexOf("::")&&s.split(":").length<=2}(s)}class $t{src;listen;hostname;port;didConnect;reconnects;lastConnect;gossiped;tlsName;resolves;constructor(e,t=!1){this.src=e,this.tlsName="";const r=function kn(s){(s=s.trim()).match(/^(.*:\/\/)(.*)/m)&&(s=s.replace(/^(.*:\/\/)(.*)/gm,"$2")),s=function On(s){const t=s.toUpperCase().indexOf("::FFFF:");if(-1!==t&&-1!==s.indexOf(".")){let r=s.substring(t+7);return r=r.replace("[",""),r.replace("]","")}return s}(s),kr(s)&&-1===s.indexOf("[")&&(s=`[${s}]`);const e=kr(s)?s.match(/(]:)(\d+)/):s.match(/(:)(\d+)/),t=e&&3===e.length&&e[1]&&e[2]?parseInt(e[2]):4222,n=new URL(`${80===t?"https":"http"}://${s}`);n.port=`${t}`;let i=n.hostname;return"["===i.charAt(0)&&(i=i.substring(1,i.length-1)),{listen:n.host,hostname:i,port:t}}(e);this.listen=r.listen,this.hostname=r.hostname,this.port=r.port,this.didConnect=!1,this.reconnects=0,this.lastConnect=0,this.gossiped=t}toString(){return this.listen}resolve(e){var t=this;return(0,O.Z)(function*(){if(!e.fn)return[t];const r=[];if(Or(t.hostname))return[t];{const n=yield e.fn(t.hostname);e.debug&&console.log(`resolve ${t.hostname} = ${n.join(",")}`);for(const i of n){const c=new URL(`${80===t.port?"https":"http"}://${kr(i)?"["+i+"]":i}`);c.port=`${t.port}`;const d=new $t(c.host,!1);d.tlsName=t.hostname,r.push(d)}}return e.randomize&&Z(r),t.resolves=r,r})()}}class An{firstSelect;servers;currentServer;tlsName;randomize;constructor(e=[],t={}){this.firstSelect=!0,this.servers=[],this.tlsName="",this.randomize=t.randomize||!1;const r=Me();e&&(e.forEach(n=>{n=r?r(n):n,this.servers.push(new $t(n))}),this.randomize&&(this.servers=Z(this.servers))),0===this.servers.length&&this.addServer(`${U}:${xe()}`,!1),this.currentServer=this.servers[0]}clear(){this.servers.length=0}updateTLSName(){const e=this.getCurrentServer();Or(e.hostname)||(this.tlsName=e.hostname,this.servers.forEach(t=>{t.gossiped&&(t.tlsName=this.tlsName)}))}getCurrentServer(){return this.currentServer}addServer(e,t=!1){const r=Me();e=r?r(e):e;const n=new $t(e,t);Or(n.hostname)&&(n.tlsName=this.tlsName),this.servers.push(n)}selectServer(){if(this.firstSelect)return this.firstSelect=!1,this.currentServer;const e=this.servers.shift();return e&&(this.servers.push(e),this.currentServer=e),e}removeCurrentServer(){this.removeServer(this.currentServer)}removeServer(e){if(e){const t=this.servers.indexOf(e);this.servers.splice(t,1)}}length(){return this.servers.length}next(){return this.servers.length?this.servers[0]:void 0}getServers(){return this.servers}update(e){const t=[];let r=[];const n=Me(),i=new Map;e.connect_urls&&e.connect_urls.length>0&&e.connect_urls.forEach(c=>{c=n?n(c):c;const d=new $t(c,!0);i.set(c,d)});const o=[];return this.servers.forEach((c,d)=>{const p=c.listen;c.gossiped&&this.currentServer.listen!==p&&void 0===i.get(p)&&o.push(d),i.delete(p)}),o.reverse(),o.forEach(c=>{const d=this.servers.splice(c,1);r=r.concat(d[0].listen)}),i.forEach((c,d)=>{this.servers.push(c),t.push(d)}),{added:t,deleted:r}}}class me{inflight;processed;received;noIterator;iterClosed;done;signal;yields;filtered;pendingFiltered;ingestionFilterFn;protocolFilterFn;dispatchedFn;ctx;_data;err;time;constructor(){this.inflight=0,this.filtered=0,this.pendingFiltered=0,this.processed=0,this.received=0,this.noIterator=!1,this.done=!1,this.signal=I(),this.yields=[],this.iterClosed=I(),this.time=0}[Symbol.asyncIterator](){return this.iterate()}push(e){if(this.done)return;if("function"==typeof e)return this.yields.push(e),void this.signal.resolve();const{ingest:t,protocol:r}=this.ingestionFilterFn?this.ingestionFilterFn(e,this.ctx||this):{ingest:!0,protocol:!1};t&&(r&&(this.filtered++,this.pendingFiltered++),this.yields.push(e),this.signal.resolve())}iterate(){var e=this;return ge(function*(){if(e.noIterator)throw new B("unsupported iterator",L.ApiError);try{for(;;){if(0===e.yields.length&&(yield W(e.signal)),e.err)throw e.err;const t=e.yields;e.inflight=t.length,e.yields=[];for(let r=0;r<t.length;r++)if("function"!=typeof t[r]){if(!e.protocolFilterFn||e.protocolFilterFn(t[r])){e.processed++;const i=Date.now();yield t[r],e.time=Date.now()-i,e.dispatchedFn&&t[r]&&e.dispatchedFn(t[r])}else e.pendingFiltered--;e.inflight--}else{const i=t[r];try{i()}catch(o){throw o}if(e.err)throw e.err}if(e.done)break;0===e.yields.length&&(t.length=0,e.yields=t,e.signal=I())}}finally{e.stop()}})()}stop(e){this.done||(this.err=e,this.done=!0,this.signal.resolve(),this.iterClosed.resolve())}getProcessed(){return this.noIterator?this.received:this.processed}getPending(){return this.yields.length+this.inflight-this.pendingFiltered}getReceived(){return this.received-this.filtered}}function ps(s){let r=!0;const n=new Array(s.length);for(let i=0;i<s.length;i++){let o=s.charCodeAt(i);if(58===o||o<33||o>126)throw new B(`'${s[i]}' is not a valid character for a header key`,L.BadHeader);r&&97<=o&&o<=122?o-=32:!r&&65<=o&&o<=90&&(o+=32),n[i]=o,r=45==o}return String.fromCharCode(...n)}function ze(s=0,e=""){if(0===s&&""!==e||s>0&&""===e)throw new Error("setting status requires both code and description");return new Qe(s,e)}const Ar="NATS/1.0";class Qe{_code;headers;_description;constructor(e=0,t=""){this._code=e,this._description=t,this.headers=new Map}[Symbol.iterator](){return this.headers.entries()}size(){return this.headers.size}equals(e){if(e&&this.headers.size===e.headers.size&&this._code===e._code){for(const[t,r]of this.headers){const n=e.values(t);if(r.length!==n.length)return!1;const i=[...r].sort(),o=[...n].sort();for(let c=0;c<i.length;c++)if(i[c]!==o[c])return!1}return!0}return!1}static decode(e){const t=new Qe,n=le.decode(e).split("\r\n"),i=n[0];if(i!==Ar){let o=i.replace(Ar,"").trim();if(o.length>0){t._code=parseInt(o,10),isNaN(t._code)&&(t._code=0);const c=t._code.toString();o=o.replace(c,""),t._description=o.trim()}}return n.length>=1&&n.slice(1).map(o=>{if(o){const c=o.indexOf(":");if(c>-1){const d=o.slice(0,c),p=o.slice(c+1).trim();t.append(d,p)}}}),t}toString(){if(0===this.headers.size&&0===this._code)return"";let e=Ar;this._code>0&&""!==this._description&&(e+=` ${this._code} ${this._description}`);for(const[t,r]of this.headers)for(let n=0;n<r.length;n++)e=`${e}\r\n${t}: ${r[n]}`;return`${e}\r\n\r\n`}encode(){return ye.encode(this.toString())}static validHeaderValue(e){if(/[\r\n]/.test(e))throw new B("invalid header value - \\r and \\n are not allowed.",L.BadHeader);return e.trim()}keys(){const e=[];for(const t of this.headers.keys())e.push(t);return e}findKeys(e,t=be.Exact){const r=this.keys();switch(t){case be.Exact:return r.filter(n=>n===e);case be.CanonicalMIME:return e=ps(e),r.filter(n=>n===e);default:{const n=e.toLowerCase();return r.filter(i=>n===i.toLowerCase())}}}get(e,t=be.Exact){const r=this.findKeys(e,t);if(r.length){const n=this.headers.get(r[0]);if(n)return Array.isArray(n)?n[0]:n}return""}has(e,t=be.Exact){return this.findKeys(e,t).length>0}set(e,t,r=be.Exact){this.delete(e,r),this.append(e,t,r)}append(e,t,r=be.Exact){const n=ps(e);r===be.CanonicalMIME&&(e=n);const i=this.findKeys(e,r);e=i.length>0?i[0]:e;const o=Qe.validHeaderValue(t);let c=this.headers.get(e);c||(c=[],this.headers.set(e,c)),c.push(o)}values(e,t=be.Exact){const r=[];return this.findKeys(e,t).forEach(i=>{const o=this.headers.get(i);o&&r.push(...o)}),r}delete(e,t=be.Exact){this.findKeys(e,t).forEach(n=>{this.headers.delete(n)})}get hasError(){return this._code>=300}get status(){return`${this._code} ${this._description}`.trim()}toRecord(){const e={};return this.keys().forEach(t=>{e[t]=this.values(t)}),e}get code(){return this._code}get description(){return this._description}static fromRecord(e){const t=new Qe;for(const r in e)t.headers.set(r,e[r]);return t}}function ke(s){return{encode(e){try{return void 0===e&&(e=null),ye.encode(JSON.stringify(e))}catch(t){throw B.errorForCode(L.BadJson,t)}},decode(e){try{return JSON.parse(le.decode(e),s)}catch(t){throw B.errorForCode(L.BadJson,t)}}}}function ms(s){return s&&0===s.data.length&&503===s.headers?.code?B.errorForCode(L.NoResponders):null}let bs=(()=>class s{_headers;_msg;_rdata;_reply;_subject;publisher;static jc;constructor(t,r,n){this._msg=t,this._rdata=r,this.publisher=n}get subject(){return this._subject||(this._subject=le.decode(this._msg.subject)),this._subject}get reply(){return this._reply||(this._reply=le.decode(this._msg.reply)),this._reply}get sid(){return this._msg.sid}get headers(){if(this._msg.hdr>-1&&!this._headers){const t=this._rdata.subarray(0,this._msg.hdr);this._headers=Qe.decode(t)}return this._headers}get data(){return this._rdata?this._msg.hdr>-1?this._rdata.subarray(this._msg.hdr):this._rdata:new Uint8Array(0)}respond(t=se,r){return!!this.reply&&(this.publisher.publish(this.reply,t,r),!0)}size(){return this._msg.subject.length+(this._msg.reply?.length||0)+(-1===this._msg.size?0:this._msg.size)}json(t){return ke(t).decode(this.data)}string(){return le.decode(this.data)}})();class In{baseInbox;reqs;constructor(){this.reqs=new Map}size(){return this.reqs.size}init(e){return this.baseInbox=`${v(e)}.`,this.baseInbox}add(e){isNaN(e.received)||(e.received=0),this.reqs.set(e.token,e)}get(e){return this.reqs.get(e)}cancel(e){this.reqs.delete(e.token)}getToken(e){const t=e.subject||"";return 0===t.indexOf(this.baseInbox)?t.substring(this.baseInbox.length):null}all(){return Array.from(this.reqs.values())}handleError(e,t){if(t&&t.permissionContext){if(e)return this.all().forEach(n=>{n.resolver(t,{})}),!0;const r=t.permissionContext;if("publish"===r.operation){const n=this.all().find(i=>i.requestSubject===r.subject);if(n)return n.resolver(t,{}),!0}}return!1}dispatcher(){return(e,t)=>{const r=this.getToken(t);if(r){const n=this.get(r);n&&(null===e&&t.headers&&(e=ms(t)),n.resolver(e,t))}}}close(){const e=B.errorForCode(L.Timeout);this.reqs.forEach(t=>{t.resolver(e,{})})}}class Mn{ph;interval;maxOut;timer;pendings;constructor(e,t,r){this.ph=e,this.interval=t,this.maxOut=r,this.pendings=[]}start(){this.cancel(),this._schedule()}cancel(e){this.timer&&(clearTimeout(this.timer),this.timer=void 0),this._reset(),e&&this.ph.disconnect()}_schedule(){this.timer=setTimeout(()=>{if(this.ph.dispatchStatus({type:Xe.PingTimer,data:`${this.pendings.length+1}`}),this.pendings.length===this.maxOut)return void this.cancel(!0);const e=I();this.ph.flush(e).then(()=>{this._reset()}).catch(()=>{this.cancel()}),this.pendings.push(e),this._schedule()},this.interval)}_reset(){this.pendings=this.pendings.filter(e=>(e.resolve(),!1))}}class Tn extends Error{constructor(e){super(e),this.name="AssertionError"}}const jr=2**32-2;function nr(s,e,t=0){const r=e.byteLength-t;return s.byteLength>r&&(s=s.subarray(0,r)),e.set(s,t),s.byteLength}class Ir{_buf;_off;constructor(e){this._off=0,this._buf=null!=e?new Uint8Array(e):new Uint8Array(0)}bytes(e={copy:!0}){return!1===e.copy?this._buf.subarray(this._off):this._buf.slice(this._off)}empty(){return this._buf.byteLength<=this._off}get length(){return this._buf.byteLength-this._off}get capacity(){return this._buf.buffer.byteLength}truncate(e){if(0!==e){if(e<0||e>this.length)throw Error("bytes.Buffer: truncation out of range");this._reslice(this._off+e)}else this.reset()}reset(){this._reslice(0),this._off=0}_tryGrowByReslice(e){const t=this._buf.byteLength;return e<=this.capacity-t?(this._reslice(t+e),t):-1}_reslice(e){(function Nn(s,e="Assertion failed."){if(!s)throw new Tn(e)})(e<=this._buf.buffer.byteLength),this._buf=new Uint8Array(this._buf.buffer,0,e)}readByte(){const e=new Uint8Array(1);return this.read(e)?e[0]:null}read(e){if(this.empty())return this.reset(),0===e.byteLength?0:null;const t=nr(this._buf.subarray(this._off),e);return this._off+=t,t}writeByte(e){return this.write(Uint8Array.of(e))}writeString(e){return this.write(ye.encode(e))}write(e){const t=this._grow(e.byteLength);return nr(e,this._buf,t)}_grow(e){const t=this.length;0===t&&0!==this._off&&this.reset();const r=this._tryGrowByReslice(e);if(r>=0)return r;const n=this.capacity;if(e<=Math.floor(n/2)-t)nr(this._buf.subarray(this._off),this._buf);else{if(n+e>jr)throw new Error("The buffer cannot be grown beyond the maximum size.");{const i=new Uint8Array(Math.min(2*n+e,jr));nr(this._buf.subarray(this._off),i),this._buf=i}}return this._off=0,this._reslice(Math.min(t+e,jr)),t}grow(e){if(e<0)throw Error("Buffer._grow: negative count");const t=this._grow(e);this._reslice(t)}readFrom(e){let t=0;const r=new Uint8Array(32768);for(;;){const n=this.capacity-this.length<32768,i=n?r:new Uint8Array(this._buf.buffer,this.length),o=e.read(i);if(null===o)return t;n?this.write(i.subarray(0,o)):this._reslice(this.length+o),t+=o}}}var we=function(s){return s[s.OK=0]="OK",s[s.ERR=1]="ERR",s[s.MSG=2]="MSG",s[s.INFO=3]="INFO",s[s.PING=4]="PING",s[s.PONG=5]="PONG",s}(we||{});class ys{dispatcher;state;as;drop;hdr;ma;argBuf;msgBuf;constructor(e){this.dispatcher=e,this.state=q.OP_START,this.as=0,this.drop=0,this.hdr=0}parse(e){let t;for(t=0;t<e.length;t++){const r=e[t];switch(this.state){case q.OP_START:switch(r){case F.M:case F.m:this.state=q.OP_M,this.hdr=-1,this.ma={sid:-1,hdr:-1,size:-1};break;case F.H:case F.h:this.state=q.OP_H,this.hdr=0,this.ma={sid:-1,hdr:-1,size:-1};break;case F.P:case F.p:this.state=q.OP_P;break;case F.PLUS:this.state=q.OP_PLUS;break;case F.MINUS:this.state=q.OP_MINUS;break;case F.I:case F.i:this.state=q.OP_I;break;default:throw this.fail(e.subarray(t))}break;case q.OP_H:switch(r){case F.M:case F.m:this.state=q.OP_M;break;default:throw this.fail(e.subarray(t))}break;case q.OP_M:switch(r){case F.S:case F.s:this.state=q.OP_MS;break;default:throw this.fail(e.subarray(t))}break;case q.OP_MS:switch(r){case F.G:case F.g:this.state=q.OP_MSG;break;default:throw this.fail(e.subarray(t))}break;case q.OP_MSG:switch(r){case F.SPACE:case F.TAB:this.state=q.OP_MSG_SPC;break;default:throw this.fail(e.subarray(t))}break;case q.OP_MSG_SPC:switch(r){case F.SPACE:case F.TAB:continue;default:this.state=q.MSG_ARG,this.as=t}break;case q.MSG_ARG:switch(r){case F.CR:this.drop=1;break;case F.NL:{const n=this.argBuf?this.argBuf.bytes():e.subarray(this.as,t-this.drop);this.processMsgArgs(n),this.drop=0,this.as=t+1,this.state=q.MSG_PAYLOAD,t=this.as+this.ma.size-1;break}default:this.argBuf&&this.argBuf.writeByte(r)}break;case q.MSG_PAYLOAD:if(this.msgBuf)if(this.msgBuf.length>=this.ma.size){const n=this.msgBuf.bytes({copy:!1});this.dispatcher.push({kind:we.MSG,msg:this.ma,data:n}),this.argBuf=void 0,this.msgBuf=void 0,this.state=q.MSG_END}else{let n=this.ma.size-this.msgBuf.length;const i=e.length-t;i<n&&(n=i),n>0?(this.msgBuf.write(e.subarray(t,t+n)),t=t+n-1):this.msgBuf.writeByte(r)}else t-this.as>=this.ma.size&&(this.dispatcher.push({kind:we.MSG,msg:this.ma,data:e.subarray(this.as,t)}),this.argBuf=void 0,this.msgBuf=void 0,this.state=q.MSG_END);break;case q.MSG_END:if(r!==F.NL)continue;this.drop=0,this.as=t+1,this.state=q.OP_START;break;case q.OP_PLUS:switch(r){case F.O:case F.o:this.state=q.OP_PLUS_O;break;default:throw this.fail(e.subarray(t))}break;case q.OP_PLUS_O:switch(r){case F.K:case F.k:this.state=q.OP_PLUS_OK;break;default:throw this.fail(e.subarray(t))}break;case q.OP_PLUS_OK:r===F.NL&&(this.dispatcher.push({kind:we.OK}),this.drop=0,this.state=q.OP_START);break;case q.OP_MINUS:switch(r){case F.E:case F.e:this.state=q.OP_MINUS_E;break;default:throw this.fail(e.subarray(t))}break;case q.OP_MINUS_E:switch(r){case F.R:case F.r:this.state=q.OP_MINUS_ER;break;default:throw this.fail(e.subarray(t))}break;case q.OP_MINUS_ER:switch(r){case F.R:case F.r:this.state=q.OP_MINUS_ERR;break;default:throw this.fail(e.subarray(t))}break;case q.OP_MINUS_ERR:switch(r){case F.SPACE:case F.TAB:this.state=q.OP_MINUS_ERR_SPC;break;default:throw this.fail(e.subarray(t))}break;case q.OP_MINUS_ERR_SPC:switch(r){case F.SPACE:case F.TAB:continue;default:this.state=q.MINUS_ERR_ARG,this.as=t}break;case q.MINUS_ERR_ARG:switch(r){case F.CR:this.drop=1;break;case F.NL:{let n;this.argBuf?(n=this.argBuf.bytes(),this.argBuf=void 0):n=e.subarray(this.as,t-this.drop),this.dispatcher.push({kind:we.ERR,data:n}),this.drop=0,this.as=t+1,this.state=q.OP_START;break}default:this.argBuf&&this.argBuf.write(Uint8Array.of(r))}break;case q.OP_P:switch(r){case F.I:case F.i:this.state=q.OP_PI;break;case F.O:case F.o:this.state=q.OP_PO;break;default:throw this.fail(e.subarray(t))}break;case q.OP_PO:switch(r){case F.N:case F.n:this.state=q.OP_PON;break;default:throw this.fail(e.subarray(t))}break;case q.OP_PON:switch(r){case F.G:case F.g:this.state=q.OP_PONG;break;default:throw this.fail(e.subarray(t))}break;case q.OP_PONG:r===F.NL&&(this.dispatcher.push({kind:we.PONG}),this.drop=0,this.state=q.OP_START);break;case q.OP_PI:switch(r){case F.N:case F.n:this.state=q.OP_PIN;break;default:throw this.fail(e.subarray(t))}break;case q.OP_PIN:switch(r){case F.G:case F.g:this.state=q.OP_PING;break;default:throw this.fail(e.subarray(t))}break;case q.OP_PING:r===F.NL&&(this.dispatcher.push({kind:we.PING}),this.drop=0,this.state=q.OP_START);break;case q.OP_I:switch(r){case F.N:case F.n:this.state=q.OP_IN;break;default:throw this.fail(e.subarray(t))}break;case q.OP_IN:switch(r){case F.F:case F.f:this.state=q.OP_INF;break;default:throw this.fail(e.subarray(t))}break;case q.OP_INF:switch(r){case F.O:case F.o:this.state=q.OP_INFO;break;default:throw this.fail(e.subarray(t))}break;case q.OP_INFO:switch(r){case F.SPACE:case F.TAB:this.state=q.OP_INFO_SPC;break;default:throw this.fail(e.subarray(t))}break;case q.OP_INFO_SPC:switch(r){case F.SPACE:case F.TAB:continue;default:this.state=q.INFO_ARG,this.as=t}break;case q.INFO_ARG:switch(r){case F.CR:this.drop=1;break;case F.NL:{let n;this.argBuf?(n=this.argBuf.bytes(),this.argBuf=void 0):n=e.subarray(this.as,t-this.drop),this.dispatcher.push({kind:we.INFO,data:n}),this.drop=0,this.as=t+1,this.state=q.OP_START;break}default:this.argBuf&&this.argBuf.writeByte(r)}break;default:throw this.fail(e.subarray(t))}}(this.state===q.MSG_ARG||this.state===q.MINUS_ERR_ARG||this.state===q.INFO_ARG)&&!this.argBuf&&(this.argBuf=new Ir(e.subarray(this.as,t-this.drop))),this.state===q.MSG_PAYLOAD&&!this.msgBuf&&(this.argBuf||this.cloneMsgArg(),this.msgBuf=new Ir(e.subarray(this.as)))}cloneMsgArg(){const e=this.ma.subject.length,r=new Uint8Array(e+(this.ma.reply?this.ma.reply.length:0));r.set(this.ma.subject),this.ma.reply&&r.set(this.ma.reply,e),this.argBuf=new Ir(r),this.ma.subject=r.subarray(0,e),this.ma.reply&&(this.ma.reply=r.subarray(e))}processMsgArgs(e){if(this.hdr>=0)return this.processHeaderMsgArgs(e);const t=[];let r=-1;for(let n=0;n<e.length;n++)switch(e[n]){case F.SPACE:case F.TAB:case F.CR:case F.NL:r>=0&&(t.push(e.subarray(r,n)),r=-1);break;default:r<0&&(r=n)}switch(r>=0&&t.push(e.subarray(r)),t.length){case 3:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=void 0,this.ma.size=this.protoParseInt(t[2]);break;case 4:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=t[2],this.ma.size=this.protoParseInt(t[3]);break;default:throw this.fail(e,"processMsgArgs Parse Error")}if(this.ma.sid<0)throw this.fail(e,"processMsgArgs Bad or Missing Sid Error");if(this.ma.size<0)throw this.fail(e,"processMsgArgs Bad or Missing Size Error")}fail(e,t=""){return t=t?`${t} [${this.state}]`:`parse error [${this.state}]`,new Error(`${t}: ${le.decode(e)}`)}processHeaderMsgArgs(e){const t=[];let r=-1;for(let n=0;n<e.length;n++)switch(e[n]){case F.SPACE:case F.TAB:case F.CR:case F.NL:r>=0&&(t.push(e.subarray(r,n)),r=-1);break;default:r<0&&(r=n)}switch(r>=0&&t.push(e.subarray(r)),t.length){case 4:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=void 0,this.ma.hdr=this.protoParseInt(t[2]),this.ma.size=this.protoParseInt(t[3]);break;case 5:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=t[2],this.ma.hdr=this.protoParseInt(t[3]),this.ma.size=this.protoParseInt(t[4]);break;default:throw this.fail(e,"processHeaderMsgArgs Parse Error")}if(this.ma.sid<0)throw this.fail(e,"processHeaderMsgArgs Bad or Missing Sid Error");if(this.ma.hdr<0||this.ma.hdr>this.ma.size)throw this.fail(e,"processHeaderMsgArgs Bad or Missing Header Size Error");if(this.ma.size<0)throw this.fail(e,"processHeaderMsgArgs Bad or Missing Size Error")}protoParseInt(e){if(0===e.length)return-1;let t=0;for(let r=0;r<e.length;r++){if(e[r]<48||e[r]>57)return-1;t=10*t+(e[r]-48)}return t}}var q=function(s){return s[s.OP_START=0]="OP_START",s[s.OP_PLUS=1]="OP_PLUS",s[s.OP_PLUS_O=2]="OP_PLUS_O",s[s.OP_PLUS_OK=3]="OP_PLUS_OK",s[s.OP_MINUS=4]="OP_MINUS",s[s.OP_MINUS_E=5]="OP_MINUS_E",s[s.OP_MINUS_ER=6]="OP_MINUS_ER",s[s.OP_MINUS_ERR=7]="OP_MINUS_ERR",s[s.OP_MINUS_ERR_SPC=8]="OP_MINUS_ERR_SPC",s[s.MINUS_ERR_ARG=9]="MINUS_ERR_ARG",s[s.OP_M=10]="OP_M",s[s.OP_MS=11]="OP_MS",s[s.OP_MSG=12]="OP_MSG",s[s.OP_MSG_SPC=13]="OP_MSG_SPC",s[s.MSG_ARG=14]="MSG_ARG",s[s.MSG_PAYLOAD=15]="MSG_PAYLOAD",s[s.MSG_END=16]="MSG_END",s[s.OP_H=17]="OP_H",s[s.OP_P=18]="OP_P",s[s.OP_PI=19]="OP_PI",s[s.OP_PIN=20]="OP_PIN",s[s.OP_PING=21]="OP_PING",s[s.OP_PO=22]="OP_PO",s[s.OP_PON=23]="OP_PON",s[s.OP_PONG=24]="OP_PONG",s[s.OP_I=25]="OP_I",s[s.OP_IN=26]="OP_IN",s[s.OP_INF=27]="OP_INF",s[s.OP_INFO=28]="OP_INFO",s[s.OP_INFO_SPC=29]="OP_INFO_SPC",s[s.INFO_ARG=30]="INFO_ARG",s}(q||{}),F=function(s){return s[s.CR="\r".charCodeAt(0)]="CR",s[s.E="E".charCodeAt(0)]="E",s[s.e="e".charCodeAt(0)]="e",s[s.F="F".charCodeAt(0)]="F",s[s.f="f".charCodeAt(0)]="f",s[s.G="G".charCodeAt(0)]="G",s[s.g="g".charCodeAt(0)]="g",s[s.H="H".charCodeAt(0)]="H",s[s.h="h".charCodeAt(0)]="h",s[s.I="I".charCodeAt(0)]="I",s[s.i="i".charCodeAt(0)]="i",s[s.K="K".charCodeAt(0)]="K",s[s.k="k".charCodeAt(0)]="k",s[s.M="M".charCodeAt(0)]="M",s[s.m="m".charCodeAt(0)]="m",s[s.MINUS="-".charCodeAt(0)]="MINUS",s[s.N="N".charCodeAt(0)]="N",s[s.n="n".charCodeAt(0)]="n",s[s.NL="\n".charCodeAt(0)]="NL",s[s.O="O".charCodeAt(0)]="O",s[s.o="o".charCodeAt(0)]="o",s[s.P="P".charCodeAt(0)]="P",s[s.p="p".charCodeAt(0)]="p",s[s.PLUS="+".charCodeAt(0)]="PLUS",s[s.R="R".charCodeAt(0)]="R",s[s.r="r".charCodeAt(0)]="r",s[s.S="S".charCodeAt(0)]="S",s[s.s="s".charCodeAt(0)]="s",s[s.SPACE=" ".charCodeAt(0)]="SPACE",s[s.TAB="\t".charCodeAt(0)]="TAB",s}(F||{});function ot(s=""){const e=s.match(/(\d+).(\d+).(\d+)/);if(e)return{major:parseInt(e[1]),minor:parseInt(e[2]),micro:parseInt(e[3])};throw new Error(`'${s}' is not a semver value`)}function Mr(s,e){return s.major<e.major?-1:s.major>e.major?1:s.minor<e.minor?-1:s.minor>e.minor?1:s.micro<e.micro?-1:s.micro>e.micro?1:0}var X=function(s){return s.JS_KV="js_kv",s.JS_OBJECTSTORE="js_objectstore",s.JS_PULL_MAX_BYTES="js_pull_max_bytes",s.JS_NEW_CONSUMER_CREATE_API="js_new_consumer_create",s.JS_ALLOW_DIRECT="js_allow_direct",s.JS_MULTIPLE_CONSUMER_FILTER="js_multiple_consumer_filter",s.JS_SIMPLIFICATION="js_simplification",s.JS_STREAM_CONSUMER_METADATA="js_stream_consumer_metadata",s.JS_CONSUMER_FILTER_SUBJECTS="js_consumer_filter_subjects",s.JS_STREAM_FIRST_SEQ="js_stream_first_seq",s.JS_STREAM_SUBJECT_TRANSFORM="js_stream_subject_transform",s.JS_STREAM_SOURCE_SUBJECT_TRANSFORM="js_stream_source_subject_transform",s.JS_STREAM_COMPRESSION="js_stream_compression",s.JS_DEFAULT_CONSUMER_LIMITS="js_default_consumer_limits",s}(X||{});class $n{server;features;disabled;constructor(e){this.features=new Map,this.disabled=[],this.update(e)}resetDisabled(){this.disabled.length=0,this.update(this.server)}disable(e){this.disabled.push(e),this.update(this.server)}isDisabled(e){return-1!==this.disabled.indexOf(e)}update(e){"string"==typeof e&&(e=ot(e)),this.server=e,this.set(X.JS_KV,"2.6.2"),this.set(X.JS_OBJECTSTORE,"2.6.3"),this.set(X.JS_PULL_MAX_BYTES,"2.8.3"),this.set(X.JS_NEW_CONSUMER_CREATE_API,"2.9.0"),this.set(X.JS_ALLOW_DIRECT,"2.9.0"),this.set(X.JS_MULTIPLE_CONSUMER_FILTER,"2.10.0"),this.set(X.JS_SIMPLIFICATION,"2.9.4"),this.set(X.JS_STREAM_CONSUMER_METADATA,"2.10.0"),this.set(X.JS_CONSUMER_FILTER_SUBJECTS,"2.10.0"),this.set(X.JS_STREAM_FIRST_SEQ,"2.10.0"),this.set(X.JS_STREAM_SUBJECT_TRANSFORM,"2.10.0"),this.set(X.JS_STREAM_SOURCE_SUBJECT_TRANSFORM,"2.10.0"),this.set(X.JS_STREAM_COMPRESSION,"2.10.0"),this.set(X.JS_DEFAULT_CONSUMER_LIMITS,"2.10.0"),this.disabled.forEach(t=>{this.features.delete(t)})}set(e,t){this.features.set(e,{min:t,ok:Mr(this.server,ot(t))>=0})}get(e){return this.features.get(e)||{min:"unknown",ok:!1}}supports(e){return this.get(e)?.ok||!1}require(e){return"string"==typeof e&&(e=ot(e)),Mr(this.server,e)>=0}}!function(s){"use strict";var e=function(a,l){this.hi=0|a,this.lo=0|l},t=function(a){var l,u=new Float64Array(16);if(a)for(l=0;l<a.length;l++)u[l]=a[l];return u},r=function(){throw new Error("no PRNG")},n=new Uint8Array(16),i=new Uint8Array(32);i[0]=9;var o=t(),c=t([1]),d=t([56129,1]),p=t([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),g=t([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),b=t([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),S=t([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),P=t([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function j(a,l){return a<<l|a>>>32-l}function N(a,l){var u=255&a[l+3];return(u=(u=u<<8|255&a[l+2])<<8|255&a[l+1])<<8|255&a[l+0]}function Q(a,l){return new e(a[l]<<24|a[l+1]<<16|a[l+2]<<8|a[l+3],a[l+4]<<24|a[l+5]<<16|a[l+6]<<8|a[l+7])}function G(a,l,u){var f;for(f=0;f<4;f++)a[l+f]=255&u,u>>>=8}function fe(a,l,u){a[l]=u.hi>>24&255,a[l+1]=u.hi>>16&255,a[l+2]=u.hi>>8&255,a[l+3]=255&u.hi,a[l+4]=u.lo>>24&255,a[l+5]=u.lo>>16&255,a[l+6]=u.lo>>8&255,a[l+7]=255&u.lo}function de(a,l,u,f,m){var _,k=0;for(_=0;_<m;_++)k|=a[l+_]^u[f+_];return(1&k-1>>>8)-1}function Fe(a,l,u,f){return de(a,l,u,f,16)}function rt(a,l,u,f){return de(a,l,u,f,32)}function St(a,l,u,f,m){var C,D,V,_=new Uint32Array(16),k=new Uint32Array(16),M=new Uint32Array(16),x=new Uint32Array(4);for(C=0;C<4;C++)k[5*C]=N(f,4*C),k[1+C]=N(u,4*C),k[6+C]=N(l,4*C),k[11+C]=N(u,16+4*C);for(C=0;C<16;C++)M[C]=k[C];for(C=0;C<20;C++){for(D=0;D<4;D++){for(V=0;V<4;V++)x[V]=k[(5*D+4*V)%16];for(x[1]^=j(x[0]+x[3]|0,7),x[2]^=j(x[1]+x[0]|0,9),x[3]^=j(x[2]+x[1]|0,13),x[0]^=j(x[3]+x[2]|0,18),V=0;V<4;V++)_[4*D+(D+V)%4]=x[V]}for(V=0;V<16;V++)k[V]=_[V]}if(m){for(C=0;C<16;C++)k[C]=k[C]+M[C]|0;for(C=0;C<4;C++)k[5*C]=k[5*C]-N(f,4*C)|0,k[6+C]=k[6+C]-N(l,4*C)|0;for(C=0;C<4;C++)G(a,4*C,k[5*C]),G(a,16+4*C,k[6+C])}else for(C=0;C<16;C++)G(a,4*C,k[C]+M[C]|0)}function br(a,l,u,f){return St(a,l,u,f,!1),0}function at(a,l,u,f){return St(a,l,u,f,!0),0}var Be=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);function Et(a,l,u,f,m,_,k){var C,D,M=new Uint8Array(16),x=new Uint8Array(64);if(!m)return 0;for(D=0;D<16;D++)M[D]=0;for(D=0;D<8;D++)M[D]=_[D];for(;m>=64;){for(br(x,M,k,Be),D=0;D<64;D++)a[l+D]=(u?u[f+D]:0)^x[D];for(C=1,D=8;D<16;D++)M[D]=255&(C=C+(255&M[D])|0),C>>>=8;m-=64,l+=64,u&&(f+=64)}if(m>0)for(br(x,M,k,Be),D=0;D<m;D++)a[l+D]=(u?u[f+D]:0)^x[D];return 0}function _r(a,l,u,f,m){return Et(a,l,null,0,u,f,m)}function Pt(a,l,u,f,m){var _=new Uint8Array(32);return at(_,f,m,Be),_r(a,l,u,f.subarray(16),_)}function Vt(a,l,u,f,m,_,k){var M=new Uint8Array(32);return at(M,_,k,Be),Et(a,l,u,f,m,_.subarray(16),M)}function st(a,l){var u,f=0;for(u=0;u<17;u++)a[u]=255&(f=f+(a[u]+l[u]|0)|0),f>>>=8}var Eo=new Uint32Array([5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,252]);function Yr(a,l,u,f,m,_){var k,M,x,C,D=new Uint32Array(17),V=new Uint32Array(17),ce=new Uint32Array(17),Ge=new Uint32Array(17),jt=new Uint32Array(17);for(x=0;x<17;x++)V[x]=ce[x]=0;for(x=0;x<16;x++)V[x]=_[x];for(V[3]&=15,V[4]&=252,V[7]&=15,V[8]&=252,V[11]&=15,V[12]&=252,V[15]&=15;m>0;){for(x=0;x<17;x++)Ge[x]=0;for(x=0;x<16&&x<m;++x)Ge[x]=u[f+x];for(Ge[x]=1,f+=x,m-=x,st(ce,Ge),M=0;M<17;M++)for(D[M]=0,x=0;x<17;x++)D[M]=0|D[M]+ce[x]*(x<=M?V[M-x]:320*V[M+17-x]|0);for(M=0;M<17;M++)ce[M]=D[M];for(C=0,x=0;x<16;x++)ce[x]=255&(C=C+ce[x]|0),C>>>=8;for(ce[16]=3&(C=C+ce[16]|0),C=5*(C>>>2)|0,x=0;x<16;x++)ce[x]=255&(C=C+ce[x]|0),C>>>=8;ce[16]=C=C+ce[16]|0}for(x=0;x<17;x++)jt[x]=ce[x];for(st(ce,Eo),k=0|-(ce[16]>>>7),x=0;x<17;x++)ce[x]^=k&(jt[x]^ce[x]);for(x=0;x<16;x++)Ge[x]=_[x+16];for(Ge[16]=0,st(ce,Ge),x=0;x<16;x++)a[l+x]=ce[x];return 0}function Qs(a,l,u,f,m,_){var k=new Uint8Array(16);return Yr(k,0,u,f,m,_),Fe(a,l,k,0)}function Xr(a,l,u,f,m){var _;if(u<32)return-1;for(Vt(a,0,l,0,u,f,m),Yr(a,16,a,32,u-32,a),_=0;_<16;_++)a[_]=0;return 0}function Qr(a,l,u,f,m){var _,k=new Uint8Array(32);if(u<32||(Pt(k,0,32,f,m),0!==Qs(l,16,l,32,u-32,k)))return-1;for(Vt(a,0,l,0,u,f,m),_=0;_<32;_++)a[_]=0;return 0}function We(a,l){var u;for(u=0;u<16;u++)a[u]=0|l[u]}function Wt(a){var l,u;for(u=0;u<16;u++)a[u]+=65536,l=Math.floor(a[u]/65536),a[(u+1)*(u<15?1:0)]+=l-1+37*(l-1)*(15===u?1:0),a[u]-=65536*l}function Ct(a,l,u){for(var f,m=~(u-1),_=0;_<16;_++)a[_]^=f=m&(a[_]^l[_]),l[_]^=f}function Ot(a,l){var u,f,m,_=t(),k=t();for(u=0;u<16;u++)k[u]=l[u];for(Wt(k),Wt(k),Wt(k),f=0;f<2;f++){for(_[0]=k[0]-65517,u=1;u<15;u++)_[u]=k[u]-65535-(_[u-1]>>16&1),_[u-1]&=65535;_[15]=k[15]-32767-(_[14]>>16&1),m=_[15]>>16&1,_[14]&=65535,Ct(k,_,1-m)}for(u=0;u<16;u++)a[2*u]=255&k[u],a[2*u+1]=k[u]>>8}function en(a,l){var u=new Uint8Array(32),f=new Uint8Array(32);return Ot(u,a),Ot(f,l),rt(u,0,f,0)}function tn(a){var l=new Uint8Array(32);return Ot(l,a),1&l[0]}function es(a,l){var u;for(u=0;u<16;u++)a[u]=l[2*u]+(l[2*u+1]<<8);a[15]&=32767}function De(a,l,u){var f;for(f=0;f<16;f++)a[f]=l[f]+u[f]|0}function He(a,l,u){var f;for(f=0;f<16;f++)a[f]=l[f]-u[f]|0}function K(a,l,u){var f,m,_=new Float64Array(31);for(f=0;f<31;f++)_[f]=0;for(f=0;f<16;f++)for(m=0;m<16;m++)_[f+m]+=l[f]*u[m];for(f=0;f<15;f++)_[f]+=38*_[f+16];for(f=0;f<16;f++)a[f]=_[f];Wt(a),Wt(a)}function Re(a,l){K(a,l,l)}function rn(a,l){var f,u=t();for(f=0;f<16;f++)u[f]=l[f];for(f=253;f>=0;f--)Re(u,u),2!==f&&4!==f&&K(u,u,l);for(f=0;f<16;f++)a[f]=u[f]}function sn(a,l){var f,u=t();for(f=0;f<16;f++)u[f]=l[f];for(f=250;f>=0;f--)Re(u,u),1!==f&&K(u,u,l);for(f=0;f<16;f++)a[f]=u[f]}function gr(a,l,u){var _,k,f=new Uint8Array(32),m=new Float64Array(80),M=t(),x=t(),C=t(),D=t(),V=t(),ce=t();for(k=0;k<31;k++)f[k]=l[k];for(f[31]=127&l[31]|64,f[0]&=248,es(m,u),k=0;k<16;k++)x[k]=m[k],D[k]=M[k]=C[k]=0;for(M[0]=D[0]=1,k=254;k>=0;--k)Ct(M,x,_=f[k>>>3]>>>(7&k)&1),Ct(C,D,_),De(V,M,C),He(M,M,C),De(C,x,D),He(x,x,D),Re(D,V),Re(ce,M),K(M,C,M),K(C,x,V),De(V,M,C),He(M,M,C),Re(x,M),He(C,D,ce),K(M,C,d),De(M,M,D),K(C,C,M),K(M,D,ce),K(D,x,m),Re(x,V),Ct(M,x,_),Ct(C,D,_);for(k=0;k<16;k++)m[k+16]=M[k],m[k+32]=C[k],m[k+48]=x[k],m[k+64]=D[k];var Ge=m.subarray(32),jt=m.subarray(16);return rn(Ge,Ge),K(jt,jt,Ge),Ot(a,jt),0}function yr(a,l){return gr(a,l,i)}function nn(a,l){return r(l,32),yr(a,l)}function xr(a,l,u){var f=new Uint8Array(32);return gr(f,u,l),at(a,n,f,Be)}var on=Xr,Po=Qr;function Yt(){var _,k,M,a=0,l=0,u=0,f=0,m=65535;for(M=0;M<arguments.length;M++)a+=(_=arguments[M].lo)&m,l+=_>>>16,u+=(k=arguments[M].hi)&m,f+=k>>>16;return new e((u+=(l+=a>>>16)>>>16)&m|(f+=u>>>16)<<16,a&m|l<<16)}function an(a,l){return new e(a.hi>>>l,a.lo>>>l|a.hi<<32-l)}function wr(){var u,a=0,l=0;for(u=0;u<arguments.length;u++)a^=arguments[u].lo,l^=arguments[u].hi;return new e(l,a)}function Je(a,l){var u,f,m=32-l;return l<32?(u=a.hi>>>l|a.lo<<m,f=a.lo>>>l|a.hi<<m):l<64&&(u=a.lo>>>l|a.hi<<m,f=a.hi>>>l|a.lo<<m),new e(u,f)}function ko(a,l,u){return new e(a.hi&l.hi^~a.hi&u.hi,a.lo&l.lo^~a.lo&u.lo)}function Ao(a,l,u){return new e(a.hi&l.hi^a.hi&u.hi^l.hi&u.hi,a.lo&l.lo^a.lo&u.lo^l.lo&u.lo)}function jo(a){return wr(Je(a,28),Je(a,34),Je(a,39))}function Io(a){return wr(Je(a,14),Je(a,18),Je(a,41))}function Mo(a){return wr(Je(a,1),Je(a,8),an(a,7))}function To(a){return wr(Je(a,19),Je(a,61),an(a,6))}var No=[new e(1116352408,3609767458),new e(1899447441,602891725),new e(3049323471,3964484399),new e(3921009573,2173295548),new e(961987163,4081628472),new e(1508970993,3053834265),new e(2453635748,2937671579),new e(2870763221,3664609560),new e(3624381080,2734883394),new e(310598401,1164996542),new e(607225278,1323610764),new e(1426881987,3590304994),new e(1925078388,4068182383),new e(2162078206,991336113),new e(2614888103,633803317),new e(3248222580,3479774868),new e(3835390401,2666613458),new e(4022224774,944711139),new e(264347078,2341262773),new e(604807628,2007800933),new e(770255983,1495990901),new e(1249150122,1856431235),new e(1555081692,3175218132),new e(1996064986,2198950837),new e(2554220882,3999719339),new e(2821834349,766784016),new e(2952996808,2566594879),new e(3210313671,3203337956),new e(3336571891,1034457026),new e(3584528711,2466948901),new e(113926993,3758326383),new e(338241895,168717936),new e(666307205,1188179964),new e(773529912,1546045734),new e(1294757372,1522805485),new e(1396182291,2643833823),new e(1695183700,2343527390),new e(1986661051,1014477480),new e(2177026350,1206759142),new e(2456956037,344077627),new e(2730485921,1290863460),new e(2820302411,3158454273),new e(3259730800,3505952657),new e(3345764771,106217008),new e(3516065817,3606008344),new e(3600352804,1432725776),new e(4094571909,1467031594),new e(275423344,851169720),new e(430227734,3100823752),new e(506948616,1363258195),new e(659060556,3750685593),new e(883997877,3785050280),new e(958139571,3318307427),new e(1322822218,3812723403),new e(1537002063,2003034995),new e(1747873779,3602036899),new e(1955562222,1575990012),new e(2024104815,1125592928),new e(2227730452,2716904306),new e(2361852424,442776044),new e(2428436474,593698344),new e(2756734187,3733110249),new e(3204031479,2999351573),new e(3329325298,3815920427),new e(3391569614,3928383900),new e(3515267271,566280711),new e(3940187606,3454069534),new e(4118630271,4000239992),new e(116418474,1914138554),new e(174292421,2731055270),new e(289380356,3203993006),new e(460393269,320620315),new e(685471733,587496836),new e(852142971,1086792851),new e(1017036298,365543100),new e(1126000580,2618297676),new e(1288033470,3409855158),new e(1501505948,4234509866),new e(1607167915,987167468),new e(1816402316,1246189591)];function cn(a,l,u){var M,x,C,f=[],m=[],_=[],k=[];for(x=0;x<8;x++)f[x]=_[x]=Q(a,8*x);for(var D=0;u>=128;){for(x=0;x<16;x++)k[x]=Q(l,8*x+D);for(x=0;x<80;x++){for(C=0;C<8;C++)m[C]=_[C];for(M=Yt(_[7],Io(_[4]),ko(_[4],_[5],_[6]),No[x],k[x%16]),m[7]=Yt(M,jo(_[0]),Ao(_[0],_[1],_[2])),m[3]=Yt(m[3],M),C=0;C<8;C++)_[(C+1)%8]=m[C];if(x%16==15)for(C=0;C<16;C++)k[C]=Yt(k[C],k[(C+9)%16],Mo(k[(C+1)%16]),To(k[(C+14)%16]))}for(x=0;x<8;x++)_[x]=Yt(_[x],f[x]),f[x]=_[x];D+=128,u-=128}for(x=0;x<8;x++)fe(a,8*x,f[x]);return u}var Ro=new Uint8Array([106,9,230,103,243,188,201,8,187,103,174,133,132,202,167,59,60,110,243,114,254,148,248,43,165,79,245,58,95,29,54,241,81,14,82,127,173,230,130,209,155,5,104,140,43,62,108,31,31,131,217,171,251,65,189,107,91,224,205,25,19,126,33,121]);function ct(a,l,u){var _,f=new Uint8Array(64),m=new Uint8Array(256),k=u;for(_=0;_<64;_++)f[_]=Ro[_];for(cn(f,l,u),u%=128,_=0;_<256;_++)m[_]=0;for(_=0;_<u;_++)m[_]=l[k-u+_];for(m[u]=128,m[(u=256-128*(u<112?1:0))-9]=0,fe(m,u-8,new e(k/536870912|0,k<<3)),cn(f,m,u),_=0;_<64;_++)a[_]=f[_];return 0}function vr(a,l){var u=t(),f=t(),m=t(),_=t(),k=t(),M=t(),x=t(),C=t(),D=t();He(u,a[1],a[0]),He(D,l[1],l[0]),K(u,u,D),De(f,a[0],a[1]),De(D,l[0],l[1]),K(f,f,D),K(m,a[3],l[3]),K(m,m,g),K(_,a[2],l[2]),De(_,_,_),He(k,f,u),He(M,_,m),De(x,_,m),De(C,f,u),K(a[0],k,M),K(a[1],C,x),K(a[2],x,M),K(a[3],k,C)}function un(a,l,u){var f;for(f=0;f<4;f++)Ct(a[f],l[f],u)}function ts(a,l){var u=t(),f=t(),m=t();rn(m,l[2]),K(u,l[0],m),K(f,l[1],m),Ot(a,f),a[31]^=tn(u)<<7}function rs(a,l,u){var f,m;for(We(a[0],o),We(a[1],c),We(a[2],c),We(a[3],o),m=255;m>=0;--m)un(a,l,f=u[m/8|0]>>(7&m)&1),vr(l,a),vr(a,a),un(a,l,f)}function Sr(a,l){var u=[t(),t(),t(),t()];We(u[0],b),We(u[1],S),We(u[2],c),K(u[3],b,S),rs(a,u,l)}function ss(a,l,u){var _,f=new Uint8Array(64),m=[t(),t(),t(),t()];for(u||r(l,32),ct(f,l,32),f[0]&=248,f[31]&=127,f[31]|=64,Sr(m,f),ts(a,m),_=0;_<32;_++)l[_+32]=a[_];return 0}var a,Er=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function ns(a,l){var u,f,m,_;for(f=63;f>=32;--f){for(u=0,m=f-32,_=f-12;m<_;++m)l[m]+=u-16*l[f]*Er[m-(f-32)],u=Math.floor((l[m]+128)/256),l[m]-=256*u;l[m]+=u,l[f]=0}for(u=0,m=0;m<32;m++)l[m]+=u-(l[31]>>4)*Er[m],u=l[m]>>8,l[m]&=255;for(m=0;m<32;m++)l[m]-=u*Er[m];for(f=0;f<32;f++)l[f+1]+=l[f]>>8,a[f]=255&l[f]}function is(a){var u,l=new Float64Array(64);for(u=0;u<64;u++)l[u]=a[u];for(u=0;u<64;u++)a[u]=0;ns(a,l)}function ln(a,l,u,f){var M,x,m=new Uint8Array(64),_=new Uint8Array(64),k=new Uint8Array(64),C=new Float64Array(64),D=[t(),t(),t(),t()];ct(m,f,32),m[0]&=248,m[31]&=127,m[31]|=64;var V=u+64;for(M=0;M<u;M++)a[64+M]=l[M];for(M=0;M<32;M++)a[32+M]=m[32+M];for(ct(k,a.subarray(32),u+32),is(k),Sr(D,k),ts(a,D),M=32;M<64;M++)a[M]=f[M];for(ct(_,a,u+64),is(_),M=0;M<64;M++)C[M]=0;for(M=0;M<32;M++)C[M]=k[M];for(M=0;M<32;M++)for(x=0;x<32;x++)C[M+x]+=_[M]*m[x];return ns(a.subarray(32),C),V}function os(a,l,u,f){var m,_=new Uint8Array(32),k=new Uint8Array(64),M=[t(),t(),t(),t()],x=[t(),t(),t(),t()];if(u<64||function $o(a,l){var u=t(),f=t(),m=t(),_=t(),k=t(),M=t(),x=t();return We(a[2],c),es(a[1],l),Re(m,a[1]),K(_,m,p),He(m,m,a[2]),De(_,a[2],_),Re(k,_),Re(M,k),K(x,M,k),K(u,x,m),K(u,u,_),sn(u,u),K(u,u,m),K(u,u,_),K(u,u,_),K(a[0],u,_),Re(f,a[0]),K(f,f,_),en(f,m)&&K(a[0],a[0],P),Re(f,a[0]),K(f,f,_),en(f,m)?-1:(tn(a[0])===l[31]>>7&&He(a[0],o,a[0]),K(a[3],a[0],a[1]),0)}(x,f))return-1;for(m=0;m<u;m++)a[m]=l[m];for(m=0;m<32;m++)a[m+32]=f[m];if(ct(k,a,u),is(k),rs(M,x,k),Sr(x,l.subarray(32)),vr(M,x),ts(_,M),u-=64,rt(l,0,_,0)){for(m=0;m<u;m++)a[m]=0;return-1}for(m=0;m<u;m++)a[m]=l[m+64];return u}function fn(a,l){if(32!==a.length)throw new Error("bad key size");if(24!==l.length)throw new Error("bad nonce size")}function Ae(){for(var a=0;a<arguments.length;a++)if(!(arguments[a]instanceof Uint8Array))throw new TypeError("unexpected type, use Uint8Array")}function dn(a){for(var l=0;l<a.length;l++)a[l]=0}s.lowlevel={crypto_core_hsalsa20:at,crypto_stream_xor:Vt,crypto_stream:Pt,crypto_stream_salsa20_xor:Et,crypto_stream_salsa20:_r,crypto_onetimeauth:Yr,crypto_onetimeauth_verify:Qs,crypto_verify_16:Fe,crypto_verify_32:rt,crypto_secretbox:Xr,crypto_secretbox_open:Qr,crypto_scalarmult:gr,crypto_scalarmult_base:yr,crypto_box_beforenm:xr,crypto_box_afternm:on,crypto_box:function Co(a,l,u,f,m,_){var k=new Uint8Array(32);return xr(k,m,_),on(a,l,u,f,k)},crypto_box_open:function Oo(a,l,u,f,m,_){var k=new Uint8Array(32);return xr(k,m,_),Po(a,l,u,f,k)},crypto_box_keypair:nn,crypto_hash:ct,crypto_sign:ln,crypto_sign_keypair:ss,crypto_sign_open:os,crypto_secretbox_KEYBYTES:32,crypto_secretbox_NONCEBYTES:24,crypto_secretbox_ZEROBYTES:32,crypto_secretbox_BOXZEROBYTES:16,crypto_scalarmult_BYTES:32,crypto_scalarmult_SCALARBYTES:32,crypto_box_PUBLICKEYBYTES:32,crypto_box_SECRETKEYBYTES:32,crypto_box_BEFORENMBYTES:32,crypto_box_NONCEBYTES:24,crypto_box_ZEROBYTES:32,crypto_box_BOXZEROBYTES:16,crypto_sign_BYTES:64,crypto_sign_PUBLICKEYBYTES:32,crypto_sign_SECRETKEYBYTES:64,crypto_sign_SEEDBYTES:32,crypto_hash_BYTES:64,gf:t,D:p,L:Er,pack25519:Ot,unpack25519:es,M:K,A:De,S:Re,Z:He,pow2523:sn,add:vr,set25519:We,modL:ns,scalarmult:rs,scalarbase:Sr},s.randomBytes=function(a){var l=new Uint8Array(a);return r(l,a),l},s.secretbox=function(a,l,u){Ae(a,l,u),fn(u,l);for(var f=new Uint8Array(32+a.length),m=new Uint8Array(f.length),_=0;_<a.length;_++)f[_+32]=a[_];return Xr(m,f,f.length,l,u),m.subarray(16)},s.secretbox.open=function(a,l,u){Ae(a,l,u),fn(u,l);for(var f=new Uint8Array(16+a.length),m=new Uint8Array(f.length),_=0;_<a.length;_++)f[_+16]=a[_];return f.length<32||0!==Qr(m,f,f.length,l,u)?null:m.subarray(32)},s.secretbox.keyLength=32,s.secretbox.nonceLength=24,s.secretbox.overheadLength=16,s.scalarMult=function(a,l){if(Ae(a,l),32!==a.length)throw new Error("bad n size");if(32!==l.length)throw new Error("bad p size");var u=new Uint8Array(32);return gr(u,a,l),u},s.scalarMult.base=function(a){if(Ae(a),32!==a.length)throw new Error("bad n size");var l=new Uint8Array(32);return yr(l,a),l},s.scalarMult.scalarLength=32,s.scalarMult.groupElementLength=32,s.box=function(a,l,u,f){var m=s.box.before(u,f);return s.secretbox(a,l,m)},s.box.before=function(a,l){Ae(a,l),function qo(a,l){if(32!==a.length)throw new Error("bad public key size");if(32!==l.length)throw new Error("bad secret key size")}(a,l);var u=new Uint8Array(32);return xr(u,a,l),u},s.box.after=s.secretbox,s.box.open=function(a,l,u,f){var m=s.box.before(u,f);return s.secretbox.open(a,l,m)},s.box.open.after=s.secretbox.open,s.box.keyPair=function(){var a=new Uint8Array(32),l=new Uint8Array(32);return nn(a,l),{publicKey:a,secretKey:l}},s.box.keyPair.fromSecretKey=function(a){if(Ae(a),32!==a.length)throw new Error("bad secret key size");var l=new Uint8Array(32);return yr(l,a),{publicKey:l,secretKey:new Uint8Array(a)}},s.box.publicKeyLength=32,s.box.secretKeyLength=32,s.box.sharedKeyLength=32,s.box.nonceLength=24,s.box.overheadLength=s.secretbox.overheadLength,s.sign=function(a,l){if(Ae(a,l),64!==l.length)throw new Error("bad secret key size");var u=new Uint8Array(64+a.length);return ln(u,a,a.length,l),u},s.sign.open=function(a,l){if(Ae(a,l),32!==l.length)throw new Error("bad public key size");var u=new Uint8Array(a.length),f=os(u,a,a.length,l);if(f<0)return null;for(var m=new Uint8Array(f),_=0;_<m.length;_++)m[_]=u[_];return m},s.sign.detached=function(a,l){for(var u=s.sign(a,l),f=new Uint8Array(64),m=0;m<f.length;m++)f[m]=u[m];return f},s.sign.detached.verify=function(a,l,u){if(Ae(a,l,u),64!==l.length)throw new Error("bad signature size");if(32!==u.length)throw new Error("bad public key size");var _,f=new Uint8Array(64+a.length),m=new Uint8Array(64+a.length);for(_=0;_<64;_++)f[_]=l[_];for(_=0;_<a.length;_++)f[_+64]=a[_];return os(m,f,f.length,u)>=0},s.sign.keyPair=function(){var a=new Uint8Array(32),l=new Uint8Array(64);return ss(a,l),{publicKey:a,secretKey:l}},s.sign.keyPair.fromSecretKey=function(a){if(Ae(a),64!==a.length)throw new Error("bad secret key size");for(var l=new Uint8Array(32),u=0;u<l.length;u++)l[u]=a[32+u];return{publicKey:l,secretKey:new Uint8Array(a)}},s.sign.keyPair.fromSeed=function(a){if(Ae(a),32!==a.length)throw new Error("bad seed size");for(var l=new Uint8Array(32),u=new Uint8Array(64),f=0;f<32;f++)u[f]=a[f];return ss(l,u,!0),{publicKey:l,secretKey:u}},s.sign.publicKeyLength=32,s.sign.secretKeyLength=64,s.sign.seedLength=32,s.sign.signatureLength=64,s.hash=function(a){Ae(a);var l=new Uint8Array(64);return ct(l,a,a.length),l},s.hash.hashLength=64,s.verify=function(a,l){return Ae(a,l),0!==a.length&&0!==l.length&&a.length===l.length&&0===de(a,0,l,0,a.length)},s.setPRNG=function(a){r=a},(a=typeof globalThis<"u"?globalThis.crypto||globalThis.msCrypto:null)&&a.getRandomValues?s.setPRNG(function(u,f){var m,_=new Uint8Array(f);for(m=0;m<f;m+=65536)a.getRandomValues(_.subarray(m,m+Math.min(f-m,65536)));for(m=0;m<f;m++)u[m]=_[m];dn(_)}):typeof require<"u"&&(a=require("crypto"))&&a.randomBytes&&s.setPRNG(function(u,f){var m,_=a.randomBytes(f);for(m=0;m<f;m++)u[m]=_[m];dn(_)})}(typeof module<"u"&&module.exports?module.exports:globalThis.nacl=globalThis.nacl||{});const ir=typeof module<"u"&&module.exports?module.exports:globalThis.nacl,Ln={fromSeed:ir.sign.keyPair.fromSeed,sign:ir.sign.detached,verify:ir.sign.detached.verify,randomBytes:ir.randomBytes};let xs;new Uint16Array([0,4129,8258,12387,16516,20645,24774,28903,33032,37161,41290,45419,49548,53677,57806,61935,4657,528,12915,8786,21173,17044,29431,25302,37689,33560,45947,41818,54205,50076,62463,58334,9314,13379,1056,5121,25830,29895,17572,21637,42346,46411,34088,38153,58862,62927,50604,54669,13907,9842,5649,1584,30423,26358,22165,18100,46939,42874,38681,34616,63455,59390,55197,51132,18628,22757,26758,30887,2112,6241,10242,14371,51660,55789,59790,63919,35144,39273,43274,47403,23285,19156,31415,27286,6769,2640,14899,10770,56317,52188,64447,60318,39801,35672,47931,43802,27814,31879,19684,23749,11298,15363,3168,7233,60846,64911,52716,56781,44330,48395,36200,40265,32407,28342,24277,20212,15891,11826,7761,3696,65439,61374,57309,53244,48923,44858,40793,36728,37256,33193,45514,41451,53516,49453,61774,57711,4224,161,12482,8419,20484,16421,28742,24679,33721,37784,41979,46042,49981,54044,58239,62302,689,4752,8947,13010,16949,21012,25207,29270,46570,42443,38312,34185,62830,58703,54572,50445,13538,9411,5280,1153,29798,25671,21540,17413,42971,47098,34713,38840,59231,63358,50973,55100,9939,14066,1681,5808,26199,30326,17941,22068,55628,51565,63758,59695,39368,35305,47498,43435,22596,18533,30726,26663,6336,2273,14466,10403,52093,56156,60223,64286,35833,39896,43963,48026,19061,23124,27191,31254,2801,6864,10931,14994,64814,60687,56684,52557,48554,44427,40424,36297,31782,27655,23652,19525,15522,11395,7392,3265,61215,65342,53085,57212,44955,49082,36825,40952,28183,32310,20053,24180,11923,16050,3793,7920]),Error,function Un(s){xs=s}(Ln);function si(s){const e=`${U}:${xe()}`;if((s=s||{servers:[e]}).servers=s.servers||[],"string"==typeof s.servers&&(s.servers=[s.servers]),s.servers.length>0&&s.port)throw new B("port and servers options are mutually exclusive",L.InvalidOption);0===s.servers.length&&s.port&&(s.servers=[`${U}:${s.port}`]),s.servers&&0===s.servers.length&&(s.servers=[e]);const t=A({maxPingOut:2,maxReconnectAttempts:10,noRandomize:!1,pedantic:!1,pingInterval:12e4,reconnect:!0,reconnectJitter:100,reconnectJitterTLS:1e3,reconnectTimeWait:2e3,tls:void 0,verbose:!1,waitOnFirstConnect:!1,ignoreAuthErrorAbort:!1},s);if(t.authenticator=function ri(s){const e=[];return"function"==typeof s.authenticator&&e.push(s.authenticator),Array.isArray(s.authenticator)&&e.push(...s.authenticator),s.token&&e.push(function Yn(s){return()=>({auth_token:"function"==typeof s?s():s})}(s.token)),s.user&&e.push(function Wn(s,e){return()=>({user:"function"==typeof s?s():s,pass:"function"==typeof e?e():e})}(s.user,s.pass)),0===e.length?()=>{}:function Kn(s){return e=>{let t={};return s.forEach(r=>{const n=r(e)||{};t=Object.assign(t,n)}),t}}(e)}(t),["reconnectDelayHandler","authenticator"].forEach(r=>{if(t[r]&&"function"!=typeof t[r])throw new B(`${r} option should be a function`,L.NotFunction)}),t.reconnectDelayHandler||(t.reconnectDelayHandler=()=>{let r=t.tls?t.reconnectJitterTLS:t.reconnectJitter;return r&&(r++,r=Math.floor(Math.random()*r)),t.reconnectTimeWait+r}),t.inboxPrefix)try{v(t.inboxPrefix)}catch(r){throw new B(r.message,L.ApiError)}if(t.resolve&&"function"!=typeof hs())throw new B("'resolve' is not supported on this client",L.InvalidOption);return t}const oi=/^INFO\s+([^\r\n]+)\r\n/i,ai=je("PONG\r\n"),Cs=je("PING\r\n");class ci{echo;no_responders;protocol;verbose;pedantic;jwt;nkey;sig;user;pass;auth_token;tls_required;name;lang;version;headers;constructor(e,t,r){this.protocol=1,this.version=e.version,this.lang=e.lang,this.echo=!t.noEcho&&void 0,this.verbose=t.verbose,this.pedantic=t.pedantic,this.tls_required=!!t.tls||void 0,this.name=t.name,A(this,(t&&"function"==typeof t.authenticator?t.authenticator(r):{})||{})}}class Os extends me{sid;queue;draining;max;subject;drained;protocol;timer;info;cleanupFn;closed;requestSubject;constructor(e,t,r={}){super(),A(this,r),this.protocol=e,this.subject=t,this.draining=!1,this.noIterator="function"==typeof r.callback,this.closed=I(),r.timeout&&(this.timer=$(r.timeout),this.timer.then(()=>{this.timer=void 0}).catch(n=>{this.stop(n),this.noIterator&&this.callback(n,{})})),this.noIterator||this.iterClosed.then(()=>{this.closed.resolve(),this.unsubscribe()})}setPrePostHandlers(e){if(this.noIterator){const t=this.callback,r=e.ingestionFilterFn?e.ingestionFilterFn:()=>({ingest:!0,protocol:!1}),n=e.protocolFilterFn?e.protocolFilterFn:()=>!0,i=e.dispatchedFn?e.dispatchedFn:()=>{};this.callback=(o,c)=>{const{ingest:d}=r(c);d&&n(c)&&(t(o,c),i(c))}}else this.protocolFilterFn=e.protocolFilterFn,this.dispatchedFn=e.dispatchedFn}callback(e,t){this.cancelTimeout(),e?this.stop(e):this.push(t)}close(){if(!this.isClosed()){this.cancelTimeout();const e=()=>{if(this.stop(),this.cleanupFn)try{this.cleanupFn(this,this.info)}catch{}this.closed.resolve()};this.noIterator?e():this.push(e)}}unsubscribe(e){this.protocol.unsubscribe(this,e)}cancelTimeout(){this.timer&&(this.timer.cancel(),this.timer=void 0)}drain(){return this.protocol.isClosed()?Promise.reject(B.errorForCode(L.ConnectionClosed)):this.isClosed()?Promise.reject(B.errorForCode(L.SubClosed)):(this.drained||(this.draining=!0,this.protocol.unsub(this),this.drained=this.protocol.flush(I()).then(()=>{this.protocol.subscriptions.cancel(this)}).catch(()=>{this.protocol.subscriptions.cancel(this)})),this.drained)}isDraining(){return this.draining}isClosed(){return this.done}getSubject(){return this.subject}getMax(){return this.max}getID(){return this.sid}}class ui{mux;subs;sidCounter;constructor(){this.sidCounter=0,this.mux=null,this.subs=new Map}size(){return this.subs.size}add(e){return this.sidCounter++,e.sid=this.sidCounter,this.subs.set(e.sid,e),e}setMux(e){return this.mux=e,e}getMux(){return this.mux}get(e){return this.subs.get(e)}resub(e){return this.sidCounter++,this.subs.delete(e.sid),e.sid=this.sidCounter,this.subs.set(e.sid,e),e}all(){return Array.from(this.subs.values())}cancel(e){e&&(e.close(),this.subs.delete(e.sid))}handleError(e){if(e&&e.permissionContext){const t=e.permissionContext,r=this.all();let n;if("subscription"===t.operation&&(n=r.find(i=>i.subject===t.subject)),"publish"===t.operation&&(n=r.find(i=>i.requestSubject===t.subject)),n)return n.callback(e,{}),n.close(),this.subs.delete(n.sid),n!==this.mux}return!1}close(){this.subs.forEach(e=>{e.close()})}}class cr{connected;connectedOnce;infoReceived;info;muxSubscriptions;options;outbound;pongs;subscriptions;transport;noMorePublishing;connectError;publisher;_closed;closed;listeners;heartbeats;parser;outMsgs;inMsgs;outBytes;inBytes;pendingLimit;lastError;abortReconnect;servers;server;features;connectPromise;constructor(e,t){this._closed=!1,this.connected=!1,this.connectedOnce=!1,this.infoReceived=!1,this.noMorePublishing=!1,this.abortReconnect=!1,this.listeners=[],this.pendingLimit=32768,this.outMsgs=0,this.inMsgs=0,this.outBytes=0,this.inBytes=0,this.options=e,this.publisher=t,this.subscriptions=new ui,this.muxSubscriptions=new In,this.outbound=new oe,this.pongs=[],this.pendingLimit=e.pendingLimit||this.pendingLimit,this.features=new $n({major:0,minor:0,micro:0}),this.connectPromise=null,this.servers=new An("string"==typeof e.servers?[e.servers]:e.servers,{randomize:!e.noRandomize}),this.closed=I(),this.parser=new ys(this),this.heartbeats=new Mn(this,this.options.pingInterval||12e4,this.options.maxPingOut||2)}resetOutbound(){this.outbound.reset();const e=this.pongs;this.pongs=[];const t=B.errorForCode(L.Disconnect);t.stack="",e.forEach(r=>{r.reject(t)}),this.parser=new ys(this),this.infoReceived=!1}dispatchStatus(e){this.listeners.forEach(t=>{t.push(e)})}status(){const e=new me;return this.listeners.push(e),e}prepare(){var e=this;this.transport&&this.transport.discard(),this.info=void 0,this.resetOutbound();const t=I();return t.catch(()=>{}),this.pongs.unshift(t),this.connectError=r=>{t.reject(r)},this.transport=function _t(){if(!ie||"function"!=typeof ie.factory)throw new Error("transport fn is not set");return ie.factory()}(),this.transport.closed().then(function(){var r=(0,O.Z)(function*(n){e.connected=!1,e.isClosed()||(yield e.disconnected(e.transport.closeError||e.lastError))});return function(n){return r.apply(this,arguments)}}()),t}disconnect(){this.dispatchStatus({type:Xe.StaleConnection,data:""}),this.transport.disconnect()}disconnected(e){var t=this;return(0,O.Z)(function*(){t.dispatchStatus({type:Ie.Disconnect,data:t.servers.getCurrentServer().toString()}),t.options.reconnect?yield t.dialLoop().then(()=>{t.dispatchStatus({type:Ie.Reconnect,data:t.servers.getCurrentServer().toString()}),t.lastError?.code===L.AuthenticationExpired&&(t.lastError=void 0)}).catch(r=>{t._close(r)}):yield t._close(e)})()}dial(e){var t=this;return(0,O.Z)(function*(){const r=t.prepare();let n;try{n=$(t.options.timeout||2e4);const i=t.transport.connect(e,t.options);yield Promise.race([i,n]),(0,O.Z)(function*(){try{var d,o=!1,c=!1;try{for(var g,p=(0,z.Z)(t.transport);o=!(g=yield p.next()).done;o=!1)t.parser.parse(g.value)}catch(b){c=!0,d=b}finally{try{o&&null!=p.return&&(yield p.return())}finally{if(c)throw d}}}catch(b){console.log("reader closed",b)}})().then()}catch(i){r.reject(i)}try{yield Promise.race([n,r]),n&&n.cancel(),t.connected=!0,t.connectError=void 0,t.sendSubscriptions(),t.connectedOnce=!0,t.server.didConnect=!0,t.server.reconnects=0,t.flushPending(),t.heartbeats.start()}catch(i){throw n&&n.cancel(),yield t.transport.close(i),i}})()}_doDial(e){var t=this;return(0,O.Z)(function*(){const r=yield e.resolve({fn:hs(),debug:t.options.debug,randomize:!t.options.noRandomize});let n=null;for(const i of r)try{return n=null,t.dispatchStatus({type:Xe.Reconnecting,data:i.toString()}),void(yield t.dial(i))}catch(o){n=o}throw n})()}dialLoop(){return null===this.connectPromise&&(this.connectPromise=this.dodialLoop(),this.connectPromise.then(()=>{}).catch(()=>{}).finally(()=>{this.connectPromise=null})),this.connectPromise}dodialLoop(){var e=this;return(0,O.Z)(function*(){let t;for(;;){e._closed&&e.servers.clear();const r=e.options.reconnectDelayHandler?e.options.reconnectDelayHandler():2e3;let n=r;const i=e.selectServer();if(!i||e.abortReconnect)throw t||(e.lastError?e.lastError:B.errorForCode(L.ConnectionRefused));const o=Date.now();if(0===i.lastConnect||i.lastConnect+r<=o){i.lastConnect=Date.now();try{yield e._doDial(i);break}catch(c){if(t=c,!e.connectedOnce){if(e.options.waitOnFirstConnect)continue;e.servers.removeCurrentServer()}i.reconnects++;const d=e.options.maxReconnectAttempts||0;-1!==d&&i.reconnects>=d&&e.servers.removeCurrentServer()}}else n=Math.min(n,i.lastConnect+r-o),yield T(n)}})()}static connect(e,t){return(0,O.Z)(function*(){const r=new cr(e,t);return yield r.dialLoop(),r})()}static toError(e){const t=e?e.toLowerCase():"";if(-1!==t.indexOf("permissions violation")){const r=new B(e,L.PermissionsViolation),n=e.match(/(Publish|Subscription) to "(\S+)"/);return n&&(r.permissionContext={operation:n[1].toLowerCase(),subject:n[2]}),r}return-1!==t.indexOf("authorization violation")?new B(e,L.AuthorizationViolation):-1!==t.indexOf("user authentication expired")?new B(e,L.AuthenticationExpired):-1!==t.indexOf("authentication timeout")?new B(e,L.AuthenticationTimeout):new B(e,L.ProtocolError)}processMsg(e,t){if(this.inMsgs++,this.inBytes+=t.length,!this.subscriptions.sidCounter)return;const r=this.subscriptions.get(e.sid);r&&(r.received+=1,r.callback&&r.callback(null,new bs(e,t,this)),void 0!==r.max&&r.received>=r.max&&r.unsubscribe())}processError(e){const t=ht(e),r=cr.toError(t),n={type:Ie.Error,data:r.code};if(r.isPermissionError()){let i=!1;r.permissionContext&&(n.permissionContext=r.permissionContext,i=this.subscriptions.getMux()?.subject===r.permissionContext.subject),this.subscriptions.handleError(r),this.muxSubscriptions.handleError(i,r),i&&this.subscriptions.setMux(null)}this.dispatchStatus(n),this.handleError(r)}handleError(e){e.isAuthError()?this.handleAuthError(e):(e.isProtocolError()||e.isAuthTimeout())&&(this.lastError=e),e.isPermissionError()||(this.lastError=e)}handleAuthError(e){this.lastError&&e.code===this.lastError.code&&!1===this.options.ignoreAuthErrorAbort&&(this.abortReconnect=!0),this.connectError?this.connectError(e):this.disconnect()}processPing(){this.transport.send(ai)}processPong(){const e=this.pongs.shift();e&&e.resolve()}processInfo(e){const t=JSON.parse(ht(e));this.info=t;const r=this.options&&this.options.ignoreClusterUpdates?void 0:this.servers.update(t);if(!this.infoReceived){this.features.update(ot(t.version)),this.infoReceived=!0,this.transport.isEncrypted()&&this.servers.updateTLSName();const{version:i,lang:o}=this.transport;try{const c=new ci({version:i,lang:o},this.options,t.nonce);t.headers&&(c.headers=!0,c.no_responders=!0);const d=JSON.stringify(c);this.transport.send(je(`CONNECT ${d}\r\n`)),this.transport.send(Cs)}catch(c){this._close(c)}}r&&this.dispatchStatus({type:Ie.Update,data:r}),void 0!==t.ldm&&t.ldm&&this.dispatchStatus({type:Ie.LDM,data:this.servers.getCurrentServer().toString()})}push(e){switch(e.kind){case we.MSG:{const{msg:t,data:r}=e;this.processMsg(t,r);break}case we.OK:break;case we.ERR:this.processError(e.data);break;case we.PING:this.processPing();break;case we.PONG:this.processPong();break;case we.INFO:this.processInfo(e.data)}}sendCommand(e,...t){const r=this.outbound.length();let n;n="string"==typeof e?je(e):e,this.outbound.fill(n,...t),0===r?queueMicrotask(()=>{this.flushPending()}):this.outbound.size()>=this.pendingLimit&&this.flushPending()}publish(e,t=se,r){let n;if(t instanceof Uint8Array)n=t;else{if("string"!=typeof t)throw B.errorForCode(L.BadPayload);n=ye.encode(t)}let i=n.length;(r=r||{}).reply=r.reply||"";let d,o=se,c=0;if(r.headers){if(this.info&&!this.info.headers)throw new B("headers",L.ServerOptionNotAvailable);o=r.headers.encode(),c=o.length,i=n.length+c}if(this.info&&i>this.info.max_payload)throw B.errorForCode(L.MaxPayloadExceeded);this.outBytes+=i,this.outMsgs++,r.headers?(d=r.reply?`HPUB ${e} ${r.reply} ${c} ${i}\r\n`:`HPUB ${e} ${c} ${i}\r\n`,this.sendCommand(d,o,n,sr)):(d=r.reply?`PUB ${e} ${r.reply} ${i}\r\n`:`PUB ${e} ${i}\r\n`,this.sendCommand(d,n,sr))}request(e){return this.initMux(),this.muxSubscriptions.add(e),e}subscribe(e){return this.subscriptions.add(e),this._subunsub(e),e}_sub(e){this.sendCommand(e.queue?`SUB ${e.subject} ${e.queue} ${e.sid}\r\n`:`SUB ${e.subject} ${e.sid}\r\n`)}_subunsub(e){return this._sub(e),e.max&&this.unsubscribe(e,e.max),e}unsubscribe(e,t){this.unsub(e,t),(void 0===e.max||e.received>=e.max)&&this.subscriptions.cancel(e)}unsub(e,t){!e||this.isClosed()||(this.sendCommand(t?`UNSUB ${e.sid} ${t}\r\n`:`UNSUB ${e.sid}\r\n`),e.max=t)}resub(e,t){!e||this.isClosed()||(e.subject=t,this.subscriptions.resub(e),this._sub(e))}flush(e){return e||(e=I()),this.pongs.push(e),this.outbound.fill(Cs),this.flushPending(),e}sendSubscriptions(){const e=[];this.subscriptions.all().forEach(t=>{e.push(t.queue?`SUB ${t.subject} ${t.queue} ${t.sid}\r\n`:`SUB ${t.subject} ${t.sid}\r\n`)}),e.length&&this.transport.send(je(e.join("")))}_close(e){var t=this;return(0,O.Z)(function*(){t._closed||(t.heartbeats.cancel(),t.connectError&&(t.connectError(e),t.connectError=void 0),t.muxSubscriptions.close(),t.subscriptions.close(),t.listeners.forEach(r=>{r.stop()}),t._closed=!0,yield t.transport.close(e),yield t.closed.resolve(e))})()}close(){return this._close()}isClosed(){return this._closed}drain(){var e=this;const t=this.subscriptions.all(),r=[];return t.forEach(n=>{r.push(n.drain())}),Promise.all(r).then((0,O.Z)(function*(){return e.noMorePublishing=!0,yield e.flush(),e.close()})).catch(()=>{})}flushPending(){if(this.infoReceived&&this.connected&&this.outbound.size()){const e=this.outbound.drain();this.transport.send(e)}}initMux(){if(!this.subscriptions.getMux()){const t=this.muxSubscriptions.init(this.options.inboxPrefix),r=new Os(this,`${t}*`);r.callback=this.muxSubscriptions.dispatcher(),this.subscriptions.setMux(r),this.subscribe(r)}}selectServer(){const e=this.servers.selectServer();if(void 0!==e)return this.server=e,this.server}getServer(){return this.server}}class ks{token;received;ctx;requestSubject;mux;constructor(e,t){this.mux=e,this.requestSubject=t,this.received=0,this.token=qe.next(),this.ctx=new Error}}class li extends ks{callback;done;timer;max;opts;constructor(e,t,r={maxWait:1e3}){if(super(e,t),this.opts=r,"function"!=typeof this.opts.callback)throw new Error("callback is required");this.callback=this.opts.callback,this.max="number"==typeof r.maxMessages&&r.maxMessages>0?r.maxMessages:-1,this.done=I(),this.done.then(()=>{this.callback(null,null)}),this.timer=setTimeout(()=>{this.cancel()},r.maxWait)}cancel(e){e&&this.callback(e,null),clearTimeout(this.timer),this.mux.cancel(this),this.done.resolve()}resolver(e,t){e?(e.stack+=`\n\n${this.ctx.stack}`,this.cancel(e)):(this.callback(null,t),this.opts.strategy===Ce.Count&&(this.max--,0===this.max&&this.cancel()),this.opts.strategy===Ce.JitterTimer&&(clearTimeout(this.timer),this.timer=setTimeout(()=>{this.cancel()},this.opts.jitter||300)),this.opts.strategy===Ce.SentinelMsg&&t&&0===t.data.length&&this.cancel())}}class As extends ks{deferred;timer;constructor(e,t,r={timeout:1e3}){super(e,t),this.deferred=I(),this.timer=$(r.timeout)}resolver(e,t){this.timer&&this.timer.cancel(),e?(e.stack+=`\n\n${this.ctx.stack}`,this.deferred.reject(e)):this.deferred.resolve(t),this.cancel()}cancel(e){this.timer&&this.timer.cancel(),this.mux.cancel(this),this.deferred.reject(e||B.errorForCode(L.Cancelled))}}function yt(s){return Nr("durable",s)}function ve(s){return Nr("stream",s)}function Nr(s,e=""){if(""===e)throw Error(`${s} name required`);return[".","*",">","/","\\"," ","\t","\n","\r"].forEach(r=>{if(-1!==e.indexOf(r)){switch(r){case"\n":r="\\n";break;case"\r":r="\\r";break;case"\t":r="\\t"}throw Error(`invalid ${s} name - ${s} name cannot contain '${r}'`)}}),""}function Lt(s,e=""){if(""===e)throw Error(`${s} name required`);const t=function hi(s=""){if(""===s)throw Error("name required");const e=/^[-\w]+$/g;if(null===s.match(e))for(const r of s.split(""))if(null===r.match(e))return`cannot contain '${r}'`;return""}(e);if(t.length)throw new Error(`invalid ${s} name - ${s} name ${t}`)}function ae(s){return 1e6*s}function Rr(s){return Math.floor(s/1e6)}function $r(s){if(s.data.length>0)return!1;const e=s.headers;return!!e&&e.code>=100&&e.code<200}function Lr(s){return $r(s)&&"Idle Heartbeat"===s.headers?.description}function xt(s){if(0!==s.data.length)return null;const e=s.headers;return e?js(e.code,e.description):null}var Te=function(s){return s.MaxBatchExceeded="exceeded maxrequestbatch of",s.MaxExpiresExceeded="exceeded maxrequestexpires of",s.MaxBytesExceeded="exceeded maxrequestmaxbytes of",s.MaxMessageSizeExceeded="message size exceeds maxbytes",s.PushConsumer="consumer is push based",s.MaxWaitingExceeded="exceeded maxwaiting",s.IdleHeartbeatMissed="idle heartbeats missed",s.ConsumerDeleted="consumer deleted",s}(Te||{});let di=!1;function js(s,e=""){if(s<300)return null;switch(e=e.toLowerCase(),s){case 404:return new B(e,L.JetStream404NoMessages);case 408:return new B(e,L.JetStream408RequestTimeout);case 409:{const t=e.startsWith(Te.IdleHeartbeatMissed)?L.JetStreamIdleHeartBeat:L.JetStream409;return new B(e,t)}case 503:return B.errorForCode(L.JetStreamNotEnabled,new Error(e));default:return""===e&&(e=L.Unknown),new B(e,`${s}`)}}class Ut{nc;opts;prefix;timeout;jc;constructor(e,t){this.nc=e,this.opts=function bi(s){return(s=s||{}).domain&&(s.apiPrefix=`$JS.${s.domain}.API`,delete s.domain),A({apiPrefix:"$JS.API",timeout:5e3},s)}(t),this._parseOpts(),this.prefix=this.opts.apiPrefix,this.timeout=this.opts.timeout,this.jc=ke()}getOptions(){return Object.assign({},this.opts)}_parseOpts(){let e=this.opts.apiPrefix;if(!e||0===e.length)throw new Error("invalid empty prefix");"."===e[e.length-1]&&(e=e.substr(0,e.length-1)),this.opts.apiPrefix=e}_request(e,t=null,r){var n=this;return(0,O.Z)(function*(){(r=r||{}).timeout=n.timeout;let i=se;t&&(i=n.jc.encode(t));const o=yield n.nc.request(e,i,r);return n.parseJsResponse(o)})()}findStream(e){var t=this;return(0,O.Z)(function*(){const r={subject:e},i=yield t._request(`${t.prefix}.STREAM.NAMES`,r);if(!i.streams||1!==i.streams.length)throw new Error("no stream matches subject");return i.streams[0]})()}getConnection(){return this.nc}parseJsResponse(e){const t=this.jc.decode(e.data),r=t;if(r.error){const n=js(r.error.code,r.error.description);if(null!==n)throw n.api_error=r.error,n}return t}}class _i{static encode(e){if("string"==typeof e)return btoa(e);const t=Array.from(e);return btoa(String.fromCharCode(...t))}static decode(e,t=!1){const r=atob(e);return t?Uint8Array.from(r,n=>n.charCodeAt(0)):r}}class qt{static encode(e){return qt.toB64URLEncoding(_i.encode(e))}static decode(e,t=!1){return qt.decode(qt.fromB64URLEncoding(e),t)}static toB64URLEncoding(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}static fromB64URLEncoding(e){return e.replace(/_/g,"/").replace(/-/g,"+")}}var Is=function(s){return s.Limits="limits",s.Interest="interest",s.Workqueue="workqueue",s}(Is||{}),ur=function(s){return s.Old="old",s.New="new",s}(ur||{}),Ms=function(s){return s.File="file",s.Memory="memory",s}(Ms||{}),he=function(s){return s.All="all",s.Last="last",s.New="new",s.StartSequence="by_start_sequence",s.StartTime="by_start_time",s.LastPerSubject="last_per_subject",s}(he||{}),pe=function(s){return s.None="none",s.All="all",s.Explicit="explicit",s.NotSet="",s}(pe||{}),Ft=function(s){return s.Instant="instant",s.Original="original",s}(Ft||{}),Ur=function(s){return s.CreateOrUpdate="",s.Update="update",s.Create="create",s}(Ur||{}),Se=function(s){return s.StreamSourceHdr="Nats-Stream-Source",s.LastConsumerSeqHdr="Nats-Last-Consumer",s.LastStreamSeqHdr="Nats-Last-Stream",s.ConsumerStalledHdr="Nats-Consumer-Stalled",s.MessageSizeHdr="Nats-Msg-Size",s.RollupHdr="Nats-Rollup",s.RollupValueSubject="sub",s.RollupValueAll="all",s.PendingMessagesHdr="Nats-Pending-Messages",s.PendingBytesHdr="Nats-Pending-Bytes",s}(Se||{}),Ze=function(s){return s.LastValue="",s.AllHistory="history",s.UpdatesOnly="updates",s}(Ze||{}),Bt=function(s){return s.Stream="Nats-Stream",s.Sequence="Nats-Sequence",s.TimeStamp="Nats-Time-Stamp",s.Subject="Nats-Subject",s}(Bt||{});const Ne="KV_";class vi{config;ordered;mack;stream;callbackFn;max;qname;isBind;filters;constructor(e){this.stream="",this.mack=!1,this.ordered=!1,this.config=function yi(s,e={}){return Object.assign({name:s,deliver_policy:he.All,ack_policy:pe.Explicit,ack_wait:ae(3e4),replay_policy:Ft.Instant},e)}("",e||{})}getOpts(){const e={};if(e.config=Object.assign({},this.config),e.config.filter_subject&&(this.filterSubject(e.config.filter_subject),e.config.filter_subject=void 0),e.config.filter_subjects&&(e.config.filter_subjects?.forEach(t=>{this.filterSubject(t)}),e.config.filter_subjects=void 0),e.mack=this.mack,e.stream=this.stream,e.callbackFn=this.callbackFn,e.max=this.max,e.queue=this.qname,e.ordered=this.ordered,e.config.ack_policy=e.ordered?pe.None:e.config.ack_policy,e.isBind=e.isBind||!1,this.filters)switch(this.filters.length){case 0:break;case 1:e.config.filter_subject=this.filters[0];break;default:e.config.filter_subjects=this.filters}return e}description(e){return this.config.description=e,this}deliverTo(e){return this.config.deliver_subject=e,this}durable(e){return yt(e),this.config.durable_name=e,this}startSequence(e){if(e<=0)throw new Error("sequence must be greater than 0");return this.config.deliver_policy=he.StartSequence,this.config.opt_start_seq=e,this}startTime(e){return this.config.deliver_policy=he.StartTime,this.config.opt_start_time=e.toISOString(),this}deliverAll(){return this.config.deliver_policy=he.All,this}deliverLastPerSubject(){return this.config.deliver_policy=he.LastPerSubject,this}deliverLast(){return this.config.deliver_policy=he.Last,this}deliverNew(){return this.config.deliver_policy=he.New,this}startAtTimeDelta(e){return this.startTime(new Date(Date.now()-e)),this}headersOnly(){return this.config.headers_only=!0,this}ackNone(){return this.config.ack_policy=pe.None,this}ackAll(){return this.config.ack_policy=pe.All,this}ackExplicit(){return this.config.ack_policy=pe.Explicit,this}ackWait(e){return this.config.ack_wait=ae(e),this}maxDeliver(e){return this.config.max_deliver=e,this}filterSubject(e){return this.filters=this.filters||[],this.filters.push(e),this}replayInstantly(){return this.config.replay_policy=Ft.Instant,this}replayOriginal(){return this.config.replay_policy=Ft.Original,this}sample(e){if((e=Math.trunc(e))<0||e>100)throw new Error("value must be between 0-100");return this.config.sample_freq=`${e}%`,this}limit(e){return this.config.rate_limit_bps=e,this}maxWaiting(e){return this.config.max_waiting=e,this}maxAckPending(e){return this.config.max_ack_pending=e,this}idleHeartbeat(e){return this.config.idle_heartbeat=ae(e),this}flowControl(){return this.config.flow_control=!0,this}deliverGroup(e){return this.queue(e),this}manualAck(){return this.mack=!0,this}maxMessages(e){return this.max=e,this}callback(e){return this.callbackFn=e,this}queue(e){return this.qname=e,this.config.deliver_group=e,this}orderedConsumer(){return this.ordered=!0,this}bind(e,t){return this.stream=e,this.config.durable_name=t,this.isBind=!0,this}bindStream(e){return this.stream=e,this}inactiveEphemeralThreshold(e){return this.config.inactive_threshold=ae(e),this}maxPullBatch(e){return this.config.max_batch=e,this}maxPullRequestExpires(e){return this.config.max_expires=ae(e),this}memory(){return this.config.mem_storage=!0,this}numReplicas(e){return this.config.num_replicas=e,this}}function tt(s){return new vi(s)}function Ts(s){return"function"==typeof s.getOpts}function Ns(s){const e=s.length;let t=s.indexOf("=");return-1===t&&(t=e),[t,t===e?0:4-t%4]}const Rs=[],$s=[],qr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";for(let s=0,e=64;s<e;++s)Rs[s]=qr[s],$s[qr.charCodeAt(s)]=s;const{toUint8Array:Ei,fromUint8Array:Pi}=function Si(s,e,t=!1){function r(o,c){return Math.floor(3*(o+c)/4-c)}function n(o){return s[o>>18&63]+s[o>>12&63]+s[o>>6&63]+s[63&o]}function i(o,c,d){const p=new Array((d-c)/3);for(let g=c,b=0;g<d;g+=3)p[b++]=n((o[g]<<16)+(o[g+1]<<8)+o[g+2]);return p.join("")}return{byteLength:o=>r.apply(null,Ns(o)),toUint8Array(o){const[c,d]=Ns(o),p=new Uint8Array(r(c,d)),g=d?c-4:c;let b,P,S=0;for(P=0;P<g;P+=4)b=e[o.charCodeAt(P)]<<18|e[o.charCodeAt(P+1)]<<12|e[o.charCodeAt(P+2)]<<6|e[o.charCodeAt(P+3)],p[S++]=b>>16&255,p[S++]=b>>8&255,p[S++]=255&b;return 2===d?(b=e[o.charCodeAt(P)]<<2|e[o.charCodeAt(P+1)]>>4,p[S++]=255&b):1===d&&(b=e[o.charCodeAt(P)]<<10|e[o.charCodeAt(P+1)]<<4|e[o.charCodeAt(P+2)]>>2,p[S++]=b>>8&255,p[S++]=255&b),p},fromUint8Array(o){const d=o.length,p=d%3,g=d-p,b=new Array(Math.ceil(g/16383)+(p?1:0));let P,j,S=0;for(let N=0;N<g;N+=16383)P=N+16383,b[S++]=i(o,N,P>g?g:P);return 1===p?(j=o[g],b[S]=s[j>>2]+s[j<<4&63],t||(b[S]+="==")):2===p&&(j=o[g]<<8|255&o[g+1],b[S]=s[j>>10]+s[j>>4&63]+s[j<<2&63],t||(b[S]+="=")),b.join("")}}}(Rs,$s,!0),Ci=new TextDecoder,Oi=new TextEncoder;class Ls{hashSize=32;_buf;_bufIdx;_count;_K;_H;_finalized;constructor(){this._buf=new Uint8Array(64),this._K=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),this.init()}init(){return this._H=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),this._bufIdx=0,this._count=new Uint32Array(2),this._buf.fill(0),this._finalized=!1,this}update(e,t){if(null===e)throw new TypeError("msg must be a string or Uint8Array.");"string"==typeof e&&(e=function Ii(s,e="utf8"){if(/^utf-?8$/i.test(e))return Oi.encode(s);if(/^base64$/i.test(e))return Ei(s);if(/^hex(?:adecimal)?$/i.test(e))return function Ai(s){const e=s.length;if(e%2||!/^[0-9a-fA-F]+$/.test(s))throw new TypeError("Invalid hex string.");s=s.toLowerCase();const t=new Uint8Array(Math.floor(e/2)),r=e/2;for(let n=0;n<r;++n)t[n]=parseInt(s.substr(2*n,2),16);return t}(s);throw new TypeError("Unsupported string encoding.")}(e,t));for(let n=0,i=e.length;n<i;n++)this._buf[this._bufIdx++]=e[n],64===this._bufIdx&&(this._transform(),this._bufIdx=0);const r=this._count;return(r[0]+=e.length<<3)<e.length<<3&&r[1]++,r[1]+=e.length>>>29,this}digest(e){if(this._finalized)throw new Error("digest has already been called.");this._finalized=!0;const t=this._buf;let r=this._bufIdx;for(t[r++]=128;56!==r;)64===r&&(this._transform(),r=0),t[r++]=0;const n=this._count;t[56]=n[1]>>>24&255,t[57]=n[1]>>>16&255,t[58]=n[1]>>>8&255,t[59]=n[1]>>>0&255,t[60]=n[0]>>>24&255,t[61]=n[0]>>>16&255,t[62]=n[0]>>>8&255,t[63]=n[0]>>>0&255,this._transform();const i=new Uint8Array(32);for(let o=0;o<8;o++)i[0+(o<<2)]=this._H[o]>>>24&255,i[1+(o<<2)]=this._H[o]>>>16&255,i[2+(o<<2)]=this._H[o]>>>8&255,i[3+(o<<2)]=this._H[o]>>>0&255;return this.init(),e?function ji(s,e="utf8"){if(/^utf-?8$/i.test(e))return Ci.decode(s);if(/^base64$/i.test(e))return Pi(s);if(/^hex(?:adecimal)?$/i.test(e))return function ki(s){return s.reduce((e,t)=>`${e}${t<16?"0":""}${t.toString(16)}`,"")}(s);throw new TypeError("Unsupported string encoding.")}(i,e):i}_transform(){const e=this._H;let t=e[0],r=e[1],n=e[2],i=e[3],o=e[4],c=e[5],d=e[6],p=e[7];const g=new Uint32Array(16);let b;for(b=0;b<16;b++)g[b]=this._buf[3+(b<<2)]|this._buf[2+(b<<2)]<<8|this._buf[1+(b<<2)]<<16|this._buf[b<<2]<<24;for(b=0;b<64;b++){let S;if(b<16)S=g[b];else{let P=g[b+1&15],j=g[b+14&15];S=g[15&b]=(P>>>7^P>>>18^P>>>3^P<<25^P<<14)+(j>>>17^j>>>19^j>>>10^j<<15^j<<13)+g[15&b]+g[b+9&15]|0}S=S+p+(o>>>6^o>>>11^o>>>25^o<<26^o<<21^o<<7)+(d^o&(c^d))+this._K[b]|0,p=d,d=c,c=o,o=i+S,i=n,n=r,r=t,t=S+(r&n^i&(r^n))+(r>>>2^r>>>13^r>>>22^r<<30^r<<19^r<<10)|0}e[0]=e[0]+t|0,e[1]=e[1]+r|0,e[2]=e[2]+n|0,e[3]=e[3]+i|0,e[4]=e[4]+o|0,e[5]=e[5]+c|0,e[6]=e[6]+d|0,e[7]=e[7]+p|0}}class Dt{err;offset;pageInfo;subject;jsm;filter;payload;constructor(e,t,r,n){if(!e)throw new Error("subject is required");this.subject=e,this.jsm=r,this.offset=0,this.pageInfo={},this.filter=t,this.payload=n||{}}next(){var e=this;return(0,O.Z)(function*(){if(e.err)return[];if(e.pageInfo&&e.offset>=e.pageInfo.total)return[];const t={offset:e.offset};e.payload&&Object.assign(t,e.payload);try{const r=yield e.jsm._request(e.subject,t,{timeout:e.jsm.timeout});return e.pageInfo=r,e.offset+=e.countResponse(r),e.filter(r)}catch(r){throw e.err=r,r}})()}countResponse(e){switch(e?.type){case"io.nats.jetstream.api.v1.stream_names_response":case"io.nats.jetstream.api.v1.stream_list_response":return e.streams.length;case"io.nats.jetstream.api.v1.consumer_list_response":return e.consumers.length;default:return console.error(`jslister.ts: unknown API response for paged output: ${e?.type}`),e.streams?.length||0}return 0}[Symbol.asyncIterator](){var e=this;return ge(function*(){let t=yield W(e.next());for(;t.length>0;){for(const r of t)yield r;t=yield W(e.next())}})()}}class Fr extends Ut{constructor(e,t){super(e,t)}add(e,t,r=Ur.Create){var n=this;return(0,O.Z)(function*(){if(ve(e),t.deliver_group&&t.flow_control)throw new Error("jetstream flow control is not supported with queue groups");if(t.deliver_group&&t.idle_heartbeat)throw new Error("jetstream idle heartbeat is not supported with queue groups");const i={};i.config=t,i.stream_name=e,i.action=r,i.config.durable_name&&yt(i.config.durable_name);const o=n.nc;let{min:c,ok:d}=o.features.get(X.JS_NEW_CONSUMER_CREATE_API);const p=""===t.name?void 0:t.name;if(p&&!d)throw new Error(`consumer 'name' requires server ${c}`);if(p)try{Nr("name",p)}catch(P){const j=P.message,N=j.indexOf("cannot contain");throw-1!==N?new Error(`consumer 'name' ${j.substring(N)}`):P}let g,b="";if(Array.isArray(t.filter_subjects)){const{min:P,ok:j}=o.features.get(X.JS_MULTIPLE_CONSUMER_FILTER);if(!j)throw new Error(`consumer 'filter_subjects' requires server ${P}`);d=!1}if(t.metadata){const{min:P,ok:j}=o.features.get(X.JS_STREAM_CONSUMER_METADATA);if(!j)throw new Error(`consumer 'metadata' requires server ${P}`)}if(d&&(b=t.name??t.durable_name??""),""!==b){let P=t.filter_subject??void 0;">"===P&&(P=void 0),g=void 0!==P?`${n.prefix}.CONSUMER.CREATE.${e}.${b}.${P}`:`${n.prefix}.CONSUMER.CREATE.${e}.${b}`}else g=t.durable_name?`${n.prefix}.CONSUMER.DURABLE.CREATE.${e}.${t.durable_name}`:`${n.prefix}.CONSUMER.CREATE.${e}`;return yield n._request(g,i)})()}update(e,t,r){var n=this;return(0,O.Z)(function*(){const i=yield n.info(e,t);return n.add(e,Object.assign(i.config,r),Ur.Update)})()}info(e,t){var r=this;return(0,O.Z)(function*(){return ve(e),yt(t),yield r._request(`${r.prefix}.CONSUMER.INFO.${e}.${t}`)})()}delete(e,t){var r=this;return(0,O.Z)(function*(){return ve(e),yt(t),(yield r._request(`${r.prefix}.CONSUMER.DELETE.${e}.${t}`)).success})()}list(e){return ve(e),new Dt(`${this.prefix}.CONSUMER.LIST.${e}`,n=>n.consumers,this)}}const Us=Uint8Array.of(43,65,67,75),Mi=Uint8Array.of(45,78,65,75),Ht=Uint8Array.of(43,87,80,73),Ti=Uint8Array.of(43,78,88,84),Ni=Uint8Array.of(43,84,69,82,77),Ri=Uint8Array.of(32);function Gt(s){return new Li(s)}class Li{msg;di;didAck;constructor(e){this.msg=e,this.didAck=!1}get subject(){return this.msg.subject}get sid(){return this.msg.sid}get data(){return this.msg.data}get headers(){return this.msg.headers}get info(){return this.di||(this.di=function $i(s){const e=s.split(".");if(9===e.length&&e.splice(2,0,"_",""),e.length<11||"$JS"!==e[0]||"ACK"!==e[1])throw new Error("not js message");const t={};return t.domain="_"===e[2]?"":e[2],t.account_hash=e[3],t.stream=e[4],t.consumer=e[5],t.redeliveryCount=parseInt(e[6],10),t.redelivered=t.redeliveryCount>1,t.streamSequence=parseInt(e[7],10),t.deliverySequence=parseInt(e[8],10),t.timestampNanos=parseInt(e[9],10),t.pending=parseInt(e[10],10),t}(this.reply)),this.di}get redelivered(){return this.info.redeliveryCount>1}get reply(){return this.msg.reply||""}get seq(){return this.info.streamSequence}doAck(e){this.didAck||(this.didAck=!this.isWIP(e),this.msg.respond(e))}isWIP(e){return 4===e.length&&e[0]===Ht[0]&&e[1]===Ht[1]&&e[2]===Ht[2]&&e[3]===Ht[3]}ackAck(){var e=this;return(0,O.Z)(function*(){if(!e.didAck&&(e.didAck=!0,e.msg.reply)){const r=e.msg.publisher,n=new As(r.muxSubscriptions,e.msg.reply);r.request(n);try{r.publish(e.msg.reply,Us,{reply:`${r.muxSubscriptions.baseInbox}${n.token}`})}catch(i){n.cancel(i)}try{return yield Promise.race([n.timer,n.deferred]),!0}catch(i){n.cancel(i)}}return!1})()}ack(){this.doAck(Us)}nak(e){let t=Mi;e&&(t=function jn(){return{encode:s=>ye.encode(s),decode:s=>le.decode(s)}}().encode(`-NAK ${JSON.stringify({delay:ae(e)})}`)),this.doAck(t)}working(){this.doAck(Ht)}next(e,t={batch:1}){const r={};r.batch=t.batch||1,r.no_wait=t.no_wait||!1,t.expires&&t.expires>0&&(r.expires=ae(t.expires));const n=ke().encode(r),i=oe.concat(Ti,Ri,n);this.msg.respond(i,e?{reply:e}:void 0)}term(){this.doAck(Ni)}json(){return this.msg.json()}string(){return this.msg.string()}}function wt(s,e,t=!1){if(!0===t&&!s)throw B.errorForCode(L.ApiError,new Error(`${e} is not a function`));if(s&&"function"!=typeof s)throw B.errorForCode(L.ApiError,new Error(`${e} is not a function`))}class Ui extends me{sub;adapter;subIterDone;constructor(e,t,r){var n;super(),n=this,wt(r.adapter,"adapter",!0),this.adapter=r.adapter,r.callback&&wt(r.callback,"callback"),this.noIterator="function"==typeof r.callback,r.ingestionFilterFn&&(wt(r.ingestionFilterFn,"ingestionFilterFn"),this.ingestionFilterFn=r.ingestionFilterFn),r.protocolFilterFn&&(wt(r.protocolFilterFn,"protocolFilterFn"),this.protocolFilterFn=r.protocolFilterFn),r.dispatchedFn&&(wt(r.dispatchedFn,"dispatchedFn"),this.dispatchedFn=r.dispatchedFn),r.cleanupFn&&wt(r.cleanupFn,"cleanupFn");let i=(g,b)=>{this.callback(g,b)};if(r.callback){const g=r.callback;i=(b,S)=>{const[P,j]=this.adapter(b,S);if(P)return void g(P,null);const{ingest:N}=this.ingestionFilterFn?this.ingestionFilterFn(j,this):{ingest:!0};N&&(!this.protocolFilterFn||this.protocolFilterFn(j))&&(g(P,j),this.dispatchedFn&&j&&this.dispatchedFn(j))}}const{max:o,queue:c,timeout:d}=r,p={queue:c,timeout:d,callback:i};var g;o&&o>0&&(p.max=o),this.sub=e.subscribe(t,p),r.cleanupFn&&(this.sub.cleanupFn=r.cleanupFn),this.noIterator||this.iterClosed.then(()=>{this.unsubscribe()}),this.subIterDone=I(),Promise.all([this.sub.closed,this.iterClosed]).then(()=>{this.subIterDone.resolve()}).catch(()=>{this.subIterDone.resolve()}),(g=(0,O.Z)(function*(b){yield b.closed,n.stop()}),function(b){return g.apply(this,arguments)})(this.sub).then().catch()}unsubscribe(e){this.sub.unsubscribe(e)}drain(){return this.sub.drain()}isDraining(){return this.sub.isDraining()}isClosed(){return this.sub.isClosed()}callback(e,t){this.sub.cancelTimeout();const[r,n]=this.adapter(e,t);r&&this.stop(r),n&&this.push(n)}getSubject(){return this.sub.getSubject()}getReceived(){return this.sub.getReceived()}getProcessed(){return this.sub.getProcessed()}getPending(){return this.sub.getPending()}getID(){return this.sub.getID()}getMax(){return this.sub.getMax()}get closed(){return this.sub.closed}}class Br{interval;maxOut;cancelAfter;timer;autoCancelTimer;last;missed;count;callback;constructor(e,t,r={maxOut:2}){this.interval=e,this.maxOut=r?.maxOut||2,this.cancelAfter=r?.cancelAfter||0,this.last=Date.now(),this.missed=0,this.count=0,this.callback=t,this._schedule()}cancel(){this.autoCancelTimer&&clearTimeout(this.autoCancelTimer),this.timer&&clearInterval(this.timer),this.timer=0,this.autoCancelTimer=0}work(){this.last=Date.now(),this.missed=0}_change(e,t=0,r=2){this.interval=e,this.maxOut=r,this.cancelAfter=t,this.restart()}restart(){this.cancel(),this._schedule()}_schedule(){this.cancelAfter>0&&(this.autoCancelTimer=setTimeout(()=>{this.cancel()},this.cancelAfter)),this.timer=setInterval(()=>{if(this.count++,Date.now()-this.last>this.interval&&this.missed++,this.missed>=this.maxOut)try{!0===this.callback(this.missed)&&this.cancel()}catch(e){console.log(e)}},this.interval)}}var Ve,Ke=function(s){return s[s.Unset=-1]="Unset",s[s.Consume=0]="Consume",s[s.Fetch=1]="Fetch",s}(Ke||{}),Dr=function(s){return s.HeartbeatsMissed="heartbeats_missed",s}(Dr||{}),lr=function(s){return s.DebugEvent="debug",s.Discard="discard",s.Next="next",s}(lr||{});class Hr extends me{consumer;opts;sub;monitor;pending;inbox;refilling;stack;pong;callback;timeout;cleanupHandler;listeners;statusIterator;constructor(e,t,r=!1){var n;super(),n=this,this.consumer=e,this.opts=this.parseOptions(t,r),this.callback=t.callback||null,this.noIterator="function"==typeof this.callback,this.monitor=null,this.pong=null,this.pending={msgs:0,bytes:0,requests:0},this.refilling=r,this.stack=(new Error).stack.split("\n").slice(1).join("\n"),this.timeout=null,this.inbox=v(e.api.nc.options.inboxPrefix),this.listeners=[];const{max_messages:i,max_bytes:o,idle_heartbeat:c,threshold_bytes:d,threshold_messages:p}=this.opts;this.closed().then(()=>{if(this.cleanupHandler)try{this.cleanupHandler()}catch{}});const{sub:g}=this;g&&g.unsubscribe(),this.sub=e.api.nc.subscribe(this.inbox,{callback:(b,S)=>{if(b)this.stop();else{if(this.monitor?.work(),S.subject===this.inbox){if(Lr(S))return;const j=S.headers?.code,N=S.headers?.description?.toLowerCase()||"unknown",{msgsLeft:Q,bytesLeft:G}=this.parseDiscard(S.headers);if(Q>0||G>0)this.pending.msgs-=Q,this.pending.bytes-=G,this.pending.requests--,this.notify(lr.Discard,{msgsLeft:Q,bytesLeft:G});else{const fe=()=>{const de=new B(N,`${j}`);return de.stack+=`\n\n${this.stack}`,de};if(400===j){const de=fe();this._push(()=>{this.stop(de)})}else if(409===j&&"consumer deleted"===N){const de=fe();this.stop(de)}else this.notify(lr.DebugEvent,`${j} ${N}`)}}else this._push(Gt(S)),this.received++,this.pending.msgs&&this.pending.msgs--,this.pending.bytes&&(this.pending.bytes-=S.size());if(0===this.pending.msgs&&0===this.pending.bytes&&(this.pending.requests=0),this.refilling){if(i&&this.pending.msgs<=p||o&&this.pending.bytes<=d){const j=this.pullOptions();this.pull(j)}}else 0===this.pending.requests&&this._push(()=>{this.stop()})}}}),this.sub.closed.then(()=>{this.sub.draining&&this._push(()=>{this.stop()})}),c&&(this.monitor=new Br(c,b=>(this.notify(Dr.HeartbeatsMissed,b),this.resetPending().then(()=>{}).catch(()=>{}),!1),{maxOut:2})),(0,O.Z)(function*(){const b=e.api.nc.status();n.statusIterator=b;var j,S=!1,P=!1;try{for(var Q,N=(0,z.Z)(b);S=!(Q=yield N.next()).done;S=!1)switch(Q.value.type){case Ie.Disconnect:n.monitor?.cancel();break;case Ie.Reconnect:n.resetPending().then(fe=>{fe&&n.monitor?.restart()}).catch(()=>{})}}catch(G){P=!0,j=G}finally{try{S&&null!=N.return&&(yield N.return())}finally{if(P)throw j}}})(),this.pull(this.pullOptions())}_push(e){if(this.callback){const t="function"==typeof e?e:null;try{t?t():this.callback(e)}catch(r){this.stop(r)}}else super.push(e)}notify(e,t){this.listeners.length>0&&this.listeners.forEach(r=>{r.done||r.push({type:e,data:t})})}resetPending(){return this.consumer.info().then(e=>(this.pending.msgs=0,this.pending.bytes=0,this.pending.requests=0,this.pull(this.pullOptions()),!0)).catch(e=>("consumer not found"===e.message&&this.stop(e),!1))}pull(e){this.pending.bytes+=e.max_bytes??0,this.pending.msgs+=e.batch??0,this.pending.requests++;const t=this.consumer.api.nc;this._push(()=>{t.publish(`${this.consumer.api.prefix}.CONSUMER.MSG.NEXT.${this.consumer.stream}.${this.consumer.name}`,this.consumer.api.jc.encode(e),{reply:this.inbox}),this.notify(lr.Next,e)})}pullOptions(){return{batch:this.opts.max_messages-this.pending.msgs,max_bytes:this.opts.max_bytes-this.pending.bytes,idle_heartbeat:ae(this.opts.idle_heartbeat),expires:ae(this.opts.expires)}}parseDiscard(e){const t={msgsLeft:0,bytesLeft:0},r=e?.get(Se.PendingMessagesHdr);r&&(t.msgsLeft=parseInt(r));const n=e?.get(Se.PendingBytesHdr);return n&&(t.bytesLeft=parseInt(n)),t}trackTimeout(e){this.timeout=e}close(){return this.stop(),this.iterClosed}closed(){return this.iterClosed}clearTimers(){this.monitor?.cancel(),this.monitor=null,this.timeout?.cancel(),this.timeout=null}setCleanupHandler(e){this.cleanupHandler=e}stop(e){this.sub?.unsubscribe(),this.clearTimers(),this.statusIterator?.stop(),this._push(()=>{super.stop(e),this.listeners.forEach(t=>{t.stop()})})}parseOptions(e,t=!1){const r=e||{};if(r.max_messages=r.max_messages||0,r.max_bytes=r.max_bytes||0,0!==r.max_messages&&0!==r.max_bytes)throw new Error("only specify one of max_messages or max_bytes");if(0===r.max_messages&&(r.max_messages=100),r.expires=r.expires||3e4,r.expires<1e3)throw new Error("expires should be at least 1000ms");if(r.idle_heartbeat=r.idle_heartbeat||r.expires/2,r.idle_heartbeat=r.idle_heartbeat>3e4?3e4:r.idle_heartbeat,t){const n=Math.round(.75*r.max_messages)||1;r.threshold_messages=r.threshold_messages||n;const i=Math.round(.75*r.max_bytes)||1;r.threshold_bytes=r.threshold_bytes||i}return r}status(){const e=new me;return this.listeners.push(e),Promise.resolve(e)}}class qs extends me{src;constructor(){super()}setSource(e){this.src&&(this.src.setCleanupHandler(),this.src.stop()),this.src=e,this.src.setCleanupHandler(()=>{this.close().catch()})}stop(e){this.src?.stop(e),super.stop(e)}close(){return this.stop(),this.iterClosed}status(){return Promise.reject(new Error("ordered consumers don't report consumer status"))}}class Fs{api;_info;stream;name;constructor(e,t){this.api=e,this._info=t,this.stream=t.stream_name,this.name=t.name}consume(e={max_messages:100,expires:3e4}){return Promise.resolve(new Hr(this,e,!0))}fetch(e={max_messages:100,expires:3e4}){const t=new Hr(this,e,!1),n=$(Math.round(1.05*t.opts.expires));return t.closed().then(()=>{n.cancel()}),n.catch(()=>{t.close().catch()}),t.trackTimeout(n),Promise.resolve(t)}next(e={expires:3e4}){const t=I(),r=e;r.max_messages=1;const n=new Hr(this,r,!1),i=Math.round(1.05*n.opts.expires);i>=6e4&&(0,O.Z)(function*(){var p,c=!1,d=!1;try{for(var b,g=(0,z.Z)(yield n.status());c=!(b=yield g.next()).done;c=!1){const S=b.value;if(S.type===Dr.HeartbeatsMissed&&S.data>=2){t.reject(new Error("consumer missed heartbeats"));break}}}catch(S){d=!0,p=S}finally{try{c&&null!=g.return&&(yield g.return())}finally{if(d)throw p}}})().catch(),(0,O.Z)(function*(){var p,c=!1,d=!1;try{for(var b,g=(0,z.Z)(n);c=!(b=yield g.next()).done;c=!1){t.resolve(b.value);break}}catch(S){d=!0,p=S}finally{try{c&&null!=g.return&&(yield g.return())}finally{if(d)throw p}}})().catch();const o=$(i);return n.closed().then(()=>{t.resolve(null),o.cancel()}).catch(c=>{t.reject(c)}),o.catch(c=>{t.resolve(null),n.close().catch()}),n.trackTimeout(o),t}delete(){const{stream_name:e,name:t}=this._info;return this.api.delete(e,t)}info(e=!1){if(e)return Promise.resolve(this._info);const{stream_name:t,name:r}=this._info;return this.api.info(t,r).then(n=>(this._info=n,this._info))}}class qi{api;consumerOpts;consumer;opts;cursor;stream;namePrefix;serial;currentConsumer;userCallback;iter;type;startSeq;constructor(e,t,r={}){this.api=e,this.stream=t,this.cursor={stream_seq:1,deliver_seq:0},this.namePrefix=qe.next(),this.serial=0,this.currentConsumer=null,this.userCallback=null,this.iter=null,this.type=Ke.Unset,this.consumerOpts=r,this.startSeq=this.consumerOpts.opt_start_seq||0,this.cursor.stream_seq=this.startSeq>0?this.startSeq-1:0}getConsumerOpts(e){this.serial++;const r={name:`${this.namePrefix}_${this.serial}`,deliver_policy:he.StartSequence,opt_start_seq:e=0===e?1:e,ack_policy:pe.None,inactive_threshold:ae(3e5),num_replicas:1};return!0===this.consumerOpts.headers_only&&(r.headers_only=!0),Array.isArray(this.consumerOpts.filterSubjects)&&(r.filter_subjects=this.consumerOpts.filterSubjects),"string"==typeof this.consumerOpts.filterSubjects&&(r.filter_subject=this.consumerOpts.filterSubjects),e===this.startSeq+1&&(r.deliver_policy=this.consumerOpts.deliver_policy||he.StartSequence,(this.consumerOpts.deliver_policy===he.LastPerSubject||this.consumerOpts.deliver_policy===he.New||this.consumerOpts.deliver_policy===he.Last)&&(delete r.opt_start_seq,r.deliver_policy=this.consumerOpts.deliver_policy),r.deliver_policy===he.LastPerSubject&&typeof r.filter_subjects>"u"&&typeof r.filter_subject>"u"&&(r.filter_subject=">"),this.consumerOpts.opt_start_time&&(delete r.opt_start_seq,r.deliver_policy=he.StartTime,r.opt_start_time=this.consumerOpts.opt_start_time),this.consumerOpts.inactive_threshold&&(r.inactive_threshold=ae(this.consumerOpts.inactive_threshold))),r}resetConsumer(e=0){var t=this;return(0,O.Z)(function*(){if(t.consumer)for(;;)try{yield t.delete();break}catch(i){if("TIMEOUT"!==i.message)throw i}e=0===e?1:e,t.cursor.deliver_seq=0;const r=t.getConsumerOpts(e);let n;for(r.max_deliver=1,r.mem_storage=!0;;)try{n=yield t.api.add(t.stream,r);break}catch(i){if("TIMEOUT"!==i.message)throw i}return n})()}internalHandler(e){return t=>{if(this.serial!==e)return;const r=t.info.deliverySequence;r===this.cursor.deliver_seq+1?(this.cursor.deliver_seq=r,this.cursor.stream_seq=t.info.streamSequence,this.userCallback?this.userCallback(t):this.iter?.push(t)):this.reset(this.opts)}}reset(e={max_messages:100,expires:3e4},t=!1){var r=this;return(0,O.Z)(function*(){r.currentConsumer=yield r.resetConsumer(r.cursor.stream_seq+1),null===r.iter&&(r.iter=new qs),r.consumer=new Fs(r.api,r.currentConsumer),e.callback=r.internalHandler(r.serial);let i=null;if(r.type===Ke.Fetch&&t)i=yield r.consumer.fetch(e);else{if(r.type!==Ke.Consume)return Promise.reject("reset called with unset consumer type");i=yield r.consumer.consume(e)}return r.iter.setSource(i),r.iter})()}consume(e={max_messages:100,expires:3e4}){if(this.type===Ke.Fetch)return Promise.reject(new Error("ordered consumer initialized as fetch"));if(this.type===Ke.Consume)return Promise.reject(new Error("ordered consumer doesn't support concurrent consume"));const{callback:t}=e;return t&&(this.userCallback=t),this.type=Ke.Consume,this.opts=e,this.reset(e)}fetch(e={max_messages:100,expires:3e4}){if(this.type===Ke.Consume)return Promise.reject(new Error("ordered consumer already initialized as consume"));if(!1===this.iter?.done)return Promise.reject(new Error("ordered consumer doesn't support concurrent fetch"));const{callback:t}=e;return t&&(this.userCallback=t),this.type=Ke.Fetch,this.opts=e,this.iter=new qs,this.reset(e,!0)}next(e={expires:3e4}){var t=this;return(0,O.Z)(function*(){const r=I(),n=e;return n.max_messages=1,n.callback=o=>{t.userCallback=null,r.resolve(o)},(yield t.fetch(n)).iterClosed.then(()=>{r.resolve(null)}).catch(o=>{r.reject(o)}),r})()}delete(){return this.currentConsumer?this.api.delete(this.stream,this.currentConsumer.name).then(e=>Promise.resolve(e)).catch(e=>Promise.reject(e)).finally(()=>{this.currentConsumer=null}):Promise.resolve(!1)}info(e){var t=this;return(0,O.Z)(function*(){return null==t.currentConsumer?(t.currentConsumer=yield t.resetConsumer(t.serial),Promise.resolve(t.currentConsumer)):e&&t.currentConsumer?Promise.resolve(t.currentConsumer):t.api.info(t.stream,t.currentConsumer.name)})()}}function hr(s){if(void 0===s)return;const{domain:e}=s;if(void 0===e)return s;const t=Object.assign({},s);if(delete t.domain,""===e)return t;if(t.external)throw new Error("domain and external are both set");return t.external={api:`$JS.${e}.API`},t}const Gr="OBJ_";class Bs{api;notified;constructor(e){this.api=e,this.notified=!1}checkVersion(){const e=this.api.nc.features.get(X.JS_SIMPLIFICATION);return e.ok?Promise.resolve():Promise.reject(new Error(`consumers framework is only supported on servers ${e.min} or better`))}get(e,t={}){var r=this;return(0,O.Z)(function*(){return"object"==typeof t?r.ordered(e,t):(yield r.checkVersion(),r.api.info(e,t).then(n=>void 0!==n.config.deliver_subject?Promise.reject(new Error("push consumer not supported")):new Fs(r.api,n)).catch(n=>Promise.reject(n)))})()}ordered(e,t){var r=this;return(0,O.Z)(function*(){yield r.checkVersion();const n=r.api;return new Jr(n.nc,n.opts).info(e).then(o=>Promise.resolve(new qi(r.api,e,t))).catch(o=>Promise.reject(o))})()}}class fr{api;_info;constructor(e,t){this.api=e,this._info=t}get name(){return this._info.config.name}alternates(){return this.info().then(e=>e.alternates?e.alternates:[])}best(){var e=this;return(0,O.Z)(function*(){if(yield e.info(),e._info.alternates){const t=yield e.api.info(e._info.alternates[0].name);return new fr(e.api,t)}return e})()}info(e=!1,t){return e?Promise.resolve(this._info):this.api.info(this.name,t).then(r=>(this._info=r,this._info))}getConsumer(e){return new Bs(new Fr(this.api.nc,this.api.opts)).get(this.name,e)}getMessage(e){return this.api.getMessage(this.name,e)}deleteMessage(e,t){return this.api.deleteMessage(this.name,e,t)}}const dr="KV-Operation",Bi=/^[-/=.\w]+$/,Di=/^[-/=.>*\w]+$/,Hi=/^[-\w]+$/;function Gi(s){if(s.startsWith(".")||s.endsWith(".")||!Bi.test(s))throw new Error(`invalid key: ${s}`)}function Zi(s){if(s.startsWith(".")||s.endsWith(".")||!Di.test(s))throw new Error(`invalid key: ${s}`)}function Ji(s){if(s.startsWith(".")||s.endsWith("."))throw new Error(`invalid key: ${s}`);const e=s.split(".");let t=!1;for(let r=0;r<e.length;r++)switch(e[r]){case"*":t=!0;break;case">":if(r!==e.length-1)throw new Error(`invalid key: ${s}`);t=!0}return t}function pr(s){if(!Hi.test(s))throw new Error(`invalid bucket name: ${s}`)}var s;(s=Ve||(Ve={})).MsgIdHdr="Nats-Msg-Id",s.ExpectedStreamHdr="Nats-Expected-Stream",s.ExpectedLastSeqHdr="Nats-Expected-Last-Sequence",s.ExpectedLastMsgIdHdr="Nats-Expected-Last-Msg-Id",s.ExpectedLastSubjectSequenceHdr="Nats-Expected-Last-Subject-Sequence";class Zt{js;jsm;stream;bucket;direct;codec;prefix;editPrefix;useJsPrefix;_prefixLen;constructor(e,t,r){pr(e),this.js=t,this.jsm=r,this.bucket=e,this.prefix="$KV",this.editPrefix="",this.useJsPrefix=!1,this._prefixLen=0}static create(e,t,r={}){return(0,O.Z)(function*(){pr(t);const n=yield e.jetstreamManager(),i=new Zt(t,e,n);return yield i.init(r),i})()}static bind(e,t,r={}){return(0,O.Z)(function*(){const n=yield e.jetstreamManager(),i=yield n.streams.info(`${Ne}${t}`);pr(i.config.name);const o=new Zt(t,e,n);return Object.assign(o,i),o.codec=r.codec||{key:{encode:s=>s,decode:s=>s},value:{encode:s=>s,decode:s=>s}},o.direct=i.config.allow_direct??!1,o.initializePrefixes(i),o})()}init(e={}){var t=this;return(0,O.Z)(function*(){const r=Object.assign(function Fi(){return{replicas:1,history:1,timeout:2e3,maxBucketSize:-1,maxValueSize:-1,codec:{key:{encode:s=>s,decode:s=>s},value:{encode:s=>s,decode:s=>s}},storage:Ms.File}}(),e);t.codec=r.codec;const n={};t.stream=n.name=e.streamName??t.bucketName(),n.retention=Is.Limits,n.max_msgs_per_subject=r.history,r.maxBucketSize&&(r.max_bytes=r.maxBucketSize),r.max_bytes&&(n.max_bytes=r.max_bytes),n.max_msg_size=r.maxValueSize,n.storage=r.storage;const i=e.placementCluster??"";if(i&&(e.placement={},e.placement.cluster=i,e.placement.tags=[]),e.placement&&(n.placement=e.placement),e.republish&&(n.republish=e.republish),e.description&&(n.description=e.description),e.mirror){const S=Object.assign({},e.mirror);S.name.startsWith(Ne)||(S.name=`${Ne}${S.name}`),n.mirror=S,n.mirror_direct=!0}else if(e.sources){const S=e.sources.map(P=>{const j=Object.assign({},P);j.name.startsWith(Ne)||(j.name=`${Ne}${j.name}`)});n.sources=S}else n.subjects=[t.subjectForBucket()];e.metadata&&(n.metadata=e.metadata);const o=t.js.nc,c=o.getServerVersion(),d=!!c&&Mr(c,ot("2.7.2"))>=0;n.discard=d?ur.New:ur.Old;const{ok:p,min:g}=o.features.get(X.JS_ALLOW_DIRECT);if(!p&&!0===e.allow_direct)return Promise.reject(new Error(`allow_direct is not available on server version ${c?`${c.major}.${c.minor}.${c.micro}`:"unknown"} - requires ${g}`));let b;e.allow_direct="boolean"==typeof e.allow_direct?e.allow_direct:p,n.allow_direct=e.allow_direct,t.direct=n.allow_direct,n.num_replicas=r.replicas,r.ttl&&(n.max_age=ae(r.ttl)),n.allow_rollup_hdrs=!0;try{b=yield t.jsm.streams.info(n.name),!b.config.allow_direct&&!0===t.direct&&(t.direct=!1)}catch(S){if("stream not found"!==S.message)throw S;b=yield t.jsm.streams.add(n)}t.initializePrefixes(b)})()}initializePrefixes(e){this._prefixLen=0,this.prefix=`$KV.${this.bucket}`,this.useJsPrefix="$JS.API"!==this.js.apiPrefix;const{mirror:t}=e.config;if(t){let r=t.name;if(r.startsWith(Ne)&&(r=r.substring(3)),t.external&&""!==t.external.api){const n=t.name.substring(3);this.useJsPrefix=!1,this.prefix=`$KV.${n}`,this.editPrefix=`${t.external.api}.$KV.${r}`}else this.editPrefix=this.prefix}}bucketName(){return this.stream??`${Ne}${this.bucket}`}subjectForBucket(){return`${this.prefix}.${this.bucket}.>`}subjectForKey(e,t=!1){const r=[];return t?(this.useJsPrefix&&r.push(this.js.apiPrefix),r.push(""!==this.editPrefix?this.editPrefix:this.prefix)):this.prefix&&r.push(this.prefix),r.push(e),r.join(".")}fullKeyName(e){return""!==this.prefix?`${this.prefix}.${e}`:`$KV.${this.bucket}.${e}`}get prefixLen(){return 0===this._prefixLen&&(this._prefixLen=this.prefix.length+1),this._prefixLen}encodeKey(e){const t=[];for(const r of e.split("."))switch(r){case">":case"*":t.push(r);break;default:t.push(this.codec.key.encode(r))}return t.join(".")}decodeKey(e){const t=[];for(const r of e.split("."))switch(r){case">":case"*":t.push(r);break;default:t.push(this.codec.key.decode(r))}return t.join(".")}validateKey=Gi;validateSearchKey=Zi;hasWildcards=Ji;close(){return Promise.resolve()}dataLen(e,t){const r=t&&t.get(Se.MessageSizeHdr)||"";return""!==r?parseInt(r,10):e.length}smToEntry(e){return new Yi(this.bucket,this.prefixLen,e)}jmToEntry(e){const t=this.decodeKey(e.subject.substring(this.prefixLen));return new Xi(this.bucket,t,e)}create(e,t){var r=this;return(0,O.Z)(function*(){let n;try{const o=yield r.put(e,t,{previousSeq:0});return Promise.resolve(o)}catch(o){if(n=o,10071!==o?.api_error?.err_code)return Promise.reject(o)}let i=0;try{const o=yield r.get(e);return"DEL"===o?.operation||"PURGE"===o?.operation?(i=null!==o?o.revision:0,r.update(e,t,i)):Promise.reject(n)}catch(o){return Promise.reject(o)}})()}update(e,t,r){if(r<=0)throw new Error("version must be greater than 0");return this.put(e,t,{previousSeq:r})}put(e,t,r={}){var n=this;return(0,O.Z)(function*(){const i=n.encodeKey(e);n.validateKey(i);const o={};if(void 0!==r.previousSeq){const c=ze();o.headers=c,c.set(Ve.ExpectedLastSubjectSequenceHdr,`${r.previousSeq}`)}try{return(yield n.js.publish(n.subjectForKey(i,!0),t,o)).seq}catch(c){const d=c;return d.isJetStreamError()?(d.message=d.api_error?.description,d.code=`${d.api_error?.code}`,Promise.reject(d)):Promise.reject(c)}})()}get(e,t){var r=this;return(0,O.Z)(function*(){const n=r.encodeKey(e);r.validateKey(n);let o,i={last_by_subj:r.subjectForKey(n)};t&&t.revision>0&&(i={seq:t.revision});try{o=r.direct?yield r.jsm.direct.getMessage(r.bucketName(),i):yield r.jsm.streams.getMessage(r.bucketName(),i);const c=r.smToEntry(o);return c.key!==n?null:c}catch(c){if(c.code===L.JetStream404NoMessages)return null;throw c}})()}purge(e){return this._deleteOrPurge(e,"PURGE")}delete(e){return this._deleteOrPurge(e,"DEL")}purgeDeletes(e=18e5){var t=this;return(0,O.Z)(function*(){const r=I(),n=[],i=yield t.watch({key:">",initializedFn:()=>{r.resolve()}});(0,O.Z)(function*(){var b,p=!1,g=!1;try{for(var P,S=(0,z.Z)(i);p=!(P=yield S.next()).done;p=!1){const j=P.value;("DEL"===j.operation||"PURGE"===j.operation)&&n.push(j)}}catch(j){g=!0,b=j}finally{try{p&&null!=S.return&&(yield S.return())}finally{if(g)throw b}}})().then(),yield r,i.stop();const o=Date.now()-e,c=n.map(p=>{const g=t.subjectForKey(p.key);return p.created.getTime()>=o?t.jsm.streams.purge(t.stream,{filter:g,keep:1}):t.jsm.streams.purge(t.stream,{filter:g,keep:0})}),d=yield Promise.all(c);return d.unshift({success:!0,purged:0}),d.reduce((p,g)=>(p.purged+=g.purged,p))})()}_deleteOrPurge(e,t){var r=this;return(0,O.Z)(function*(){if(!r.hasWildcards(e))return r._doDeleteOrPurge(e,t);const n=yield r.keys(e),i=[];var d,o=!1,c=!1;try{for(var g,p=(0,z.Z)(n);o=!(g=yield p.next()).done;o=!1)i.push(r._doDeleteOrPurge(g.value,t)),100===i.length&&(yield Promise.all(i),i.length=0)}catch(b){c=!0,d=b}finally{try{o&&null!=p.return&&(yield p.return())}finally{if(c)throw d}}i.length>0&&(yield Promise.all(i))})()}_doDeleteOrPurge(e,t){var r=this;return(0,O.Z)(function*(){const n=r.encodeKey(e);r.validateKey(n);const i=ze();i.set(dr,t),"PURGE"===t&&i.set(Se.RollupHdr,Se.RollupValueSubject),yield r.js.publish(r.subjectForKey(n,!0),se,{headers:i})})()}_buildCC(e,t,r={}){const n=this.encodeKey(e);this.validateSearchKey(e);let i=he.LastPerSubject;return t===Ze.AllHistory&&(i=he.All),t===Ze.UpdatesOnly&&(i=he.New),Object.assign({deliver_policy:i,ack_policy:pe.None,filter_subject:this.fullKeyName(n),flow_control:!0,idle_heartbeat:ae(5e3)},r)}remove(e){return this.purge(e)}history(e={}){var t=this;return(0,O.Z)(function*(){const r=e.key??">",n=new me,i={};let o;i.headers_only=e.headers_only||!1,o=()=>{n.stop()};let c=0;const d=t._buildCC(r,Ze.AllHistory,i),p=d.filter_subject,g=tt(d);g.bindStream(t.stream),g.orderedConsumer(),g.callback((S,P)=>{if(S)n.stop(S);else if(P){const j=t.jmToEntry(P);n.push(j),n.received++,(o&&c>0&&n.received>=c||0===P.info.pending)&&(n.push(o),o=void 0)}});const b=yield t.js.subscribe(p,g);if(o){const{info:{last:S}}=b,P=S.num_pending+S.delivered.consumer_seq;if(0===P||n.received>=P)try{o()}catch(j){n.stop(j)}finally{o=void 0}else c=P}return n._data=b,n.iterClosed.then(()=>{b.unsubscribe()}),b.closed.then(()=>{n.stop()}).catch(S=>{n.stop(S)}),n})()}watch(e={}){var t=this;return(0,O.Z)(function*(){const r=e.key??">",n=new me,i={};i.headers_only=e.headers_only||!1;let o=Ze.LastValue;e.include===Ze.AllHistory?o=Ze.AllHistory:e.include===Ze.UpdatesOnly&&(o=Ze.UpdatesOnly);const c=!0===e.ignoreDeletes;let d=e.initializedFn,p=0;const g=t._buildCC(r,o,i),b=g.filter_subject,S=tt(g);S.bindStream(t.stream),S.orderedConsumer(),S.callback((j,N)=>{if(j)n.stop(j);else if(N){const Q=t.jmToEntry(N);if(c&&"DEL"===Q.operation)return;n.push(Q),n.received++,d&&(p>0&&n.received>=p||0===N.info.pending)&&(n.push(d),d=void 0)}});const P=yield t.js.subscribe(b,S);if(d){const{info:{last:j}}=P,N=j.num_pending+j.delivered.consumer_seq;if(0===N||n.received>=N)try{d()}catch(Q){n.stop(Q)}finally{d=void 0}else p=N}return n._data=P,n.iterClosed.then(()=>{P.unsubscribe()}),P.closed.then(()=>{n.stop()}).catch(j=>{n.stop(j)}),n})()}keys(e=">"){var t=this;return(0,O.Z)(function*(){const r=new me,n=t._buildCC(e,Ze.LastValue,{headers_only:!0}),i=n.filter_subject,o=tt(n);o.bindStream(t.stream),o.orderedConsumer();const c=yield t.js.subscribe(i,o);return(0,O.Z)(function*(){var b,p=!1,g=!1;try{for(var P,S=(0,z.Z)(c);p=!(P=yield S.next()).done;p=!1){const j=P.value;{const N=j.headers?.get(dr);if("DEL"!==N&&"PURGE"!==N){const Q=t.decodeKey(j.subject.substring(t.prefixLen));r.push(Q)}0===j.info.pending&&c.unsubscribe()}}}catch(j){g=!0,b=j}finally{try{p&&null!=S.return&&(yield S.return())}finally{if(g)throw b}}})().then(()=>{r.stop()}).catch(p=>{r.stop(p)}),0===c.info.last.num_pending&&c.unsubscribe(),r})()}purgeBucket(e){return this.jsm.streams.purge(this.bucketName(),e)}destroy(){return this.jsm.streams.delete(this.bucketName())}status(){var e=this;return(0,O.Z)(function*(){const r=e.js.nc.info?.cluster??"",n=e.bucketName(),i=yield e.jsm.streams.info(n);return new Gs(i,r)})()}}class Gs{si;cluster;constructor(e,t=""){this.si=e,this.cluster=t}get bucket(){return this.si.config.name.startsWith(Ne)?this.si.config.name.substring(3):this.si.config.name}get values(){return this.si.state.messages}get history(){return this.si.config.max_msgs_per_subject}get ttl(){return Rr(this.si.config.max_age)}get bucket_location(){return this.cluster}get backingStore(){return this.si.config.storage}get storage(){return this.si.config.storage}get replicas(){return this.si.config.num_replicas}get description(){return this.si.config.description??""}get maxBucketSize(){return this.si.config.max_bytes}get maxValueSize(){return this.si.config.max_msg_size}get max_bytes(){return this.si.config.max_bytes}get placement(){return this.si.config.placement||{cluster:"",tags:[]}}get placementCluster(){return this.si.config.placement?.cluster??""}get republish(){return this.si.config.republish??{src:"",dest:""}}get streamInfo(){return this.si}get size(){return this.si.state.bytes}get metadata(){return this.si.config.metadata??{}}}const Zs="SHA-256=";class Zr{si;backingStore;constructor(e){this.si=e,this.backingStore="JetStream"}get bucket(){return function Ki(s){return s.startsWith(Gr)?s.substring(4):s}(this.si.config.name)}get description(){return this.si.config.description??""}get ttl(){return this.si.config.max_age}get storage(){return this.si.config.storage}get replicas(){return this.si.config.num_replicas}get sealed(){return this.si.config.sealed}get size(){return this.si.state.bytes}get streamInfo(){return this.si}get metadata(){return this.si.config.metadata}}class Jr extends Ut{constructor(e,t){super(e,t)}checkStreamConfigVersions(e){const t=this.nc;if(e.metadata){const{min:n,ok:i}=t.features.get(X.JS_STREAM_CONSUMER_METADATA);if(!i)throw new Error(`stream 'metadata' requires server ${n}`)}if(e.first_seq){const{min:n,ok:i}=t.features.get(X.JS_STREAM_FIRST_SEQ);if(!i)throw new Error(`stream 'first_seq' requires server ${n}`)}if(e.subject_transform){const{min:n,ok:i}=t.features.get(X.JS_STREAM_SUBJECT_TRANSFORM);if(!i)throw new Error(`stream 'subject_transform' requires server ${n}`)}if(e.compression){const{min:n,ok:i}=t.features.get(X.JS_STREAM_COMPRESSION);if(!i)throw new Error(`stream 'compression' requires server ${n}`)}if(e.consumer_limits){const{min:n,ok:i}=t.features.get(X.JS_DEFAULT_CONSUMER_LIMITS);if(!i)throw new Error(`stream 'consumer_limits' requires server ${n}`)}function r(n,i){if((i.subject_transforms?.length||0)>0){const{min:c,ok:d}=t.features.get(X.JS_STREAM_SOURCE_SUBJECT_TRANSFORM);if(!d)throw new Error(`${n} 'subject_transforms' requires server ${c}`)}}e.sources&&e.sources.forEach(n=>{r("stream sources",n)}),e.mirror&&r("stream mirror",e.mirror)}add(e={}){var t=this;return(0,O.Z)(function*(){t.checkStreamConfigVersions(e),ve(e.name),e.mirror=hr(e.mirror),e.sources=e.sources?.map(hr);const n=yield t._request(`${t.prefix}.STREAM.CREATE.${e.name}`,e);return t._fixInfo(n),n})()}delete(e){var t=this;return(0,O.Z)(function*(){return ve(e),(yield t._request(`${t.prefix}.STREAM.DELETE.${e}`)).success})()}update(e,t={}){var r=this;return(0,O.Z)(function*(){if("object"==typeof e){const d=e;e=d.name,t=d,console.trace("\x1b[33m >> streams.update(config: StreamConfig) api changed to streams.update(name: string, config: StreamUpdateConfig) - this shim will be removed - update your code.  \x1b[0m")}r.checkStreamConfigVersions(t),ve(e);const n=yield r.info(e),i=Object.assign(n.config,t);i.mirror=hr(i.mirror),i.sources=i.sources?.map(hr);const c=yield r._request(`${r.prefix}.STREAM.UPDATE.${e}`,i);return r._fixInfo(c),c})()}info(e,t){var r=this;return(0,O.Z)(function*(){ve(e);const n=`${r.prefix}.STREAM.INFO.${e}`;let o=yield r._request(n,t),{total:c,limit:d}=o,p=o.state.subjects?Object.getOwnPropertyNames(o.state.subjects).length:1;if(c&&c>p){const g=[o],b=t||{};let S=0;for(;c>p;){S++,b.offset=d*S;const j=yield r._request(n,b);c=j.total,g.push(j);const N=Object.getOwnPropertyNames(j.state.subjects).length;if(p+=N,N<d)break}let P={};for(let j=0;j<g.length;j++)o=g[j],o.state.subjects&&(P=Object.assign(P,o.state.subjects));o.offset=0,o.total=0,o.limit=0,o.state.subjects=P}return r._fixInfo(o),o})()}list(e=""){return new Dt(`${this.prefix}.STREAM.LIST`,i=>{const o=i;return o.streams.forEach(c=>{this._fixInfo(c)}),o.streams},this,e?.length?{subject:e}:{})}_fixInfo(e){e.config.sealed=e.config.sealed||!1,e.config.deny_delete=e.config.deny_delete||!1,e.config.deny_purge=e.config.deny_purge||!1,e.config.allow_rollup_hdrs=e.config.allow_rollup_hdrs||!1}purge(e,t){var r=this;return(0,O.Z)(function*(){if(t){const{keep:i,seq:o}=t;if("number"==typeof i&&"number"==typeof o)throw new Error("can specify one of keep or seq")}return ve(e),yield r._request(`${r.prefix}.STREAM.PURGE.${e}`,t)})()}deleteMessage(e,t,r=!0){var n=this;return(0,O.Z)(function*(){ve(e);const i={seq:t};return r||(i.no_erase=!0),(yield n._request(`${n.prefix}.STREAM.MSG.DELETE.${e}`,i)).success})()}getMessage(e,t){var r=this;return(0,O.Z)(function*(){ve(e);const i=yield r._request(`${r.prefix}.STREAM.MSG.GET.${e}`,t);return new Vi(i)})()}find(e){return this.findStream(e)}listKvs(){return new Dt(`${this.prefix}.STREAM.LIST`,r=>{const i=r.streams.filter(d=>d.config.name.startsWith(Ne));i.forEach(d=>{this._fixInfo(d)});let o="";return i.length&&(o=this.nc.info?.cluster??""),i.map(d=>new Gs(d,o))},this)}listObjectStores(){return new Dt(`${this.prefix}.STREAM.LIST`,r=>{const i=r.streams.filter(c=>c.config.name.startsWith(Gr));return i.forEach(c=>{this._fixInfo(c)}),i.map(c=>new Zr(c))},this)}names(e=""){return new Dt(`${this.prefix}.STREAM.NAMES`,i=>i.streams,this,e?.length?{subject:e}:{})}get(e){var t=this;return(0,O.Z)(function*(){const r=yield t.info(e);return Promise.resolve(new fr(t,r))})()}}let Vi=(()=>class s{_header;smr;static jc;constructor(t){this.smr=t}get subject(){return this.smr.message.subject}get seq(){return this.smr.message.seq}get timestamp(){return this.smr.message.time}get time(){return new Date(Date.parse(this.timestamp))}get data(){return this.smr.message.data?this._parse(this.smr.message.data):se}get header(){if(!this._header)if(this.smr.message.hdrs){const t=this._parse(this.smr.message.hdrs);this._header=Qe.decode(t)}else this._header=ze();return this._header}_parse(t){const r=atob(t),n=r.length,i=new Uint8Array(n);for(let o=0;o<n;o++)i[o]=r.charCodeAt(o);return i}json(t){return ke(t).decode(this.data)}string(){return le.decode(this.data)}})();class Wi{api;constructor(e){this.api=e}get(e){return this.api.info(e).then(t=>new fr(this.api,t))}}class Yi{bucket;sm;prefixLen;constructor(e,t,r){this.bucket=e,this.prefixLen=t,this.sm=r}get key(){return this.sm.subject.substring(this.prefixLen)}get value(){return this.sm.data}get delta(){return 0}get created(){return this.sm.time}get revision(){return this.sm.seq}get operation(){return this.sm.header.get(dr)||"PUT"}get length(){const e=this.sm.header.get(Se.MessageSizeHdr)||"";return""!==e?parseInt(e,10):this.sm.data.length}json(){return this.sm.json()}string(){return this.sm.string()}}class Xi{bucket;key;sm;constructor(e,t,r){this.bucket=e,this.key=t,this.sm=r}get value(){return this.sm.data}get created(){return new Date(Rr(this.sm.info.timestampNanos))}get revision(){return this.sm.seq}get operation(){return this.sm.headers?.get(dr)||"PUT"}get delta(){return this.sm.info.pending}get length(){const e=this.sm.headers?.get(Se.MessageSizeHdr)||"";return""!==e?parseInt(e,10):this.sm.data.length}json(){return this.sm.json()}string(){return this.sm.string()}}class zr{info;hdrs;constructor(e){this.info=e}get name(){return this.info.name}get description(){return this.info.description??""}get headers(){return this.hdrs||(this.hdrs=Qe.fromRecord(this.info.headers||{})),this.hdrs}get options(){return this.info.options}get bucket(){return this.info.bucket}get chunks(){return this.info.chunks}get deleted(){return this.info.deleted??!1}get digest(){return this.info.digest}get mtime(){return this.info.mtime}get nuid(){return this.info.nuid}get size(){return this.info.size}get revision(){return this.info.revision}get metadata(){return this.info.metadata||{}}isLink(){return void 0!==this.info.options?.link}}function Js(s){const e={name:s.name,description:s.description??"",options:s.options,metadata:s.metadata};return s.headers&&(e.headers=s.headers.toRecord()),e}class Jt{jsm;js;stream;name;constructor(e,t,r){this.name=e,this.jsm=t,this.js=r}_checkNotEmpty(e){return e&&0!==e.length?{name:e}:{name:e,error:new Error("name cannot be empty")}}info(e){var t=this;return(0,O.Z)(function*(){const r=yield t.rawInfo(e);return r?new zr(r):null})()}list(){var e=this;return(0,O.Z)(function*(){const t=[],r=yield e.watch({ignoreDeletes:!0,includeHistory:!0});var o,n=!1,i=!1;try{for(var d,c=(0,z.Z)(r);n=!(d=yield c.next()).done;n=!1){const p=d.value;if(null===p)break;t.push(p)}}catch(p){i=!0,o=p}finally{try{n&&null!=c.return&&(yield c.return())}finally{if(i)throw o}}return Promise.resolve(t)})()}rawInfo(e){var t=this;return(0,O.Z)(function*(){const{name:r,error:n}=t._checkNotEmpty(e);if(n)return Promise.reject(n);const i=t._metaSubject(r);try{const o=yield t.jsm.streams.getMessage(t.stream,{last_by_subj:i}),d=ke().decode(o.data);return d.revision=o.seq,d}catch(o){return"404"===o.code?null:Promise.reject(o)}})()}_si(e){var t=this;return(0,O.Z)(function*(){try{return yield t.jsm.streams.info(t.stream,e)}catch(r){return"404"===r.code?null:Promise.reject(r)}})()}seal(){var e=this;return(0,O.Z)(function*(){let t=yield e._si();return null===t?Promise.reject(new Error("object store not found")):(t.config.sealed=!0,t=yield e.jsm.streams.update(e.stream,t.config),Promise.resolve(new Zr(t)))})()}status(e){var t=this;return(0,O.Z)(function*(){const r=yield t._si(e);return null===r?Promise.reject(new Error("object store not found")):Promise.resolve(new Zr(r))})()}destroy(){return this.jsm.streams.delete(this.stream)}_put(e,t,r){var n=this;return(0,O.Z)(function*(){const i=n.js.getOptions();(r=r||{timeout:i.timeout}).timeout=r.timeout||i.timeout,r.previousRevision=r.previousRevision??void 0;const{timeout:o,previousRevision:c}=r,p=n.js.nc.info?.max_payload||1024;(e=e||{}).options=e.options||{};let g=e.options?.max_chunk_size||131072;g=g>p?p:g,e.options.max_chunk_size=g;const b=yield n.info(e.name),{name:S,error:P}=n._checkNotEmpty(e.name);if(P)return Promise.reject(P);const j=qe.next(),N=n._chunkSubject(j),Q=n._metaSubject(S),G=Object.assign({bucket:n.name,nuid:j,size:0,chunks:0},Js(e)),fe=I(),de=[],Fe=new oe;try{const rt=t?t.getReader():null,St=new Ls;for(;;){const{done:br,value:at}=rt?yield rt.read():{done:!0,value:void 0};if(br){if(Fe.size()>0){const st=Fe.drain();St.update(st),G.chunks++,G.size+=st.length,de.push(n.js.publish(N,st,{timeout:o}))}yield Promise.all(de),de.length=0,G.mtime=(new Date).toISOString();const Be=St.digest("base64"),Et=Be.length%3,_r=Et>0?"=".repeat(Et):"";G.digest=`${Zs}${Be}${_r}`,G.deleted=!1;const Pt=ze();"number"==typeof c&&Pt.set(Ve.ExpectedLastSubjectSequenceHdr,`${c}`),Pt.set(Se.RollupHdr,Se.RollupValueSubject);const Vt=yield n.js.publish(Q,ke().encode(G),{headers:Pt,timeout:o});if(G.revision=Vt.seq,b)try{yield n.jsm.streams.purge(n.stream,{filter:`$O.${n.name}.C.${b.nuid}`})}catch{}fe.resolve(new zr(G));break}if(at)for(Fe.fill(at);Fe.size()>g;){G.chunks++,G.size+=g;const Be=Fe.drain(e.options.max_chunk_size);St.update(Be),de.push(n.js.publish(N,Be,{timeout:o}))}}}catch(rt){yield n.jsm.streams.purge(n.stream,{filter:N}),fe.reject(rt)}return fe})()}putBlob(e,t,r){return null===t&&(t=new Uint8Array(0)),this.put(e,function n(i){return new ReadableStream({pull(o){o.enqueue(i),o.close()}})}(t),r)}put(e,t,r){return e?.options?.link?Promise.reject(new Error("link cannot be set when putting the object in bucket")):this._put(e,t,r)}getBlob(e){var t=this;return(0,O.Z)(function*(){function n(){return(n=(0,O.Z)(function*(c){const d=new oe,p=c.getReader();for(;;){const{done:g,value:b}=yield p.read();if(g)return d.drain();b&&b.length&&d.fill(b)}})).apply(this,arguments)}const i=yield t.get(e);if(null===i)return Promise.resolve(null);const o=yield Promise.all([i.error,function r(c){return n.apply(this,arguments)}(i.data)]);return o[0]?Promise.reject(o[0]):Promise.resolve(o[1])})()}get(e){var t=this;return(0,O.Z)(function*(){const r=yield t.rawInfo(e);if(null===r||r.deleted)return Promise.resolve(null);if(r.options&&r.options.link){const b=r.options.link.name||"";if(""===b)throw new Error("link is a bucket");return(r.options.link.bucket!==t.name?yield Jt.create(t.js,r.options.link.bucket):t).get(b)}const n=I(),i={info:new zr(r),error:n};if(0===r.size)return i.data=function Qi(){return new ReadableStream({pull(s){s.enqueue(new Uint8Array(0)),s.close()}})}(),n.resolve(null),Promise.resolve(i);let o;const c=tt();c.orderedConsumer();const d=new Ls,p=`$O.${t.name}.C.${r.nuid}`,g=yield t.js.subscribe(p,c);return(0,O.Z)(function*(){var P,b=!1,S=!1;try{for(var N,j=(0,z.Z)(g);b=!(N=yield j.next()).done;b=!1){const Q=N.value;if(Q.data.length>0&&(d.update(Q.data),o.enqueue(Q.data)),0===Q.info.pending){const G=d.digest("base64"),fe=G.length%3,de=fe>0?"=".repeat(fe):"",Fe=`${Zs}${G}${de}`;Fe!==r.digest?o.error(new Error(`received a corrupt object, digests do not match received: ${r.digest} calculated ${Fe}`)):o.close(),g.unsubscribe()}}}catch(Q){S=!0,P=Q}finally{try{b&&null!=j.return&&(yield j.return())}finally{if(S)throw P}}})().then(()=>{n.resolve()}).catch(b=>{o.error(b),n.reject(b)}),i.data=new ReadableStream({start(b){o=b},cancel(){g.unsubscribe()}}),i})()}linkStore(e,t){if(!(t instanceof Jt))return Promise.reject("bucket required");const r=t,{name:n,error:i}=this._checkNotEmpty(e);return i?Promise.reject(i):this._put({name:n,options:{link:{bucket:r.name}}},null)}link(e,t){var r=this;return(0,O.Z)(function*(){const{name:n,error:i}=r._checkNotEmpty(e);if(i)return Promise.reject(i);if(t.deleted)return Promise.reject(new Error("src object is deleted"));if(t.isLink())return Promise.reject(new Error("src object is a link"));const o=yield r.rawInfo(e);if(null!==o&&!o.deleted)return Promise.reject(new Error("an object already exists with that name"));const d={name:n,options:{link:{bucket:t.bucket,name:t.name}}};yield r.js.publish(r._metaSubject(e),JSON.stringify(d));const p=yield r.info(e);return Promise.resolve(p)})()}delete(e){var t=this;return(0,O.Z)(function*(){const r=yield t.rawInfo(e);if(null===r)return Promise.resolve({purged:0,success:!1});r.deleted=!0,r.size=0,r.chunks=0,r.digest="";const n=ke(),i=ze();return i.set(Se.RollupHdr,Se.RollupValueSubject),yield t.js.publish(t._metaSubject(r.name),n.encode(r),{headers:i}),t.jsm.streams.purge(t.stream,{filter:t._chunkSubject(r.nuid)})})()}update(e,t={}){var r=this;return(0,O.Z)(function*(){const n=yield r.rawInfo(e);if(null===n)return Promise.reject(new Error("object not found"));if(n.deleted)return Promise.reject(new Error("cannot update meta for a deleted object"));t.name=t.name??n.name;const{name:i,error:o}=r._checkNotEmpty(t.name);if(o)return Promise.reject(o);if(e!==t.name){const p=yield r.info(t.name);if(p&&!p.deleted)return Promise.reject(new Error("an object already exists with that name"))}t.name=i;const c=Object.assign({},n,Js(t)),d=yield r.js.publish(r._metaSubject(c.name),JSON.stringify(c));return e!==t.name&&(yield r.jsm.streams.purge(r.stream,{filter:r._metaSubject(e)})),Promise.resolve(d)})()}watch(e={}){var t=this;return(0,O.Z)(function*(){e.includeHistory=e.includeHistory??!1,e.ignoreDeletes=e.ignoreDeletes??!1;let r=!1;const n=new me,i=t._metaSubjectAll();try{yield t.jsm.streams.getMessage(t.stream,{last_by_subj:i})}catch(p){"404"===p.code?(n.push(null),r=!0):n.stop(p)}const o=ke(),c=tt();c.orderedConsumer(),e.includeHistory?c.deliverLastPerSubject():(r=!0,c.deliverNew()),c.callback((p,g)=>{if(p)n.stop(p);else if(null!==g){const b=o.decode(g.data);b.deleted&&!0===e.ignoreDeletes||n.push(b),0===g.info?.pending&&!r&&(r=!0,n.push(null))}});const d=yield t.js.subscribe(i,c);return n._data=d,n.iterClosed.then(()=>{d.unsubscribe()}),d.closed.then(()=>{n.stop()}).catch(p=>{n.stop(p)}),n})()}_chunkSubject(e){return`$O.${this.name}.C.${e}`}_metaSubject(e){return`$O.${this.name}.M.${qt.encode(e)}`}_metaSubjectAll(){return`$O.${this.name}.M.>`}init(e={}){var t=this;return(0,O.Z)(function*(){try{t.stream=function zi(s){return pr(s),`${Gr}${s}`}(t.name)}catch(i){return Promise.reject(i)}const r=e?.ttl||0;delete e.ttl;const n=Object.assign({max_age:r},e);n.name=t.stream,n.allow_direct=!0,n.allow_rollup_hdrs=!0,n.discard=ur.New,n.subjects=[`$O.${t.name}.C.>`,`$O.${t.name}.M.>`],e.placement&&(n.placement=e.placement),e.metadata&&(n.metadata=e.metadata);try{yield t.jsm.streams.info(n.name)}catch(i){"stream not found"===i.message&&(yield t.jsm.streams.add(n))}})()}static create(e,t,r={}){return(0,O.Z)(function*(){const n=yield e.jetstreamManager(),i=new Jt(t,n,e);return yield i.init(r),Promise.resolve(i)})()}}class eo{js;jsm;constructor(e){this.js=e}kv(e,t={}){const r=this.js,{ok:n,min:i}=r.nc.features.get(X.JS_KV);return n?t.bindOnly?Zt.bind(this.js,e):Zt.create(this.js,e,t):Promise.reject(new Error(`kv is only supported on servers ${i} or better`))}os(e,t={}){if("function"!=typeof crypto?.subtle?.digest)return Promise.reject(new Error("objectstore: unable to calculate hashes - crypto.subtle.digest with sha256 support is required"));const r=this.js,{ok:n,min:i}=r.nc.features.get(X.JS_OBJECTSTORE);return n?Jt.create(this.js,e,t):Promise.reject(new Error(`objectstore is only supported on servers ${i} or better`))}}class Kr extends Ut{consumers;streams;consumerAPI;streamAPI;constructor(e,t){super(e,t),this.consumerAPI=new Fr(e,t),this.streamAPI=new Jr(e,t),this.consumers=new Bs(this.consumerAPI),this.streams=new Wi(this.streamAPI)}jetstreamManager(){return this.nc.jetstreamManager(this.opts)}get apiPrefix(){return this.prefix}get views(){return new eo(this)}publish(e,t=se,r){var n=this;return(0,O.Z)(function*(){(r=r||{}).expect=r.expect||{};const i=r?.headers||ze();r&&(r.msgID&&i.set(Ve.MsgIdHdr,r.msgID),r.expect.lastMsgID&&i.set(Ve.ExpectedLastMsgIdHdr,r.expect.lastMsgID),r.expect.streamName&&i.set(Ve.ExpectedStreamHdr,r.expect.streamName),"number"==typeof r.expect.lastSequence&&i.set(Ve.ExpectedLastSeqHdr,`${r.expect.lastSequence}`),"number"==typeof r.expect.lastSubjectSequence&&i.set(Ve.ExpectedLastSubjectSequenceHdr,`${r.expect.lastSubjectSequence}`));const o=r.timeout||n.timeout,c={};o&&(c.timeout=o),r&&(c.headers=i);let g,{retries:d,retry_delay:p}=r;d=d||1,p=p||250;for(let S=0;S<d;S++)try{g=yield n.nc.request(e,t,c);break}catch(P){if(!("503"===P.code&&S+1<d))throw P;yield T(p)}const b=n.parseJsResponse(g);if(""===b.stream)throw B.errorForCode(L.JetStreamInvalidAck);return b.duplicate=!!b.duplicate&&b.duplicate,b})()}pull(e,t,r=0){var n=this;return(0,O.Z)(function*(){ve(e),yt(t);let i=n.timeout;r>i&&(i=r);const o={batch:1,no_wait:0===(r=r<0?0:ae(r)),expires:r},c=yield n.nc.request(`${n.prefix}.CONSUMER.MSG.NEXT.${e}.${t}`,n.jc.encode(o),{noMux:!0,timeout:i}),d=xt(c);if(d)throw d;return Gt(c)})()}fetch(e,t,r={}){ve(e),yt(t);let n=null;const i=(r.max_bytes??0)>0;let o=0;const c=i?r.max_bytes:0;let d=null;const p={};if(p.batch=r.batch||1,c){const G=this.nc.features.get(X.JS_PULL_MAX_BYTES);if(!G.ok)throw new Error(`max_bytes is only supported on servers ${G.min} or better`);p.max_bytes=c}p.no_wait=r.no_wait||!1,p.no_wait&&p.expires&&(p.expires=0);const g=r.expires||0;if(g&&(p.expires=ae(g)),0===g&&!1===p.no_wait)throw new Error("expires or no_wait is required");const b=r.idle_heartbeat||0;b&&(p.idle_heartbeat=ae(b),!0===r.delay_heartbeat&&(p.idle_heartbeat=ae(4*b)));const S=new me,P=p.batch;let j=0;S.protocolFilterFn=(G,fe=!1)=>!Lr(G.msg)||(d?.work(),!1),S.dispatchedFn=G=>{if(G){if(i&&(o+=G.data.length),j++,n&&0===G.info.pending)return;(1===S.getPending()&&0===G.info.pending||P===j||c>0&&o>=c)&&S.stop()}};const N=v(this.nc.options.inboxPrefix),Q=this.nc.subscribe(N,{max:r.batch,callback:(G,fe)=>{null===G&&(G=xt(fe)),null!==G?(n&&(n.cancel(),n=null),function Tt(s){return"string"==typeof s.code}(G)?S.stop(null===Ks(G)?void 0:G):S.stop(G)):(d?.work(),S.received++,S.push(Gt(fe)))}});return g&&(n=$(g),n.catch(()=>{Q.isClosed()||(Q.drain().catch(()=>{}),n=null),d&&d.cancel()})),(0,O.Z)(function*(){try{b&&(d=new Br(b,G=>(S.push(()=>{S.err=new B(`${Te.IdleHeartbeatMissed}: ${G}`,L.JetStreamIdleHeartBeat)}),!0)))}catch{}yield Q.closed,null!==n&&(n.cancel(),n=null),d&&d.cancel(),S.stop()})().catch(),this.nc.publish(`${this.prefix}.CONSUMER.MSG.NEXT.${e}.${t}`,this.jc.encode(p),{reply:N}),S}pullSubscribe(e,t=tt()){var r=this;return(0,O.Z)(function*(){const n=yield r._processOptions(e,t);if(n.ordered)throw new Error("pull subscribers cannot be be ordered");if(n.config.deliver_subject)throw new Error("consumer info specifies deliver_subject - pull consumers cannot have deliver_subject set");const i=n.config.ack_policy;if(i===pe.None||i===pe.All)throw new Error("ack policy for pull consumers must be explicit");const o=r._buildTypedSubscriptionOpts(n),c=new to(r,n.deliver,o);c.info=n;try{yield r._maybeCreateConsumer(n)}catch(d){throw c.unsubscribe(),d}return c})()}subscribe(e,t=tt()){var r=this;return(0,O.Z)(function*(){const n=yield r._processOptions(e,t);if(!n.isBind&&!n.config.deliver_subject)throw new Error("push consumer requires deliver_subject");const i=r._buildTypedSubscriptionOpts(n),o=new zs(r,n.deliver,i);o.info=n;try{yield r._maybeCreateConsumer(n)}catch(c){throw o.unsubscribe(),c}return o._maybeSetupHbMonitoring(),o})()}_processOptions(e,t=tt()){var r=this;return(0,O.Z)(function*(){const n=Ts(t)?t.getOpts():t;if(n.isBind=!!Ts(t)&&t.isBind,n.flow_control={heartbeat_count:0,fc_count:0,consumer_restarts:0},n.ordered){if(n.ordered_consumer_sequence={stream_seq:0,delivery_seq:0},n.config.ack_policy!==pe.NotSet&&n.config.ack_policy!==pe.None)throw new B("ordered consumer: ack_policy can only be set to 'none'",L.ApiError);if(n.config.durable_name&&n.config.durable_name.length>0)throw new B("ordered consumer: durable_name cannot be set",L.ApiError);if(n.config.deliver_subject&&n.config.deliver_subject.length>0)throw new B("ordered consumer: deliver_subject cannot be set",L.ApiError);if(void 0!==n.config.max_deliver&&n.config.max_deliver>1)throw new B("ordered consumer: max_deliver cannot be set",L.ApiError);if(n.config.deliver_group&&n.config.deliver_group.length>0)throw new B("ordered consumer: deliver_group cannot be set",L.ApiError);n.config.deliver_subject=v(r.nc.options.inboxPrefix),n.config.ack_policy=pe.None,n.config.max_deliver=1,n.config.flow_control=!0,n.config.idle_heartbeat=n.config.idle_heartbeat||ae(5e3),n.config.ack_wait=ae(792e5),n.config.mem_storage=!0,n.config.num_replicas=1}if(n.config.ack_policy===pe.NotSet&&(n.config.ack_policy=pe.All),n.api=r,n.config=n.config||{},n.stream=n.stream?n.stream:yield r.findStream(e),n.attached=!1,n.config.durable_name)try{const i=yield r.consumerAPI.info(n.stream,n.config.durable_name);if(i){if(i.config.filter_subject&&i.config.filter_subject!==e)throw new Error("subject does not match consumer");const o=n.config.deliver_group??"";if(""===o&&!0===i.push_bound)throw new Error("duplicate subscription");const c=i.config.deliver_group??"";if(o!==c)throw""===c?new Error("durable requires no queue group"):new Error(`durable requires queue group '${c}'`);n.last=i,n.config=i.config,n.attached=!0,n.config.durable_name||(n.name=i.name)}}catch(i){if("404"!==i.code)throw i}return!n.attached&&void 0===n.config.filter_subject&&void 0===n.config.filter_subjects&&(n.config.filter_subject=e),n.deliver=n.config.deliver_subject||v(r.nc.options.inboxPrefix),n})()}_buildTypedSubscriptionOpts(e){const t={};return t.adapter=function ro(s){return s?no:so}(void 0===e.callbackFn),t.ingestionFilterFn=Kr.ingestionFn(e.ordered),t.protocolFilterFn=(r,n=!1)=>{const i=r;return!$r(i.msg)||(n||i.msg.respond(),!1)},!e.mack&&e.config.ack_policy!==pe.None&&(t.dispatchedFn=io),e.callbackFn&&(t.callback=e.callbackFn),t.max=e.max||0,t.queue=e.queue,t}_maybeCreateConsumer(e){var t=this;return(0,O.Z)(function*(){if(e.attached)return;if(e.isBind)throw new Error(`unable to bind - durable consumer ${e.config.durable_name} doesn't exist in ${e.stream}`);e.config=Object.assign({deliver_policy:he.All,ack_policy:pe.Explicit,ack_wait:ae(3e4),replay_policy:Ft.Instant},e.config);const r=yield t.consumerAPI.add(e.stream,e.config);if(Array.isArray(e.config.filter_subjects&&!Array.isArray(r.config.filter_subjects)))throw new Error("jetstream server doesn't support consumers with multiple filter subjects");e.name=r.name,e.config=r.config,e.last=r})()}static ingestionFn(e){return(t,r)=>{const n=r;if(!t)return{ingest:!1,protocol:!1};const i=t;if(xt(i.msg)||n.monitor?.work(),Lr(i.msg)){const c=!e||n._checkHbOrderConsumer(i.msg);return e||n.info.flow_control.heartbeat_count++,{ingest:c,protocol:!0}}return $r(i.msg)?(n.info.flow_control.fc_count++,{ingest:!0,protocol:!0}):{ingest:!e||n._checkOrderedConsumer(t),protocol:!1}}}}class zs extends Ui{js;monitor;constructor(e,t,r){super(e.nc,t,r),this.js=e,this.monitor=null,this.sub.closed.then(()=>{this.monitor&&this.monitor.cancel()})}set info(e){this.sub.info=e}get info(){return this.sub.info}_resetOrderedConsumer(e){if(null===this.info||this.sub.isClosed())return;const t=v(this.js.nc.options.inboxPrefix);this.js.nc._resub(this.sub,t);const n=this.info;n.ordered_consumer_sequence.delivery_seq=0,n.flow_control.heartbeat_count=0,n.flow_control.fc_count=0,n.flow_control.consumer_restarts++,n.deliver=t,n.config.deliver_subject=t,n.config.deliver_policy=he.StartSequence,n.config.opt_start_seq=e;const i={};i.stream_name=this.info.stream,i.config=n.config,this.js._request(`${n.api.prefix}.CONSUMER.CREATE.${n.stream}`,i).then(c=>{const d=c;this.info.config=d.config,this.info.name=d.name}).catch(c=>{const d=new B(`unable to recreate ordered consumer ${n.stream} at seq ${e}`,L.RequestError,c);this.sub.callback(d,{})})}_maybeSetupHbMonitoring(){const e=this.info?.config?.idle_heartbeat||0;e&&this._setupHbMonitoring(Rr(e))}_setupHbMonitoring(e,t=0){const r={cancelAfter:0,maxOut:2};t&&(r.cancelAfter=t);const n=this.sub;this.monitor=new Br(e,o=>{const c=function fi(s,e,t){const r=ze(s,e),i=new bs({hdr:1,sid:0,size:0},se,{});return i._headers=r,i._subject=t,i}(409,`${Te.IdleHeartbeatMissed}: ${o}`,this.sub.subject);return this.info?.ordered?!!this.js.nc.protocol.connected&&(this._resetOrderedConsumer((this.info?.ordered_consumer_sequence?.stream_seq||0)+1),!1):(this.sub.callback(null,c),!n.noIterator)},r)}_checkHbOrderConsumer(e){const t=e.headers.get(Se.ConsumerStalledHdr);""!==t&&this.js.nc.publish(t);const r=parseInt(e.headers.get(Se.LastConsumerSeqHdr),10),n=this.info.ordered_consumer_sequence;return this.info.flow_control.heartbeat_count++,r!==n.delivery_seq&&this._resetOrderedConsumer(n.stream_seq+1),!1}_checkOrderedConsumer(e){const t=this.info.ordered_consumer_sequence,r=e.info.streamSequence,n=e.info.deliverySequence;return n!=t.delivery_seq+1?(this._resetOrderedConsumer(t.stream_seq+1),!1):(t.delivery_seq=n,t.stream_seq=r,!0)}destroy(){var e=this;return(0,O.Z)(function*(){e.isClosed()||(yield e.drain());const t=e.sub.info,n=`${t.api.prefix}.CONSUMER.DELETE.${t.stream}.${t.config.durable_name||t.name}`;yield t.api._request(n)})()}consumerInfo(){var e=this;return(0,O.Z)(function*(){const t=e.sub.info,n=`${t.api.prefix}.CONSUMER.INFO.${t.stream}.${t.config.durable_name||t.name}`,i=yield t.api._request(n);return t.last=i,i})()}}class to extends zs{constructor(e,t,r){super(e,t,r)}pull(e={batch:1}){const{stream:t,config:r,name:n}=this.sub.info,i=r.durable_name??n,o={};if(o.batch=e.batch||1,o.no_wait=e.no_wait||!1,(e.max_bytes??0)>0){const p=this.js.nc.features.get(X.JS_PULL_MAX_BYTES);if(!p.ok)throw new Error(`max_bytes is only supported on servers ${p.min} or better`);o.max_bytes=e.max_bytes}let c=0;e.expires&&e.expires>0&&(c=e.expires,o.expires=ae(c));let d=0;if(e.idle_heartbeat&&e.idle_heartbeat>0&&(d=e.idle_heartbeat,o.idle_heartbeat=ae(d)),d&&0===c)throw new Error("idle_heartbeat requires expires");if(d>c)throw new Error("expires must be greater than idle_heartbeat");if(this.info){this.monitor&&this.monitor.cancel(),c&&d&&(this.monitor?this.monitor._change(d,c):this._setupHbMonitoring(d,c));const p=this.info.api,b=this.sub.subject;p.nc.publish(`${p.prefix}.CONSUMER.MSG.NEXT.${t}.${i}`,p.jc.encode(o),{reply:b})}}}function so(s,e){return s||(s=xt(e))?[s,null]:[null,Gt(e)]}function no(s,e){if(s)return[s,null];const t=xt(e);return null!==t?[Ks(t),null]:[null,Gt(e)]}function Ks(s){if(null!==s)switch(s.code){case L.JetStream404NoMessages:case L.JetStream408RequestTimeout:return null;case L.JetStream409:return function pi(s){if(s.code!==L.JetStream409)return!1;const e=[Te.MaxBatchExceeded,Te.MaxExpiresExceeded,Te.MaxBytesExceeded,Te.MaxMessageSizeExceeded,Te.PushConsumer,Te.IdleHeartbeatMissed,Te.ConsumerDeleted];return di&&e.push(Te.MaxWaitingExceeded),void 0!==e.find(t=>-1!==s.message.indexOf(t))}(s)?s:null;default:return s}return null}function io(s){s&&s.ack()}class oo extends Ut{constructor(e,t){super(e,t)}getMessage(e,t){var r=this;return(0,O.Z)(function*(){ve(e);let n=t;const{last_by_subj:i}=n;i&&(n=null);const o=n?r.jc.encode(n):se,c=r.opts.apiPrefix||"$JS.API",d=i?`${c}.DIRECT.GET.${e}.${i}`:`${c}.DIRECT.GET.${e}`,p=yield r.nc.request(d,o),g=xt(p);if(g)return Promise.reject(g);const b=new ao(p);return Promise.resolve(b)})()}}let ao=(()=>class s{data;header;static jc;constructor(t){if(!t.headers)throw new Error("headers expected");this.data=t.data,this.header=t.headers}get subject(){return this.header.get(Bt.Subject)}get seq(){const t=this.header.get(Bt.Sequence);return"string"==typeof t?parseInt(t):0}get time(){return new Date(Date.parse(this.timestamp))}get timestamp(){return this.header.get(Bt.TimeStamp)}get stream(){return this.header.get(Bt.Stream)}json(t){return ke(t).decode(this.data)}string(){return le.decode(this.data)}})();class co extends Ut{streams;consumers;direct;constructor(e,t){super(e,t),this.streams=new Jr(e,t),this.consumers=new Fr(e,t),this.direct=new oo(e,t)}getAccountInfo(){var e=this;return(0,O.Z)(function*(){return yield e._request(`${e.prefix}.INFO`)})()}jetstream(){return this.nc.jetstream(this.getOptions())}advisories(){const e=new me;return this.nc.subscribe("$JS.EVENT.ADVISORY.>",{callback:(t,r)=>{if(t)throw t;try{const n=this.parseJsResponse(r),i=n.type.split(".");e.push({kind:i[i.length-1],data:n})}catch(n){e.stop(n)}}}),e}}class Vs{msg;constructor(e){this.msg=e}get data(){return this.msg.data}get sid(){return this.msg.sid}get subject(){return this.msg.subject}get reply(){return this.msg.reply||""}get headers(){return this.msg.headers}respond(e,t){return this.msg.respond(e,t)}respondError(e,t,r,n){return(n=n||{}).headers=n.headers||ze(),n.headers?.set(w,`${e}`),n.headers?.set(y,t),this.msg.respond(r,n)}json(e){return this.msg.json(e)}string(){return this.msg.string()}}class zt{subject;queue;srv;constructor(e,t="",r=""){""!==t&&function ho(s,e){if(-1!==e.indexOf(" "))throw new Error(`${s} cannot contain spaces: '${e}'`);e.split(".").forEach(r=>{if(">"===r)throw new Error(`${s} name cannot contain internal '>': '${e}'`)})}("service group",t);let n="";if(e instanceof Kt)this.srv=e,n="";else{if(!(e instanceof zt))throw new Error("unknown ServiceGroup type");{const i=e;this.srv=i.srv,""===r&&""!==i.queue&&(r=i.queue),n=i.subject}}this.subject=this.calcSubject(n,t),this.queue=r}calcSubject(e,t=""){return""===t?e:""!==e?`${e}.${t}`:t}addEndpoint(e="",t){const r="function"==typeof(t=t||{subject:e})?{handler:t,subject:e}:t;Lt("endpoint",e);let{subject:n,handler:i,metadata:o,queue:c}=r;return n=n||e,c=c||this.queue,function lo(s,e){if(""===e)throw new Error(`${s} cannot be empty`);if(-1!==e.indexOf(" "))throw new Error(`${s} cannot contain spaces: '${e}'`);const t=e.split(".");t.forEach((r,n)=>{if(">"===r&&n!==t.length-1)throw new Error(`${s} cannot have internal '>': '${e}'`)})}("endpoint subject",n),n=this.calcSubject(this.subject,n),this.srv._addEndpoint({name:e,subject:n,queue:c,handler:i,metadata:o})}addGroup(e="",t=""){return new zt(this,e,t)}}class Kt{nc;_id;config;handlers;internal;_stopped;_done;started;static controlSubject(e,t="",r="",n){const i=n??"$SRV";return""===t&&""===r?`${i}.${e}`:(Lt("control subject name",t),""!==r?(Lt("control subject id",r),`${i}.${e}.${t}.${r}`):`${i}.${e}.${t}`)}constructor(e,t={name:"",version:""}){this.nc=e,this.config=Object.assign({},t),this.config.queue||(this.config.queue="q"),Lt("name",this.config.name),Lt("queue",this.config.queue),ot(this.config.version),this._id=qe.next(),this.internal=[],this._done=I(),this._stopped=!1,this.handlers=[],this.started=(new Date).toISOString(),this.reset(),this.nc.closed().then(()=>{this.close().catch()}).catch(r=>{this.close(r).catch()})}get subjects(){return this.handlers.filter(e=>!1===e.internal).map(e=>e.subject)}get id(){return this._id}get name(){return this.config.name}get description(){return this.config.description??""}get version(){return this.config.version}get metadata(){return this.config.metadata}errorToHeader(e){const t=ze();if(e instanceof E){const r=e;t.set(y,r.message),t.set(w,`${r.code}`)}else t.set(y,e.message),t.set(w,"500");return t}setupHandler(e,t=!1){const r=t?"":e.queue?e.queue:this.config.queue,{name:n,subject:i,handler:o}=e,c=e;c.internal=t,t&&this.internal.push(c),c.stats=new fo(n,i,r),c.queue=r;const d=o?(p,g)=>{if(p)return void this.close(p);const b=Date.now();try{o(p,new Vs(g))}catch(S){c.stats.countError(S),g?.respond(se,{headers:this.errorToHeader(S)})}finally{c.stats.countLatency(b)}}:void 0;return c.sub=this.nc.subscribe(i,{callback:d,queue:r}),c.sub.closed.then(()=>{this._stopped||this.close(new Error(`required subscription ${e.subject} stopped`)).catch()}).catch(p=>{if(!this._stopped){const g=new Error(`required subscription ${e.subject} errored: ${p.message}`);g.stack=p.stack,this.close(g).catch()}}),c}info(){return{type:it.INFO,name:this.name,id:this.id,version:this.version,description:this.description,metadata:this.metadata,endpoints:this.endpoints()}}endpoints(){return this.handlers.map(e=>{const{subject:t,metadata:r,name:n,queue:i}=e;return{subject:t,metadata:r,name:n,queue_group:i}})}stats(){var e=this;return(0,O.Z)(function*(){const t=[];for(const r of e.handlers){if("function"==typeof e.config.statsHandler)try{r.stats.data=yield e.config.statsHandler(r)}catch(n){r.stats.countError(n)}t.push(r.stats.stats(r.qi))}return{type:it.STATS,name:e.name,id:e.id,version:e.version,started:e.started,metadata:e.metadata,endpoints:t}})()}addInternalHandler(e,t){const r=`${e}`.toUpperCase();this._doAddInternalHandler(`${r}-all`,e,t),this._doAddInternalHandler(`${r}-kind`,e,t,this.name),this._doAddInternalHandler(`${r}`,e,t,this.name,this.id)}_doAddInternalHandler(e,t,r,n="",i=""){const o={};o.name=e,o.subject=Kt.controlSubject(t,n,i),o.handler=r,this.setupHandler(o,!0)}start(){const e=ke(),n=e.encode(this.ping());return this.addInternalHandler(R.PING,(o,c)=>o?(this.close(o).then().catch(),Promise.reject(o)):(c.respond(n),Promise.resolve())),this.addInternalHandler(R.STATS,(o,c)=>o?(this.close(o),Promise.reject(o)):this.stats().then(d=>(c?.respond(e.encode(d)),Promise.resolve()))),this.addInternalHandler(R.INFO,(o,c)=>o?(this.close(o),Promise.reject(o)):(c?.respond(e.encode(this.info())),Promise.resolve())),this.handlers.forEach(o=>{const{subject:c}=o;"string"==typeof c&&null!==o.handler&&this.setupHandler(o)}),Promise.resolve(this)}close(e){if(this._stopped)return this._done;this._stopped=!0;let t=[];return this.nc.isClosed()||(t=this.handlers.concat(this.internal).map(r=>r.sub.drain())),Promise.allSettled(t).then(()=>{this._done.resolve(e||null)}),this._done}get stopped(){return this._done}get isStopped(){return this._stopped}stop(e){return this.close(e)}ping(){return{type:it.PING,name:this.name,id:this.id,version:this.version,metadata:this.metadata}}reset(){if(this.started=(new Date).toISOString(),this.handlers)for(const e of this.handlers)e.stats.reset(e.qi)}addGroup(e,t){return new zt(this,e,t)}addEndpoint(e,t){return new zt(this).addEndpoint(e,t)}_addEndpoint(e){const t=new me;t.noIterator="function"==typeof e.handler,t.noIterator||(e.handler=(n,i)=>{n?this.stop(n).catch():t.push(new Vs(i))},t.iterClosed.then(()=>{this.close().catch()}));const r=this.setupHandler(e,!1);return r.qi=t,this.handlers.push(r),t}}class fo{name;subject;average_processing_time;num_requests;processing_time;num_errors;last_error;data;metadata;queue;constructor(e,t,r=""){this.name=e,this.subject=t,this.average_processing_time=0,this.num_errors=0,this.num_requests=0,this.processing_time=0,this.queue=r}reset(e){this.num_requests=0,this.processing_time=0,this.average_processing_time=0,this.num_errors=0,this.last_error=void 0,this.data=void 0;const t=e;t&&(t.time=0,t.processed=0)}countLatency(e){this.num_requests++,this.processing_time+=ae(Date.now()-e),this.average_processing_time=Math.round(this.processing_time/this.num_requests)}countError(e){this.num_errors++,this.last_error=e.message}_stats(){const{name:e,subject:t,average_processing_time:r,num_errors:n,num_requests:i,processing_time:o,last_error:c,data:d,queue:p}=this;return{name:e,subject:t,average_processing_time:r,num_errors:n,num_requests:i,processing_time:o,last_error:c,data:d,queue_group:p}}stats(e){const t=e;return!1===t?.noIterator&&(this.processing_time=t.time,this.num_requests=t.processed,this.average_processing_time=this.processing_time>0&&this.num_requests>0?this.processing_time/this.num_requests:0),this._stats()}}class po{nc;prefix;opts;constructor(e,t={strategy:Ce.JitterTimer,maxWait:2e3},r){this.nc=e,this.prefix=r,this.opts=t}ping(e="",t=""){return this.q(R.PING,e,t)}stats(e="",t=""){return this.q(R.STATS,e,t)}info(e="",t=""){return this.q(R.INFO,e,t)}q(e,t="",r=""){var n=this;return(0,O.Z)(function*(){const i=new me,o=ke(),c=Kt.controlSubject(e,t,r,n.prefix),d=yield n.nc.requestMany(c,se,n.opts);return(0,O.Z)(function*(){var b,p=!1,g=!1;try{for(var P,S=(0,z.Z)(d);p=!(P=yield S.next()).done;p=!1){const j=P.value;try{const N=o.decode(j.data);i.push(N)}catch(N){i.push(()=>{i.stop(N)})}}}catch(j){g=!0,b=j}finally{try{p&&null!=S.return&&(yield S.return())}finally{if(g)throw b}}i.push(()=>{i.stop()})})().catch(p=>{i.stop(p)}),i})()}}class Vr{options;protocol;draining;listeners;_services;constructor(e){this.draining=!1,this.options=si(e),this.listeners=[]}static connect(e={}){return new Promise((t,r)=>{const n=new Vr(e);cr.connect(n.options,n).then(i=>{n.protocol=i,(0,O.Z)(function*(){var d,o=!1,c=!1;try{for(var g,p=(0,z.Z)(i.status());o=!(g=yield p.next()).done;o=!1){const b=g.value;n.listeners.forEach(S=>{S.push(b)})}}catch(b){c=!0,d=b}finally{try{o&&null!=p.return&&(yield p.return())}finally{if(c)throw d}}})(),t(n)}).catch(i=>{r(i)})})}closed(){return this.protocol.closed}close(){var e=this;return(0,O.Z)(function*(){yield e.protocol.close()})()}_check(e,t,r){if(this.isClosed())throw B.errorForCode(L.ConnectionClosed);if(t&&this.isDraining()||r&&this.protocol.noMorePublishing)throw B.errorForCode(L.ConnectionDraining);if(0===(e=e||"").length)throw B.errorForCode(L.BadSubject)}publish(e,t,r){this._check(e,!1,!0),this.protocol.publish(e,t,r)}subscribe(e,t={}){this._check(e,!0,!1);const r=new Os(this.protocol,e,t);return this.protocol.subscribe(r),r}_resub(e,t,r){this._check(t,!0,!1);const n=e;n.max=r,r&&(n.max=r+n.received),this.protocol.resub(n,t)}requestMany(e,t=se,r={maxWait:1e3,maxMessages:-1}){try{this._check(e,!0,!0)}catch(c){return Promise.reject(c)}if(r.strategy=r.strategy||Ce.Timer,r.maxWait=r.maxWait||1e3,r.maxWait<1)return Promise.reject(new B("timeout",L.InvalidOption));const n=new me;function i(c){n.push(()=>{n.stop(c)})}function o(c,d){c||null===d?i(null===c?void 0:c):n.push(d)}if(r.noMux){const c=(new Error).stack;let d="number"==typeof r.maxMessages&&r.maxMessages>0?r.maxMessages:-1;const p=this.subscribe(v(this.options.inboxPrefix),{callback:(P,j)=>{if(0===j?.data?.length&&j?.headers?.status===L.NoResponders&&(P=B.errorForCode(L.NoResponders)),P)return P.stack+=`\n\n${c}`,void g(P);o(null,j),r.strategy===Ce.Count&&(d--,0===d&&g()),r.strategy===Ce.JitterTimer&&(S(),b=setTimeout(()=>{g()},300)),r.strategy===Ce.SentinelMsg&&j&&0===j.data.length&&g()}});p.closed.then(()=>{i()}).catch(P=>{n.stop(P)});const g=P=>{P&&n.push(()=>{throw P}),S(),p.drain().then(()=>{i()}).catch(j=>{i()})};n.iterClosed.then(()=>{S(),p?.unsubscribe()}).catch(P=>{S(),p?.unsubscribe()});try{this.publish(e,t,{reply:p.getSubject()})}catch(P){g(P)}let b=setTimeout(()=>{g()},r.maxWait);const S=()=>{b&&clearTimeout(b)}}else{const c=r;c.callback=o,n.iterClosed.then(()=>{d.cancel()}).catch(p=>{d.cancel(p)});const d=new li(this.protocol.muxSubscriptions,e,c);this.protocol.request(d);try{this.publish(e,t,{reply:`${this.protocol.muxSubscriptions.baseInbox}${d.token}`,headers:r.headers})}catch(p){d.cancel(p)}}return Promise.resolve(n)}request(e,t,r={timeout:1e3,noMux:!1}){try{this._check(e,!0,!0)}catch(n){return Promise.reject(n)}if(r.timeout=r.timeout||1e3,r.timeout<1)return Promise.reject(new B("timeout",L.InvalidOption));if(!r.noMux&&r.reply)return Promise.reject(new B("reply can only be used with noMux",L.InvalidOption));if(r.noMux){const n=r.reply?r.reply:v(this.options.inboxPrefix),i=I(),o=new Error;return this.subscribe(n,{max:1,timeout:r.timeout,callback:(d,p)=>{d?(d.code!==L.Timeout&&(d.stack+=`\n\n${o.stack}`),i.reject(d)):(d=ms(p))?(d.stack+=`\n\n${o.stack}`,i.reject(d)):i.resolve(p)}}).requestSubject=e,this.protocol.publish(e,t,{reply:n,headers:r.headers}),i}{const n=new As(this.protocol.muxSubscriptions,e,r);this.protocol.request(n);try{this.publish(e,t,{reply:`${this.protocol.muxSubscriptions.baseInbox}${n.token}`,headers:r.headers})}catch(o){n.cancel(o)}const i=Promise.race([n.timer,n.deferred]);return i.catch(()=>{n.cancel()}),i}}flush(){return this.isClosed()?Promise.reject(B.errorForCode(L.ConnectionClosed)):this.protocol.flush()}drain(){return this.isClosed()?Promise.reject(B.errorForCode(L.ConnectionClosed)):this.isDraining()?Promise.reject(B.errorForCode(L.ConnectionDraining)):(this.draining=!0,this.protocol.drain())}isClosed(){return this.protocol.isClosed()}isDraining(){return this.draining}getServer(){const e=this.protocol.getServer();return e?e.listen:""}status(){const e=new me;return e.iterClosed.then(()=>{const t=this.listeners.indexOf(e);this.listeners.splice(t,1)}),this.listeners.push(e),e}get info(){return this.protocol.isClosed()?void 0:this.protocol.info}stats(){return{inBytes:this.protocol.inBytes,outBytes:this.protocol.outBytes,inMsgs:this.protocol.inMsgs,outMsgs:this.protocol.outMsgs}}jetstreamManager(e={}){var t=this;return(0,O.Z)(function*(){const r=new co(t,e);try{yield r.getAccountInfo()}catch(n){const i=n;throw i.code===L.NoResponders&&(i.code=L.JetStreamNotEnabled),i}return r})()}jetstream(e={}){return new Kr(this,e)}getServerVersion(){const e=this.info;return e?ot(e.version):void 0}rtt(){var e=this;return(0,O.Z)(function*(){if(!e.protocol._closed&&!e.protocol.connected)throw B.errorForCode(L.Disconnect);const t=Date.now();return yield e.flush(),Date.now()-t})()}get features(){return this.protocol.features}get services(){return this._services||(this._services=new mo(this)),this._services}}class mo{nc;constructor(e){this.nc=e}add(e){try{return new Kt(this.nc,e).start()}catch(t){return Promise.reject(t)}}client(e,t){return new po(this.nc,e,t)}}class wo{version;lang;closeError;connected;done;socket;options;socketClosed;encrypted;peeked;yields;signal;closedNotification;constructor(){this.version="1.18.0",this.lang="nats.ws",this.connected=!1,this.done=!1,this.socketClosed=!1,this.encrypted=!1,this.peeked=!1,this.yields=[],this.signal=I(),this.closedNotification=I()}connect(e,t){var r=this;return(0,O.Z)(function*(){const i=I();if(t.tls)return i.reject(new B("tls",L.InvalidOption)),i;r.options=t;const o=e.src;if(t.wsFactory){const{socket:c,encrypted:d}=yield t.wsFactory(e.src,t);r.socket=c,r.encrypted=d}else r.encrypted=0===o.indexOf("wss://"),r.socket=new WebSocket(o);return r.socket.binaryType="arraybuffer",r.socket.onopen=()=>{r.isDiscarded()},r.socket.onmessage=c=>{if(r.isDiscarded())return;if(r.yields.push(new Uint8Array(c.data)),r.peeked)return void r.signal.resolve();const d=oe.concat(...r.yields),p=function _n(s){const e=function bn(s){for(let e=0;e<s.length;e++){const t=e+1;if(s.byteLength>t&&s[e]===pn&&s[t]===mn)return t+1}return 0}(s);if(e>0){const r=new Uint8Array(s).slice(0,e);return le.decode(r)}return""}(d);if(""!==p){const g=oi.exec(p);if(!g)return t.debug&&console.error("!!!",H(d)),void i.reject(new Error("unexpected response from server"));try{(function ni(s,e){const{proto:t,tls_required:r,tls_available:n}=s;if((void 0===t||t<1)&&e.noEcho)throw new B("noEcho",L.ServerOptionNotAvailable);if(e.tls&&!r&&!n)throw new B("tls",L.ServerOptionNotAvailable)})(JSON.parse(g[1]),r.options),r.peeked=!0,r.connected=!0,r.signal.resolve(),i.resolve()}catch(b){return void i.reject(b)}}},r.socket.onclose=c=>{if(r.isDiscarded())return;let d;r.socketClosed=!0,r.done||(c.wasClean||(d=new Error(c.reason)),r._closed(d))},r.socket.onerror=c=>{if(r.isDiscarded())return;const p=new B(c.message,L.Unknown,new Error(c.error));i.reject(p)},i})()}disconnect(){this._closed(void 0,!0)}_closed(e,t=!0){var r=this;return(0,O.Z)(function*(){if(!r.isDiscarded()&&r.connected&&!r.done){if(r.closeError=e,!e)for(;!r.socketClosed&&r.socket.bufferedAmount>0;)yield T(100);r.done=!0;try{r.socket.close(e?1002:1e3,e?e.message:void 0)}catch{}t&&r.closedNotification.resolve(e)}})()}get isClosed(){return this.done}[Symbol.asyncIterator](){return this.iterate()}iterate(){var e=this;return ge(function*(){for(;;){if(e.isDiscarded())return;0===e.yields.length&&(yield W(e.signal));const t=e.yields;e.yields=[];for(let r=0;r<t.length;r++)e.options.debug&&console.info(`> ${H(t[r])}`),yield t[r];if(e.done)break;0===e.yields.length&&(t.length=0,e.yields=t,e.signal=I())}})()}isEncrypted(){return this.connected&&this.encrypted}send(e){if(!this.isDiscarded())try{return this.socket.send(e.buffer),void(this.options.debug&&console.info(`< ${H(e)}`))}catch(t){this.options.debug&&console.error(`!!! ${H(e)}: ${t}`)}}close(e){return this._closed(e,!1)}closed(){return this.closedNotification}isDiscarded(){return!!this.done&&(this.discard(),!0)}discard(){this.done=!0;try{this.socket?.close()}catch{}}}function vo(s){/^(.*:\/\/)(.*)/.test(s)||(s=`https://${s}`);let t=new URL(s);const r=t.protocol.toLowerCase();let n,i;"https:"!==r&&"http"!==r&&(s=s.replace(/^(.*:\/\/)(.*)/gm,"$2"),t=new URL(`http://${s}`));const o=t.hostname,c=t.pathname,d=t.search||"";switch(r){case"http:":case"ws:":case"nats:":i=t.port||"80",n="ws:";break;default:i=t.port||"443",n="wss:"}return`${n}//${o}:${i}${c}${d}`}J(6021);let Wr=class{#e;#t;#r;#s=ke();#n;constructor(e){this.#e=e||{name:""}}connect(e,t,r){var n=this;return(0,O.Z)(function*(){try{n.#t=yield function So(s={}){return function Oe(s){ie=s}({defaultPort:443,urlParseFn:vo,factory:()=>new wo}),Vr.connect(s)}({servers:e,user:t,pass:r})}catch(i){console.error(i)}n.#r=yield n.#t.jetstream()})()}publish(e,t){var r=this;return(0,O.Z)(function*(){try{const n={data:t};yield r.#r.publish(e,r.#s.encode(n))}catch(n){console.log(n)}})()}unsubscribe(){void 0!==this.#n?this.#n.close():console.error("Should have subscribed first")}subscribe(e=mr.Pull,t,r){return new ue.Observable(n=>{(e===mr.Pull?this.#o(t):this.#i(t,r)).then(o=>{this.#n=o,n.next(o)})})}#i(e,t){var r=this;return(0,O.Z)(function*(){return t?(yield r.#r.consumers.get(r.#e.name,{filterSubjects:e,inactive_threshold:1e3,deliver_policy:t})).consume():(yield r.#r.consumers.get(r.#e.name,{filterSubjects:e,inactive_threshold:1e3})).consume()})()}#o(e){var t=this;return(0,O.Z)(function*(){return(yield t.#r.consumers.get(t.#e.name,e)).consume()})()}request(e,t){const r=new ue.Subject;let n;return n=(0,ue.from)(null!=t&&""!==t&&0!==t&&!1!==t?this.#t.request(`core.${e}`,this.#s.encode({data:t})):this.#t.request(`core.${e}`,this.#s.encode({data:{}}))),n.subscribe(c=>{r.next(this.#s.decode(c.data))}),r.asObservable()}drain(){var e=this;return(0,O.Z)(function*(){yield e.#t.drain()})()}};Wr=(0,Ee.gn)([(0,h.Injectable)({providedIn:"root"})],Wr);var mr=function(s){return s.Pull="pull",s.Push="push",s}(mr||{}),Ws=function(s){return s.None="none",s.All="all",s.Explicit="explicit",s.NotSet="",s}(Ws||{}),Ys=function(s){return s.Limits="limits",s.Interest="interest",s.Workqueue="workqueue",s}(Ys||{}),Xs=function(s){return s.All="all",s.Last="last",s.New="new",s.StartSequence="by_start_sequence",s.StartTime="by_start_time",s.LastPerSubject="last_per_subject",s}(Xs||{})},931:(rr,$e,J)=>{J.r($e),J.d($e,{NewsInfoComponent:()=>R,NewsListComponent:()=>U,NewsService:()=>v});var O=J(5861),Ee=J(6296),h=J(5863),ue=J(5126),z=J(6753),ne=J(575),W=J(1496),Pe=J(1189),ge=J(3433),se=J(6701),ye=J(2182),le=J(25),lt=J(9891),je=J(6107),ht=J(7752),Le=J(8426),nt=J(6488);function It(A,H){1&A&&(h.\u0275\u0275elementContainerStart(0),h.\u0275\u0275element(1,"h1",4),h.\u0275\u0275pipe(2,"translate"),h.\u0275\u0275elementContainerEnd()),2&A&&(h.\u0275\u0275advance(1),h.\u0275\u0275property("innerText",h.\u0275\u0275pipeBind1(2,1,"\u6c92\u6709\u6700\u65b0\u6d88\u606f")))}function ft(A,H){if(1&A&&h.\u0275\u0275elementContainer(0,5),2&A){const $=h.\u0275\u0275nextContext(),T=h.\u0275\u0275reference(4);h.\u0275\u0275property("ngTemplateOutlet",T||$.customTemplate)}}function Mt(A,H){if(1&A){const $=h.\u0275\u0275getCurrentView();h.\u0275\u0275elementStart(0,"span")(1,"button",10),h.\u0275\u0275listener("click",function(){h.\u0275\u0275restoreView($);const I=h.\u0275\u0275nextContext().$implicit,Z=h.\u0275\u0275nextContext(2);return h.\u0275\u0275resetView(Z.onChangeStatus(I))}),h.\u0275\u0275pipe(2,"translate"),h.\u0275\u0275elementEnd()()}2&A&&(h.\u0275\u0275advance(1),h.\u0275\u0275property("label",h.\u0275\u0275pipeBind1(2,1,"\u5b8c\u6210")))}function Ue(A,H){if(1&A){const $=h.\u0275\u0275getCurrentView();h.\u0275\u0275elementStart(0,"span")(1,"p-button",11,12),h.\u0275\u0275listener("click",function(){h.\u0275\u0275restoreView($);const I=h.\u0275\u0275nextContext().$implicit,Z=h.\u0275\u0275nextContext(2);return h.\u0275\u0275resetView(Z.onNavNewsClick(I.url,I.sharedData))}),h.\u0275\u0275pipe(3,"translate"),h.\u0275\u0275elementEnd()()}2&A&&(h.\u0275\u0275advance(1),h.\u0275\u0275property("label",h.\u0275\u0275pipeBind1(3,1,"clickToEnter")))}const dt=function(){return[]},pt=function(){return{hour12:!1}};function mt(A,H){if(1&A&&(h.\u0275\u0275elementStart(0,"tr")(1,"td"),h.\u0275\u0275template(2,Mt,3,3,"span",8),h.\u0275\u0275elementEnd(),h.\u0275\u0275elementStart(3,"td")(4,"span",9),h.\u0275\u0275text(5),h.\u0275\u0275elementEnd()(),h.\u0275\u0275elementStart(6,"td")(7,"span",9),h.\u0275\u0275text(8),h.\u0275\u0275elementEnd()(),h.\u0275\u0275elementStart(9,"td"),h.\u0275\u0275template(10,Ue,4,3,"span",8),h.\u0275\u0275elementEnd()()),2&A){const $=H.$implicit;h.\u0275\u0275advance(2),h.\u0275\u0275property("ngIf","10"===$.execStatus.code),h.\u0275\u0275advance(3),h.\u0275\u0275textInterpolate($.period.start.toLocaleString(h.\u0275\u0275pureFunction0(4,dt),h.\u0275\u0275pureFunction0(5,pt))),h.\u0275\u0275advance(3),h.\u0275\u0275textInterpolate($.subject),h.\u0275\u0275advance(2),h.\u0275\u0275property("ngIf",$.url)}}const qe=function(){return{width:"100%"}};function Ie(A,H){if(1&A&&(h.\u0275\u0275elementStart(0,"p-table",6),h.\u0275\u0275template(1,mt,11,6,"ng-template",7),h.\u0275\u0275elementEnd()),2&A){const $=h.\u0275\u0275nextContext();h.\u0275\u0275property("value",$.news)("tableStyle",h.\u0275\u0275pureFunction0(2,qe))}}function Xe(A,H){if(1&A){const $=h.\u0275\u0275getCurrentView();h.\u0275\u0275elementStart(0,"span")(1,"button",13),h.\u0275\u0275listener("click",function(){h.\u0275\u0275restoreView($);const I=h.\u0275\u0275nextContext().$implicit,Z=h.\u0275\u0275nextContext(2);return h.\u0275\u0275resetView(Z.onChangeStatus(I))}),h.\u0275\u0275pipe(2,"translate"),h.\u0275\u0275elementEnd()()}2&A&&(h.\u0275\u0275advance(1),h.\u0275\u0275property("label",h.\u0275\u0275pipeBind1(2,1,"\u5b8c\u6210")))}function L(A,H){if(1&A){const $=h.\u0275\u0275getCurrentView();h.\u0275\u0275elementStart(0,"span")(1,"p-button",11,12),h.\u0275\u0275listener("click",function(){h.\u0275\u0275restoreView($);const I=h.\u0275\u0275nextContext().$implicit,Z=h.\u0275\u0275nextContext(2);return h.\u0275\u0275resetView(Z.onNavNewsClick(I.url,I.sharedData))}),h.\u0275\u0275pipe(3,"translate"),h.\u0275\u0275elementEnd()()}2&A&&(h.\u0275\u0275advance(1),h.\u0275\u0275property("label",h.\u0275\u0275pipeBind1(3,1,"\u8acb\u9ede\u9078\u9032\u5165")))}function Tt(A,H){if(1&A&&(h.\u0275\u0275elementStart(0,"tr")(1,"td"),h.\u0275\u0275template(2,Xe,3,3,"span",8),h.\u0275\u0275elementEnd(),h.\u0275\u0275elementStart(3,"td")(4,"span",9),h.\u0275\u0275text(5),h.\u0275\u0275elementEnd()(),h.\u0275\u0275elementStart(6,"td")(7,"span",9),h.\u0275\u0275text(8),h.\u0275\u0275elementEnd()(),h.\u0275\u0275elementStart(9,"td"),h.\u0275\u0275template(10,L,4,3,"span",8),h.\u0275\u0275elementEnd()()),2&A){const $=H.$implicit;h.\u0275\u0275advance(2),h.\u0275\u0275property("ngIf","10"===$.execStatus.code),h.\u0275\u0275advance(3),h.\u0275\u0275textInterpolate($.period.start.toLocaleString(h.\u0275\u0275pureFunction0(4,pt))),h.\u0275\u0275advance(3),h.\u0275\u0275textInterpolate($.subject),h.\u0275\u0275advance(2),h.\u0275\u0275property("ngIf",$.url)}}function bt(A,H){if(1&A&&(h.\u0275\u0275elementStart(0,"p-table",6),h.\u0275\u0275template(1,Tt,11,5,"ng-template",7),h.\u0275\u0275elementEnd()),2&A){const $=h.\u0275\u0275nextContext();h.\u0275\u0275property("value",$.news)("tableStyle",h.\u0275\u0275pureFunction0(2,qe))}}function Nt(A,H){1&A&&(h.\u0275\u0275elementStart(0,"div"),h.\u0275\u0275element(1,"span",19),h.\u0275\u0275elementEnd())}function B(A,H){1&A&&(h.\u0275\u0275elementStart(0,"div"),h.\u0275\u0275element(1,"span",20),h.\u0275\u0275elementEnd())}function be(A,H){1&A&&(h.\u0275\u0275elementStart(0,"div"),h.\u0275\u0275element(1,"span",19),h.\u0275\u0275elementEnd())}function Ce(A,H){1&A&&(h.\u0275\u0275elementStart(0,"div"),h.\u0275\u0275element(1,"span",20),h.\u0275\u0275elementEnd())}function it(A,H){1&A&&(h.\u0275\u0275elementStart(0,"div"),h.\u0275\u0275element(1,"span",19),h.\u0275\u0275elementEnd())}function y(A,H){1&A&&(h.\u0275\u0275elementStart(0,"div"),h.\u0275\u0275element(1,"span",20),h.\u0275\u0275elementEnd())}function w(A,H){1&A&&(h.\u0275\u0275elementStart(0,"div"),h.\u0275\u0275element(1,"span",19),h.\u0275\u0275elementEnd())}function E(A,H){1&A&&(h.\u0275\u0275elementStart(0,"div"),h.\u0275\u0275element(1,"span",20),h.\u0275\u0275elementEnd())}let v=(()=>{class A{constructor(){this.originalNews=(0,h.signal)({}),this.allNormalNews=(0,h.signal)({}),this.allTodoList=(0,h.signal)({}),this.normalNews=(0,h.signal)({}),this.toDoList=(0,h.signal)({}),this.checkedNormalNews=(0,h.signal)({}),this.checkedToDoList=(0,h.signal)({}),this.#e="ws://localhost:8080",this.#t=new ue.Subject,this.#s=(0,h.inject)(z.JetstreamWsService)}#e;#t;#r;#s;connect(){var $=this;return(0,O.Z)(function*(){yield $.#s.connect($.#e)})()}disconnect(){var $=this;return(0,O.Z)(function*(){yield $.#s.drain()})()}getInitNews($){return this.#s.request("news.appPortal.newsList",$)}changeStatus($){const T=new Date;this.originalNews.mutate(I=>{const Z=I.findIndex(Y=>Y._id==$._id);I.splice(Z,1)}),$.execStatus={code:"60",display:"\u5df2\u8b80/\u5df2\u5b8c\u6210"},$.execTime=T,this.#s.publish("news.appPortal.setNews",$)}filterType($,T){return T?$.filter(I=>I.type.code==T):$}filterStatus($,T){return T?$.filter(I=>I.execStatus.code==T):$}filterOverdue($){const T=new Date;return $.filter(Z=>T.valueOf()-Z.execTime.valueOf()<864e5)}filterSubject($){const T=this.originalNews();this.upsertNews(T.filter(I=>I.subject.match($)))}filterReset(){this.upsertNews(this.originalNews())}upsertNews($){this.allNormalNews.set(this.filterType($,"10")),this.allTodoList.set(this.filterType($,"60")),this.normalNews.set(this.filterStatus(this.allNormalNews(),"10")),this.toDoList.set(this.filterStatus(this.allTodoList(),"10")),this.checkedNormalNews.set(this.filterOverdue(this.filterStatus(this.allNormalNews(),"60"))),this.checkedToDoList.set(this.filterOverdue(this.filterStatus(this.allTodoList(),"60")))}upsertAllNews($){this.originalNews.set($),this.upsertNews($)}formatNews($){const T=[];return $.forEach(I=>{const Z={_id:I._id,appId:I.appId,userCode:I.userCode,subject:I.subject,url:I.url,sharedData:I.sharedData,period:{start:new Date(I.period.start),end:new Date(I.period.end)},type:I.type,execTime:new Date(I.execTime),execStatus:I.execStatus,updatedBy:I.updatedBy,updatedAt:new Date(I.updatedAt)};T.push(Z)}),T}subMyNews($){var T=this;return(0,O.Z)(function*(){T.#t=new ue.Subject;const I=(0,z.JSONCodec)();T.#r=T.#s.subscribe(z.SubscribeType.Push,`news.appPortal.${$.code}`),T.#r.pipe((0,ue.mergeMap)(function(){var Z=(0,O.Z)(function*(Y){var Oe,oe=!1,ie=!1;try{for(var Me,xe=(0,Ee.Z)(Y);oe=!(Me=yield xe.next()).done;oe=!1){const _t=Me.value;T.#t.next(I.decode(_t.data)),_t.ack()}}catch(_t){ie=!0,Oe=_t}finally{try{oe&&null!=xe.return&&(yield xe.return())}finally{if(ie)throw Oe}}});return function(Y){return Z.apply(this,arguments)}}())).subscribe(()=>{}),T.#t.subscribe(Z=>{T.originalNews.mutate(Y=>{const oe=T.formatNews([Z]);Y.push(oe[0])}),T.upsertNews(T.originalNews())})})()}static#n=this.\u0275fac=function(T){return new(T||A)};static#i=this.\u0275prov=h.\u0275\u0275defineInjectable({token:A,factory:A.\u0275fac,providedIn:"root"})}return A})(),U=(()=>{class A{constructor(){this.newsService=(0,h.inject)(v),this.sharedService=(0,h.inject)(ye.SharedService),this.#e=(0,h.inject)(se.Router)}#e;onNavNewsClick($,T){const I=this.sharedService.setValue(T);this.#e.navigate([$],{state:{token:I}})}onChangeStatus($){var T=this;return(0,O.Z)(function*(){T.newsService.changeStatus($)})()}static#t=this.\u0275fac=function(T){return new(T||A)};static#r=this.\u0275cmp=h.\u0275\u0275defineComponent({type:A,selectors:[["his-news-list"]],inputs:{news:"news",customTemplate:"customTemplate"},standalone:!0,features:[h.\u0275\u0275StandaloneFeature],decls:7,vars:2,consts:[[4,"ngIf","ngIfElse"],["ShowNews",""],["defaultTable",""],["customtemplate",""],[1,"p-datatable",3,"innerText"],[3,"ngTemplateOutlet"],[3,"value","tableStyle"],["pTemplate","body"],[4,"ngIf"],[1,"label-m"],["pButton","","pRipple","","type","button",1,"p-button-outlined","check-button",3,"label","click"],["styleClass","p-button-link",3,"label","click"],["navButton",""],["pButton","","pRipple","","type","button",1,"p-button-outlined",3,"label","click"]],template:function(T,I){if(1&T&&(h.\u0275\u0275template(0,It,3,3,"ng-container",0),h.\u0275\u0275template(1,ft,1,1,"ng-template",null,1,h.\u0275\u0275templateRefExtractor),h.\u0275\u0275template(3,Ie,2,3,"ng-template",null,2,h.\u0275\u0275templateRefExtractor),h.\u0275\u0275template(5,bt,2,3,"ng-template",null,3,h.\u0275\u0275templateRefExtractor)),2&T){const Z=h.\u0275\u0275reference(2);h.\u0275\u0275property("ngIf",I.news&&I.news.length<1)("ngIfElse",Z)}},dependencies:[ne.CommonModule,ne.NgIf,ne.NgTemplateOutlet,W.TableModule,W.Table,le.PrimeTemplate,Pe.ButtonModule,Pe.ButtonDirective,Pe.Button,ge.TranslateModule,ge.TranslatePipe],styles:[".check-button[_ngcontent-%COMP%]{width:88px;height:32px;padding:4px,12px,4px,12px;border-radius:20px;border:1px;gap:4px}[_nghost-%COMP%]     .p-datatable{height:100%;background:#fff;font-style:normal;font-weight:400;line-height:20px;letter-spacing:.16px;color:var(--surface-on-surface)}[_nghost-%COMP%]     .p-datatable .p-datatable-tbody>tr{width:100%}[_nghost-%COMP%]     .p-datatable .p-datatable-tbody>tr:last-child>td{border-bottom:none}[_nghost-%COMP%]     .p-datatable .p-datatable-tbody>tr>td{padding:8px 0}[_nghost-%COMP%]     .p-datatable .p-datatable-tbody>tr>td:first-child{width:5%;min-width:45px}[_nghost-%COMP%]     .p-datatable .p-datatable-tbody>tr>td:first-child .p-button{min-width:60px}[_nghost-%COMP%]     .p-datatable .p-datatable-tbody>tr>td:nth-child(2){width:13%}[_nghost-%COMP%]     .p-datatable .p-datatable-tbody>tr>td:last-child{width:13%}[_nghost-%COMP%]     .p-fieldset{border-radius:12px}[_nghost-%COMP%]     .p-fieldset .p-fieldset-content{padding:8px 12px}"]})}return A})(),R=(()=>{class A{constructor(){this.news=(0,h.computed)(()=>this.newsService.originalNews()),this.normalNews=(0,h.computed)(()=>this.newsService.normalNews()),this.toDoList=(0,h.computed)(()=>this.newsService.toDoList()),this.checkedNormalNews=(0,h.computed)(()=>this.newsService.checkedNormalNews()),this.checkedToDoList=(0,h.computed)(()=>this.newsService.checkedToDoList()),this.query="",this.newsService=(0,h.inject)(v),this.sharedService=(0,h.inject)(ye.SharedService),this.httpClient=(0,h.inject)(ht.HttpClient),this.userAccountService=(0,h.inject)(nt.Ng),this.#e=(0,h.inject)(se.Router)}#e;onBackClick(){window.history.back()}onNavNewsClick($,T){const I=this.sharedService.setValue(T);this.#e.navigate([$],{state:{token:I}})}filterSubject(){this.newsService.filterSubject(this.query)}filterReset(){this.newsService.filterReset()}static#t=this.\u0275fac=function(T){return new(T||A)};static#r=this.\u0275cmp=h.\u0275\u0275defineComponent({type:A,selectors:[["his-news-info"]],standalone:!0,features:[h.\u0275\u0275StandaloneFeature],decls:38,vars:32,consts:[[1,"content-container"],[1,"top-bar-container"],["styleClass","mr-2","size","xlarge","shape","circle",3,"image"],[1,"title"],[1,"toolbar-container"],[1,"icon-container"],["pButton","","pRipple","","type","button","icon","pi pi-angle-left",1,"p-button-rounded","p-button-secondary","p-button-outlined",3,"click"],[3,"innerText"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["type","text","pinputtext","",1,"p-inputtext","p-component","p-element",3,"placeholder","ngModel","ngModelChange","keyup","keyup.excape"],[1,"flex","flex-column"],[1,"first",3,"legend","toggleable"],["pTemplate","expandicon"],["pTemplate","collapseicon"],[1,"news-container",3,"news"],[1,"second",3,"legend","toggleable"],[1,"third",3,"legend","toggleable"],[1,"fourth",3,"legend","toggleable"],[1,"pi","pi-chevron-down"],[1,"pi","pi-chevron-up"]],template:function(T,I){1&T&&(h.\u0275\u0275elementStart(0,"div",0)(1,"div",1),h.\u0275\u0275element(2,"p-avatar",2),h.\u0275\u0275elementStart(3,"div",3),h.\u0275\u0275text(4),h.\u0275\u0275pipe(5,"translate"),h.\u0275\u0275elementEnd()(),h.\u0275\u0275elementStart(6,"div",4)(7,"div",5)(8,"button",6),h.\u0275\u0275listener("click",function(){return I.onBackClick()}),h.\u0275\u0275elementEnd(),h.\u0275\u0275elementStart(9,"div"),h.\u0275\u0275element(10,"h3",7),h.\u0275\u0275pipe(11,"translate"),h.\u0275\u0275elementEnd()(),h.\u0275\u0275elementStart(12,"div")(13,"span",8),h.\u0275\u0275element(14,"i",9),h.\u0275\u0275elementStart(15,"input",10),h.\u0275\u0275listener("ngModelChange",function(Y){return I.query=Y})("keyup",function(){return I.filterSubject()})("keyup.excape",function(){return I.filterReset()}),h.\u0275\u0275pipe(16,"translate"),h.\u0275\u0275elementEnd()()()(),h.\u0275\u0275elementStart(17,"div",11)(18,"p-fieldset",12),h.\u0275\u0275pipe(19,"translate"),h.\u0275\u0275template(20,Nt,2,0,"ng-template",13),h.\u0275\u0275template(21,B,2,0,"ng-template",14),h.\u0275\u0275element(22,"his-news-list",15),h.\u0275\u0275elementEnd(),h.\u0275\u0275elementStart(23,"p-fieldset",16),h.\u0275\u0275pipe(24,"translate"),h.\u0275\u0275template(25,be,2,0,"ng-template",13),h.\u0275\u0275template(26,Ce,2,0,"ng-template",14),h.\u0275\u0275element(27,"his-news-list",15),h.\u0275\u0275elementEnd(),h.\u0275\u0275elementStart(28,"p-fieldset",17),h.\u0275\u0275pipe(29,"translate"),h.\u0275\u0275template(30,it,2,0,"ng-template",13),h.\u0275\u0275template(31,y,2,0,"ng-template",14),h.\u0275\u0275element(32,"his-news-list",15),h.\u0275\u0275elementEnd(),h.\u0275\u0275elementStart(33,"p-fieldset",18),h.\u0275\u0275pipe(34,"translate"),h.\u0275\u0275template(35,w,2,0,"ng-template",13),h.\u0275\u0275template(36,E,2,0,"ng-template",14),h.\u0275\u0275element(37,"his-news-list",15),h.\u0275\u0275elementEnd()()()),2&T&&(h.\u0275\u0275advance(2),h.\u0275\u0275propertyInterpolate("image",I.userAccountService.userImage().image),h.\u0275\u0275advance(2),h.\u0275\u0275textInterpolate2(" ",I.userAccountService.userAccount().userCode.display,",",h.\u0275\u0275pipeBind1(5,18,"\u6b61\u8fce\u56de\u4f86")," "),h.\u0275\u0275advance(6),h.\u0275\u0275property("innerText",h.\u0275\u0275pipeBind1(11,20,"\u6700\u65b0\u6d88\u606f")),h.\u0275\u0275advance(5),h.\u0275\u0275property("placeholder",h.\u0275\u0275pipeBind1(16,22,"\u641c\u5c0b"))("ngModel",I.query),h.\u0275\u0275advance(3),h.\u0275\u0275property("legend",h.\u0275\u0275pipeBind1(19,24,"\u4ee3\u8fa6\u5de5\u4f5c"))("toggleable",!0),h.\u0275\u0275advance(4),h.\u0275\u0275property("news",I.toDoList()),h.\u0275\u0275advance(1),h.\u0275\u0275property("legend",h.\u0275\u0275pipeBind1(24,26,"\u516c\u544a\u8a0a\u606f"))("toggleable",!0),h.\u0275\u0275advance(4),h.\u0275\u0275property("news",I.normalNews()),h.\u0275\u0275advance(1),h.\u0275\u0275property("legend",h.\u0275\u0275pipeBind1(29,28,"\u5b8c\u6210\u5de5\u4f5c"))("toggleable",!0),h.\u0275\u0275advance(4),h.\u0275\u0275property("news",I.checkedToDoList()),h.\u0275\u0275advance(1),h.\u0275\u0275property("legend",h.\u0275\u0275pipeBind1(34,30,"\u5df2\u8b80\u8a0a\u606f"))("toggleable",!0),h.\u0275\u0275advance(4),h.\u0275\u0275property("news",I.checkedNormalNews()))},dependencies:[ne.CommonModule,U,W.TableModule,le.PrimeTemplate,lt.FieldsetModule,lt.Fieldset,Pe.ButtonModule,Pe.ButtonDirective,je.AvatarModule,je.Avatar,ge.TranslateModule,ge.TranslatePipe,Le.FormsModule,Le.DefaultValueAccessor,Le.NgControlStatus,Le.NgModel],styles:[".top-bar-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center}.icon-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:12px}.icon-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.5rem;font-style:normal;font-weight:700;line-height:2rem;letter-spacing:.03rem;color:var(--surface-on-surface)}.content-container[_ngcontent-%COMP%]{padding:32px;height:100%;gap:16px;display:flex;flex-direction:column;background-color:var(--surface-ground)}.flex-column[_ngcontent-%COMP%]{gap:26px}[_nghost-%COMP%]     p-fieldset .p-fieldset-toggleable .p-fieldset-legend{padding:0;margin-left:-1px;width:129px;transition:background-color .2s,color .2s,box-shadow .2s}[_nghost-%COMP%]     p-fieldset .p-fieldset-toggleable .p-fieldset-legend a{min-height:34px;padding:var(--spacing-xs) var(--spacing-md)}[_nghost-%COMP%]     p-fieldset .p-fieldset-legend-text{font-weight:700}[_nghost-%COMP%]     p-fieldset .p-fieldset .p-fieldset-content{padding:8px 0}[_nghost-%COMP%]     p-fieldset .p-fieldset-legend>a{flex-direction:row-reverse}[_nghost-%COMP%]     p-fieldset .p-fieldset.p-fieldset-toggleable .p-fieldset-legend a .p-fieldset-toggler{margin-right:0;margin-left:18px}[_nghost-%COMP%]     p-fieldset.first .p-fieldset-toggleable .p-fieldset-legend{background-color:var(--tertiary-main)}[_nghost-%COMP%]     p-fieldset.first .p-fieldset-toggleable .p-fieldset-legend a{color:var(--white)}[_nghost-%COMP%]     p-fieldset.second .p-fieldset-toggleable .p-fieldset-legend{background-color:var(--primary-main)}[_nghost-%COMP%]     p-fieldset.second .p-fieldset-toggleable .p-fieldset-legend a{color:#f6f6f6}[_nghost-%COMP%]     p-fieldset.third .p-fieldset-toggleable .p-fieldset-legend{background-color:var(--surface-section)}[_nghost-%COMP%]     p-fieldset.third .p-fieldset-toggleable .p-fieldset-legend a{color:var(--surface-on-surface)}[_nghost-%COMP%]     .p-datatable{height:100%;background:#fff;font-style:normal;font-weight:400;line-height:20px;letter-spacing:.16px;color:var(--surface-on-surface)}[_nghost-%COMP%]     .p-datatable .p-datatable-tbody>tr{width:100%}[_nghost-%COMP%]     .p-datatable .p-datatable-tbody>tr:last-child>td{border-bottom:none}[_nghost-%COMP%]     .p-datatable .p-datatable-tbody>tr>td{padding:8px 0 8px 5px}[_nghost-%COMP%]     .p-datatable .p-datatable-tbody>tr>td:first-child{width:5%;padding-left:0;min-width:45px}[_nghost-%COMP%]     .p-datatable .p-datatable-tbody>tr>td:first-child .p-button{min-width:60px}[_nghost-%COMP%]     .p-datatable .p-datatable-tbody>tr>td:nth-child(2){width:10%;padding-left:14px}[_nghost-%COMP%]     .p-datatable .p-datatable-tbody>tr>td:last-child{width:10%;text-align:end}[_nghost-%COMP%]     .p-fieldset{border-radius:12px}[_nghost-%COMP%]     .p-fieldset .p-fieldset-content{padding:8px 0}.title[_ngcontent-%COMP%]{padding-left:24px;font-size:28px;font-weight:700;line-height:40px;letter-spacing:1.12px;color:var(--primary-main)}.toolbar-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;width:100%;justify-content:space-between}.p-button[_ngcontent-%COMP%]{color:#fff;background:var(--primary-main);border:0 none;padding:4px 12px;font-size:1rem;transition:background-color .2s,border-color .2s,color .2s,box-shadow .2s,background-size .2s cubic-bezier(.64,.09,.08,1);border-radius:6px}.check-button[_ngcontent-%COMP%]{width:88px;height:32px;padding:4px,12px,4px,12px;border-radius:20px;border:1px;gap:4px}.p-input-icon-left[_ngcontent-%COMP%]{padding:0 3px 0 0;width:320px}.p-inputtext[_ngcontent-%COMP%]{width:100%}.pi[_ngcontent-%COMP%]{width:17.51px;height:17.51px}"]})}return A})()},6488:(rr,$e,J)=>{J.d($e,{Ng:()=>z,iw:()=>ne});var O=J(5863),Ee=J(9159),h=J(6390);let z=(()=>{class W{constructor(){this.#e=(0,O.inject)(Ee.JetstreamWsService),this.userAccount=(0,O.signal)({}),this.userImage=(0,O.signal)({})}#e;getUserImage(ge){this.#e.request("UserImage.GetUserImage",ge).subscribe(se=>{this.userImage.set(se),console.log("get image",se)})}static#t=this.\u0275fac=function(se){return new(se||W)};static#r=this.\u0275prov=O.\u0275\u0275defineInjectable({token:W,factory:W.\u0275fac,providedIn:"root"})}return W})(),ne=(()=>{class W{#e;constructor(){this.#e=(0,O.inject)(Ee.JetstreamWsService),this.userProfile=(0,O.signal)({}),this.userProfile.set({_id:"jidweqjiefwi",userCode:{code:"Neo",display:"alphaTeam-001"},appId:"web-client",profile:{isDockVisible:!0},updatedBy:new h.Coding,updatedAt:new Date})}static#t=this.\u0275fac=function(se){return new(se||W)};static#r=this.\u0275prov=O.\u0275\u0275defineInjectable({token:W,factory:W.\u0275fac,providedIn:"root"})}return W})()},6296:(rr,$e,J)=>{function O(h){var ue,z,ne,W=2;for(typeof Symbol<"u"&&(z=Symbol.asyncIterator,ne=Symbol.iterator);W--;){if(z&&null!=(ue=h[z]))return ue.call(h);if(ne&&null!=(ue=h[ne]))return new Ee(ue.call(h));z="@@asyncIterator",ne="@@iterator"}throw new TypeError("Object is not async iterable")}function Ee(h){function ue(z){if(Object(z)!==z)return Promise.reject(new TypeError(z+" is not an object."));var ne=z.done;return Promise.resolve(z.value).then(function(W){return{value:W,done:ne}})}return(Ee=function(ne){this.s=ne,this.n=ne.next}).prototype={s:null,n:null,next:function(){return ue(this.n.apply(this.s,arguments))},return:function(ne){var W=this.s.return;return void 0===W?Promise.resolve({value:ne,done:!0}):ue(W.apply(this.s,arguments))},throw:function(ne){var W=this.s.return;return void 0===W?Promise.reject(ne):ue(W.apply(this.s,arguments))}},new Ee(h)}J.d($e,{Z:()=>O})},7582:(rr,$e,J)=>{function z(y,w,E,v){var A,U=arguments.length,R=U<3?w:null===v?v=Object.getOwnPropertyDescriptor(w,E):v;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)R=Reflect.decorate(y,w,E,v);else for(var H=y.length-1;H>=0;H--)(A=y[H])&&(R=(U<3?A(R):U>3?A(w,E,R):A(w,E))||R);return U>3&&R&&Object.defineProperty(w,E,R),R}function le(y,w,E,v){return new(E||(E=Promise))(function(R,A){function H(I){try{T(v.next(I))}catch(Z){A(Z)}}function $(I){try{T(v.throw(I))}catch(Z){A(Z)}}function T(I){I.done?R(I.value):function U(R){return R instanceof E?R:new E(function(A){A(R)})}(I.value).then(H,$)}T((v=v.apply(y,w||[])).next())})}function Ue(y){return this instanceof Ue?(this.v=y,this):new Ue(y)}function dt(y,w,E){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var U,v=E.apply(y,w||[]),R=[];return U={},A("next"),A("throw"),A("return"),U[Symbol.asyncIterator]=function(){return this},U;function A(Y){v[Y]&&(U[Y]=function(oe){return new Promise(function(ie,Oe){R.push([Y,oe,ie,Oe])>1||H(Y,oe)})})}function H(Y,oe){try{!function $(Y){Y.value instanceof Ue?Promise.resolve(Y.value.v).then(T,I):Z(R[0][2],Y)}(v[Y](oe))}catch(ie){Z(R[0][3],ie)}}function T(Y){H("next",Y)}function I(Y){H("throw",Y)}function Z(Y,oe){Y(oe),R.shift(),R.length&&H(R[0][0],R[0][1])}}function mt(y){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var E,w=y[Symbol.asyncIterator];return w?w.call(y):(y=function Le(y){var w="function"==typeof Symbol&&Symbol.iterator,E=w&&y[w],v=0;if(E)return E.call(y);if(y&&"number"==typeof y.length)return{next:function(){return y&&v>=y.length&&(y=void 0),{value:y&&y[v++],done:!y}}};throw new TypeError(w?"Object is not iterable.":"Symbol.iterator is not defined.")}(y),E={},v("next"),v("throw"),v("return"),E[Symbol.asyncIterator]=function(){return this},E);function v(R){E[R]=y[R]&&function(A){return new Promise(function(H,$){!function U(R,A,H,$){Promise.resolve($).then(function(T){R({value:T,done:H})},A)}(H,$,(A=y[R](A)).done,A.value)})}}}J.d($e,{FC:()=>dt,KL:()=>mt,gn:()=>z,mG:()=>le,qq:()=>Ue}),"function"==typeof SuppressedError&&SuppressedError}}]);