(self.webpackChunkapp_portal=self.webpackChunkapp_portal||[]).push([[6746,3395,9191],{9159:(Ct,Ne,B)=>{B.r(Ne),B.d(Ne,{AckPolicy:()=>Yn,DeliverPolicy:()=>Qn,JSONCodec:()=>De,JetstreamWsService:()=>Yr,RetentionPolicy:()=>Xn,SubscribeType:()=>gr});var d=B(5861),a=B(7582),ce=B(5863),le=B(5126),Z=B(6296);function ue(n,e){this.v=n,this.k=e}function he(n){return new ue(n,0)}function ve(n){var e,t;function r(i,o){try{var l=n[i](o),p=l.value,m=p instanceof ue;Promise.resolve(m?p.v:p).then(function(y){if(m){var _="return"===i?"return":"next";if(!p.k||y.done)return r(_,y);y=n[_](y).value}s(l.done?"return":"normal",y)},function(y){r("throw",y)})}catch(y){s("throw",y)}}function s(i,o){switch(i){case"return":e.resolve({value:o,done:!0});break;case"throw":e.reject(o);break;default:e.resolve({value:o,done:!1})}(e=e.next)?r(e.key,e.arg):t=null}this._invoke=function(i,o){return new Promise(function(l,p){var m={key:i,arg:o,resolve:l,reject:p,next:null};t?t=t.next=m:(e=t=m,r(i,o))})},"function"!=typeof n.return&&(this.return=void 0)}function He(n){return function(){return new ve(n.apply(this,arguments))}}ve.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},ve.prototype.next=function(n){return this._invoke("next",n)},ve.prototype.throw=function(n){return this._invoke("throw",n)},ve.prototype.return=function(n){return this._invoke("return",n)};const _e=new Uint8Array(0),Oe=new TextEncoder,fe=new TextDecoder;function je(...n){const e=[];for(let t=0;t<n.length;t++)e.push(Oe.encode(n[t]));return 0===e.length?_e:1===e.length?e[0]:function nt(...n){let e=0;for(let s=0;s<n.length;s++)e+=n[s].length;const t=new Uint8Array(e);let r=0;for(let s=0;s<n.length;s++)t.set(n[s],r),r+=n[s].length;return t}(...e)}function Ke(n){return n&&0!==n.length?fe.decode(n):""}const ze="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";const Pe=new class pe{buf;seq;inc;constructor(){this.buf=new Uint8Array(22),this.init()}init(){this.setPre(),this.initSeqAndInc(),this.fillSeq()}initSeqAndInc(){this.seq=Math.floor(0xcfd41b9100000*Math.random()),this.inc=Math.floor(300*Math.random()+33)}setPre(){const e=new Uint8Array(12);!function xe(n){globalThis?.crypto?.getRandomValues?globalThis.crypto.getRandomValues(n):function H(n){for(let e=0;e<n.length;e++)n[e]=Math.floor(255*Math.random())}(n)}(e);for(let t=0;t<12;t++)this.buf[t]=ze.charCodeAt(e[t]%36)}fillSeq(){let e=this.seq;for(let t=21;t>=12;t--)this.buf[t]=ze.charCodeAt(e%36),e=Math.floor(e/36)}next(){return this.seq+=this.inc,this.seq>0xcfd41b9100000&&(this.setPre(),this.initSeqAndInc()),this.fillSeq(),String.fromCharCode.apply(String,this.buf)}reset(){this.init()}};var Le=function(n){return n.Disconnect="disconnect",n.Reconnect="reconnect",n.Update="update",n.LDM="ldm",n.Error="error",n}(Le||{}),Ye=function(n){return n.Reconnecting="reconnecting",n.PingTimer="pingTimer",n.StaleConnection="staleConnection",n}(Ye||{}),O=function(n){return n.ApiError="BAD API",n.BadAuthentication="BAD_AUTHENTICATION",n.BadCreds="BAD_CREDS",n.BadHeader="BAD_HEADER",n.BadJson="BAD_JSON",n.BadPayload="BAD_PAYLOAD",n.BadSubject="BAD_SUBJECT",n.Cancelled="CANCELLED",n.ConnectionClosed="CONNECTION_CLOSED",n.ConnectionDraining="CONNECTION_DRAINING",n.ConnectionRefused="CONNECTION_REFUSED",n.ConnectionTimeout="CONNECTION_TIMEOUT",n.Disconnect="DISCONNECT",n.InvalidOption="INVALID_OPTION",n.InvalidPayload="INVALID_PAYLOAD",n.MaxPayloadExceeded="MAX_PAYLOAD_EXCEEDED",n.NoResponders="503",n.NotFunction="NOT_FUNC",n.RequestError="REQUEST_ERROR",n.ServerOptionNotAvailable="SERVER_OPT_NA",n.SubClosed="SUB_CLOSED",n.SubDraining="SUB_DRAINING",n.Timeout="TIMEOUT",n.Tls="TLS",n.Unknown="UNKNOWN_ERROR",n.WssRequired="WSS_REQUIRED",n.JetStreamInvalidAck="JESTREAM_INVALID_ACK",n.JetStream404NoMessages="404",n.JetStream408RequestTimeout="408",n.JetStream409MaxAckPendingExceeded="409",n.JetStream409="409",n.JetStreamNotEnabled="503",n.JetStreamIdleHeartBeat="IDLE_HEARTBEAT",n.AuthorizationViolation="AUTHORIZATION_VIOLATION",n.AuthenticationExpired="AUTHENTICATION_EXPIRED",n.ProtocolError="NATS_PROTOCOL_ERR",n.PermissionsViolation="PERMISSIONS_VIOLATION",n.AuthenticationTimeout="AUTHENTICATION_TIMEOUT",n}(O||{});class D{messages;constructor(){this.messages=new Map,this.messages.set(O.InvalidPayload,"Invalid payload type - payloads can be 'binary', 'string', or 'json'"),this.messages.set(O.BadJson,"Bad JSON"),this.messages.set(O.WssRequired,"TLS is required, therefore a secure websocket connection is also required")}static getMessage(e){return W.getMessage(e)}getMessage(e){return this.messages.get(e)||e}}const W=new D;class j extends Error{name;message;code;permissionContext;chainedError;api_error;constructor(e,t,r){super(e),this.name="NatsError",this.message=e,this.code=t,this.chainedError=r}static errorForCode(e,t){const r=D.getMessage(e);return new j(r,e,t)}isAuthError(){return this.code===O.AuthenticationExpired||this.code===O.AuthorizationViolation}isAuthTimeout(){return this.code===O.AuthenticationTimeout}isPermissionError(){return this.code===O.PermissionsViolation}isProtocolError(){return this.code===O.ProtocolError}isJetStreamError(){return void 0!==this.api_error}jsError(){return this.api_error?this.api_error:null}}var re=function(n){return n[n.Exact=0]="Exact",n[n.CanonicalMIME=1]="CanonicalMIME",n[n.IgnoreCase=2]="IgnoreCase",n}(re||{}),Ie=function(n){return n.Timer="timer",n.Count="count",n.JitterTimer="jitterTimer",n.SentinelMsg="sentinelMsg",n}(Ie||{}),yt=function(n){return n.STATS="io.nats.micro.v1.stats_response",n.INFO="io.nats.micro.v1.info_response",n.PING="io.nats.micro.v1.ping_response",n}(yt||{});const x="Nats-Service-Error",w="Nats-Service-Error-Code";class P extends Error{code;constructor(e,t){super(t),this.code=e}static isServiceError(e){return null!==P.toServiceError(e)}static toServiceError(e){const t=e?.headers?.get(w)||"";if(""!==t){const r=parseInt(t)||400,s=e?.headers?.get(x)||"";return new P(r,s.length?s:t)}return null}}function C(n=""){if("string"!=typeof(n=n||"_INBOX"))throw new Error("prefix must be a string");return n.split(".").forEach(e=>{if("*"===e||">"===e)throw new Error(`inbox prefixes cannot have wildcards '${n}'`)}),`${n}.${Pe.next()}`}const L="127.0.0.1";var F=function(n){return n.PING="PING",n.STATS="STATS",n.INFO="INFO",n}(F||{});function V(n,...e){for(let t=0;t<e.length;t++){const r=e[t];Object.keys(r).forEach(function(s){n[s]=r[s]})}return n}function X(n){return fe.decode(n).replace(/\n/g,"\u240a").replace(/\r/g,"\u240d")}function we(n){const e=j.errorForCode(O.Timeout);let t,r;const s=new Promise((i,o)=>{t={cancel:()=>{r&&clearTimeout(r)}},r=setTimeout(()=>{o(e)},n)});return Object.assign(s,t)}function G(n=0){return new Promise(e=>{setTimeout(()=>{e()},n)})}function z(){let n={};const e=new Promise((t,r)=>{n={resolve:t,reject:r}});return Object.assign(e,n)}function Se(n){for(let e=n.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[n[e],n[t]]=[n[t],n[e]]}return n}class Ee{buffers;byteLength;constructor(){this.buffers=[],this.byteLength=0}static concat(...e){let t=0;for(let i=0;i<e.length;i++)t+=e[i].length;const r=new Uint8Array(t);let s=0;for(let i=0;i<e.length;i++)r.set(e[i],s),s+=e[i].length;return r}static fromAscii(e){return e||(e=""),Oe.encode(e)}static toAscii(e){return fe.decode(e)}reset(){this.buffers.length=0,this.byteLength=0}pack(){if(this.buffers.length>1){const e=new Uint8Array(this.byteLength);let t=0;for(let r=0;r<this.buffers.length;r++)e.set(this.buffers[r],t),t+=this.buffers[r].length;this.buffers.length=0,this.buffers.push(e)}}shift(){if(this.buffers.length){const e=this.buffers.shift();if(e)return this.byteLength-=e.length,e}return new Uint8Array(0)}drain(e){if(this.buffers.length){this.pack();const t=this.buffers.pop();if(t){const r=this.byteLength;(void 0===e||e>r)&&(e=r);const s=t.subarray(0,e);return r>e&&this.buffers.push(t.subarray(e)),this.byteLength=r-e,s}}return new Uint8Array(0)}fill(e,...t){e&&(this.buffers.push(e),this.byteLength+=e.length);for(let r=0;r<t.length;r++)t[r]&&t[r].length&&(this.buffers.push(t[r]),this.byteLength+=t[r].length)}peek(){return this.buffers.length?(this.pack(),this.buffers[0]):new Uint8Array(0)}size(){return this.byteLength}length(){return this.buffers.length}}let T;function N(){return void 0!==T&&void 0!==T.defaultPort?T.defaultPort:4222}function Y(){return void 0!==T&&T.urlParseFn?T.urlParseFn:void 0}function Ae(){return void 0!==T&&T.dnsResolveFn?T.dnsResolveFn:void 0}const sr=Ee.fromAscii("\r\n"),ps=new Uint8Array(sr)[0],ms=new Uint8Array(sr)[1];const bs=4,fn=48,ys=65,xs=97;function Ar(n){return void 0!==function ws(n){for(let e=0;e<n.length;e++)switch(n[e]){case".":return pn(n);case":":return Ss(n)}}(n)}function pn(n){const e=new Uint8Array(4);for(let t=0;t<4;t++){if(0===n.length)return;if(t>0){if("."!==n[0])return;n=n.substring(1)}const{n:r,c:s,ok:i}=Cs(n);if(!i||r>255)return;n=n.substring(s),e[t]=r}return function vs(n,e,t,r){const s=new Uint8Array(16);return[0,0,0,0,0,0,0,0,0,0,255,255].forEach((o,l)=>{s[l]=o}),s[12]=n,s[13]=e,s[14]=t,s[15]=r,s}(e[0],e[1],e[2],e[3])}function Ss(n){const e=new Uint8Array(16);let t=-1;if(n.length>=2&&":"===n[0]&&":"===n[1]&&(t=0,0===(n=n.substring(2)).length))return e;let r=0;for(;r<16;){const{n:s,c:i,ok:o}=Ps(n);if(!o||s>65535)return;if(i<n.length&&"."===n[i]){if(t<0&&12!=r||r+4>16)return;const l=pn(n);if(void 0===l)return;e[r]=l[12],e[r+1]=l[13],e[r+2]=l[14],e[r+3]=l[15],n="",r+=bs;break}if(e[r]=s>>8,e[r+1]=s,r+=2,0===(n=n.substring(i)).length)break;if(":"!==n[0]||1==n.length)return;if(":"===(n=n.substring(1))[0]){if(t>=0)return;if(t=r,0===(n=n.substring(1)).length)break}}if(0===n.length){if(r<16){if(t<0)return;const s=16-r;for(let i=r-1;i>=t;i--)e[i+s]=e[i];for(let i=t+s-1;i>=t;i--)e[i]=0}else if(t>=0)return;return e}}function Cs(n){let e=0,t=0;for(e=0;e<n.length&&48<=n.charCodeAt(e)&&n.charCodeAt(e)<=57;e++)if(t=10*t+(n.charCodeAt(e)-fn),t>=16777215)return{n:16777215,c:e,ok:!1};return 0===e?{n:0,c:0,ok:!1}:{n:t,c:e,ok:!0}}function Ps(n){let e=0,t=0;for(t=0;t<n.length;t++){if(48<=n.charCodeAt(t)&&n.charCodeAt(t)<=57)e*=16,e+=n.charCodeAt(t)-fn;else if(97<=n.charCodeAt(t)&&n.charCodeAt(t)<=102)e*=16,e+=n.charCodeAt(t)-xs+10;else{if(!(65<=n.charCodeAt(t)&&n.charCodeAt(t)<=70))break;e*=16,e+=n.charCodeAt(t)-ys+10}if(e>=16777215)return{n:0,c:t,ok:!1}}return 0===t?{n:0,c:t,ok:!1}:{n:e,c:t,ok:!0}}function Mr(n){return!function Es(n){return-1!==n.indexOf(".")||-1===n.indexOf("[")&&-1===n.indexOf("::")&&n.split(":").length<=2}(n)}class Ut{src;listen;hostname;port;didConnect;reconnects;lastConnect;gossiped;tlsName;resolves;constructor(e,t=!1){this.src=e,this.tlsName="";const r=function As(n){(n=n.trim()).match(/^(.*:\/\/)(.*)/m)&&(n=n.replace(/^(.*:\/\/)(.*)/gm,"$2")),n=function Os(n){const t=n.toUpperCase().indexOf("::FFFF:");if(-1!==t&&-1!==n.indexOf(".")){let r=n.substring(t+7);return r=r.replace("[",""),r.replace("]","")}return n}(n),Mr(n)&&-1===n.indexOf("[")&&(n=`[${n}]`);const e=Mr(n)?n.match(/(]:)(\d+)/):n.match(/(:)(\d+)/),t=e&&3===e.length&&e[1]&&e[2]?parseInt(e[2]):4222,s=new URL(`${80===t?"https":"http"}://${n}`);s.port=`${t}`;let i=s.hostname;return"["===i.charAt(0)&&(i=i.substring(1,i.length-1)),{listen:s.host,hostname:i,port:t}}(e);this.listen=r.listen,this.hostname=r.hostname,this.port=r.port,this.didConnect=!1,this.reconnects=0,this.lastConnect=0,this.gossiped=t}toString(){return this.listen}resolve(e){var t=this;return(0,d.Z)(function*(){if(!e.fn)return[t];const r=[];if(Ar(t.hostname))return[t];{const s=yield e.fn(t.hostname);e.debug&&console.log(`resolve ${t.hostname} = ${s.join(",")}`);for(const i of s){const l=new URL(`${80===t.port?"https":"http"}://${Mr(i)?"["+i+"]":i}`);l.port=`${t.port}`;const p=new Ut(l.host,!1);p.tlsName=t.hostname,r.push(p)}}return e.randomize&&Se(r),t.resolves=r,r})()}}class Ms{firstSelect;servers;currentServer;tlsName;randomize;constructor(e=[],t={}){this.firstSelect=!0,this.servers=[],this.tlsName="",this.randomize=t.randomize||!1;const r=Y();e&&(e.forEach(s=>{s=r?r(s):s,this.servers.push(new Ut(s))}),this.randomize&&(this.servers=Se(this.servers))),0===this.servers.length&&this.addServer(`${L}:${N()}`,!1),this.currentServer=this.servers[0]}clear(){this.servers.length=0}updateTLSName(){const e=this.getCurrentServer();Ar(e.hostname)||(this.tlsName=e.hostname,this.servers.forEach(t=>{t.gossiped&&(t.tlsName=this.tlsName)}))}getCurrentServer(){return this.currentServer}addServer(e,t=!1){const r=Y();e=r?r(e):e;const s=new Ut(e,t);Ar(s.hostname)&&(s.tlsName=this.tlsName),this.servers.push(s)}selectServer(){if(this.firstSelect)return this.firstSelect=!1,this.currentServer;const e=this.servers.shift();return e&&(this.servers.push(e),this.currentServer=e),e}removeCurrentServer(){this.removeServer(this.currentServer)}removeServer(e){if(e){const t=this.servers.indexOf(e);this.servers.splice(t,1)}}length(){return this.servers.length}next(){return this.servers.length?this.servers[0]:void 0}getServers(){return this.servers}update(e){const t=[];let r=[];const s=Y(),i=new Map;e.connect_urls&&e.connect_urls.length>0&&e.connect_urls.forEach(l=>{l=s?s(l):l;const p=new Ut(l,!0);i.set(l,p)});const o=[];return this.servers.forEach((l,p)=>{const m=l.listen;l.gossiped&&this.currentServer.listen!==m&&void 0===i.get(m)&&o.push(p),i.delete(m)}),o.reverse(),o.forEach(l=>{const p=this.servers.splice(l,1);r=r.concat(p[0].listen)}),i.forEach((l,p)=>{this.servers.push(l),t.push(p)}),{added:t,deleted:r}}}class Re{inflight;processed;received;noIterator;iterClosed;done;signal;yields;filtered;pendingFiltered;ingestionFilterFn;protocolFilterFn;dispatchedFn;ctx;_data;err;time;constructor(){this.inflight=0,this.filtered=0,this.pendingFiltered=0,this.processed=0,this.received=0,this.noIterator=!1,this.done=!1,this.signal=z(),this.yields=[],this.iterClosed=z(),this.time=0}[Symbol.asyncIterator](){return this.iterate()}push(e){if(this.done)return;if("function"==typeof e)return this.yields.push(e),void this.signal.resolve();const{ingest:t,protocol:r}=this.ingestionFilterFn?this.ingestionFilterFn(e,this.ctx||this):{ingest:!0,protocol:!1};t&&(r&&(this.filtered++,this.pendingFiltered++),this.yields.push(e),this.signal.resolve())}iterate(){var e=this;return He(function*(){if(e.noIterator)throw new j("unsupported iterator",O.ApiError);try{for(;;){if(0===e.yields.length&&(yield he(e.signal)),e.err)throw e.err;const t=e.yields;e.inflight=t.length,e.yields=[];for(let r=0;r<t.length;r++)if("function"!=typeof t[r]){if(!e.protocolFilterFn||e.protocolFilterFn(t[r])){e.processed++;const i=Date.now();yield t[r],e.time=Date.now()-i,e.dispatchedFn&&t[r]&&e.dispatchedFn(t[r])}else e.pendingFiltered--;e.inflight--}else{const i=t[r];try{i()}catch(o){throw o}if(e.err)throw e.err}if(e.done)break;0===e.yields.length&&(t.length=0,e.yields=t,e.signal=z())}}finally{e.stop()}})()}stop(e){this.done||(this.err=e,this.done=!0,this.signal.resolve(),this.iterClosed.resolve())}getProcessed(){return this.noIterator?this.received:this.processed}getPending(){return this.yields.length+this.inflight-this.pendingFiltered}getReceived(){return this.received-this.filtered}}function mn(n){let r=!0;const s=new Array(n.length);for(let i=0;i<n.length;i++){let o=n.charCodeAt(i);if(58===o||o<33||o>126)throw new j(`'${n[i]}' is not a valid character for a header key`,O.BadHeader);r&&97<=o&&o<=122?o-=32:!r&&65<=o&&o<=90&&(o+=32),s[i]=o,r=45==o}return String.fromCharCode(...s)}function ct(n=0,e=""){if(0===n&&""!==e||n>0&&""===e)throw new Error("setting status requires both code and description");return new pt(n,e)}const kr="NATS/1.0";class pt{_code;headers;_description;constructor(e=0,t=""){this._code=e,this._description=t,this.headers=new Map}[Symbol.iterator](){return this.headers.entries()}size(){return this.headers.size}equals(e){if(e&&this.headers.size===e.headers.size&&this._code===e._code){for(const[t,r]of this.headers){const s=e.values(t);if(r.length!==s.length)return!1;const i=[...r].sort(),o=[...s].sort();for(let l=0;l<i.length;l++)if(i[l]!==o[l])return!1}return!0}return!1}static decode(e){const t=new pt,s=fe.decode(e).split("\r\n"),i=s[0];if(i!==kr){let o=i.replace(kr,"").trim();if(o.length>0){t._code=parseInt(o,10),isNaN(t._code)&&(t._code=0);const l=t._code.toString();o=o.replace(l,""),t._description=o.trim()}}return s.length>=1&&s.slice(1).map(o=>{if(o){const l=o.indexOf(":");if(l>-1){const p=o.slice(0,l),m=o.slice(l+1).trim();t.append(p,m)}}}),t}toString(){if(0===this.headers.size&&0===this._code)return"";let e=kr;this._code>0&&""!==this._description&&(e+=` ${this._code} ${this._description}`);for(const[t,r]of this.headers)for(let s=0;s<r.length;s++)e=`${e}\r\n${t}: ${r[s]}`;return`${e}\r\n\r\n`}encode(){return Oe.encode(this.toString())}static validHeaderValue(e){if(/[\r\n]/.test(e))throw new j("invalid header value - \\r and \\n are not allowed.",O.BadHeader);return e.trim()}keys(){const e=[];for(const t of this.headers.keys())e.push(t);return e}findKeys(e,t=re.Exact){const r=this.keys();switch(t){case re.Exact:return r.filter(s=>s===e);case re.CanonicalMIME:return e=mn(e),r.filter(s=>s===e);default:{const s=e.toLowerCase();return r.filter(i=>s===i.toLowerCase())}}}get(e,t=re.Exact){const r=this.findKeys(e,t);if(r.length){const s=this.headers.get(r[0]);if(s)return Array.isArray(s)?s[0]:s}return""}has(e,t=re.Exact){return this.findKeys(e,t).length>0}set(e,t,r=re.Exact){this.delete(e,r),this.append(e,t,r)}append(e,t,r=re.Exact){const s=mn(e);r===re.CanonicalMIME&&(e=s);const i=this.findKeys(e,r);e=i.length>0?i[0]:e;const o=pt.validHeaderValue(t);let l=this.headers.get(e);l||(l=[],this.headers.set(e,l)),l.push(o)}values(e,t=re.Exact){const r=[];return this.findKeys(e,t).forEach(i=>{const o=this.headers.get(i);o&&r.push(...o)}),r}delete(e,t=re.Exact){this.findKeys(e,t).forEach(s=>{this.headers.delete(s)})}get hasError(){return this._code>=300}get status(){return`${this._code} ${this._description}`.trim()}toRecord(){const e={};return this.keys().forEach(t=>{e[t]=this.values(t)}),e}get code(){return this._code}get description(){return this._description}static fromRecord(e){const t=new pt;for(const r in e)t.headers.set(r,e[r]);return t}}function De(n){return{encode(e){try{return void 0===e&&(e=null),Oe.encode(JSON.stringify(e))}catch(t){throw j.errorForCode(O.BadJson,t)}},decode(e){try{return JSON.parse(fe.decode(e),n)}catch(t){throw j.errorForCode(O.BadJson,t)}}}}function gn(n){return n&&0===n.data.length&&503===n.headers?.code?j.errorForCode(O.NoResponders):null}let _n=(()=>class n{_headers;_msg;_rdata;_reply;_subject;publisher;static jc;constructor(t,r,s){this._msg=t,this._rdata=r,this.publisher=s}get subject(){return this._subject||(this._subject=fe.decode(this._msg.subject)),this._subject}get reply(){return this._reply||(this._reply=fe.decode(this._msg.reply)),this._reply}get sid(){return this._msg.sid}get headers(){if(this._msg.hdr>-1&&!this._headers){const t=this._rdata.subarray(0,this._msg.hdr);this._headers=pt.decode(t)}return this._headers}get data(){return this._rdata?this._msg.hdr>-1?this._rdata.subarray(this._msg.hdr):this._rdata:new Uint8Array(0)}respond(t=_e,r){return!!this.reply&&(this.publisher.publish(this.reply,t,r),!0)}size(){return this._msg.subject.length+(this._msg.reply?.length||0)+(-1===this._msg.size?0:this._msg.size)}json(t){return De(t).decode(this.data)}string(){return fe.decode(this.data)}})();class js{baseInbox;reqs;constructor(){this.reqs=new Map}size(){return this.reqs.size}init(e){return this.baseInbox=`${C(e)}.`,this.baseInbox}add(e){isNaN(e.received)||(e.received=0),this.reqs.set(e.token,e)}get(e){return this.reqs.get(e)}cancel(e){this.reqs.delete(e.token)}getToken(e){const t=e.subject||"";return 0===t.indexOf(this.baseInbox)?t.substring(this.baseInbox.length):null}all(){return Array.from(this.reqs.values())}handleError(e,t){if(t&&t.permissionContext){if(e)return this.all().forEach(s=>{s.resolver(t,{})}),!0;const r=t.permissionContext;if("publish"===r.operation){const s=this.all().find(i=>i.requestSubject===r.subject);if(s)return s.resolver(t,{}),!0}}return!1}dispatcher(){return(e,t)=>{const r=this.getToken(t);if(r){const s=this.get(r);s&&(null===e&&t.headers&&(e=gn(t)),s.resolver(e,t))}}}close(){const e=j.errorForCode(O.Timeout);this.reqs.forEach(t=>{t.resolver(e,{})})}}class Is{ph;interval;maxOut;timer;pendings;constructor(e,t,r){this.ph=e,this.interval=t,this.maxOut=r,this.pendings=[]}start(){this.cancel(),this._schedule()}cancel(e){this.timer&&(clearTimeout(this.timer),this.timer=void 0),this._reset(),e&&this.ph.disconnect()}_schedule(){this.timer=setTimeout(()=>{if(this.ph.dispatchStatus({type:Ye.PingTimer,data:`${this.pendings.length+1}`}),this.pendings.length===this.maxOut)return void this.cancel(!0);const e=z();this.ph.flush(e).then(()=>{this._reset()}).catch(()=>{this.cancel()}),this.pendings.push(e),this._schedule()},this.interval)}_reset(){this.pendings=this.pendings.filter(e=>(e.resolve(),!1))}}class Ts extends Error{constructor(e){super(e),this.name="AssertionError"}}const jr=2**32-2;function ir(n,e,t=0){const r=e.byteLength-t;return n.byteLength>r&&(n=n.subarray(0,r)),e.set(n,t),n.byteLength}class Ir{_buf;_off;constructor(e){this._off=0,this._buf=null!=e?new Uint8Array(e):new Uint8Array(0)}bytes(e={copy:!0}){return!1===e.copy?this._buf.subarray(this._off):this._buf.slice(this._off)}empty(){return this._buf.byteLength<=this._off}get length(){return this._buf.byteLength-this._off}get capacity(){return this._buf.buffer.byteLength}truncate(e){if(0!==e){if(e<0||e>this.length)throw Error("bytes.Buffer: truncation out of range");this._reslice(this._off+e)}else this.reset()}reset(){this._reslice(0),this._off=0}_tryGrowByReslice(e){const t=this._buf.byteLength;return e<=this.capacity-t?(this._reslice(t+e),t):-1}_reslice(e){(function Ns(n,e="Assertion failed."){if(!n)throw new Ts(e)})(e<=this._buf.buffer.byteLength),this._buf=new Uint8Array(this._buf.buffer,0,e)}readByte(){const e=new Uint8Array(1);return this.read(e)?e[0]:null}read(e){if(this.empty())return this.reset(),0===e.byteLength?0:null;const t=ir(this._buf.subarray(this._off),e);return this._off+=t,t}writeByte(e){return this.write(Uint8Array.of(e))}writeString(e){return this.write(Oe.encode(e))}write(e){const t=this._grow(e.byteLength);return ir(e,this._buf,t)}_grow(e){const t=this.length;0===t&&0!==this._off&&this.reset();const r=this._tryGrowByReslice(e);if(r>=0)return r;const s=this.capacity;if(e<=Math.floor(s/2)-t)ir(this._buf.subarray(this._off),this._buf);else{if(s+e>jr)throw new Error("The buffer cannot be grown beyond the maximum size.");{const i=new Uint8Array(Math.min(2*s+e,jr));ir(this._buf.subarray(this._off),i),this._buf=i}}return this._off=0,this._reslice(Math.min(t+e,jr)),t}grow(e){if(e<0)throw Error("Buffer._grow: negative count");const t=this._grow(e);this._reslice(t)}readFrom(e){let t=0;const r=new Uint8Array(32768);for(;;){const s=this.capacity-this.length<32768,i=s?r:new Uint8Array(this._buf.buffer,this.length),o=e.read(i);if(null===o)return t;s?this.write(i.subarray(0,o)):this._reslice(this.length+o),t+=o}}}var Ue=function(n){return n[n.OK=0]="OK",n[n.ERR=1]="ERR",n[n.MSG=2]="MSG",n[n.INFO=3]="INFO",n[n.PING=4]="PING",n[n.PONG=5]="PONG",n}(Ue||{});class xn{dispatcher;state;as;drop;hdr;ma;argBuf;msgBuf;constructor(e){this.dispatcher=e,this.state=U.OP_START,this.as=0,this.drop=0,this.hdr=0}parse(e){let t;for(t=0;t<e.length;t++){const r=e[t];switch(this.state){case U.OP_START:switch(r){case $.M:case $.m:this.state=U.OP_M,this.hdr=-1,this.ma={sid:-1,hdr:-1,size:-1};break;case $.H:case $.h:this.state=U.OP_H,this.hdr=0,this.ma={sid:-1,hdr:-1,size:-1};break;case $.P:case $.p:this.state=U.OP_P;break;case $.PLUS:this.state=U.OP_PLUS;break;case $.MINUS:this.state=U.OP_MINUS;break;case $.I:case $.i:this.state=U.OP_I;break;default:throw this.fail(e.subarray(t))}break;case U.OP_H:switch(r){case $.M:case $.m:this.state=U.OP_M;break;default:throw this.fail(e.subarray(t))}break;case U.OP_M:switch(r){case $.S:case $.s:this.state=U.OP_MS;break;default:throw this.fail(e.subarray(t))}break;case U.OP_MS:switch(r){case $.G:case $.g:this.state=U.OP_MSG;break;default:throw this.fail(e.subarray(t))}break;case U.OP_MSG:switch(r){case $.SPACE:case $.TAB:this.state=U.OP_MSG_SPC;break;default:throw this.fail(e.subarray(t))}break;case U.OP_MSG_SPC:switch(r){case $.SPACE:case $.TAB:continue;default:this.state=U.MSG_ARG,this.as=t}break;case U.MSG_ARG:switch(r){case $.CR:this.drop=1;break;case $.NL:{const s=this.argBuf?this.argBuf.bytes():e.subarray(this.as,t-this.drop);this.processMsgArgs(s),this.drop=0,this.as=t+1,this.state=U.MSG_PAYLOAD,t=this.as+this.ma.size-1;break}default:this.argBuf&&this.argBuf.writeByte(r)}break;case U.MSG_PAYLOAD:if(this.msgBuf)if(this.msgBuf.length>=this.ma.size){const s=this.msgBuf.bytes({copy:!1});this.dispatcher.push({kind:Ue.MSG,msg:this.ma,data:s}),this.argBuf=void 0,this.msgBuf=void 0,this.state=U.MSG_END}else{let s=this.ma.size-this.msgBuf.length;const i=e.length-t;i<s&&(s=i),s>0?(this.msgBuf.write(e.subarray(t,t+s)),t=t+s-1):this.msgBuf.writeByte(r)}else t-this.as>=this.ma.size&&(this.dispatcher.push({kind:Ue.MSG,msg:this.ma,data:e.subarray(this.as,t)}),this.argBuf=void 0,this.msgBuf=void 0,this.state=U.MSG_END);break;case U.MSG_END:if(r!==$.NL)continue;this.drop=0,this.as=t+1,this.state=U.OP_START;break;case U.OP_PLUS:switch(r){case $.O:case $.o:this.state=U.OP_PLUS_O;break;default:throw this.fail(e.subarray(t))}break;case U.OP_PLUS_O:switch(r){case $.K:case $.k:this.state=U.OP_PLUS_OK;break;default:throw this.fail(e.subarray(t))}break;case U.OP_PLUS_OK:r===$.NL&&(this.dispatcher.push({kind:Ue.OK}),this.drop=0,this.state=U.OP_START);break;case U.OP_MINUS:switch(r){case $.E:case $.e:this.state=U.OP_MINUS_E;break;default:throw this.fail(e.subarray(t))}break;case U.OP_MINUS_E:switch(r){case $.R:case $.r:this.state=U.OP_MINUS_ER;break;default:throw this.fail(e.subarray(t))}break;case U.OP_MINUS_ER:switch(r){case $.R:case $.r:this.state=U.OP_MINUS_ERR;break;default:throw this.fail(e.subarray(t))}break;case U.OP_MINUS_ERR:switch(r){case $.SPACE:case $.TAB:this.state=U.OP_MINUS_ERR_SPC;break;default:throw this.fail(e.subarray(t))}break;case U.OP_MINUS_ERR_SPC:switch(r){case $.SPACE:case $.TAB:continue;default:this.state=U.MINUS_ERR_ARG,this.as=t}break;case U.MINUS_ERR_ARG:switch(r){case $.CR:this.drop=1;break;case $.NL:{let s;this.argBuf?(s=this.argBuf.bytes(),this.argBuf=void 0):s=e.subarray(this.as,t-this.drop),this.dispatcher.push({kind:Ue.ERR,data:s}),this.drop=0,this.as=t+1,this.state=U.OP_START;break}default:this.argBuf&&this.argBuf.write(Uint8Array.of(r))}break;case U.OP_P:switch(r){case $.I:case $.i:this.state=U.OP_PI;break;case $.O:case $.o:this.state=U.OP_PO;break;default:throw this.fail(e.subarray(t))}break;case U.OP_PO:switch(r){case $.N:case $.n:this.state=U.OP_PON;break;default:throw this.fail(e.subarray(t))}break;case U.OP_PON:switch(r){case $.G:case $.g:this.state=U.OP_PONG;break;default:throw this.fail(e.subarray(t))}break;case U.OP_PONG:r===$.NL&&(this.dispatcher.push({kind:Ue.PONG}),this.drop=0,this.state=U.OP_START);break;case U.OP_PI:switch(r){case $.N:case $.n:this.state=U.OP_PIN;break;default:throw this.fail(e.subarray(t))}break;case U.OP_PIN:switch(r){case $.G:case $.g:this.state=U.OP_PING;break;default:throw this.fail(e.subarray(t))}break;case U.OP_PING:r===$.NL&&(this.dispatcher.push({kind:Ue.PING}),this.drop=0,this.state=U.OP_START);break;case U.OP_I:switch(r){case $.N:case $.n:this.state=U.OP_IN;break;default:throw this.fail(e.subarray(t))}break;case U.OP_IN:switch(r){case $.F:case $.f:this.state=U.OP_INF;break;default:throw this.fail(e.subarray(t))}break;case U.OP_INF:switch(r){case $.O:case $.o:this.state=U.OP_INFO;break;default:throw this.fail(e.subarray(t))}break;case U.OP_INFO:switch(r){case $.SPACE:case $.TAB:this.state=U.OP_INFO_SPC;break;default:throw this.fail(e.subarray(t))}break;case U.OP_INFO_SPC:switch(r){case $.SPACE:case $.TAB:continue;default:this.state=U.INFO_ARG,this.as=t}break;case U.INFO_ARG:switch(r){case $.CR:this.drop=1;break;case $.NL:{let s;this.argBuf?(s=this.argBuf.bytes(),this.argBuf=void 0):s=e.subarray(this.as,t-this.drop),this.dispatcher.push({kind:Ue.INFO,data:s}),this.drop=0,this.as=t+1,this.state=U.OP_START;break}default:this.argBuf&&this.argBuf.writeByte(r)}break;default:throw this.fail(e.subarray(t))}}(this.state===U.MSG_ARG||this.state===U.MINUS_ERR_ARG||this.state===U.INFO_ARG)&&!this.argBuf&&(this.argBuf=new Ir(e.subarray(this.as,t-this.drop))),this.state===U.MSG_PAYLOAD&&!this.msgBuf&&(this.argBuf||this.cloneMsgArg(),this.msgBuf=new Ir(e.subarray(this.as)))}cloneMsgArg(){const e=this.ma.subject.length,r=new Uint8Array(e+(this.ma.reply?this.ma.reply.length:0));r.set(this.ma.subject),this.ma.reply&&r.set(this.ma.reply,e),this.argBuf=new Ir(r),this.ma.subject=r.subarray(0,e),this.ma.reply&&(this.ma.reply=r.subarray(e))}processMsgArgs(e){if(this.hdr>=0)return this.processHeaderMsgArgs(e);const t=[];let r=-1;for(let s=0;s<e.length;s++)switch(e[s]){case $.SPACE:case $.TAB:case $.CR:case $.NL:r>=0&&(t.push(e.subarray(r,s)),r=-1);break;default:r<0&&(r=s)}switch(r>=0&&t.push(e.subarray(r)),t.length){case 3:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=void 0,this.ma.size=this.protoParseInt(t[2]);break;case 4:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=t[2],this.ma.size=this.protoParseInt(t[3]);break;default:throw this.fail(e,"processMsgArgs Parse Error")}if(this.ma.sid<0)throw this.fail(e,"processMsgArgs Bad or Missing Sid Error");if(this.ma.size<0)throw this.fail(e,"processMsgArgs Bad or Missing Size Error")}fail(e,t=""){return t=t?`${t} [${this.state}]`:`parse error [${this.state}]`,new Error(`${t}: ${fe.decode(e)}`)}processHeaderMsgArgs(e){const t=[];let r=-1;for(let s=0;s<e.length;s++)switch(e[s]){case $.SPACE:case $.TAB:case $.CR:case $.NL:r>=0&&(t.push(e.subarray(r,s)),r=-1);break;default:r<0&&(r=s)}switch(r>=0&&t.push(e.subarray(r)),t.length){case 4:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=void 0,this.ma.hdr=this.protoParseInt(t[2]),this.ma.size=this.protoParseInt(t[3]);break;case 5:this.ma.subject=t[0],this.ma.sid=this.protoParseInt(t[1]),this.ma.reply=t[2],this.ma.hdr=this.protoParseInt(t[3]),this.ma.size=this.protoParseInt(t[4]);break;default:throw this.fail(e,"processHeaderMsgArgs Parse Error")}if(this.ma.sid<0)throw this.fail(e,"processHeaderMsgArgs Bad or Missing Sid Error");if(this.ma.hdr<0||this.ma.hdr>this.ma.size)throw this.fail(e,"processHeaderMsgArgs Bad or Missing Header Size Error");if(this.ma.size<0)throw this.fail(e,"processHeaderMsgArgs Bad or Missing Size Error")}protoParseInt(e){if(0===e.length)return-1;let t=0;for(let r=0;r<e.length;r++){if(e[r]<48||e[r]>57)return-1;t=10*t+(e[r]-48)}return t}}var U=function(n){return n[n.OP_START=0]="OP_START",n[n.OP_PLUS=1]="OP_PLUS",n[n.OP_PLUS_O=2]="OP_PLUS_O",n[n.OP_PLUS_OK=3]="OP_PLUS_OK",n[n.OP_MINUS=4]="OP_MINUS",n[n.OP_MINUS_E=5]="OP_MINUS_E",n[n.OP_MINUS_ER=6]="OP_MINUS_ER",n[n.OP_MINUS_ERR=7]="OP_MINUS_ERR",n[n.OP_MINUS_ERR_SPC=8]="OP_MINUS_ERR_SPC",n[n.MINUS_ERR_ARG=9]="MINUS_ERR_ARG",n[n.OP_M=10]="OP_M",n[n.OP_MS=11]="OP_MS",n[n.OP_MSG=12]="OP_MSG",n[n.OP_MSG_SPC=13]="OP_MSG_SPC",n[n.MSG_ARG=14]="MSG_ARG",n[n.MSG_PAYLOAD=15]="MSG_PAYLOAD",n[n.MSG_END=16]="MSG_END",n[n.OP_H=17]="OP_H",n[n.OP_P=18]="OP_P",n[n.OP_PI=19]="OP_PI",n[n.OP_PIN=20]="OP_PIN",n[n.OP_PING=21]="OP_PING",n[n.OP_PO=22]="OP_PO",n[n.OP_PON=23]="OP_PON",n[n.OP_PONG=24]="OP_PONG",n[n.OP_I=25]="OP_I",n[n.OP_IN=26]="OP_IN",n[n.OP_INF=27]="OP_INF",n[n.OP_INFO=28]="OP_INFO",n[n.OP_INFO_SPC=29]="OP_INFO_SPC",n[n.INFO_ARG=30]="INFO_ARG",n}(U||{}),$=function(n){return n[n.CR="\r".charCodeAt(0)]="CR",n[n.E="E".charCodeAt(0)]="E",n[n.e="e".charCodeAt(0)]="e",n[n.F="F".charCodeAt(0)]="F",n[n.f="f".charCodeAt(0)]="f",n[n.G="G".charCodeAt(0)]="G",n[n.g="g".charCodeAt(0)]="g",n[n.H="H".charCodeAt(0)]="H",n[n.h="h".charCodeAt(0)]="h",n[n.I="I".charCodeAt(0)]="I",n[n.i="i".charCodeAt(0)]="i",n[n.K="K".charCodeAt(0)]="K",n[n.k="k".charCodeAt(0)]="k",n[n.M="M".charCodeAt(0)]="M",n[n.m="m".charCodeAt(0)]="m",n[n.MINUS="-".charCodeAt(0)]="MINUS",n[n.N="N".charCodeAt(0)]="N",n[n.n="n".charCodeAt(0)]="n",n[n.NL="\n".charCodeAt(0)]="NL",n[n.O="O".charCodeAt(0)]="O",n[n.o="o".charCodeAt(0)]="o",n[n.P="P".charCodeAt(0)]="P",n[n.p="p".charCodeAt(0)]="p",n[n.PLUS="+".charCodeAt(0)]="PLUS",n[n.R="R".charCodeAt(0)]="R",n[n.r="r".charCodeAt(0)]="r",n[n.S="S".charCodeAt(0)]="S",n[n.s="s".charCodeAt(0)]="s",n[n.SPACE=" ".charCodeAt(0)]="SPACE",n[n.TAB="\t".charCodeAt(0)]="TAB",n}($||{});function xt(n=""){const e=n.match(/(\d+).(\d+).(\d+)/);if(e)return{major:parseInt(e[1]),minor:parseInt(e[2]),micro:parseInt(e[3])};throw new Error(`'${n}' is not a semver value`)}function Tr(n,e){return n.major<e.major?-1:n.major>e.major?1:n.minor<e.minor?-1:n.minor>e.minor?1:n.micro<e.micro?-1:n.micro>e.micro?1:0}var ne=function(n){return n.JS_KV="js_kv",n.JS_OBJECTSTORE="js_objectstore",n.JS_PULL_MAX_BYTES="js_pull_max_bytes",n.JS_NEW_CONSUMER_CREATE_API="js_new_consumer_create",n.JS_ALLOW_DIRECT="js_allow_direct",n.JS_MULTIPLE_CONSUMER_FILTER="js_multiple_consumer_filter",n.JS_SIMPLIFICATION="js_simplification",n.JS_STREAM_CONSUMER_METADATA="js_stream_consumer_metadata",n.JS_CONSUMER_FILTER_SUBJECTS="js_consumer_filter_subjects",n.JS_STREAM_FIRST_SEQ="js_stream_first_seq",n.JS_STREAM_SUBJECT_TRANSFORM="js_stream_subject_transform",n.JS_STREAM_SOURCE_SUBJECT_TRANSFORM="js_stream_source_subject_transform",n.JS_STREAM_COMPRESSION="js_stream_compression",n.JS_DEFAULT_CONSUMER_LIMITS="js_default_consumer_limits",n}(ne||{});class Fs{server;features;disabled;constructor(e){this.features=new Map,this.disabled=[],this.update(e)}resetDisabled(){this.disabled.length=0,this.update(this.server)}disable(e){this.disabled.push(e),this.update(this.server)}isDisabled(e){return-1!==this.disabled.indexOf(e)}update(e){"string"==typeof e&&(e=xt(e)),this.server=e,this.set(ne.JS_KV,"2.6.2"),this.set(ne.JS_OBJECTSTORE,"2.6.3"),this.set(ne.JS_PULL_MAX_BYTES,"2.8.3"),this.set(ne.JS_NEW_CONSUMER_CREATE_API,"2.9.0"),this.set(ne.JS_ALLOW_DIRECT,"2.9.0"),this.set(ne.JS_MULTIPLE_CONSUMER_FILTER,"2.10.0"),this.set(ne.JS_SIMPLIFICATION,"2.9.4"),this.set(ne.JS_STREAM_CONSUMER_METADATA,"2.10.0"),this.set(ne.JS_CONSUMER_FILTER_SUBJECTS,"2.10.0"),this.set(ne.JS_STREAM_FIRST_SEQ,"2.10.0"),this.set(ne.JS_STREAM_SUBJECT_TRANSFORM,"2.10.0"),this.set(ne.JS_STREAM_SOURCE_SUBJECT_TRANSFORM,"2.10.0"),this.set(ne.JS_STREAM_COMPRESSION,"2.10.0"),this.set(ne.JS_DEFAULT_CONSUMER_LIMITS,"2.10.0"),this.disabled.forEach(t=>{this.features.delete(t)})}set(e,t){this.features.set(e,{min:t,ok:Tr(this.server,xt(t))>=0})}get(e){return this.features.get(e)||{min:"unknown",ok:!1}}supports(e){return this.get(e)?.ok||!1}require(e){return"string"==typeof e&&(e=xt(e)),Tr(this.server,e)>=0}}!function(n){"use strict";var e=function(c,h){this.hi=0|c,this.lo=0|h},t=function(c){var h,u=new Float64Array(16);if(c)for(h=0;h<c.length;h++)u[h]=c[h];return u},r=function(){throw new Error("no PRNG")},s=new Uint8Array(16),i=new Uint8Array(32);i[0]=9;var o=t(),l=t([1]),p=t([56129,1]),m=t([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),y=t([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),_=t([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),S=t([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),E=t([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function k(c,h){return c<<h|c>>>32-h}function R(c,h){var u=255&c[h+3];return(u=(u=u<<8|255&c[h+2])<<8|255&c[h+1])<<8|255&c[h+0]}function se(c,h){return new e(c[h]<<24|c[h+1]<<16|c[h+2]<<8|c[h+3],c[h+4]<<24|c[h+5]<<16|c[h+6]<<8|c[h+7])}function J(c,h,u){var f;for(f=0;f<4;f++)c[h+f]=255&u,u>>>=8}function Me(c,h,u){c[h]=u.hi>>24&255,c[h+1]=u.hi>>16&255,c[h+2]=u.hi>>8&255,c[h+3]=255&u.hi,c[h+4]=u.lo>>24&255,c[h+5]=u.lo>>16&255,c[h+6]=u.lo>>8&255,c[h+7]=255&u.lo}function ke(c,h,u,f,g){var b,M=0;for(b=0;b<g;b++)M|=c[h+b]^u[f+b];return(1&M-1>>>8)-1}function Xe(c,h,u,f){return ke(c,h,u,f,16)}function _t(c,h,u,f){return ke(c,h,u,f,32)}function kt(c,h,u,f,g){var A,q,te,b=new Uint32Array(16),M=new Uint32Array(16),I=new Uint32Array(16),v=new Uint32Array(4);for(A=0;A<4;A++)M[5*A]=R(f,4*A),M[1+A]=R(u,4*A),M[6+A]=R(h,4*A),M[11+A]=R(u,16+4*A);for(A=0;A<16;A++)I[A]=M[A];for(A=0;A<20;A++){for(q=0;q<4;q++){for(te=0;te<4;te++)v[te]=M[(5*q+4*te)%16];for(v[1]^=k(v[0]+v[3]|0,7),v[2]^=k(v[1]+v[0]|0,9),v[3]^=k(v[2]+v[1]|0,13),v[0]^=k(v[3]+v[2]|0,18),te=0;te<4;te++)b[4*q+(q+te)%4]=v[te]}for(te=0;te<16;te++)M[te]=b[te]}if(g){for(A=0;A<16;A++)M[A]=M[A]+I[A]|0;for(A=0;A<4;A++)M[5*A]=M[5*A]-R(f,4*A)|0,M[6+A]=M[6+A]-R(h,4*A)|0;for(A=0;A<4;A++)J(c,4*A,M[5*A]),J(c,16+4*A,M[6+A])}else for(A=0;A<16;A++)J(c,4*A,M[A]+I[A]|0)}function _r(c,h,u,f){return kt(c,h,u,f,!1),0}function vt(c,h,u,f){return kt(c,h,u,f,!0),0}var Qe=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);function jt(c,h,u,f,g,b,M){var A,q,I=new Uint8Array(16),v=new Uint8Array(64);if(!g)return 0;for(q=0;q<16;q++)I[q]=0;for(q=0;q<8;q++)I[q]=b[q];for(;g>=64;){for(_r(v,I,M,Qe),q=0;q<64;q++)c[h+q]=(u?u[f+q]:0)^v[q];for(A=1,q=8;q<16;q++)I[q]=255&(A=A+(255&I[q])|0),A>>>=8;g-=64,h+=64,u&&(f+=64)}if(g>0)for(_r(v,I,M,Qe),q=0;q<g;q++)c[h+q]=(u?u[f+q]:0)^v[q];return 0}function br(c,h,u,f,g){return jt(c,h,null,0,u,f,g)}function It(c,h,u,f,g){var b=new Uint8Array(32);return vt(b,f,g,Qe),br(c,h,u,f.subarray(16),b)}function Yt(c,h,u,f,g,b,M){var I=new Uint8Array(32);return vt(I,b,M,Qe),jt(c,h,u,f,g,b.subarray(16),I)}function bt(c,h){var u,f=0;for(u=0;u<17;u++)c[u]=255&(f=f+(c[u]+h[u]|0)|0),f>>>=8}var Co=new Uint32Array([5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,252]);function Xr(c,h,u,f,g,b){var M,I,v,A,q=new Uint32Array(17),te=new Uint32Array(17),ye=new Uint32Array(17),rt=new Uint32Array(17),Lt=new Uint32Array(17);for(v=0;v<17;v++)te[v]=ye[v]=0;for(v=0;v<16;v++)te[v]=b[v];for(te[3]&=15,te[4]&=252,te[7]&=15,te[8]&=252,te[11]&=15,te[12]&=252,te[15]&=15;g>0;){for(v=0;v<17;v++)rt[v]=0;for(v=0;v<16&&v<g;++v)rt[v]=u[f+v];for(rt[v]=1,f+=v,g-=v,bt(ye,rt),I=0;I<17;I++)for(q[I]=0,v=0;v<17;v++)q[I]=0|q[I]+ye[v]*(v<=I?te[I-v]:320*te[I+17-v]|0);for(I=0;I<17;I++)ye[I]=q[I];for(A=0,v=0;v<16;v++)ye[v]=255&(A=A+ye[v]|0),A>>>=8;for(ye[16]=3&(A=A+ye[16]|0),A=5*(A>>>2)|0,v=0;v<16;v++)ye[v]=255&(A=A+ye[v]|0),A>>>=8;ye[16]=A=A+ye[16]|0}for(v=0;v<17;v++)Lt[v]=ye[v];for(bt(ye,Co),M=0|-(ye[16]>>>7),v=0;v<17;v++)ye[v]^=M&(Lt[v]^ye[v]);for(v=0;v<16;v++)rt[v]=b[v+16];for(rt[16]=0,bt(ye,rt),v=0;v<16;v++)c[h+v]=ye[v];return 0}function es(c,h,u,f,g,b){var M=new Uint8Array(16);return Xr(M,0,u,f,g,b),Xe(c,h,M,0)}function Qr(c,h,u,f,g){var b;if(u<32)return-1;for(Yt(c,0,h,0,u,f,g),Xr(c,16,c,32,u-32,c),b=0;b<16;b++)c[b]=0;return 0}function en(c,h,u,f,g){var b,M=new Uint8Array(32);if(u<32||(It(M,0,32,f,g),0!==es(h,16,h,32,u-32,M)))return-1;for(Yt(c,0,h,0,u,f,g),b=0;b<32;b++)c[b]=0;return 0}function ht(c,h){var u;for(u=0;u<16;u++)c[u]=0|h[u]}function Xt(c){var h,u;for(u=0;u<16;u++)c[u]+=65536,h=Math.floor(c[u]/65536),c[(u+1)*(u<15?1:0)]+=h-1+37*(h-1)*(15===u?1:0),c[u]-=65536*h}function Tt(c,h,u){for(var f,g=~(u-1),b=0;b<16;b++)c[b]^=f=g&(c[b]^h[b]),h[b]^=f}function Nt(c,h){var u,f,g,b=t(),M=t();for(u=0;u<16;u++)M[u]=h[u];for(Xt(M),Xt(M),Xt(M),f=0;f<2;f++){for(b[0]=M[0]-65517,u=1;u<15;u++)b[u]=M[u]-65535-(b[u-1]>>16&1),b[u-1]&=65535;b[15]=M[15]-32767-(b[14]>>16&1),g=b[15]>>16&1,b[14]&=65535,Tt(M,b,1-g)}for(u=0;u<16;u++)c[2*u]=255&M[u],c[2*u+1]=M[u]>>8}function ts(c,h){var u=new Uint8Array(32),f=new Uint8Array(32);return Nt(u,c),Nt(f,h),_t(u,0,f,0)}function rs(c){var h=new Uint8Array(32);return Nt(h,c),1&h[0]}function tn(c,h){var u;for(u=0;u<16;u++)c[u]=h[2*u]+(h[2*u+1]<<8);c[15]&=32767}function et(c,h,u){var f;for(f=0;f<16;f++)c[f]=h[f]+u[f]|0}function tt(c,h,u){var f;for(f=0;f<16;f++)c[f]=h[f]-u[f]|0}function ee(c,h,u){var f,g,b=new Float64Array(31);for(f=0;f<31;f++)b[f]=0;for(f=0;f<16;f++)for(g=0;g<16;g++)b[f+g]+=h[f]*u[g];for(f=0;f<15;f++)b[f]+=38*b[f+16];for(f=0;f<16;f++)c[f]=b[f];Xt(c),Xt(c)}function Je(c,h){ee(c,h,h)}function ns(c,h){var f,u=t();for(f=0;f<16;f++)u[f]=h[f];for(f=253;f>=0;f--)Je(u,u),2!==f&&4!==f&&ee(u,u,h);for(f=0;f<16;f++)c[f]=u[f]}function ss(c,h){var f,u=t();for(f=0;f<16;f++)u[f]=h[f];for(f=250;f>=0;f--)Je(u,u),1!==f&&ee(u,u,h);for(f=0;f<16;f++)c[f]=u[f]}function yr(c,h,u){var b,M,f=new Uint8Array(32),g=new Float64Array(80),I=t(),v=t(),A=t(),q=t(),te=t(),ye=t();for(M=0;M<31;M++)f[M]=h[M];for(f[31]=127&h[31]|64,f[0]&=248,tn(g,u),M=0;M<16;M++)v[M]=g[M],q[M]=I[M]=A[M]=0;for(I[0]=q[0]=1,M=254;M>=0;--M)Tt(I,v,b=f[M>>>3]>>>(7&M)&1),Tt(A,q,b),et(te,I,A),tt(I,I,A),et(A,v,q),tt(v,v,q),Je(q,te),Je(ye,I),ee(I,A,I),ee(A,v,te),et(te,I,A),tt(I,I,A),Je(v,I),tt(A,q,ye),ee(I,A,p),et(I,I,q),ee(A,A,I),ee(I,q,ye),ee(q,v,g),Je(v,te),Tt(I,v,b),Tt(A,q,b);for(M=0;M<16;M++)g[M+16]=I[M],g[M+32]=A[M],g[M+48]=v[M],g[M+64]=q[M];var rt=g.subarray(32),Lt=g.subarray(16);return ns(rt,rt),ee(Lt,Lt,rt),Nt(c,Lt),0}function xr(c,h){return yr(c,h,i)}function is(c,h){return r(h,32),xr(c,h)}function vr(c,h,u){var f=new Uint8Array(32);return yr(f,u,h),vt(c,s,f,Qe)}var os=Qr,Po=en;function Qt(){var b,M,I,c=0,h=0,u=0,f=0,g=65535;for(I=0;I<arguments.length;I++)c+=(b=arguments[I].lo)&g,h+=b>>>16,u+=(M=arguments[I].hi)&g,f+=M>>>16;return new e((u+=(h+=c>>>16)>>>16)&g|(f+=u>>>16)<<16,c&g|h<<16)}function as(c,h){return new e(c.hi>>>h,c.lo>>>h|c.hi<<32-h)}function wr(){var u,c=0,h=0;for(u=0;u<arguments.length;u++)c^=arguments[u].lo,h^=arguments[u].hi;return new e(h,c)}function ot(c,h){var u,f,g=32-h;return h<32?(u=c.hi>>>h|c.lo<<g,f=c.lo>>>h|c.hi<<g):h<64&&(u=c.lo>>>h|c.hi<<g,f=c.hi>>>h|c.lo<<g),new e(u,f)}function Ao(c,h,u){return new e(c.hi&h.hi^~c.hi&u.hi,c.lo&h.lo^~c.lo&u.lo)}function Mo(c,h,u){return new e(c.hi&h.hi^c.hi&u.hi^h.hi&u.hi,c.lo&h.lo^c.lo&u.lo^h.lo&u.lo)}function ko(c){return wr(ot(c,28),ot(c,34),ot(c,39))}function jo(c){return wr(ot(c,14),ot(c,18),ot(c,41))}function Io(c){return wr(ot(c,1),ot(c,8),as(c,7))}function To(c){return wr(ot(c,19),ot(c,61),as(c,6))}var No=[new e(1116352408,3609767458),new e(1899447441,602891725),new e(3049323471,3964484399),new e(3921009573,2173295548),new e(961987163,4081628472),new e(1508970993,3053834265),new e(2453635748,2937671579),new e(2870763221,3664609560),new e(3624381080,2734883394),new e(310598401,1164996542),new e(607225278,1323610764),new e(1426881987,3590304994),new e(1925078388,4068182383),new e(2162078206,991336113),new e(2614888103,633803317),new e(3248222580,3479774868),new e(3835390401,2666613458),new e(4022224774,944711139),new e(264347078,2341262773),new e(604807628,2007800933),new e(770255983,1495990901),new e(1249150122,1856431235),new e(1555081692,3175218132),new e(1996064986,2198950837),new e(2554220882,3999719339),new e(2821834349,766784016),new e(2952996808,2566594879),new e(3210313671,3203337956),new e(3336571891,1034457026),new e(3584528711,2466948901),new e(113926993,3758326383),new e(338241895,168717936),new e(666307205,1188179964),new e(773529912,1546045734),new e(1294757372,1522805485),new e(1396182291,2643833823),new e(1695183700,2343527390),new e(1986661051,1014477480),new e(2177026350,1206759142),new e(2456956037,344077627),new e(2730485921,1290863460),new e(2820302411,3158454273),new e(3259730800,3505952657),new e(3345764771,106217008),new e(3516065817,3606008344),new e(3600352804,1432725776),new e(4094571909,1467031594),new e(275423344,851169720),new e(430227734,3100823752),new e(506948616,1363258195),new e(659060556,3750685593),new e(883997877,3785050280),new e(958139571,3318307427),new e(1322822218,3812723403),new e(1537002063,2003034995),new e(1747873779,3602036899),new e(1955562222,1575990012),new e(2024104815,1125592928),new e(2227730452,2716904306),new e(2361852424,442776044),new e(2428436474,593698344),new e(2756734187,3733110249),new e(3204031479,2999351573),new e(3329325298,3815920427),new e(3391569614,3928383900),new e(3515267271,566280711),new e(3940187606,3454069534),new e(4118630271,4000239992),new e(116418474,1914138554),new e(174292421,2731055270),new e(289380356,3203993006),new e(460393269,320620315),new e(685471733,587496836),new e(852142971,1086792851),new e(1017036298,365543100),new e(1126000580,2618297676),new e(1288033470,3409855158),new e(1501505948,4234509866),new e(1607167915,987167468),new e(1816402316,1246189591)];function cs(c,h,u){var I,v,A,f=[],g=[],b=[],M=[];for(v=0;v<8;v++)f[v]=b[v]=se(c,8*v);for(var q=0;u>=128;){for(v=0;v<16;v++)M[v]=se(h,8*v+q);for(v=0;v<80;v++){for(A=0;A<8;A++)g[A]=b[A];for(I=Qt(b[7],jo(b[4]),Ao(b[4],b[5],b[6]),No[v],M[v%16]),g[7]=Qt(I,ko(b[0]),Mo(b[0],b[1],b[2])),g[3]=Qt(g[3],I),A=0;A<8;A++)b[(A+1)%8]=g[A];if(v%16==15)for(A=0;A<16;A++)M[A]=Qt(M[A],M[(A+9)%16],Io(M[(A+1)%16]),To(M[(A+14)%16]))}for(v=0;v<8;v++)b[v]=Qt(b[v],f[v]),f[v]=b[v];q+=128,u-=128}for(v=0;v<8;v++)Me(c,8*v,f[v]);return u}var Ro=new Uint8Array([106,9,230,103,243,188,201,8,187,103,174,133,132,202,167,59,60,110,243,114,254,148,248,43,165,79,245,58,95,29,54,241,81,14,82,127,173,230,130,209,155,5,104,140,43,62,108,31,31,131,217,171,251,65,189,107,91,224,205,25,19,126,33,121]);function wt(c,h,u){var b,f=new Uint8Array(64),g=new Uint8Array(256),M=u;for(b=0;b<64;b++)f[b]=Ro[b];for(cs(f,h,u),u%=128,b=0;b<256;b++)g[b]=0;for(b=0;b<u;b++)g[b]=h[M-u+b];for(g[u]=128,g[(u=256-128*(u<112?1:0))-9]=0,Me(g,u-8,new e(M/536870912|0,M<<3)),cs(f,g,u),b=0;b<64;b++)c[b]=f[b];return 0}function Sr(c,h){var u=t(),f=t(),g=t(),b=t(),M=t(),I=t(),v=t(),A=t(),q=t();tt(u,c[1],c[0]),tt(q,h[1],h[0]),ee(u,u,q),et(f,c[0],c[1]),et(q,h[0],h[1]),ee(f,f,q),ee(g,c[3],h[3]),ee(g,g,y),ee(b,c[2],h[2]),et(b,b,b),tt(M,f,u),tt(I,b,g),et(v,b,g),et(A,f,u),ee(c[0],M,I),ee(c[1],A,v),ee(c[2],v,I),ee(c[3],M,A)}function ls(c,h,u){var f;for(f=0;f<4;f++)Tt(c[f],h[f],u)}function rn(c,h){var u=t(),f=t(),g=t();ns(g,h[2]),ee(u,h[0],g),ee(f,h[1],g),Nt(c,f),c[31]^=rs(u)<<7}function nn(c,h,u){var f,g;for(ht(c[0],o),ht(c[1],l),ht(c[2],l),ht(c[3],o),g=255;g>=0;--g)ls(c,h,f=u[g/8|0]>>(7&g)&1),Sr(h,c),Sr(c,c),ls(c,h,f)}function Cr(c,h){var u=[t(),t(),t(),t()];ht(u[0],_),ht(u[1],S),ht(u[2],l),ee(u[3],_,S),nn(c,u,h)}function sn(c,h,u){var b,f=new Uint8Array(64),g=[t(),t(),t(),t()];for(u||r(h,32),wt(f,h,32),f[0]&=248,f[31]&=127,f[31]|=64,Cr(g,f),rn(c,g),b=0;b<32;b++)h[b+32]=c[b];return 0}var c,Pr=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function on(c,h){var u,f,g,b;for(f=63;f>=32;--f){for(u=0,g=f-32,b=f-12;g<b;++g)h[g]+=u-16*h[f]*Pr[g-(f-32)],u=Math.floor((h[g]+128)/256),h[g]-=256*u;h[g]+=u,h[f]=0}for(u=0,g=0;g<32;g++)h[g]+=u-(h[31]>>4)*Pr[g],u=h[g]>>8,h[g]&=255;for(g=0;g<32;g++)h[g]-=u*Pr[g];for(f=0;f<32;f++)h[f+1]+=h[f]>>8,c[f]=255&h[f]}function an(c){var u,h=new Float64Array(64);for(u=0;u<64;u++)h[u]=c[u];for(u=0;u<64;u++)c[u]=0;on(c,h)}function us(c,h,u,f){var I,v,g=new Uint8Array(64),b=new Uint8Array(64),M=new Uint8Array(64),A=new Float64Array(64),q=[t(),t(),t(),t()];wt(g,f,32),g[0]&=248,g[31]&=127,g[31]|=64;var te=u+64;for(I=0;I<u;I++)c[64+I]=h[I];for(I=0;I<32;I++)c[32+I]=g[32+I];for(wt(M,c.subarray(32),u+32),an(M),Cr(q,M),rn(c,q),I=32;I<64;I++)c[I]=f[I];for(wt(b,c,u+64),an(b),I=0;I<64;I++)A[I]=0;for(I=0;I<32;I++)A[I]=M[I];for(I=0;I<32;I++)for(v=0;v<32;v++)A[I+v]+=b[I]*g[v];return on(c.subarray(32),A),te}function cn(c,h,u,f){var g,b=new Uint8Array(32),M=new Uint8Array(64),I=[t(),t(),t(),t()],v=[t(),t(),t(),t()];if(u<64||function Fo(c,h){var u=t(),f=t(),g=t(),b=t(),M=t(),I=t(),v=t();return ht(c[2],l),tn(c[1],h),Je(g,c[1]),ee(b,g,m),tt(g,g,c[2]),et(b,c[2],b),Je(M,b),Je(I,M),ee(v,I,M),ee(u,v,g),ee(u,u,b),ss(u,u),ee(u,u,g),ee(u,u,b),ee(u,u,b),ee(c[0],u,b),Je(f,c[0]),ee(f,f,b),ts(f,g)&&ee(c[0],c[0],E),Je(f,c[0]),ee(f,f,b),ts(f,g)?-1:(rs(c[0])===h[31]>>7&&tt(c[0],o,c[0]),ee(c[3],c[0],c[1]),0)}(v,f))return-1;for(g=0;g<u;g++)c[g]=h[g];for(g=0;g<32;g++)c[g+32]=f[g];if(wt(M,c,u),an(M),nn(I,v,M),Cr(v,h.subarray(32)),Sr(I,v),rn(b,I),u-=64,_t(h,0,b,0)){for(g=0;g<u;g++)c[g]=0;return-1}for(g=0;g<u;g++)c[g]=h[g+64];return u}function ds(c,h){if(32!==c.length)throw new Error("bad key size");if(24!==h.length)throw new Error("bad nonce size")}function Ve(){for(var c=0;c<arguments.length;c++)if(!(arguments[c]instanceof Uint8Array))throw new TypeError("unexpected type, use Uint8Array")}function fs(c){for(var h=0;h<c.length;h++)c[h]=0}n.lowlevel={crypto_core_hsalsa20:vt,crypto_stream_xor:Yt,crypto_stream:It,crypto_stream_salsa20_xor:jt,crypto_stream_salsa20:br,crypto_onetimeauth:Xr,crypto_onetimeauth_verify:es,crypto_verify_16:Xe,crypto_verify_32:_t,crypto_secretbox:Qr,crypto_secretbox_open:en,crypto_scalarmult:yr,crypto_scalarmult_base:xr,crypto_box_beforenm:vr,crypto_box_afternm:os,crypto_box:function Eo(c,h,u,f,g,b){var M=new Uint8Array(32);return vr(M,g,b),os(c,h,u,f,M)},crypto_box_open:function Oo(c,h,u,f,g,b){var M=new Uint8Array(32);return vr(M,g,b),Po(c,h,u,f,M)},crypto_box_keypair:is,crypto_hash:wt,crypto_sign:us,crypto_sign_keypair:sn,crypto_sign_open:cn,crypto_secretbox_KEYBYTES:32,crypto_secretbox_NONCEBYTES:24,crypto_secretbox_ZEROBYTES:32,crypto_secretbox_BOXZEROBYTES:16,crypto_scalarmult_BYTES:32,crypto_scalarmult_SCALARBYTES:32,crypto_box_PUBLICKEYBYTES:32,crypto_box_SECRETKEYBYTES:32,crypto_box_BEFORENMBYTES:32,crypto_box_NONCEBYTES:24,crypto_box_ZEROBYTES:32,crypto_box_BOXZEROBYTES:16,crypto_sign_BYTES:64,crypto_sign_PUBLICKEYBYTES:32,crypto_sign_SECRETKEYBYTES:64,crypto_sign_SEEDBYTES:32,crypto_hash_BYTES:64,gf:t,D:m,L:Pr,pack25519:Nt,unpack25519:tn,M:ee,A:et,S:Je,Z:tt,pow2523:ss,add:Sr,set25519:ht,modL:on,scalarmult:nn,scalarbase:Cr},n.randomBytes=function(c){var h=new Uint8Array(c);return r(h,c),h},n.secretbox=function(c,h,u){Ve(c,h,u),ds(u,h);for(var f=new Uint8Array(32+c.length),g=new Uint8Array(f.length),b=0;b<c.length;b++)f[b+32]=c[b];return Qr(g,f,f.length,h,u),g.subarray(16)},n.secretbox.open=function(c,h,u){Ve(c,h,u),ds(u,h);for(var f=new Uint8Array(16+c.length),g=new Uint8Array(f.length),b=0;b<c.length;b++)f[b+16]=c[b];return f.length<32||0!==en(g,f,f.length,h,u)?null:g.subarray(32)},n.secretbox.keyLength=32,n.secretbox.nonceLength=24,n.secretbox.overheadLength=16,n.scalarMult=function(c,h){if(Ve(c,h),32!==c.length)throw new Error("bad n size");if(32!==h.length)throw new Error("bad p size");var u=new Uint8Array(32);return yr(u,c,h),u},n.scalarMult.base=function(c){if(Ve(c),32!==c.length)throw new Error("bad n size");var h=new Uint8Array(32);return xr(h,c),h},n.scalarMult.scalarLength=32,n.scalarMult.groupElementLength=32,n.box=function(c,h,u,f){var g=n.box.before(u,f);return n.secretbox(c,h,g)},n.box.before=function(c,h){Ve(c,h),function $o(c,h){if(32!==c.length)throw new Error("bad public key size");if(32!==h.length)throw new Error("bad secret key size")}(c,h);var u=new Uint8Array(32);return vr(u,c,h),u},n.box.after=n.secretbox,n.box.open=function(c,h,u,f){var g=n.box.before(u,f);return n.secretbox.open(c,h,g)},n.box.open.after=n.secretbox.open,n.box.keyPair=function(){var c=new Uint8Array(32),h=new Uint8Array(32);return is(c,h),{publicKey:c,secretKey:h}},n.box.keyPair.fromSecretKey=function(c){if(Ve(c),32!==c.length)throw new Error("bad secret key size");var h=new Uint8Array(32);return xr(h,c),{publicKey:h,secretKey:new Uint8Array(c)}},n.box.publicKeyLength=32,n.box.secretKeyLength=32,n.box.sharedKeyLength=32,n.box.nonceLength=24,n.box.overheadLength=n.secretbox.overheadLength,n.sign=function(c,h){if(Ve(c,h),64!==h.length)throw new Error("bad secret key size");var u=new Uint8Array(64+c.length);return us(u,c,c.length,h),u},n.sign.open=function(c,h){if(Ve(c,h),32!==h.length)throw new Error("bad public key size");var u=new Uint8Array(c.length),f=cn(u,c,c.length,h);if(f<0)return null;for(var g=new Uint8Array(f),b=0;b<g.length;b++)g[b]=u[b];return g},n.sign.detached=function(c,h){for(var u=n.sign(c,h),f=new Uint8Array(64),g=0;g<f.length;g++)f[g]=u[g];return f},n.sign.detached.verify=function(c,h,u){if(Ve(c,h,u),64!==h.length)throw new Error("bad signature size");if(32!==u.length)throw new Error("bad public key size");var b,f=new Uint8Array(64+c.length),g=new Uint8Array(64+c.length);for(b=0;b<64;b++)f[b]=h[b];for(b=0;b<c.length;b++)f[b+64]=c[b];return cn(g,f,f.length,u)>=0},n.sign.keyPair=function(){var c=new Uint8Array(32),h=new Uint8Array(64);return sn(c,h),{publicKey:c,secretKey:h}},n.sign.keyPair.fromSecretKey=function(c){if(Ve(c),64!==c.length)throw new Error("bad secret key size");for(var h=new Uint8Array(32),u=0;u<h.length;u++)h[u]=c[32+u];return{publicKey:h,secretKey:new Uint8Array(c)}},n.sign.keyPair.fromSeed=function(c){if(Ve(c),32!==c.length)throw new Error("bad seed size");for(var h=new Uint8Array(32),u=new Uint8Array(64),f=0;f<32;f++)u[f]=c[f];return sn(h,u,!0),{publicKey:h,secretKey:u}},n.sign.publicKeyLength=32,n.sign.secretKeyLength=64,n.sign.seedLength=32,n.sign.signatureLength=64,n.hash=function(c){Ve(c);var h=new Uint8Array(64);return wt(h,c,c.length),h},n.hash.hashLength=64,n.verify=function(c,h){return Ve(c,h),0!==c.length&&0!==h.length&&c.length===h.length&&0===ke(c,0,h,0,c.length)},n.setPRNG=function(c){r=c},(c=typeof globalThis<"u"?globalThis.crypto||globalThis.msCrypto:null)&&c.getRandomValues?n.setPRNG(function(u,f){var g,b=new Uint8Array(f);for(g=0;g<f;g+=65536)c.getRandomValues(b.subarray(g,g+Math.min(f-g,65536)));for(g=0;g<f;g++)u[g]=b[g];fs(b)}):typeof require<"u"&&(c=require("crypto"))&&c.randomBytes&&n.setPRNG(function(u,f){var g,b=c.randomBytes(f);for(g=0;g<f;g++)u[g]=b[g];fs(b)})}(typeof module<"u"&&module.exports?module.exports:globalThis.nacl=globalThis.nacl||{});const or=typeof module<"u"&&module.exports?module.exports:globalThis.nacl,Ls={fromSeed:or.sign.keyPair.fromSeed,sign:or.sign.detached,verify:or.sign.detached.verify,randomBytes:or.randomBytes};let vn;new Uint16Array([0,4129,8258,12387,16516,20645,24774,28903,33032,37161,41290,45419,49548,53677,57806,61935,4657,528,12915,8786,21173,17044,29431,25302,37689,33560,45947,41818,54205,50076,62463,58334,9314,13379,1056,5121,25830,29895,17572,21637,42346,46411,34088,38153,58862,62927,50604,54669,13907,9842,5649,1584,30423,26358,22165,18100,46939,42874,38681,34616,63455,59390,55197,51132,18628,22757,26758,30887,2112,6241,10242,14371,51660,55789,59790,63919,35144,39273,43274,47403,23285,19156,31415,27286,6769,2640,14899,10770,56317,52188,64447,60318,39801,35672,47931,43802,27814,31879,19684,23749,11298,15363,3168,7233,60846,64911,52716,56781,44330,48395,36200,40265,32407,28342,24277,20212,15891,11826,7761,3696,65439,61374,57309,53244,48923,44858,40793,36728,37256,33193,45514,41451,53516,49453,61774,57711,4224,161,12482,8419,20484,16421,28742,24679,33721,37784,41979,46042,49981,54044,58239,62302,689,4752,8947,13010,16949,21012,25207,29270,46570,42443,38312,34185,62830,58703,54572,50445,13538,9411,5280,1153,29798,25671,21540,17413,42971,47098,34713,38840,59231,63358,50973,55100,9939,14066,1681,5808,26199,30326,17941,22068,55628,51565,63758,59695,39368,35305,47498,43435,22596,18533,30726,26663,6336,2273,14466,10403,52093,56156,60223,64286,35833,39896,43963,48026,19061,23124,27191,31254,2801,6864,10931,14994,64814,60687,56684,52557,48554,44427,40424,36297,31782,27655,23652,19525,15522,11395,7392,3265,61215,65342,53085,57212,44955,49082,36825,40952,28183,32310,20053,24180,11923,16050,3793,7920]),Error,function Us(n){vn=n}(Ls);function ni(n){const e=`${L}:${N()}`;if((n=n||{servers:[e]}).servers=n.servers||[],"string"==typeof n.servers&&(n.servers=[n.servers]),n.servers.length>0&&n.port)throw new j("port and servers options are mutually exclusive",O.InvalidOption);0===n.servers.length&&n.port&&(n.servers=[`${L}:${n.port}`]),n.servers&&0===n.servers.length&&(n.servers=[e]);const t=V({maxPingOut:2,maxReconnectAttempts:10,noRandomize:!1,pedantic:!1,pingInterval:12e4,reconnect:!0,reconnectJitter:100,reconnectJitterTLS:1e3,reconnectTimeWait:2e3,tls:void 0,verbose:!1,waitOnFirstConnect:!1,ignoreAuthErrorAbort:!1},n);if(t.authenticator=function ri(n){const e=[];return"function"==typeof n.authenticator&&e.push(n.authenticator),Array.isArray(n.authenticator)&&e.push(...n.authenticator),n.token&&e.push(function Ys(n){return()=>({auth_token:"function"==typeof n?n():n})}(n.token)),n.user&&e.push(function Ws(n,e){return()=>({user:"function"==typeof n?n():n,pass:"function"==typeof e?e():e})}(n.user,n.pass)),0===e.length?()=>{}:function Js(n){return e=>{let t={};return n.forEach(r=>{const s=r(e)||{};t=Object.assign(t,s)}),t}}(e)}(t),["reconnectDelayHandler","authenticator"].forEach(r=>{if(t[r]&&"function"!=typeof t[r])throw new j(`${r} option should be a function`,O.NotFunction)}),t.reconnectDelayHandler||(t.reconnectDelayHandler=()=>{let r=t.tls?t.reconnectJitterTLS:t.reconnectJitter;return r&&(r++,r=Math.floor(Math.random()*r)),t.reconnectTimeWait+r}),t.inboxPrefix)try{C(t.inboxPrefix)}catch(r){throw new j(r.message,O.ApiError)}if(t.resolve&&"function"!=typeof Ae())throw new j("'resolve' is not supported on this client",O.InvalidOption);return t}const oi=/^INFO\s+([^\r\n]+)\r\n/i,ai=je("PONG\r\n"),On=je("PING\r\n");class ci{echo;no_responders;protocol;verbose;pedantic;jwt;nkey;sig;user;pass;auth_token;tls_required;name;lang;version;headers;constructor(e,t,r){this.protocol=1,this.version=e.version,this.lang=e.lang,this.echo=!t.noEcho&&void 0,this.verbose=t.verbose,this.pedantic=t.pedantic,this.tls_required=!!t.tls||void 0,this.name=t.name,V(this,(t&&"function"==typeof t.authenticator?t.authenticator(r):{})||{})}}class An extends Re{sid;queue;draining;max;subject;drained;protocol;timer;info;cleanupFn;closed;requestSubject;constructor(e,t,r={}){super(),V(this,r),this.protocol=e,this.subject=t,this.draining=!1,this.noIterator="function"==typeof r.callback,this.closed=z(),r.timeout&&(this.timer=we(r.timeout),this.timer.then(()=>{this.timer=void 0}).catch(s=>{this.stop(s),this.noIterator&&this.callback(s,{})})),this.noIterator||this.iterClosed.then(()=>{this.closed.resolve(),this.unsubscribe()})}setPrePostHandlers(e){if(this.noIterator){const t=this.callback,r=e.ingestionFilterFn?e.ingestionFilterFn:()=>({ingest:!0,protocol:!1}),s=e.protocolFilterFn?e.protocolFilterFn:()=>!0,i=e.dispatchedFn?e.dispatchedFn:()=>{};this.callback=(o,l)=>{const{ingest:p}=r(l);p&&s(l)&&(t(o,l),i(l))}}else this.protocolFilterFn=e.protocolFilterFn,this.dispatchedFn=e.dispatchedFn}callback(e,t){this.cancelTimeout(),e?this.stop(e):this.push(t)}close(){if(!this.isClosed()){this.cancelTimeout();const e=()=>{if(this.stop(),this.cleanupFn)try{this.cleanupFn(this,this.info)}catch{}this.closed.resolve()};this.noIterator?e():this.push(e)}}unsubscribe(e){this.protocol.unsubscribe(this,e)}cancelTimeout(){this.timer&&(this.timer.cancel(),this.timer=void 0)}drain(){return this.protocol.isClosed()?Promise.reject(j.errorForCode(O.ConnectionClosed)):this.isClosed()?Promise.reject(j.errorForCode(O.SubClosed)):(this.drained||(this.draining=!0,this.protocol.unsub(this),this.drained=this.protocol.flush(z()).then(()=>{this.protocol.subscriptions.cancel(this)}).catch(()=>{this.protocol.subscriptions.cancel(this)})),this.drained)}isDraining(){return this.draining}isClosed(){return this.done}getSubject(){return this.subject}getMax(){return this.max}getID(){return this.sid}}class li{mux;subs;sidCounter;constructor(){this.sidCounter=0,this.mux=null,this.subs=new Map}size(){return this.subs.size}add(e){return this.sidCounter++,e.sid=this.sidCounter,this.subs.set(e.sid,e),e}setMux(e){return this.mux=e,e}getMux(){return this.mux}get(e){return this.subs.get(e)}resub(e){return this.sidCounter++,this.subs.delete(e.sid),e.sid=this.sidCounter,this.subs.set(e.sid,e),e}all(){return Array.from(this.subs.values())}cancel(e){e&&(e.close(),this.subs.delete(e.sid))}handleError(e){if(e&&e.permissionContext){const t=e.permissionContext,r=this.all();let s;if("subscription"===t.operation&&(s=r.find(i=>i.subject===t.subject)),"publish"===t.operation&&(s=r.find(i=>i.requestSubject===t.subject)),s)return s.callback(e,{}),s.close(),this.subs.delete(s.sid),s!==this.mux}return!1}close(){this.subs.forEach(e=>{e.close()})}}class lr{connected;connectedOnce;infoReceived;info;muxSubscriptions;options;outbound;pongs;subscriptions;transport;noMorePublishing;connectError;publisher;_closed;closed;listeners;heartbeats;parser;outMsgs;inMsgs;outBytes;inBytes;pendingLimit;lastError;abortReconnect;servers;server;features;connectPromise;constructor(e,t){this._closed=!1,this.connected=!1,this.connectedOnce=!1,this.infoReceived=!1,this.noMorePublishing=!1,this.abortReconnect=!1,this.listeners=[],this.pendingLimit=32768,this.outMsgs=0,this.inMsgs=0,this.outBytes=0,this.inBytes=0,this.options=e,this.publisher=t,this.subscriptions=new li,this.muxSubscriptions=new js,this.outbound=new Ee,this.pongs=[],this.pendingLimit=e.pendingLimit||this.pendingLimit,this.features=new Fs({major:0,minor:0,micro:0}),this.connectPromise=null,this.servers=new Ms("string"==typeof e.servers?[e.servers]:e.servers,{randomize:!e.noRandomize}),this.closed=z(),this.parser=new xn(this),this.heartbeats=new Is(this,this.options.pingInterval||12e4,this.options.maxPingOut||2)}resetOutbound(){this.outbound.reset();const e=this.pongs;this.pongs=[];const t=j.errorForCode(O.Disconnect);t.stack="",e.forEach(r=>{r.reject(t)}),this.parser=new xn(this),this.infoReceived=!1}dispatchStatus(e){this.listeners.forEach(t=>{t.push(e)})}status(){const e=new Re;return this.listeners.push(e),e}prepare(){var e=this;this.transport&&this.transport.discard(),this.info=void 0,this.resetOutbound();const t=z();return t.catch(()=>{}),this.pongs.unshift(t),this.connectError=r=>{t.reject(r)},this.transport=function Q(){if(!T||"function"!=typeof T.factory)throw new Error("transport fn is not set");return T.factory()}(),this.transport.closed().then(function(){var r=(0,d.Z)(function*(s){e.connected=!1,e.isClosed()||(yield e.disconnected(e.transport.closeError||e.lastError))});return function(s){return r.apply(this,arguments)}}()),t}disconnect(){this.dispatchStatus({type:Ye.StaleConnection,data:""}),this.transport.disconnect()}disconnected(e){var t=this;return(0,d.Z)(function*(){t.dispatchStatus({type:Le.Disconnect,data:t.servers.getCurrentServer().toString()}),t.options.reconnect?yield t.dialLoop().then(()=>{t.dispatchStatus({type:Le.Reconnect,data:t.servers.getCurrentServer().toString()}),t.lastError?.code===O.AuthenticationExpired&&(t.lastError=void 0)}).catch(r=>{t._close(r)}):yield t._close(e)})()}dial(e){var t=this;return(0,d.Z)(function*(){const r=t.prepare();let s;try{s=we(t.options.timeout||2e4);const i=t.transport.connect(e,t.options);yield Promise.race([i,s]),(0,d.Z)(function*(){try{var p,o=!1,l=!1;try{for(var y,m=(0,Z.Z)(t.transport);o=!(y=yield m.next()).done;o=!1)t.parser.parse(y.value)}catch(_){l=!0,p=_}finally{try{o&&null!=m.return&&(yield m.return())}finally{if(l)throw p}}}catch(_){console.log("reader closed",_)}})().then()}catch(i){r.reject(i)}try{yield Promise.race([s,r]),s&&s.cancel(),t.connected=!0,t.connectError=void 0,t.sendSubscriptions(),t.connectedOnce=!0,t.server.didConnect=!0,t.server.reconnects=0,t.flushPending(),t.heartbeats.start()}catch(i){throw s&&s.cancel(),yield t.transport.close(i),i}})()}_doDial(e){var t=this;return(0,d.Z)(function*(){const r=yield e.resolve({fn:Ae(),debug:t.options.debug,randomize:!t.options.noRandomize});let s=null;for(const i of r)try{return s=null,t.dispatchStatus({type:Ye.Reconnecting,data:i.toString()}),void(yield t.dial(i))}catch(o){s=o}throw s})()}dialLoop(){return null===this.connectPromise&&(this.connectPromise=this.dodialLoop(),this.connectPromise.then(()=>{}).catch(()=>{}).finally(()=>{this.connectPromise=null})),this.connectPromise}dodialLoop(){var e=this;return(0,d.Z)(function*(){let t;for(;;){e._closed&&e.servers.clear();const r=e.options.reconnectDelayHandler?e.options.reconnectDelayHandler():2e3;let s=r;const i=e.selectServer();if(!i||e.abortReconnect)throw t||(e.lastError?e.lastError:j.errorForCode(O.ConnectionRefused));const o=Date.now();if(0===i.lastConnect||i.lastConnect+r<=o){i.lastConnect=Date.now();try{yield e._doDial(i);break}catch(l){if(t=l,!e.connectedOnce){if(e.options.waitOnFirstConnect)continue;e.servers.removeCurrentServer()}i.reconnects++;const p=e.options.maxReconnectAttempts||0;-1!==p&&i.reconnects>=p&&e.servers.removeCurrentServer()}}else s=Math.min(s,i.lastConnect+r-o),yield G(s)}})()}static connect(e,t){return(0,d.Z)(function*(){const r=new lr(e,t);return yield r.dialLoop(),r})()}static toError(e){const t=e?e.toLowerCase():"";if(-1!==t.indexOf("permissions violation")){const r=new j(e,O.PermissionsViolation),s=e.match(/(Publish|Subscription) to "(\S+)"/);return s&&(r.permissionContext={operation:s[1].toLowerCase(),subject:s[2]}),r}return-1!==t.indexOf("authorization violation")?new j(e,O.AuthorizationViolation):-1!==t.indexOf("user authentication expired")?new j(e,O.AuthenticationExpired):-1!==t.indexOf("authentication timeout")?new j(e,O.AuthenticationTimeout):new j(e,O.ProtocolError)}processMsg(e,t){if(this.inMsgs++,this.inBytes+=t.length,!this.subscriptions.sidCounter)return;const r=this.subscriptions.get(e.sid);r&&(r.received+=1,r.callback&&r.callback(null,new _n(e,t,this)),void 0!==r.max&&r.received>=r.max&&r.unsubscribe())}processError(e){const t=Ke(e),r=lr.toError(t),s={type:Le.Error,data:r.code};if(r.isPermissionError()){let i=!1;r.permissionContext&&(s.permissionContext=r.permissionContext,i=this.subscriptions.getMux()?.subject===r.permissionContext.subject),this.subscriptions.handleError(r),this.muxSubscriptions.handleError(i,r),i&&this.subscriptions.setMux(null)}this.dispatchStatus(s),this.handleError(r)}handleError(e){e.isAuthError()?this.handleAuthError(e):(e.isProtocolError()||e.isAuthTimeout())&&(this.lastError=e),e.isPermissionError()||(this.lastError=e)}handleAuthError(e){this.lastError&&e.code===this.lastError.code&&!1===this.options.ignoreAuthErrorAbort&&(this.abortReconnect=!0),this.connectError?this.connectError(e):this.disconnect()}processPing(){this.transport.send(ai)}processPong(){const e=this.pongs.shift();e&&e.resolve()}processInfo(e){const t=JSON.parse(Ke(e));this.info=t;const r=this.options&&this.options.ignoreClusterUpdates?void 0:this.servers.update(t);if(!this.infoReceived){this.features.update(xt(t.version)),this.infoReceived=!0,this.transport.isEncrypted()&&this.servers.updateTLSName();const{version:i,lang:o}=this.transport;try{const l=new ci({version:i,lang:o},this.options,t.nonce);t.headers&&(l.headers=!0,l.no_responders=!0);const p=JSON.stringify(l);this.transport.send(je(`CONNECT ${p}\r\n`)),this.transport.send(On)}catch(l){this._close(l)}}r&&this.dispatchStatus({type:Le.Update,data:r}),void 0!==t.ldm&&t.ldm&&this.dispatchStatus({type:Le.LDM,data:this.servers.getCurrentServer().toString()})}push(e){switch(e.kind){case Ue.MSG:{const{msg:t,data:r}=e;this.processMsg(t,r);break}case Ue.OK:break;case Ue.ERR:this.processError(e.data);break;case Ue.PING:this.processPing();break;case Ue.PONG:this.processPong();break;case Ue.INFO:this.processInfo(e.data)}}sendCommand(e,...t){const r=this.outbound.length();let s;s="string"==typeof e?je(e):e,this.outbound.fill(s,...t),0===r?queueMicrotask(()=>{this.flushPending()}):this.outbound.size()>=this.pendingLimit&&this.flushPending()}publish(e,t=_e,r){let s;if(t instanceof Uint8Array)s=t;else{if("string"!=typeof t)throw j.errorForCode(O.BadPayload);s=Oe.encode(t)}let i=s.length;(r=r||{}).reply=r.reply||"";let p,o=_e,l=0;if(r.headers){if(this.info&&!this.info.headers)throw new j("headers",O.ServerOptionNotAvailable);o=r.headers.encode(),l=o.length,i=s.length+l}if(this.info&&i>this.info.max_payload)throw j.errorForCode(O.MaxPayloadExceeded);this.outBytes+=i,this.outMsgs++,r.headers?(p=r.reply?`HPUB ${e} ${r.reply} ${l} ${i}\r\n`:`HPUB ${e} ${l} ${i}\r\n`,this.sendCommand(p,o,s,sr)):(p=r.reply?`PUB ${e} ${r.reply} ${i}\r\n`:`PUB ${e} ${i}\r\n`,this.sendCommand(p,s,sr))}request(e){return this.initMux(),this.muxSubscriptions.add(e),e}subscribe(e){return this.subscriptions.add(e),this._subunsub(e),e}_sub(e){this.sendCommand(e.queue?`SUB ${e.subject} ${e.queue} ${e.sid}\r\n`:`SUB ${e.subject} ${e.sid}\r\n`)}_subunsub(e){return this._sub(e),e.max&&this.unsubscribe(e,e.max),e}unsubscribe(e,t){this.unsub(e,t),(void 0===e.max||e.received>=e.max)&&this.subscriptions.cancel(e)}unsub(e,t){!e||this.isClosed()||(this.sendCommand(t?`UNSUB ${e.sid} ${t}\r\n`:`UNSUB ${e.sid}\r\n`),e.max=t)}resub(e,t){!e||this.isClosed()||(e.subject=t,this.subscriptions.resub(e),this._sub(e))}flush(e){return e||(e=z()),this.pongs.push(e),this.outbound.fill(On),this.flushPending(),e}sendSubscriptions(){const e=[];this.subscriptions.all().forEach(t=>{e.push(t.queue?`SUB ${t.subject} ${t.queue} ${t.sid}\r\n`:`SUB ${t.subject} ${t.sid}\r\n`)}),e.length&&this.transport.send(je(e.join("")))}_close(e){var t=this;return(0,d.Z)(function*(){t._closed||(t.heartbeats.cancel(),t.connectError&&(t.connectError(e),t.connectError=void 0),t.muxSubscriptions.close(),t.subscriptions.close(),t.listeners.forEach(r=>{r.stop()}),t._closed=!0,yield t.transport.close(e),yield t.closed.resolve(e))})()}close(){return this._close()}isClosed(){return this._closed}drain(){var e=this;const t=this.subscriptions.all(),r=[];return t.forEach(s=>{r.push(s.drain())}),Promise.all(r).then((0,d.Z)(function*(){return e.noMorePublishing=!0,yield e.flush(),e.close()})).catch(()=>{})}flushPending(){if(this.infoReceived&&this.connected&&this.outbound.size()){const e=this.outbound.drain();this.transport.send(e)}}initMux(){if(!this.subscriptions.getMux()){const t=this.muxSubscriptions.init(this.options.inboxPrefix),r=new An(this,`${t}*`);r.callback=this.muxSubscriptions.dispatcher(),this.subscriptions.setMux(r),this.subscribe(r)}}selectServer(){const e=this.servers.selectServer();if(void 0!==e)return this.server=e,this.server}getServer(){return this.server}}class Mn{token;received;ctx;requestSubject;mux;constructor(e,t){this.mux=e,this.requestSubject=t,this.received=0,this.token=Pe.next(),this.ctx=new Error}}class ui extends Mn{callback;done;timer;max;opts;constructor(e,t,r={maxWait:1e3}){if(super(e,t),this.opts=r,"function"!=typeof this.opts.callback)throw new Error("callback is required");this.callback=this.opts.callback,this.max="number"==typeof r.maxMessages&&r.maxMessages>0?r.maxMessages:-1,this.done=z(),this.done.then(()=>{this.callback(null,null)}),this.timer=setTimeout(()=>{this.cancel()},r.maxWait)}cancel(e){e&&this.callback(e,null),clearTimeout(this.timer),this.mux.cancel(this),this.done.resolve()}resolver(e,t){e?(e.stack+=`\n\n${this.ctx.stack}`,this.cancel(e)):(this.callback(null,t),this.opts.strategy===Ie.Count&&(this.max--,0===this.max&&this.cancel()),this.opts.strategy===Ie.JitterTimer&&(clearTimeout(this.timer),this.timer=setTimeout(()=>{this.cancel()},this.opts.jitter||300)),this.opts.strategy===Ie.SentinelMsg&&t&&0===t.data.length&&this.cancel())}}class kn extends Mn{deferred;timer;constructor(e,t,r={timeout:1e3}){super(e,t),this.deferred=z(),this.timer=we(r.timeout)}resolver(e,t){this.timer&&this.timer.cancel(),e?(e.stack+=`\n\n${this.ctx.stack}`,this.deferred.reject(e)):this.deferred.resolve(t),this.cancel()}cancel(e){this.timer&&this.timer.cancel(),this.mux.cancel(this),this.deferred.reject(e||j.errorForCode(O.Cancelled))}}function Et(n){return Rr("durable",n)}function $e(n){return Rr("stream",n)}function Rr(n,e=""){if(""===e)throw Error(`${n} name required`);return[".","*",">","/","\\"," ","\t","\n","\r"].forEach(r=>{if(-1!==e.indexOf(r)){switch(r){case"\n":r="\\n";break;case"\r":r="\\r";break;case"\t":r="\\t"}throw Error(`invalid ${n} name - ${n} name cannot contain '${r}'`)}}),""}function $t(n,e=""){if(""===e)throw Error(`${n} name required`);const t=function hi(n=""){if(""===n)throw Error("name required");const e=/^[-\w]+$/g;if(null===n.match(e))for(const r of n.split(""))if(null===r.match(e))return`cannot contain '${r}'`;return""}(e);if(t.length)throw new Error(`invalid ${n} name - ${n} name ${t}`)}function be(n){return 1e6*n}function Fr(n){return Math.floor(n/1e6)}function Lr(n){if(n.data.length>0)return!1;const e=n.headers;return!!e&&e.code>=100&&e.code<200}function Ur(n){return Lr(n)&&"Idle Heartbeat"===n.headers?.description}function Ot(n){if(0!==n.data.length)return null;const e=n.headers;return e?jn(e.code,e.description):null}var Ze=function(n){return n.MaxBatchExceeded="exceeded maxrequestbatch of",n.MaxExpiresExceeded="exceeded maxrequestexpires of",n.MaxBytesExceeded="exceeded maxrequestmaxbytes of",n.MaxMessageSizeExceeded="message size exceeds maxbytes",n.PushConsumer="consumer is push based",n.MaxWaitingExceeded="exceeded maxwaiting",n.IdleHeartbeatMissed="idle heartbeats missed",n.ConsumerDeleted="consumer deleted",n}(Ze||{});let fi=!1;function jn(n,e=""){if(n<300)return null;switch(e=e.toLowerCase(),n){case 404:return new j(e,O.JetStream404NoMessages);case 408:return new j(e,O.JetStream408RequestTimeout);case 409:{const t=e.startsWith(Ze.IdleHeartbeatMissed)?O.JetStreamIdleHeartBeat:O.JetStream409;return new j(e,t)}case 503:return j.errorForCode(O.JetStreamNotEnabled,new Error(e));default:return""===e&&(e=O.Unknown),new j(e,`${n}`)}}class Bt{nc;opts;prefix;timeout;jc;constructor(e,t){this.nc=e,this.opts=function gi(n){return(n=n||{}).domain&&(n.apiPrefix=`$JS.${n.domain}.API`,delete n.domain),V({apiPrefix:"$JS.API",timeout:5e3},n)}(t),this._parseOpts(),this.prefix=this.opts.apiPrefix,this.timeout=this.opts.timeout,this.jc=De()}getOptions(){return Object.assign({},this.opts)}_parseOpts(){let e=this.opts.apiPrefix;if(!e||0===e.length)throw new Error("invalid empty prefix");"."===e[e.length-1]&&(e=e.substr(0,e.length-1)),this.opts.apiPrefix=e}_request(e,t=null,r){var s=this;return(0,d.Z)(function*(){(r=r||{}).timeout=s.timeout;let i=_e;t&&(i=s.jc.encode(t));const o=yield s.nc.request(e,i,r);return s.parseJsResponse(o)})()}findStream(e){var t=this;return(0,d.Z)(function*(){const r={subject:e},i=yield t._request(`${t.prefix}.STREAM.NAMES`,r);if(!i.streams||1!==i.streams.length)throw new Error("no stream matches subject");return i.streams[0]})()}getConnection(){return this.nc}parseJsResponse(e){const t=this.jc.decode(e.data),r=t;if(r.error){const s=jn(r.error.code,r.error.description);if(null!==s)throw s.api_error=r.error,s}return t}}class _i{static encode(e){if("string"==typeof e)return btoa(e);const t=Array.from(e);return btoa(String.fromCharCode(...t))}static decode(e,t=!1){const r=atob(e);return t?Uint8Array.from(r,s=>s.charCodeAt(0)):r}}class qt{static encode(e){return qt.toB64URLEncoding(_i.encode(e))}static decode(e,t=!1){return qt.decode(qt.fromB64URLEncoding(e),t)}static toB64URLEncoding(e){return e.replace(/\+/g,"-").replace(/\//g,"_")}static fromB64URLEncoding(e){return e.replace(/_/g,"/").replace(/-/g,"+")}}var In=function(n){return n.Limits="limits",n.Interest="interest",n.Workqueue="workqueue",n}(In||{}),ur=function(n){return n.Old="old",n.New="new",n}(ur||{}),Tn=function(n){return n.File="file",n.Memory="memory",n}(Tn||{}),Ce=function(n){return n.All="all",n.Last="last",n.New="new",n.StartSequence="by_start_sequence",n.StartTime="by_start_time",n.LastPerSubject="last_per_subject",n}(Ce||{}),Te=function(n){return n.None="none",n.All="all",n.Explicit="explicit",n.NotSet="",n}(Te||{}),Dt=function(n){return n.Instant="instant",n.Original="original",n}(Dt||{}),$r=function(n){return n.CreateOrUpdate="",n.Update="update",n.Create="create",n}($r||{}),Be=function(n){return n.StreamSourceHdr="Nats-Stream-Source",n.LastConsumerSeqHdr="Nats-Last-Consumer",n.LastStreamSeqHdr="Nats-Last-Stream",n.ConsumerStalledHdr="Nats-Consumer-Stalled",n.MessageSizeHdr="Nats-Msg-Size",n.RollupHdr="Nats-Rollup",n.RollupValueSubject="sub",n.RollupValueAll="all",n.PendingMessagesHdr="Nats-Pending-Messages",n.PendingBytesHdr="Nats-Pending-Bytes",n}(Be||{}),it=function(n){return n.LastValue="",n.AllHistory="history",n.UpdatesOnly="updates",n}(it||{}),Vt=function(n){return n.Stream="Nats-Stream",n.Sequence="Nats-Sequence",n.TimeStamp="Nats-Time-Stamp",n.Subject="Nats-Subject",n}(Vt||{});const Ge="KV_";class wi{config;ordered;mack;stream;callbackFn;max;qname;isBind;filters;constructor(e){this.stream="",this.mack=!1,this.ordered=!1,this.config=function yi(n,e={}){return Object.assign({name:n,deliver_policy:Ce.All,ack_policy:Te.Explicit,ack_wait:be(3e4),replay_policy:Dt.Instant},e)}("",e||{})}getOpts(){const e={};if(e.config=Object.assign({},this.config),e.config.filter_subject&&(this.filterSubject(e.config.filter_subject),e.config.filter_subject=void 0),e.config.filter_subjects&&(e.config.filter_subjects?.forEach(t=>{this.filterSubject(t)}),e.config.filter_subjects=void 0),e.mack=this.mack,e.stream=this.stream,e.callbackFn=this.callbackFn,e.max=this.max,e.queue=this.qname,e.ordered=this.ordered,e.config.ack_policy=e.ordered?Te.None:e.config.ack_policy,e.isBind=e.isBind||!1,this.filters)switch(this.filters.length){case 0:break;case 1:e.config.filter_subject=this.filters[0];break;default:e.config.filter_subjects=this.filters}return e}description(e){return this.config.description=e,this}deliverTo(e){return this.config.deliver_subject=e,this}durable(e){return Et(e),this.config.durable_name=e,this}startSequence(e){if(e<=0)throw new Error("sequence must be greater than 0");return this.config.deliver_policy=Ce.StartSequence,this.config.opt_start_seq=e,this}startTime(e){return this.config.deliver_policy=Ce.StartTime,this.config.opt_start_time=e.toISOString(),this}deliverAll(){return this.config.deliver_policy=Ce.All,this}deliverLastPerSubject(){return this.config.deliver_policy=Ce.LastPerSubject,this}deliverLast(){return this.config.deliver_policy=Ce.Last,this}deliverNew(){return this.config.deliver_policy=Ce.New,this}startAtTimeDelta(e){return this.startTime(new Date(Date.now()-e)),this}headersOnly(){return this.config.headers_only=!0,this}ackNone(){return this.config.ack_policy=Te.None,this}ackAll(){return this.config.ack_policy=Te.All,this}ackExplicit(){return this.config.ack_policy=Te.Explicit,this}ackWait(e){return this.config.ack_wait=be(e),this}maxDeliver(e){return this.config.max_deliver=e,this}filterSubject(e){return this.filters=this.filters||[],this.filters.push(e),this}replayInstantly(){return this.config.replay_policy=Dt.Instant,this}replayOriginal(){return this.config.replay_policy=Dt.Original,this}sample(e){if((e=Math.trunc(e))<0||e>100)throw new Error("value must be between 0-100");return this.config.sample_freq=`${e}%`,this}limit(e){return this.config.rate_limit_bps=e,this}maxWaiting(e){return this.config.max_waiting=e,this}maxAckPending(e){return this.config.max_ack_pending=e,this}idleHeartbeat(e){return this.config.idle_heartbeat=be(e),this}flowControl(){return this.config.flow_control=!0,this}deliverGroup(e){return this.queue(e),this}manualAck(){return this.mack=!0,this}maxMessages(e){return this.max=e,this}callback(e){return this.callbackFn=e,this}queue(e){return this.qname=e,this.config.deliver_group=e,this}orderedConsumer(){return this.ordered=!0,this}bind(e,t){return this.stream=e,this.config.durable_name=t,this.isBind=!0,this}bindStream(e){return this.stream=e,this}inactiveEphemeralThreshold(e){return this.config.inactive_threshold=be(e),this}maxPullBatch(e){return this.config.max_batch=e,this}maxPullRequestExpires(e){return this.config.max_expires=be(e),this}memory(){return this.config.mem_storage=!0,this}numReplicas(e){return this.config.num_replicas=e,this}}function gt(n){return new wi(n)}function Nn(n){return"function"==typeof n.getOpts}function Rn(n){const e=n.length;let t=n.indexOf("=");return-1===t&&(t=e),[t,t===e?0:4-t%4]}const Fn=[],Ln=[],Br="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";for(let n=0,e=64;n<e;++n)Fn[n]=Br[n],Ln[Br.charCodeAt(n)]=n;const{toUint8Array:Ci,fromUint8Array:Pi}=function Si(n,e,t=!1){function r(o,l){return Math.floor(3*(o+l)/4-l)}function s(o){return n[o>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]}function i(o,l,p){const m=new Array((p-l)/3);for(let y=l,_=0;y<p;y+=3)m[_++]=s((o[y]<<16)+(o[y+1]<<8)+o[y+2]);return m.join("")}return{byteLength:o=>r.apply(null,Rn(o)),toUint8Array(o){const[l,p]=Rn(o),m=new Uint8Array(r(l,p)),y=p?l-4:l;let _,E,S=0;for(E=0;E<y;E+=4)_=e[o.charCodeAt(E)]<<18|e[o.charCodeAt(E+1)]<<12|e[o.charCodeAt(E+2)]<<6|e[o.charCodeAt(E+3)],m[S++]=_>>16&255,m[S++]=_>>8&255,m[S++]=255&_;return 2===p?(_=e[o.charCodeAt(E)]<<2|e[o.charCodeAt(E+1)]>>4,m[S++]=255&_):1===p&&(_=e[o.charCodeAt(E)]<<10|e[o.charCodeAt(E+1)]<<4|e[o.charCodeAt(E+2)]>>2,m[S++]=_>>8&255,m[S++]=255&_),m},fromUint8Array(o){const p=o.length,m=p%3,y=p-m,_=new Array(Math.ceil(y/16383)+(m?1:0));let E,k,S=0;for(let R=0;R<y;R+=16383)E=R+16383,_[S++]=i(o,R,E>y?y:E);return 1===m?(k=o[y],_[S]=n[k>>2]+n[k<<4&63],t||(_[S]+="==")):2===m&&(k=o[y]<<8|255&o[y+1],_[S]=n[k>>10]+n[k>>4&63]+n[k<<2&63],t||(_[S]+="=")),_.join("")}}}(Fn,Ln,!0),Ei=new TextDecoder,Oi=new TextEncoder;class Un{hashSize=32;_buf;_bufIdx;_count;_K;_H;_finalized;constructor(){this._buf=new Uint8Array(64),this._K=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),this.init()}init(){return this._H=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),this._bufIdx=0,this._count=new Uint32Array(2),this._buf.fill(0),this._finalized=!1,this}update(e,t){if(null===e)throw new TypeError("msg must be a string or Uint8Array.");"string"==typeof e&&(e=function ji(n,e="utf8"){if(/^utf-?8$/i.test(e))return Oi.encode(n);if(/^base64$/i.test(e))return Ci(n);if(/^hex(?:adecimal)?$/i.test(e))return function Mi(n){const e=n.length;if(e%2||!/^[0-9a-fA-F]+$/.test(n))throw new TypeError("Invalid hex string.");n=n.toLowerCase();const t=new Uint8Array(Math.floor(e/2)),r=e/2;for(let s=0;s<r;++s)t[s]=parseInt(n.substr(2*s,2),16);return t}(n);throw new TypeError("Unsupported string encoding.")}(e,t));for(let s=0,i=e.length;s<i;s++)this._buf[this._bufIdx++]=e[s],64===this._bufIdx&&(this._transform(),this._bufIdx=0);const r=this._count;return(r[0]+=e.length<<3)<e.length<<3&&r[1]++,r[1]+=e.length>>>29,this}digest(e){if(this._finalized)throw new Error("digest has already been called.");this._finalized=!0;const t=this._buf;let r=this._bufIdx;for(t[r++]=128;56!==r;)64===r&&(this._transform(),r=0),t[r++]=0;const s=this._count;t[56]=s[1]>>>24&255,t[57]=s[1]>>>16&255,t[58]=s[1]>>>8&255,t[59]=s[1]>>>0&255,t[60]=s[0]>>>24&255,t[61]=s[0]>>>16&255,t[62]=s[0]>>>8&255,t[63]=s[0]>>>0&255,this._transform();const i=new Uint8Array(32);for(let o=0;o<8;o++)i[0+(o<<2)]=this._H[o]>>>24&255,i[1+(o<<2)]=this._H[o]>>>16&255,i[2+(o<<2)]=this._H[o]>>>8&255,i[3+(o<<2)]=this._H[o]>>>0&255;return this.init(),e?function ki(n,e="utf8"){if(/^utf-?8$/i.test(e))return Ei.decode(n);if(/^base64$/i.test(e))return Pi(n);if(/^hex(?:adecimal)?$/i.test(e))return function Ai(n){return n.reduce((e,t)=>`${e}${t<16?"0":""}${t.toString(16)}`,"")}(n);throw new TypeError("Unsupported string encoding.")}(i,e):i}_transform(){const e=this._H;let t=e[0],r=e[1],s=e[2],i=e[3],o=e[4],l=e[5],p=e[6],m=e[7];const y=new Uint32Array(16);let _;for(_=0;_<16;_++)y[_]=this._buf[3+(_<<2)]|this._buf[2+(_<<2)]<<8|this._buf[1+(_<<2)]<<16|this._buf[_<<2]<<24;for(_=0;_<64;_++){let S;if(_<16)S=y[_];else{let E=y[_+1&15],k=y[_+14&15];S=y[15&_]=(E>>>7^E>>>18^E>>>3^E<<25^E<<14)+(k>>>17^k>>>19^k>>>10^k<<15^k<<13)+y[15&_]+y[_+9&15]|0}S=S+m+(o>>>6^o>>>11^o>>>25^o<<26^o<<21^o<<7)+(p^o&(l^p))+this._K[_]|0,m=p,p=l,l=o,o=i+S,i=s,s=r,r=t,t=S+(r&s^i&(r^s))+(r>>>2^r>>>13^r>>>22^r<<30^r<<19^r<<10)|0}e[0]=e[0]+t|0,e[1]=e[1]+r|0,e[2]=e[2]+s|0,e[3]=e[3]+i|0,e[4]=e[4]+o|0,e[5]=e[5]+l|0,e[6]=e[6]+p|0,e[7]=e[7]+m|0}}class Ht{err;offset;pageInfo;subject;jsm;filter;payload;constructor(e,t,r,s){if(!e)throw new Error("subject is required");this.subject=e,this.jsm=r,this.offset=0,this.pageInfo={},this.filter=t,this.payload=s||{}}next(){var e=this;return(0,d.Z)(function*(){if(e.err)return[];if(e.pageInfo&&e.offset>=e.pageInfo.total)return[];const t={offset:e.offset};e.payload&&Object.assign(t,e.payload);try{const r=yield e.jsm._request(e.subject,t,{timeout:e.jsm.timeout});return e.pageInfo=r,e.offset+=e.countResponse(r),e.filter(r)}catch(r){throw e.err=r,r}})()}countResponse(e){switch(e?.type){case"io.nats.jetstream.api.v1.stream_names_response":case"io.nats.jetstream.api.v1.stream_list_response":return e.streams.length;case"io.nats.jetstream.api.v1.consumer_list_response":return e.consumers.length;default:return console.error(`jslister.ts: unknown API response for paged output: ${e?.type}`),e.streams?.length||0}return 0}[Symbol.asyncIterator](){var e=this;return He(function*(){let t=yield he(e.next());for(;t.length>0;){for(const r of t)yield r;t=yield he(e.next())}})()}}class qr extends Bt{constructor(e,t){super(e,t)}add(e,t,r=$r.Create){var s=this;return(0,d.Z)(function*(){if($e(e),t.deliver_group&&t.flow_control)throw new Error("jetstream flow control is not supported with queue groups");if(t.deliver_group&&t.idle_heartbeat)throw new Error("jetstream idle heartbeat is not supported with queue groups");const i={};i.config=t,i.stream_name=e,i.action=r,i.config.durable_name&&Et(i.config.durable_name);const o=s.nc;let{min:l,ok:p}=o.features.get(ne.JS_NEW_CONSUMER_CREATE_API);const m=""===t.name?void 0:t.name;if(m&&!p)throw new Error(`consumer 'name' requires server ${l}`);if(m)try{Rr("name",m)}catch(E){const k=E.message,R=k.indexOf("cannot contain");throw-1!==R?new Error(`consumer 'name' ${k.substring(R)}`):E}let y,_="";if(Array.isArray(t.filter_subjects)){const{min:E,ok:k}=o.features.get(ne.JS_MULTIPLE_CONSUMER_FILTER);if(!k)throw new Error(`consumer 'filter_subjects' requires server ${E}`);p=!1}if(t.metadata){const{min:E,ok:k}=o.features.get(ne.JS_STREAM_CONSUMER_METADATA);if(!k)throw new Error(`consumer 'metadata' requires server ${E}`)}if(p&&(_=t.name??t.durable_name??""),""!==_){let E=t.filter_subject??void 0;">"===E&&(E=void 0),y=void 0!==E?`${s.prefix}.CONSUMER.CREATE.${e}.${_}.${E}`:`${s.prefix}.CONSUMER.CREATE.${e}.${_}`}else y=t.durable_name?`${s.prefix}.CONSUMER.DURABLE.CREATE.${e}.${t.durable_name}`:`${s.prefix}.CONSUMER.CREATE.${e}`;return yield s._request(y,i)})()}update(e,t,r){var s=this;return(0,d.Z)(function*(){const i=yield s.info(e,t);return s.add(e,Object.assign(i.config,r),$r.Update)})()}info(e,t){var r=this;return(0,d.Z)(function*(){return $e(e),Et(t),yield r._request(`${r.prefix}.CONSUMER.INFO.${e}.${t}`)})()}delete(e,t){var r=this;return(0,d.Z)(function*(){return $e(e),Et(t),(yield r._request(`${r.prefix}.CONSUMER.DELETE.${e}.${t}`)).success})()}list(e){return $e(e),new Ht(`${this.prefix}.CONSUMER.LIST.${e}`,s=>s.consumers,this)}}const $n=Uint8Array.of(43,65,67,75),Ii=Uint8Array.of(45,78,65,75),zt=Uint8Array.of(43,87,80,73),Ti=Uint8Array.of(43,78,88,84),Ni=Uint8Array.of(43,84,69,82,77),Ri=Uint8Array.of(32);function Zt(n){return new Li(n)}class Li{msg;di;didAck;constructor(e){this.msg=e,this.didAck=!1}get subject(){return this.msg.subject}get sid(){return this.msg.sid}get data(){return this.msg.data}get headers(){return this.msg.headers}get info(){return this.di||(this.di=function Fi(n){const e=n.split(".");if(9===e.length&&e.splice(2,0,"_",""),e.length<11||"$JS"!==e[0]||"ACK"!==e[1])throw new Error("not js message");const t={};return t.domain="_"===e[2]?"":e[2],t.account_hash=e[3],t.stream=e[4],t.consumer=e[5],t.redeliveryCount=parseInt(e[6],10),t.redelivered=t.redeliveryCount>1,t.streamSequence=parseInt(e[7],10),t.deliverySequence=parseInt(e[8],10),t.timestampNanos=parseInt(e[9],10),t.pending=parseInt(e[10],10),t}(this.reply)),this.di}get redelivered(){return this.info.redeliveryCount>1}get reply(){return this.msg.reply||""}get seq(){return this.info.streamSequence}doAck(e){this.didAck||(this.didAck=!this.isWIP(e),this.msg.respond(e))}isWIP(e){return 4===e.length&&e[0]===zt[0]&&e[1]===zt[1]&&e[2]===zt[2]&&e[3]===zt[3]}ackAck(){var e=this;return(0,d.Z)(function*(){if(!e.didAck&&(e.didAck=!0,e.msg.reply)){const r=e.msg.publisher,s=new kn(r.muxSubscriptions,e.msg.reply);r.request(s);try{r.publish(e.msg.reply,$n,{reply:`${r.muxSubscriptions.baseInbox}${s.token}`})}catch(i){s.cancel(i)}try{return yield Promise.race([s.timer,s.deferred]),!0}catch(i){s.cancel(i)}}return!1})()}ack(){this.doAck($n)}nak(e){let t=Ii;e&&(t=function ks(){return{encode:n=>Oe.encode(n),decode:n=>fe.decode(n)}}().encode(`-NAK ${JSON.stringify({delay:be(e)})}`)),this.doAck(t)}working(){this.doAck(zt)}next(e,t={batch:1}){const r={};r.batch=t.batch||1,r.no_wait=t.no_wait||!1,t.expires&&t.expires>0&&(r.expires=be(t.expires));const s=De().encode(r),i=Ee.concat(Ti,Ri,s);this.msg.respond(i,e?{reply:e}:void 0)}term(){this.doAck(Ni)}json(){return this.msg.json()}string(){return this.msg.string()}}function At(n,e,t=!1){if(!0===t&&!n)throw j.errorForCode(O.ApiError,new Error(`${e} is not a function`));if(n&&"function"!=typeof n)throw j.errorForCode(O.ApiError,new Error(`${e} is not a function`))}class Ui extends Re{sub;adapter;subIterDone;constructor(e,t,r){var s;super(),s=this,At(r.adapter,"adapter",!0),this.adapter=r.adapter,r.callback&&At(r.callback,"callback"),this.noIterator="function"==typeof r.callback,r.ingestionFilterFn&&(At(r.ingestionFilterFn,"ingestionFilterFn"),this.ingestionFilterFn=r.ingestionFilterFn),r.protocolFilterFn&&(At(r.protocolFilterFn,"protocolFilterFn"),this.protocolFilterFn=r.protocolFilterFn),r.dispatchedFn&&(At(r.dispatchedFn,"dispatchedFn"),this.dispatchedFn=r.dispatchedFn),r.cleanupFn&&At(r.cleanupFn,"cleanupFn");let i=(y,_)=>{this.callback(y,_)};if(r.callback){const y=r.callback;i=(_,S)=>{const[E,k]=this.adapter(_,S);if(E)return void y(E,null);const{ingest:R}=this.ingestionFilterFn?this.ingestionFilterFn(k,this):{ingest:!0};R&&(!this.protocolFilterFn||this.protocolFilterFn(k))&&(y(E,k),this.dispatchedFn&&k&&this.dispatchedFn(k))}}const{max:o,queue:l,timeout:p}=r,m={queue:l,timeout:p,callback:i};var y;o&&o>0&&(m.max=o),this.sub=e.subscribe(t,m),r.cleanupFn&&(this.sub.cleanupFn=r.cleanupFn),this.noIterator||this.iterClosed.then(()=>{this.unsubscribe()}),this.subIterDone=z(),Promise.all([this.sub.closed,this.iterClosed]).then(()=>{this.subIterDone.resolve()}).catch(()=>{this.subIterDone.resolve()}),(y=(0,d.Z)(function*(_){yield _.closed,s.stop()}),function(_){return y.apply(this,arguments)})(this.sub).then().catch()}unsubscribe(e){this.sub.unsubscribe(e)}drain(){return this.sub.drain()}isDraining(){return this.sub.isDraining()}isClosed(){return this.sub.isClosed()}callback(e,t){this.sub.cancelTimeout();const[r,s]=this.adapter(e,t);r&&this.stop(r),s&&this.push(s)}getSubject(){return this.sub.getSubject()}getReceived(){return this.sub.getReceived()}getProcessed(){return this.sub.getProcessed()}getPending(){return this.sub.getPending()}getID(){return this.sub.getID()}getMax(){return this.sub.getMax()}get closed(){return this.sub.closed}}class Dr{interval;maxOut;cancelAfter;timer;autoCancelTimer;last;missed;count;callback;constructor(e,t,r={maxOut:2}){this.interval=e,this.maxOut=r?.maxOut||2,this.cancelAfter=r?.cancelAfter||0,this.last=Date.now(),this.missed=0,this.count=0,this.callback=t,this._schedule()}cancel(){this.autoCancelTimer&&clearTimeout(this.autoCancelTimer),this.timer&&clearInterval(this.timer),this.timer=0,this.autoCancelTimer=0}work(){this.last=Date.now(),this.missed=0}_change(e,t=0,r=2){this.interval=e,this.maxOut=r,this.cancelAfter=t,this.restart()}restart(){this.cancel(),this._schedule()}_schedule(){this.cancelAfter>0&&(this.autoCancelTimer=setTimeout(()=>{this.cancel()},this.cancelAfter)),this.timer=setInterval(()=>{if(this.count++,Date.now()-this.last>this.interval&&this.missed++,this.missed>=this.maxOut)try{!0===this.callback(this.missed)&&this.cancel()}catch(e){console.log(e)}},this.interval)}}var ut,lt=function(n){return n[n.Unset=-1]="Unset",n[n.Consume=0]="Consume",n[n.Fetch=1]="Fetch",n}(lt||{}),Vr=function(n){return n.HeartbeatsMissed="heartbeats_missed",n}(Vr||{}),hr=function(n){return n.DebugEvent="debug",n.Discard="discard",n.Next="next",n}(hr||{});class Hr extends Re{consumer;opts;sub;monitor;pending;inbox;refilling;stack;pong;callback;timeout;cleanupHandler;listeners;statusIterator;constructor(e,t,r=!1){var s;super(),s=this,this.consumer=e,this.opts=this.parseOptions(t,r),this.callback=t.callback||null,this.noIterator="function"==typeof this.callback,this.monitor=null,this.pong=null,this.pending={msgs:0,bytes:0,requests:0},this.refilling=r,this.stack=(new Error).stack.split("\n").slice(1).join("\n"),this.timeout=null,this.inbox=C(e.api.nc.options.inboxPrefix),this.listeners=[];const{max_messages:i,max_bytes:o,idle_heartbeat:l,threshold_bytes:p,threshold_messages:m}=this.opts;this.closed().then(()=>{if(this.cleanupHandler)try{this.cleanupHandler()}catch{}});const{sub:y}=this;y&&y.unsubscribe(),this.sub=e.api.nc.subscribe(this.inbox,{callback:(_,S)=>{if(_)this.stop();else{if(this.monitor?.work(),S.subject===this.inbox){if(Ur(S))return;const k=S.headers?.code,R=S.headers?.description?.toLowerCase()||"unknown",{msgsLeft:se,bytesLeft:J}=this.parseDiscard(S.headers);if(se>0||J>0)this.pending.msgs-=se,this.pending.bytes-=J,this.pending.requests--,this.notify(hr.Discard,{msgsLeft:se,bytesLeft:J});else{const Me=()=>{const ke=new j(R,`${k}`);return ke.stack+=`\n\n${this.stack}`,ke};if(400===k){const ke=Me();this._push(()=>{this.stop(ke)})}else if(409===k&&"consumer deleted"===R){const ke=Me();this.stop(ke)}else this.notify(hr.DebugEvent,`${k} ${R}`)}}else this._push(Zt(S)),this.received++,this.pending.msgs&&this.pending.msgs--,this.pending.bytes&&(this.pending.bytes-=S.size());if(0===this.pending.msgs&&0===this.pending.bytes&&(this.pending.requests=0),this.refilling){if(i&&this.pending.msgs<=m||o&&this.pending.bytes<=p){const k=this.pullOptions();this.pull(k)}}else 0===this.pending.requests&&this._push(()=>{this.stop()})}}}),this.sub.closed.then(()=>{this.sub.draining&&this._push(()=>{this.stop()})}),l&&(this.monitor=new Dr(l,_=>(this.notify(Vr.HeartbeatsMissed,_),this.resetPending().then(()=>{}).catch(()=>{}),!1),{maxOut:2})),(0,d.Z)(function*(){const _=e.api.nc.status();s.statusIterator=_;var k,S=!1,E=!1;try{for(var se,R=(0,Z.Z)(_);S=!(se=yield R.next()).done;S=!1)switch(se.value.type){case Le.Disconnect:s.monitor?.cancel();break;case Le.Reconnect:s.resetPending().then(Me=>{Me&&s.monitor?.restart()}).catch(()=>{})}}catch(J){E=!0,k=J}finally{try{S&&null!=R.return&&(yield R.return())}finally{if(E)throw k}}})(),this.pull(this.pullOptions())}_push(e){if(this.callback){const t="function"==typeof e?e:null;try{t?t():this.callback(e)}catch(r){this.stop(r)}}else super.push(e)}notify(e,t){this.listeners.length>0&&this.listeners.forEach(r=>{r.done||r.push({type:e,data:t})})}resetPending(){return this.consumer.info().then(e=>(this.pending.msgs=0,this.pending.bytes=0,this.pending.requests=0,this.pull(this.pullOptions()),!0)).catch(e=>("consumer not found"===e.message&&this.stop(e),!1))}pull(e){this.pending.bytes+=e.max_bytes??0,this.pending.msgs+=e.batch??0,this.pending.requests++;const t=this.consumer.api.nc;this._push(()=>{t.publish(`${this.consumer.api.prefix}.CONSUMER.MSG.NEXT.${this.consumer.stream}.${this.consumer.name}`,this.consumer.api.jc.encode(e),{reply:this.inbox}),this.notify(hr.Next,e)})}pullOptions(){return{batch:this.opts.max_messages-this.pending.msgs,max_bytes:this.opts.max_bytes-this.pending.bytes,idle_heartbeat:be(this.opts.idle_heartbeat),expires:be(this.opts.expires)}}parseDiscard(e){const t={msgsLeft:0,bytesLeft:0},r=e?.get(Be.PendingMessagesHdr);r&&(t.msgsLeft=parseInt(r));const s=e?.get(Be.PendingBytesHdr);return s&&(t.bytesLeft=parseInt(s)),t}trackTimeout(e){this.timeout=e}close(){return this.stop(),this.iterClosed}closed(){return this.iterClosed}clearTimers(){this.monitor?.cancel(),this.monitor=null,this.timeout?.cancel(),this.timeout=null}setCleanupHandler(e){this.cleanupHandler=e}stop(e){this.sub?.unsubscribe(),this.clearTimers(),this.statusIterator?.stop(),this._push(()=>{super.stop(e),this.listeners.forEach(t=>{t.stop()})})}parseOptions(e,t=!1){const r=e||{};if(r.max_messages=r.max_messages||0,r.max_bytes=r.max_bytes||0,0!==r.max_messages&&0!==r.max_bytes)throw new Error("only specify one of max_messages or max_bytes");if(0===r.max_messages&&(r.max_messages=100),r.expires=r.expires||3e4,r.expires<1e3)throw new Error("expires should be at least 1000ms");if(r.idle_heartbeat=r.idle_heartbeat||r.expires/2,r.idle_heartbeat=r.idle_heartbeat>3e4?3e4:r.idle_heartbeat,t){const s=Math.round(.75*r.max_messages)||1;r.threshold_messages=r.threshold_messages||s;const i=Math.round(.75*r.max_bytes)||1;r.threshold_bytes=r.threshold_bytes||i}return r}status(){const e=new Re;return this.listeners.push(e),Promise.resolve(e)}}class Bn extends Re{src;constructor(){super()}setSource(e){this.src&&(this.src.setCleanupHandler(),this.src.stop()),this.src=e,this.src.setCleanupHandler(()=>{this.close().catch()})}stop(e){this.src?.stop(e),super.stop(e)}close(){return this.stop(),this.iterClosed}status(){return Promise.reject(new Error("ordered consumers don't report consumer status"))}}class qn{api;_info;stream;name;constructor(e,t){this.api=e,this._info=t,this.stream=t.stream_name,this.name=t.name}consume(e={max_messages:100,expires:3e4}){return Promise.resolve(new Hr(this,e,!0))}fetch(e={max_messages:100,expires:3e4}){const t=new Hr(this,e,!1),s=we(Math.round(1.05*t.opts.expires));return t.closed().then(()=>{s.cancel()}),s.catch(()=>{t.close().catch()}),t.trackTimeout(s),Promise.resolve(t)}next(e={expires:3e4}){const t=z(),r=e;r.max_messages=1;const s=new Hr(this,r,!1),i=Math.round(1.05*s.opts.expires);i>=6e4&&(0,d.Z)(function*(){var m,l=!1,p=!1;try{for(var _,y=(0,Z.Z)(yield s.status());l=!(_=yield y.next()).done;l=!1){const S=_.value;if(S.type===Vr.HeartbeatsMissed&&S.data>=2){t.reject(new Error("consumer missed heartbeats"));break}}}catch(S){p=!0,m=S}finally{try{l&&null!=y.return&&(yield y.return())}finally{if(p)throw m}}})().catch(),(0,d.Z)(function*(){var m,l=!1,p=!1;try{for(var _,y=(0,Z.Z)(s);l=!(_=yield y.next()).done;l=!1){t.resolve(_.value);break}}catch(S){p=!0,m=S}finally{try{l&&null!=y.return&&(yield y.return())}finally{if(p)throw m}}})().catch();const o=we(i);return s.closed().then(()=>{t.resolve(null),o.cancel()}).catch(l=>{t.reject(l)}),o.catch(l=>{t.resolve(null),s.close().catch()}),s.trackTimeout(o),t}delete(){const{stream_name:e,name:t}=this._info;return this.api.delete(e,t)}info(e=!1){if(e)return Promise.resolve(this._info);const{stream_name:t,name:r}=this._info;return this.api.info(t,r).then(s=>(this._info=s,this._info))}}class $i{api;consumerOpts;consumer;opts;cursor;stream;namePrefix;serial;currentConsumer;userCallback;iter;type;startSeq;constructor(e,t,r={}){this.api=e,this.stream=t,this.cursor={stream_seq:1,deliver_seq:0},this.namePrefix=Pe.next(),this.serial=0,this.currentConsumer=null,this.userCallback=null,this.iter=null,this.type=lt.Unset,this.consumerOpts=r,this.startSeq=this.consumerOpts.opt_start_seq||0,this.cursor.stream_seq=this.startSeq>0?this.startSeq-1:0}getConsumerOpts(e){this.serial++;const r={name:`${this.namePrefix}_${this.serial}`,deliver_policy:Ce.StartSequence,opt_start_seq:e=0===e?1:e,ack_policy:Te.None,inactive_threshold:be(3e5),num_replicas:1};return!0===this.consumerOpts.headers_only&&(r.headers_only=!0),Array.isArray(this.consumerOpts.filterSubjects)&&(r.filter_subjects=this.consumerOpts.filterSubjects),"string"==typeof this.consumerOpts.filterSubjects&&(r.filter_subject=this.consumerOpts.filterSubjects),e===this.startSeq+1&&(r.deliver_policy=this.consumerOpts.deliver_policy||Ce.StartSequence,(this.consumerOpts.deliver_policy===Ce.LastPerSubject||this.consumerOpts.deliver_policy===Ce.New||this.consumerOpts.deliver_policy===Ce.Last)&&(delete r.opt_start_seq,r.deliver_policy=this.consumerOpts.deliver_policy),r.deliver_policy===Ce.LastPerSubject&&typeof r.filter_subjects>"u"&&typeof r.filter_subject>"u"&&(r.filter_subject=">"),this.consumerOpts.opt_start_time&&(delete r.opt_start_seq,r.deliver_policy=Ce.StartTime,r.opt_start_time=this.consumerOpts.opt_start_time),this.consumerOpts.inactive_threshold&&(r.inactive_threshold=be(this.consumerOpts.inactive_threshold))),r}resetConsumer(e=0){var t=this;return(0,d.Z)(function*(){if(t.consumer)for(;;)try{yield t.delete();break}catch(i){if("TIMEOUT"!==i.message)throw i}e=0===e?1:e,t.cursor.deliver_seq=0;const r=t.getConsumerOpts(e);let s;for(r.max_deliver=1,r.mem_storage=!0;;)try{s=yield t.api.add(t.stream,r);break}catch(i){if("TIMEOUT"!==i.message)throw i}return s})()}internalHandler(e){return t=>{if(this.serial!==e)return;const r=t.info.deliverySequence;r===this.cursor.deliver_seq+1?(this.cursor.deliver_seq=r,this.cursor.stream_seq=t.info.streamSequence,this.userCallback?this.userCallback(t):this.iter?.push(t)):this.reset(this.opts)}}reset(e={max_messages:100,expires:3e4},t=!1){var r=this;return(0,d.Z)(function*(){r.currentConsumer=yield r.resetConsumer(r.cursor.stream_seq+1),null===r.iter&&(r.iter=new Bn),r.consumer=new qn(r.api,r.currentConsumer),e.callback=r.internalHandler(r.serial);let i=null;if(r.type===lt.Fetch&&t)i=yield r.consumer.fetch(e);else{if(r.type!==lt.Consume)return Promise.reject("reset called with unset consumer type");i=yield r.consumer.consume(e)}return r.iter.setSource(i),r.iter})()}consume(e={max_messages:100,expires:3e4}){if(this.type===lt.Fetch)return Promise.reject(new Error("ordered consumer initialized as fetch"));if(this.type===lt.Consume)return Promise.reject(new Error("ordered consumer doesn't support concurrent consume"));const{callback:t}=e;return t&&(this.userCallback=t),this.type=lt.Consume,this.opts=e,this.reset(e)}fetch(e={max_messages:100,expires:3e4}){if(this.type===lt.Consume)return Promise.reject(new Error("ordered consumer already initialized as consume"));if(!1===this.iter?.done)return Promise.reject(new Error("ordered consumer doesn't support concurrent fetch"));const{callback:t}=e;return t&&(this.userCallback=t),this.type=lt.Fetch,this.opts=e,this.iter=new Bn,this.reset(e,!0)}next(e={expires:3e4}){var t=this;return(0,d.Z)(function*(){const r=z(),s=e;return s.max_messages=1,s.callback=o=>{t.userCallback=null,r.resolve(o)},(yield t.fetch(s)).iterClosed.then(()=>{r.resolve(null)}).catch(o=>{r.reject(o)}),r})()}delete(){return this.currentConsumer?this.api.delete(this.stream,this.currentConsumer.name).then(e=>Promise.resolve(e)).catch(e=>Promise.reject(e)).finally(()=>{this.currentConsumer=null}):Promise.resolve(!1)}info(e){var t=this;return(0,d.Z)(function*(){return null==t.currentConsumer?(t.currentConsumer=yield t.resetConsumer(t.serial),Promise.resolve(t.currentConsumer)):e&&t.currentConsumer?Promise.resolve(t.currentConsumer):t.api.info(t.stream,t.currentConsumer.name)})()}}function dr(n){if(void 0===n)return;const{domain:e}=n;if(void 0===e)return n;const t=Object.assign({},n);if(delete t.domain,""===e)return t;if(t.external)throw new Error("domain and external are both set");return t.external={api:`$JS.${e}.API`},t}const zr="OBJ_";class Dn{api;notified;constructor(e){this.api=e,this.notified=!1}checkVersion(){const e=this.api.nc.features.get(ne.JS_SIMPLIFICATION);return e.ok?Promise.resolve():Promise.reject(new Error(`consumers framework is only supported on servers ${e.min} or better`))}get(e,t={}){var r=this;return(0,d.Z)(function*(){return"object"==typeof t?r.ordered(e,t):(yield r.checkVersion(),r.api.info(e,t).then(s=>void 0!==s.config.deliver_subject?Promise.reject(new Error("push consumer not supported")):new qn(r.api,s)).catch(s=>Promise.reject(s)))})()}ordered(e,t){var r=this;return(0,d.Z)(function*(){yield r.checkVersion();const s=r.api;return new Gr(s.nc,s.opts).info(e).then(o=>Promise.resolve(new $i(r.api,e,t))).catch(o=>Promise.reject(o))})()}}class fr{api;_info;constructor(e,t){this.api=e,this._info=t}get name(){return this._info.config.name}alternates(){return this.info().then(e=>e.alternates?e.alternates:[])}best(){var e=this;return(0,d.Z)(function*(){if(yield e.info(),e._info.alternates){const t=yield e.api.info(e._info.alternates[0].name);return new fr(e.api,t)}return e})()}info(e=!1,t){return e?Promise.resolve(this._info):this.api.info(this.name,t).then(r=>(this._info=r,this._info))}getConsumer(e){return new Dn(new qr(this.api.nc,this.api.opts)).get(this.name,e)}getMessage(e){return this.api.getMessage(this.name,e)}deleteMessage(e,t){return this.api.deleteMessage(this.name,e,t)}}const pr="KV-Operation",qi=/^[-/=.\w]+$/,Di=/^[-/=.>*\w]+$/,Vi=/^[-\w]+$/;function Hi(n){if(n.startsWith(".")||n.endsWith(".")||!qi.test(n))throw new Error(`invalid key: ${n}`)}function zi(n){if(n.startsWith(".")||n.endsWith(".")||!Di.test(n))throw new Error(`invalid key: ${n}`)}function Zi(n){if(n.startsWith(".")||n.endsWith("."))throw new Error(`invalid key: ${n}`);const e=n.split(".");let t=!1;for(let r=0;r<e.length;r++)switch(e[r]){case"*":t=!0;break;case">":if(r!==e.length-1)throw new Error(`invalid key: ${n}`);t=!0}return t}function mr(n){if(!Vi.test(n))throw new Error(`invalid bucket name: ${n}`)}var n;(n=ut||(ut={})).MsgIdHdr="Nats-Msg-Id",n.ExpectedStreamHdr="Nats-Expected-Stream",n.ExpectedLastSeqHdr="Nats-Expected-Last-Sequence",n.ExpectedLastMsgIdHdr="Nats-Expected-Last-Msg-Id",n.ExpectedLastSubjectSequenceHdr="Nats-Expected-Last-Subject-Sequence";class Gt{js;jsm;stream;bucket;direct;codec;prefix;editPrefix;useJsPrefix;_prefixLen;constructor(e,t,r){mr(e),this.js=t,this.jsm=r,this.bucket=e,this.prefix="$KV",this.editPrefix="",this.useJsPrefix=!1,this._prefixLen=0}static create(e,t,r={}){return(0,d.Z)(function*(){mr(t);const s=yield e.jetstreamManager(),i=new Gt(t,e,s);return yield i.init(r),i})()}static bind(e,t,r={}){return(0,d.Z)(function*(){const s=yield e.jetstreamManager(),i=yield s.streams.info(`${Ge}${t}`);mr(i.config.name);const o=new Gt(t,e,s);return Object.assign(o,i),o.codec=r.codec||{key:{encode:n=>n,decode:n=>n},value:{encode:n=>n,decode:n=>n}},o.direct=i.config.allow_direct??!1,o.initializePrefixes(i),o})()}init(e={}){var t=this;return(0,d.Z)(function*(){const r=Object.assign(function Bi(){return{replicas:1,history:1,timeout:2e3,maxBucketSize:-1,maxValueSize:-1,codec:{key:{encode:n=>n,decode:n=>n},value:{encode:n=>n,decode:n=>n}},storage:Tn.File}}(),e);t.codec=r.codec;const s={};t.stream=s.name=e.streamName??t.bucketName(),s.retention=In.Limits,s.max_msgs_per_subject=r.history,r.maxBucketSize&&(r.max_bytes=r.maxBucketSize),r.max_bytes&&(s.max_bytes=r.max_bytes),s.max_msg_size=r.maxValueSize,s.storage=r.storage;const i=e.placementCluster??"";if(i&&(e.placement={},e.placement.cluster=i,e.placement.tags=[]),e.placement&&(s.placement=e.placement),e.republish&&(s.republish=e.republish),e.description&&(s.description=e.description),e.mirror){const S=Object.assign({},e.mirror);S.name.startsWith(Ge)||(S.name=`${Ge}${S.name}`),s.mirror=S,s.mirror_direct=!0}else if(e.sources){const S=e.sources.map(E=>{const k=Object.assign({},E);k.name.startsWith(Ge)||(k.name=`${Ge}${k.name}`)});s.sources=S}else s.subjects=[t.subjectForBucket()];e.metadata&&(s.metadata=e.metadata);const o=t.js.nc,l=o.getServerVersion(),p=!!l&&Tr(l,xt("2.7.2"))>=0;s.discard=p?ur.New:ur.Old;const{ok:m,min:y}=o.features.get(ne.JS_ALLOW_DIRECT);if(!m&&!0===e.allow_direct)return Promise.reject(new Error(`allow_direct is not available on server version ${l?`${l.major}.${l.minor}.${l.micro}`:"unknown"} - requires ${y}`));let _;e.allow_direct="boolean"==typeof e.allow_direct?e.allow_direct:m,s.allow_direct=e.allow_direct,t.direct=s.allow_direct,s.num_replicas=r.replicas,r.ttl&&(s.max_age=be(r.ttl)),s.allow_rollup_hdrs=!0;try{_=yield t.jsm.streams.info(s.name),!_.config.allow_direct&&!0===t.direct&&(t.direct=!1)}catch(S){if("stream not found"!==S.message)throw S;_=yield t.jsm.streams.add(s)}t.initializePrefixes(_)})()}initializePrefixes(e){this._prefixLen=0,this.prefix=`$KV.${this.bucket}`,this.useJsPrefix="$JS.API"!==this.js.apiPrefix;const{mirror:t}=e.config;if(t){let r=t.name;if(r.startsWith(Ge)&&(r=r.substring(3)),t.external&&""!==t.external.api){const s=t.name.substring(3);this.useJsPrefix=!1,this.prefix=`$KV.${s}`,this.editPrefix=`${t.external.api}.$KV.${r}`}else this.editPrefix=this.prefix}}bucketName(){return this.stream??`${Ge}${this.bucket}`}subjectForBucket(){return`${this.prefix}.${this.bucket}.>`}subjectForKey(e,t=!1){const r=[];return t?(this.useJsPrefix&&r.push(this.js.apiPrefix),r.push(""!==this.editPrefix?this.editPrefix:this.prefix)):this.prefix&&r.push(this.prefix),r.push(e),r.join(".")}fullKeyName(e){return""!==this.prefix?`${this.prefix}.${e}`:`$KV.${this.bucket}.${e}`}get prefixLen(){return 0===this._prefixLen&&(this._prefixLen=this.prefix.length+1),this._prefixLen}encodeKey(e){const t=[];for(const r of e.split("."))switch(r){case">":case"*":t.push(r);break;default:t.push(this.codec.key.encode(r))}return t.join(".")}decodeKey(e){const t=[];for(const r of e.split("."))switch(r){case">":case"*":t.push(r);break;default:t.push(this.codec.key.decode(r))}return t.join(".")}validateKey=Hi;validateSearchKey=zi;hasWildcards=Zi;close(){return Promise.resolve()}dataLen(e,t){const r=t&&t.get(Be.MessageSizeHdr)||"";return""!==r?parseInt(r,10):e.length}smToEntry(e){return new Yi(this.bucket,this.prefixLen,e)}jmToEntry(e){const t=this.decodeKey(e.subject.substring(this.prefixLen));return new Xi(this.bucket,t,e)}create(e,t){var r=this;return(0,d.Z)(function*(){let s;try{const o=yield r.put(e,t,{previousSeq:0});return Promise.resolve(o)}catch(o){if(s=o,10071!==o?.api_error?.err_code)return Promise.reject(o)}let i=0;try{const o=yield r.get(e);return"DEL"===o?.operation||"PURGE"===o?.operation?(i=null!==o?o.revision:0,r.update(e,t,i)):Promise.reject(s)}catch(o){return Promise.reject(o)}})()}update(e,t,r){if(r<=0)throw new Error("version must be greater than 0");return this.put(e,t,{previousSeq:r})}put(e,t,r={}){var s=this;return(0,d.Z)(function*(){const i=s.encodeKey(e);s.validateKey(i);const o={};if(void 0!==r.previousSeq){const l=ct();o.headers=l,l.set(ut.ExpectedLastSubjectSequenceHdr,`${r.previousSeq}`)}try{return(yield s.js.publish(s.subjectForKey(i,!0),t,o)).seq}catch(l){const p=l;return p.isJetStreamError()?(p.message=p.api_error?.description,p.code=`${p.api_error?.code}`,Promise.reject(p)):Promise.reject(l)}})()}get(e,t){var r=this;return(0,d.Z)(function*(){const s=r.encodeKey(e);r.validateKey(s);let o,i={last_by_subj:r.subjectForKey(s)};t&&t.revision>0&&(i={seq:t.revision});try{o=r.direct?yield r.jsm.direct.getMessage(r.bucketName(),i):yield r.jsm.streams.getMessage(r.bucketName(),i);const l=r.smToEntry(o);return l.key!==s?null:l}catch(l){if(l.code===O.JetStream404NoMessages)return null;throw l}})()}purge(e){return this._deleteOrPurge(e,"PURGE")}delete(e){return this._deleteOrPurge(e,"DEL")}purgeDeletes(e=18e5){var t=this;return(0,d.Z)(function*(){const r=z(),s=[],i=yield t.watch({key:">",initializedFn:()=>{r.resolve()}});(0,d.Z)(function*(){var _,m=!1,y=!1;try{for(var E,S=(0,Z.Z)(i);m=!(E=yield S.next()).done;m=!1){const k=E.value;("DEL"===k.operation||"PURGE"===k.operation)&&s.push(k)}}catch(k){y=!0,_=k}finally{try{m&&null!=S.return&&(yield S.return())}finally{if(y)throw _}}})().then(),yield r,i.stop();const o=Date.now()-e,l=s.map(m=>{const y=t.subjectForKey(m.key);return m.created.getTime()>=o?t.jsm.streams.purge(t.stream,{filter:y,keep:1}):t.jsm.streams.purge(t.stream,{filter:y,keep:0})}),p=yield Promise.all(l);return p.unshift({success:!0,purged:0}),p.reduce((m,y)=>(m.purged+=y.purged,m))})()}_deleteOrPurge(e,t){var r=this;return(0,d.Z)(function*(){if(!r.hasWildcards(e))return r._doDeleteOrPurge(e,t);const s=yield r.keys(e),i=[];var p,o=!1,l=!1;try{for(var y,m=(0,Z.Z)(s);o=!(y=yield m.next()).done;o=!1)i.push(r._doDeleteOrPurge(y.value,t)),100===i.length&&(yield Promise.all(i),i.length=0)}catch(_){l=!0,p=_}finally{try{o&&null!=m.return&&(yield m.return())}finally{if(l)throw p}}i.length>0&&(yield Promise.all(i))})()}_doDeleteOrPurge(e,t){var r=this;return(0,d.Z)(function*(){const s=r.encodeKey(e);r.validateKey(s);const i=ct();i.set(pr,t),"PURGE"===t&&i.set(Be.RollupHdr,Be.RollupValueSubject),yield r.js.publish(r.subjectForKey(s,!0),_e,{headers:i})})()}_buildCC(e,t,r={}){const s=this.encodeKey(e);this.validateSearchKey(e);let i=Ce.LastPerSubject;return t===it.AllHistory&&(i=Ce.All),t===it.UpdatesOnly&&(i=Ce.New),Object.assign({deliver_policy:i,ack_policy:Te.None,filter_subject:this.fullKeyName(s),flow_control:!0,idle_heartbeat:be(5e3)},r)}remove(e){return this.purge(e)}history(e={}){var t=this;return(0,d.Z)(function*(){const r=e.key??">",s=new Re,i={};let o;i.headers_only=e.headers_only||!1,o=()=>{s.stop()};let l=0;const p=t._buildCC(r,it.AllHistory,i),m=p.filter_subject,y=gt(p);y.bindStream(t.stream),y.orderedConsumer(),y.callback((S,E)=>{if(S)s.stop(S);else if(E){const k=t.jmToEntry(E);s.push(k),s.received++,(o&&l>0&&s.received>=l||0===E.info.pending)&&(s.push(o),o=void 0)}});const _=yield t.js.subscribe(m,y);if(o){const{info:{last:S}}=_,E=S.num_pending+S.delivered.consumer_seq;if(0===E||s.received>=E)try{o()}catch(k){s.stop(k)}finally{o=void 0}else l=E}return s._data=_,s.iterClosed.then(()=>{_.unsubscribe()}),_.closed.then(()=>{s.stop()}).catch(S=>{s.stop(S)}),s})()}watch(e={}){var t=this;return(0,d.Z)(function*(){const r=e.key??">",s=new Re,i={};i.headers_only=e.headers_only||!1;let o=it.LastValue;e.include===it.AllHistory?o=it.AllHistory:e.include===it.UpdatesOnly&&(o=it.UpdatesOnly);const l=!0===e.ignoreDeletes;let p=e.initializedFn,m=0;const y=t._buildCC(r,o,i),_=y.filter_subject,S=gt(y);S.bindStream(t.stream),S.orderedConsumer(),S.callback((k,R)=>{if(k)s.stop(k);else if(R){const se=t.jmToEntry(R);if(l&&"DEL"===se.operation)return;s.push(se),s.received++,p&&(m>0&&s.received>=m||0===R.info.pending)&&(s.push(p),p=void 0)}});const E=yield t.js.subscribe(_,S);if(p){const{info:{last:k}}=E,R=k.num_pending+k.delivered.consumer_seq;if(0===R||s.received>=R)try{p()}catch(se){s.stop(se)}finally{p=void 0}else m=R}return s._data=E,s.iterClosed.then(()=>{E.unsubscribe()}),E.closed.then(()=>{s.stop()}).catch(k=>{s.stop(k)}),s})()}keys(e=">"){var t=this;return(0,d.Z)(function*(){const r=new Re,s=t._buildCC(e,it.LastValue,{headers_only:!0}),i=s.filter_subject,o=gt(s);o.bindStream(t.stream),o.orderedConsumer();const l=yield t.js.subscribe(i,o);return(0,d.Z)(function*(){var _,m=!1,y=!1;try{for(var E,S=(0,Z.Z)(l);m=!(E=yield S.next()).done;m=!1){const k=E.value;{const R=k.headers?.get(pr);if("DEL"!==R&&"PURGE"!==R){const se=t.decodeKey(k.subject.substring(t.prefixLen));r.push(se)}0===k.info.pending&&l.unsubscribe()}}}catch(k){y=!0,_=k}finally{try{m&&null!=S.return&&(yield S.return())}finally{if(y)throw _}}})().then(()=>{r.stop()}).catch(m=>{r.stop(m)}),0===l.info.last.num_pending&&l.unsubscribe(),r})()}purgeBucket(e){return this.jsm.streams.purge(this.bucketName(),e)}destroy(){return this.jsm.streams.delete(this.bucketName())}status(){var e=this;return(0,d.Z)(function*(){const r=e.js.nc.info?.cluster??"",s=e.bucketName(),i=yield e.jsm.streams.info(s);return new zn(i,r)})()}}class zn{si;cluster;constructor(e,t=""){this.si=e,this.cluster=t}get bucket(){return this.si.config.name.startsWith(Ge)?this.si.config.name.substring(3):this.si.config.name}get values(){return this.si.state.messages}get history(){return this.si.config.max_msgs_per_subject}get ttl(){return Fr(this.si.config.max_age)}get bucket_location(){return this.cluster}get backingStore(){return this.si.config.storage}get storage(){return this.si.config.storage}get replicas(){return this.si.config.num_replicas}get description(){return this.si.config.description??""}get maxBucketSize(){return this.si.config.max_bytes}get maxValueSize(){return this.si.config.max_msg_size}get max_bytes(){return this.si.config.max_bytes}get placement(){return this.si.config.placement||{cluster:"",tags:[]}}get placementCluster(){return this.si.config.placement?.cluster??""}get republish(){return this.si.config.republish??{src:"",dest:""}}get streamInfo(){return this.si}get size(){return this.si.state.bytes}get metadata(){return this.si.config.metadata??{}}}const Zn="SHA-256=";class Zr{si;backingStore;constructor(e){this.si=e,this.backingStore="JetStream"}get bucket(){return function Ji(n){return n.startsWith(zr)?n.substring(4):n}(this.si.config.name)}get description(){return this.si.config.description??""}get ttl(){return this.si.config.max_age}get storage(){return this.si.config.storage}get replicas(){return this.si.config.num_replicas}get sealed(){return this.si.config.sealed}get size(){return this.si.state.bytes}get streamInfo(){return this.si}get metadata(){return this.si.config.metadata}}class Gr extends Bt{constructor(e,t){super(e,t)}checkStreamConfigVersions(e){const t=this.nc;if(e.metadata){const{min:s,ok:i}=t.features.get(ne.JS_STREAM_CONSUMER_METADATA);if(!i)throw new Error(`stream 'metadata' requires server ${s}`)}if(e.first_seq){const{min:s,ok:i}=t.features.get(ne.JS_STREAM_FIRST_SEQ);if(!i)throw new Error(`stream 'first_seq' requires server ${s}`)}if(e.subject_transform){const{min:s,ok:i}=t.features.get(ne.JS_STREAM_SUBJECT_TRANSFORM);if(!i)throw new Error(`stream 'subject_transform' requires server ${s}`)}if(e.compression){const{min:s,ok:i}=t.features.get(ne.JS_STREAM_COMPRESSION);if(!i)throw new Error(`stream 'compression' requires server ${s}`)}if(e.consumer_limits){const{min:s,ok:i}=t.features.get(ne.JS_DEFAULT_CONSUMER_LIMITS);if(!i)throw new Error(`stream 'consumer_limits' requires server ${s}`)}function r(s,i){if((i.subject_transforms?.length||0)>0){const{min:l,ok:p}=t.features.get(ne.JS_STREAM_SOURCE_SUBJECT_TRANSFORM);if(!p)throw new Error(`${s} 'subject_transforms' requires server ${l}`)}}e.sources&&e.sources.forEach(s=>{r("stream sources",s)}),e.mirror&&r("stream mirror",e.mirror)}add(e={}){var t=this;return(0,d.Z)(function*(){t.checkStreamConfigVersions(e),$e(e.name),e.mirror=dr(e.mirror),e.sources=e.sources?.map(dr);const s=yield t._request(`${t.prefix}.STREAM.CREATE.${e.name}`,e);return t._fixInfo(s),s})()}delete(e){var t=this;return(0,d.Z)(function*(){return $e(e),(yield t._request(`${t.prefix}.STREAM.DELETE.${e}`)).success})()}update(e,t={}){var r=this;return(0,d.Z)(function*(){if("object"==typeof e){const p=e;e=p.name,t=p,console.trace("\x1b[33m >> streams.update(config: StreamConfig) api changed to streams.update(name: string, config: StreamUpdateConfig) - this shim will be removed - update your code.  \x1b[0m")}r.checkStreamConfigVersions(t),$e(e);const s=yield r.info(e),i=Object.assign(s.config,t);i.mirror=dr(i.mirror),i.sources=i.sources?.map(dr);const l=yield r._request(`${r.prefix}.STREAM.UPDATE.${e}`,i);return r._fixInfo(l),l})()}info(e,t){var r=this;return(0,d.Z)(function*(){$e(e);const s=`${r.prefix}.STREAM.INFO.${e}`;let o=yield r._request(s,t),{total:l,limit:p}=o,m=o.state.subjects?Object.getOwnPropertyNames(o.state.subjects).length:1;if(l&&l>m){const y=[o],_=t||{};let S=0;for(;l>m;){S++,_.offset=p*S;const k=yield r._request(s,_);l=k.total,y.push(k);const R=Object.getOwnPropertyNames(k.state.subjects).length;if(m+=R,R<p)break}let E={};for(let k=0;k<y.length;k++)o=y[k],o.state.subjects&&(E=Object.assign(E,o.state.subjects));o.offset=0,o.total=0,o.limit=0,o.state.subjects=E}return r._fixInfo(o),o})()}list(e=""){return new Ht(`${this.prefix}.STREAM.LIST`,i=>{const o=i;return o.streams.forEach(l=>{this._fixInfo(l)}),o.streams},this,e?.length?{subject:e}:{})}_fixInfo(e){e.config.sealed=e.config.sealed||!1,e.config.deny_delete=e.config.deny_delete||!1,e.config.deny_purge=e.config.deny_purge||!1,e.config.allow_rollup_hdrs=e.config.allow_rollup_hdrs||!1}purge(e,t){var r=this;return(0,d.Z)(function*(){if(t){const{keep:i,seq:o}=t;if("number"==typeof i&&"number"==typeof o)throw new Error("can specify one of keep or seq")}return $e(e),yield r._request(`${r.prefix}.STREAM.PURGE.${e}`,t)})()}deleteMessage(e,t,r=!0){var s=this;return(0,d.Z)(function*(){$e(e);const i={seq:t};return r||(i.no_erase=!0),(yield s._request(`${s.prefix}.STREAM.MSG.DELETE.${e}`,i)).success})()}getMessage(e,t){var r=this;return(0,d.Z)(function*(){$e(e);const i=yield r._request(`${r.prefix}.STREAM.MSG.GET.${e}`,t);return new Ki(i)})()}find(e){return this.findStream(e)}listKvs(){return new Ht(`${this.prefix}.STREAM.LIST`,r=>{const i=r.streams.filter(p=>p.config.name.startsWith(Ge));i.forEach(p=>{this._fixInfo(p)});let o="";return i.length&&(o=this.nc.info?.cluster??""),i.map(p=>new zn(p,o))},this)}listObjectStores(){return new Ht(`${this.prefix}.STREAM.LIST`,r=>{const i=r.streams.filter(l=>l.config.name.startsWith(zr));return i.forEach(l=>{this._fixInfo(l)}),i.map(l=>new Zr(l))},this)}names(e=""){return new Ht(`${this.prefix}.STREAM.NAMES`,i=>i.streams,this,e?.length?{subject:e}:{})}get(e){var t=this;return(0,d.Z)(function*(){const r=yield t.info(e);return Promise.resolve(new fr(t,r))})()}}let Ki=(()=>class n{_header;smr;static jc;constructor(t){this.smr=t}get subject(){return this.smr.message.subject}get seq(){return this.smr.message.seq}get timestamp(){return this.smr.message.time}get time(){return new Date(Date.parse(this.timestamp))}get data(){return this.smr.message.data?this._parse(this.smr.message.data):_e}get header(){if(!this._header)if(this.smr.message.hdrs){const t=this._parse(this.smr.message.hdrs);this._header=pt.decode(t)}else this._header=ct();return this._header}_parse(t){const r=atob(t),s=r.length,i=new Uint8Array(s);for(let o=0;o<s;o++)i[o]=r.charCodeAt(o);return i}json(t){return De(t).decode(this.data)}string(){return fe.decode(this.data)}})();class Wi{api;constructor(e){this.api=e}get(e){return this.api.info(e).then(t=>new fr(this.api,t))}}class Yi{bucket;sm;prefixLen;constructor(e,t,r){this.bucket=e,this.prefixLen=t,this.sm=r}get key(){return this.sm.subject.substring(this.prefixLen)}get value(){return this.sm.data}get delta(){return 0}get created(){return this.sm.time}get revision(){return this.sm.seq}get operation(){return this.sm.header.get(pr)||"PUT"}get length(){const e=this.sm.header.get(Be.MessageSizeHdr)||"";return""!==e?parseInt(e,10):this.sm.data.length}json(){return this.sm.json()}string(){return this.sm.string()}}class Xi{bucket;key;sm;constructor(e,t,r){this.bucket=e,this.key=t,this.sm=r}get value(){return this.sm.data}get created(){return new Date(Fr(this.sm.info.timestampNanos))}get revision(){return this.sm.seq}get operation(){return this.sm.headers?.get(pr)||"PUT"}get delta(){return this.sm.info.pending}get length(){const e=this.sm.headers?.get(Be.MessageSizeHdr)||"";return""!==e?parseInt(e,10):this.sm.data.length}json(){return this.sm.json()}string(){return this.sm.string()}}class Jr{info;hdrs;constructor(e){this.info=e}get name(){return this.info.name}get description(){return this.info.description??""}get headers(){return this.hdrs||(this.hdrs=pt.fromRecord(this.info.headers||{})),this.hdrs}get options(){return this.info.options}get bucket(){return this.info.bucket}get chunks(){return this.info.chunks}get deleted(){return this.info.deleted??!1}get digest(){return this.info.digest}get mtime(){return this.info.mtime}get nuid(){return this.info.nuid}get size(){return this.info.size}get revision(){return this.info.revision}get metadata(){return this.info.metadata||{}}isLink(){return void 0!==this.info.options?.link}}function Gn(n){const e={name:n.name,description:n.description??"",options:n.options,metadata:n.metadata};return n.headers&&(e.headers=n.headers.toRecord()),e}class Jt{jsm;js;stream;name;constructor(e,t,r){this.name=e,this.jsm=t,this.js=r}_checkNotEmpty(e){return e&&0!==e.length?{name:e}:{name:e,error:new Error("name cannot be empty")}}info(e){var t=this;return(0,d.Z)(function*(){const r=yield t.rawInfo(e);return r?new Jr(r):null})()}list(){var e=this;return(0,d.Z)(function*(){const t=[],r=yield e.watch({ignoreDeletes:!0,includeHistory:!0});var o,s=!1,i=!1;try{for(var p,l=(0,Z.Z)(r);s=!(p=yield l.next()).done;s=!1){const m=p.value;if(null===m)break;t.push(m)}}catch(m){i=!0,o=m}finally{try{s&&null!=l.return&&(yield l.return())}finally{if(i)throw o}}return Promise.resolve(t)})()}rawInfo(e){var t=this;return(0,d.Z)(function*(){const{name:r,error:s}=t._checkNotEmpty(e);if(s)return Promise.reject(s);const i=t._metaSubject(r);try{const o=yield t.jsm.streams.getMessage(t.stream,{last_by_subj:i}),p=De().decode(o.data);return p.revision=o.seq,p}catch(o){return"404"===o.code?null:Promise.reject(o)}})()}_si(e){var t=this;return(0,d.Z)(function*(){try{return yield t.jsm.streams.info(t.stream,e)}catch(r){return"404"===r.code?null:Promise.reject(r)}})()}seal(){var e=this;return(0,d.Z)(function*(){let t=yield e._si();return null===t?Promise.reject(new Error("object store not found")):(t.config.sealed=!0,t=yield e.jsm.streams.update(e.stream,t.config),Promise.resolve(new Zr(t)))})()}status(e){var t=this;return(0,d.Z)(function*(){const r=yield t._si(e);return null===r?Promise.reject(new Error("object store not found")):Promise.resolve(new Zr(r))})()}destroy(){return this.jsm.streams.delete(this.stream)}_put(e,t,r){var s=this;return(0,d.Z)(function*(){const i=s.js.getOptions();(r=r||{timeout:i.timeout}).timeout=r.timeout||i.timeout,r.previousRevision=r.previousRevision??void 0;const{timeout:o,previousRevision:l}=r,m=s.js.nc.info?.max_payload||1024;(e=e||{}).options=e.options||{};let y=e.options?.max_chunk_size||131072;y=y>m?m:y,e.options.max_chunk_size=y;const _=yield s.info(e.name),{name:S,error:E}=s._checkNotEmpty(e.name);if(E)return Promise.reject(E);const k=Pe.next(),R=s._chunkSubject(k),se=s._metaSubject(S),J=Object.assign({bucket:s.name,nuid:k,size:0,chunks:0},Gn(e)),Me=z(),ke=[],Xe=new Ee;try{const _t=t?t.getReader():null,kt=new Un;for(;;){const{done:_r,value:vt}=_t?yield _t.read():{done:!0,value:void 0};if(_r){if(Xe.size()>0){const bt=Xe.drain();kt.update(bt),J.chunks++,J.size+=bt.length,ke.push(s.js.publish(R,bt,{timeout:o}))}yield Promise.all(ke),ke.length=0,J.mtime=(new Date).toISOString();const Qe=kt.digest("base64"),jt=Qe.length%3,br=jt>0?"=".repeat(jt):"";J.digest=`${Zn}${Qe}${br}`,J.deleted=!1;const It=ct();"number"==typeof l&&It.set(ut.ExpectedLastSubjectSequenceHdr,`${l}`),It.set(Be.RollupHdr,Be.RollupValueSubject);const Yt=yield s.js.publish(se,De().encode(J),{headers:It,timeout:o});if(J.revision=Yt.seq,_)try{yield s.jsm.streams.purge(s.stream,{filter:`$O.${s.name}.C.${_.nuid}`})}catch{}Me.resolve(new Jr(J));break}if(vt)for(Xe.fill(vt);Xe.size()>y;){J.chunks++,J.size+=y;const Qe=Xe.drain(e.options.max_chunk_size);kt.update(Qe),ke.push(s.js.publish(R,Qe,{timeout:o}))}}}catch(_t){yield s.jsm.streams.purge(s.stream,{filter:R}),Me.reject(_t)}return Me})()}putBlob(e,t,r){return null===t&&(t=new Uint8Array(0)),this.put(e,function s(i){return new ReadableStream({pull(o){o.enqueue(i),o.close()}})}(t),r)}put(e,t,r){return e?.options?.link?Promise.reject(new Error("link cannot be set when putting the object in bucket")):this._put(e,t,r)}getBlob(e){var t=this;return(0,d.Z)(function*(){function s(){return(s=(0,d.Z)(function*(l){const p=new Ee,m=l.getReader();for(;;){const{done:y,value:_}=yield m.read();if(y)return p.drain();_&&_.length&&p.fill(_)}})).apply(this,arguments)}const i=yield t.get(e);if(null===i)return Promise.resolve(null);const o=yield Promise.all([i.error,function r(l){return s.apply(this,arguments)}(i.data)]);return o[0]?Promise.reject(o[0]):Promise.resolve(o[1])})()}get(e){var t=this;return(0,d.Z)(function*(){const r=yield t.rawInfo(e);if(null===r||r.deleted)return Promise.resolve(null);if(r.options&&r.options.link){const _=r.options.link.name||"";if(""===_)throw new Error("link is a bucket");return(r.options.link.bucket!==t.name?yield Jt.create(t.js,r.options.link.bucket):t).get(_)}const s=z(),i={info:new Jr(r),error:s};if(0===r.size)return i.data=function Qi(){return new ReadableStream({pull(n){n.enqueue(new Uint8Array(0)),n.close()}})}(),s.resolve(null),Promise.resolve(i);let o;const l=gt();l.orderedConsumer();const p=new Un,m=`$O.${t.name}.C.${r.nuid}`,y=yield t.js.subscribe(m,l);return(0,d.Z)(function*(){var E,_=!1,S=!1;try{for(var R,k=(0,Z.Z)(y);_=!(R=yield k.next()).done;_=!1){const se=R.value;if(se.data.length>0&&(p.update(se.data),o.enqueue(se.data)),0===se.info.pending){const J=p.digest("base64"),Me=J.length%3,ke=Me>0?"=".repeat(Me):"",Xe=`${Zn}${J}${ke}`;Xe!==r.digest?o.error(new Error(`received a corrupt object, digests do not match received: ${r.digest} calculated ${Xe}`)):o.close(),y.unsubscribe()}}}catch(se){S=!0,E=se}finally{try{_&&null!=k.return&&(yield k.return())}finally{if(S)throw E}}})().then(()=>{s.resolve()}).catch(_=>{o.error(_),s.reject(_)}),i.data=new ReadableStream({start(_){o=_},cancel(){y.unsubscribe()}}),i})()}linkStore(e,t){if(!(t instanceof Jt))return Promise.reject("bucket required");const r=t,{name:s,error:i}=this._checkNotEmpty(e);return i?Promise.reject(i):this._put({name:s,options:{link:{bucket:r.name}}},null)}link(e,t){var r=this;return(0,d.Z)(function*(){const{name:s,error:i}=r._checkNotEmpty(e);if(i)return Promise.reject(i);if(t.deleted)return Promise.reject(new Error("src object is deleted"));if(t.isLink())return Promise.reject(new Error("src object is a link"));const o=yield r.rawInfo(e);if(null!==o&&!o.deleted)return Promise.reject(new Error("an object already exists with that name"));const p={name:s,options:{link:{bucket:t.bucket,name:t.name}}};yield r.js.publish(r._metaSubject(e),JSON.stringify(p));const m=yield r.info(e);return Promise.resolve(m)})()}delete(e){var t=this;return(0,d.Z)(function*(){const r=yield t.rawInfo(e);if(null===r)return Promise.resolve({purged:0,success:!1});r.deleted=!0,r.size=0,r.chunks=0,r.digest="";const s=De(),i=ct();return i.set(Be.RollupHdr,Be.RollupValueSubject),yield t.js.publish(t._metaSubject(r.name),s.encode(r),{headers:i}),t.jsm.streams.purge(t.stream,{filter:t._chunkSubject(r.nuid)})})()}update(e,t={}){var r=this;return(0,d.Z)(function*(){const s=yield r.rawInfo(e);if(null===s)return Promise.reject(new Error("object not found"));if(s.deleted)return Promise.reject(new Error("cannot update meta for a deleted object"));t.name=t.name??s.name;const{name:i,error:o}=r._checkNotEmpty(t.name);if(o)return Promise.reject(o);if(e!==t.name){const m=yield r.info(t.name);if(m&&!m.deleted)return Promise.reject(new Error("an object already exists with that name"))}t.name=i;const l=Object.assign({},s,Gn(t)),p=yield r.js.publish(r._metaSubject(l.name),JSON.stringify(l));return e!==t.name&&(yield r.jsm.streams.purge(r.stream,{filter:r._metaSubject(e)})),Promise.resolve(p)})()}watch(e={}){var t=this;return(0,d.Z)(function*(){e.includeHistory=e.includeHistory??!1,e.ignoreDeletes=e.ignoreDeletes??!1;let r=!1;const s=new Re,i=t._metaSubjectAll();try{yield t.jsm.streams.getMessage(t.stream,{last_by_subj:i})}catch(m){"404"===m.code?(s.push(null),r=!0):s.stop(m)}const o=De(),l=gt();l.orderedConsumer(),e.includeHistory?l.deliverLastPerSubject():(r=!0,l.deliverNew()),l.callback((m,y)=>{if(m)s.stop(m);else if(null!==y){const _=o.decode(y.data);_.deleted&&!0===e.ignoreDeletes||s.push(_),0===y.info?.pending&&!r&&(r=!0,s.push(null))}});const p=yield t.js.subscribe(i,l);return s._data=p,s.iterClosed.then(()=>{p.unsubscribe()}),p.closed.then(()=>{s.stop()}).catch(m=>{s.stop(m)}),s})()}_chunkSubject(e){return`$O.${this.name}.C.${e}`}_metaSubject(e){return`$O.${this.name}.M.${qt.encode(e)}`}_metaSubjectAll(){return`$O.${this.name}.M.>`}init(e={}){var t=this;return(0,d.Z)(function*(){try{t.stream=function Gi(n){return mr(n),`${zr}${n}`}(t.name)}catch(i){return Promise.reject(i)}const r=e?.ttl||0;delete e.ttl;const s=Object.assign({max_age:r},e);s.name=t.stream,s.allow_direct=!0,s.allow_rollup_hdrs=!0,s.discard=ur.New,s.subjects=[`$O.${t.name}.C.>`,`$O.${t.name}.M.>`],e.placement&&(s.placement=e.placement),e.metadata&&(s.metadata=e.metadata);try{yield t.jsm.streams.info(s.name)}catch(i){"stream not found"===i.message&&(yield t.jsm.streams.add(s))}})()}static create(e,t,r={}){return(0,d.Z)(function*(){const s=yield e.jetstreamManager(),i=new Jt(t,s,e);return yield i.init(r),Promise.resolve(i)})()}}class eo{js;jsm;constructor(e){this.js=e}kv(e,t={}){const r=this.js,{ok:s,min:i}=r.nc.features.get(ne.JS_KV);return s?t.bindOnly?Gt.bind(this.js,e):Gt.create(this.js,e,t):Promise.reject(new Error(`kv is only supported on servers ${i} or better`))}os(e,t={}){if("function"!=typeof crypto?.subtle?.digest)return Promise.reject(new Error("objectstore: unable to calculate hashes - crypto.subtle.digest with sha256 support is required"));const r=this.js,{ok:s,min:i}=r.nc.features.get(ne.JS_OBJECTSTORE);return s?Jt.create(this.js,e,t):Promise.reject(new Error(`objectstore is only supported on servers ${i} or better`))}}class Kr extends Bt{consumers;streams;consumerAPI;streamAPI;constructor(e,t){super(e,t),this.consumerAPI=new qr(e,t),this.streamAPI=new Gr(e,t),this.consumers=new Dn(this.consumerAPI),this.streams=new Wi(this.streamAPI)}jetstreamManager(){return this.nc.jetstreamManager(this.opts)}get apiPrefix(){return this.prefix}get views(){return new eo(this)}publish(e,t=_e,r){var s=this;return(0,d.Z)(function*(){(r=r||{}).expect=r.expect||{};const i=r?.headers||ct();r&&(r.msgID&&i.set(ut.MsgIdHdr,r.msgID),r.expect.lastMsgID&&i.set(ut.ExpectedLastMsgIdHdr,r.expect.lastMsgID),r.expect.streamName&&i.set(ut.ExpectedStreamHdr,r.expect.streamName),"number"==typeof r.expect.lastSequence&&i.set(ut.ExpectedLastSeqHdr,`${r.expect.lastSequence}`),"number"==typeof r.expect.lastSubjectSequence&&i.set(ut.ExpectedLastSubjectSequenceHdr,`${r.expect.lastSubjectSequence}`));const o=r.timeout||s.timeout,l={};o&&(l.timeout=o),r&&(l.headers=i);let y,{retries:p,retry_delay:m}=r;p=p||1,m=m||250;for(let S=0;S<p;S++)try{y=yield s.nc.request(e,t,l);break}catch(E){if(!("503"===E.code&&S+1<p))throw E;yield G(m)}const _=s.parseJsResponse(y);if(""===_.stream)throw j.errorForCode(O.JetStreamInvalidAck);return _.duplicate=!!_.duplicate&&_.duplicate,_})()}pull(e,t,r=0){var s=this;return(0,d.Z)(function*(){$e(e),Et(t);let i=s.timeout;r>i&&(i=r);const o={batch:1,no_wait:0===(r=r<0?0:be(r)),expires:r},l=yield s.nc.request(`${s.prefix}.CONSUMER.MSG.NEXT.${e}.${t}`,s.jc.encode(o),{noMux:!0,timeout:i}),p=Ot(l);if(p)throw p;return Zt(l)})()}fetch(e,t,r={}){$e(e),Et(t);let s=null;const i=(r.max_bytes??0)>0;let o=0;const l=i?r.max_bytes:0;let p=null;const m={};if(m.batch=r.batch||1,l){const J=this.nc.features.get(ne.JS_PULL_MAX_BYTES);if(!J.ok)throw new Error(`max_bytes is only supported on servers ${J.min} or better`);m.max_bytes=l}m.no_wait=r.no_wait||!1,m.no_wait&&m.expires&&(m.expires=0);const y=r.expires||0;if(y&&(m.expires=be(y)),0===y&&!1===m.no_wait)throw new Error("expires or no_wait is required");const _=r.idle_heartbeat||0;_&&(m.idle_heartbeat=be(_),!0===r.delay_heartbeat&&(m.idle_heartbeat=be(4*_)));const S=new Re,E=m.batch;let k=0;S.protocolFilterFn=(J,Me=!1)=>!Ur(J.msg)||(p?.work(),!1),S.dispatchedFn=J=>{if(J){if(i&&(o+=J.data.length),k++,s&&0===J.info.pending)return;(1===S.getPending()&&0===J.info.pending||E===k||l>0&&o>=l)&&S.stop()}};const R=C(this.nc.options.inboxPrefix),se=this.nc.subscribe(R,{max:r.batch,callback:(J,Me)=>{null===J&&(J=Ot(Me)),null!==J?(s&&(s.cancel(),s=null),function qe(n){return"string"==typeof n.code}(J)?S.stop(null===Kn(J)?void 0:J):S.stop(J)):(p?.work(),S.received++,S.push(Zt(Me)))}});return y&&(s=we(y),s.catch(()=>{se.isClosed()||(se.drain().catch(()=>{}),s=null),p&&p.cancel()})),(0,d.Z)(function*(){try{_&&(p=new Dr(_,J=>(S.push(()=>{S.err=new j(`${Ze.IdleHeartbeatMissed}: ${J}`,O.JetStreamIdleHeartBeat)}),!0)))}catch{}yield se.closed,null!==s&&(s.cancel(),s=null),p&&p.cancel(),S.stop()})().catch(),this.nc.publish(`${this.prefix}.CONSUMER.MSG.NEXT.${e}.${t}`,this.jc.encode(m),{reply:R}),S}pullSubscribe(e,t=gt()){var r=this;return(0,d.Z)(function*(){const s=yield r._processOptions(e,t);if(s.ordered)throw new Error("pull subscribers cannot be be ordered");if(s.config.deliver_subject)throw new Error("consumer info specifies deliver_subject - pull consumers cannot have deliver_subject set");const i=s.config.ack_policy;if(i===Te.None||i===Te.All)throw new Error("ack policy for pull consumers must be explicit");const o=r._buildTypedSubscriptionOpts(s),l=new to(r,s.deliver,o);l.info=s;try{yield r._maybeCreateConsumer(s)}catch(p){throw l.unsubscribe(),p}return l})()}subscribe(e,t=gt()){var r=this;return(0,d.Z)(function*(){const s=yield r._processOptions(e,t);if(!s.isBind&&!s.config.deliver_subject)throw new Error("push consumer requires deliver_subject");const i=r._buildTypedSubscriptionOpts(s),o=new Jn(r,s.deliver,i);o.info=s;try{yield r._maybeCreateConsumer(s)}catch(l){throw o.unsubscribe(),l}return o._maybeSetupHbMonitoring(),o})()}_processOptions(e,t=gt()){var r=this;return(0,d.Z)(function*(){const s=Nn(t)?t.getOpts():t;if(s.isBind=!!Nn(t)&&t.isBind,s.flow_control={heartbeat_count:0,fc_count:0,consumer_restarts:0},s.ordered){if(s.ordered_consumer_sequence={stream_seq:0,delivery_seq:0},s.config.ack_policy!==Te.NotSet&&s.config.ack_policy!==Te.None)throw new j("ordered consumer: ack_policy can only be set to 'none'",O.ApiError);if(s.config.durable_name&&s.config.durable_name.length>0)throw new j("ordered consumer: durable_name cannot be set",O.ApiError);if(s.config.deliver_subject&&s.config.deliver_subject.length>0)throw new j("ordered consumer: deliver_subject cannot be set",O.ApiError);if(void 0!==s.config.max_deliver&&s.config.max_deliver>1)throw new j("ordered consumer: max_deliver cannot be set",O.ApiError);if(s.config.deliver_group&&s.config.deliver_group.length>0)throw new j("ordered consumer: deliver_group cannot be set",O.ApiError);s.config.deliver_subject=C(r.nc.options.inboxPrefix),s.config.ack_policy=Te.None,s.config.max_deliver=1,s.config.flow_control=!0,s.config.idle_heartbeat=s.config.idle_heartbeat||be(5e3),s.config.ack_wait=be(792e5),s.config.mem_storage=!0,s.config.num_replicas=1}if(s.config.ack_policy===Te.NotSet&&(s.config.ack_policy=Te.All),s.api=r,s.config=s.config||{},s.stream=s.stream?s.stream:yield r.findStream(e),s.attached=!1,s.config.durable_name)try{const i=yield r.consumerAPI.info(s.stream,s.config.durable_name);if(i){if(i.config.filter_subject&&i.config.filter_subject!==e)throw new Error("subject does not match consumer");const o=s.config.deliver_group??"";if(""===o&&!0===i.push_bound)throw new Error("duplicate subscription");const l=i.config.deliver_group??"";if(o!==l)throw""===l?new Error("durable requires no queue group"):new Error(`durable requires queue group '${l}'`);s.last=i,s.config=i.config,s.attached=!0,s.config.durable_name||(s.name=i.name)}}catch(i){if("404"!==i.code)throw i}return!s.attached&&void 0===s.config.filter_subject&&void 0===s.config.filter_subjects&&(s.config.filter_subject=e),s.deliver=s.config.deliver_subject||C(r.nc.options.inboxPrefix),s})()}_buildTypedSubscriptionOpts(e){const t={};return t.adapter=function ro(n){return n?so:no}(void 0===e.callbackFn),t.ingestionFilterFn=Kr.ingestionFn(e.ordered),t.protocolFilterFn=(r,s=!1)=>{const i=r;return!Lr(i.msg)||(s||i.msg.respond(),!1)},!e.mack&&e.config.ack_policy!==Te.None&&(t.dispatchedFn=io),e.callbackFn&&(t.callback=e.callbackFn),t.max=e.max||0,t.queue=e.queue,t}_maybeCreateConsumer(e){var t=this;return(0,d.Z)(function*(){if(e.attached)return;if(e.isBind)throw new Error(`unable to bind - durable consumer ${e.config.durable_name} doesn't exist in ${e.stream}`);e.config=Object.assign({deliver_policy:Ce.All,ack_policy:Te.Explicit,ack_wait:be(3e4),replay_policy:Dt.Instant},e.config);const r=yield t.consumerAPI.add(e.stream,e.config);if(Array.isArray(e.config.filter_subjects&&!Array.isArray(r.config.filter_subjects)))throw new Error("jetstream server doesn't support consumers with multiple filter subjects");e.name=r.name,e.config=r.config,e.last=r})()}static ingestionFn(e){return(t,r)=>{const s=r;if(!t)return{ingest:!1,protocol:!1};const i=t;if(Ot(i.msg)||s.monitor?.work(),Ur(i.msg)){const l=!e||s._checkHbOrderConsumer(i.msg);return e||s.info.flow_control.heartbeat_count++,{ingest:l,protocol:!0}}return Lr(i.msg)?(s.info.flow_control.fc_count++,{ingest:!0,protocol:!0}):{ingest:!e||s._checkOrderedConsumer(t),protocol:!1}}}}class Jn extends Ui{js;monitor;constructor(e,t,r){super(e.nc,t,r),this.js=e,this.monitor=null,this.sub.closed.then(()=>{this.monitor&&this.monitor.cancel()})}set info(e){this.sub.info=e}get info(){return this.sub.info}_resetOrderedConsumer(e){if(null===this.info||this.sub.isClosed())return;const t=C(this.js.nc.options.inboxPrefix);this.js.nc._resub(this.sub,t);const s=this.info;s.ordered_consumer_sequence.delivery_seq=0,s.flow_control.heartbeat_count=0,s.flow_control.fc_count=0,s.flow_control.consumer_restarts++,s.deliver=t,s.config.deliver_subject=t,s.config.deliver_policy=Ce.StartSequence,s.config.opt_start_seq=e;const i={};i.stream_name=this.info.stream,i.config=s.config,this.js._request(`${s.api.prefix}.CONSUMER.CREATE.${s.stream}`,i).then(l=>{const p=l;this.info.config=p.config,this.info.name=p.name}).catch(l=>{const p=new j(`unable to recreate ordered consumer ${s.stream} at seq ${e}`,O.RequestError,l);this.sub.callback(p,{})})}_maybeSetupHbMonitoring(){const e=this.info?.config?.idle_heartbeat||0;e&&this._setupHbMonitoring(Fr(e))}_setupHbMonitoring(e,t=0){const r={cancelAfter:0,maxOut:2};t&&(r.cancelAfter=t);const s=this.sub;this.monitor=new Dr(e,o=>{const l=function di(n,e,t){const r=ct(n,e),i=new _n({hdr:1,sid:0,size:0},_e,{});return i._headers=r,i._subject=t,i}(409,`${Ze.IdleHeartbeatMissed}: ${o}`,this.sub.subject);return this.info?.ordered?!!this.js.nc.protocol.connected&&(this._resetOrderedConsumer((this.info?.ordered_consumer_sequence?.stream_seq||0)+1),!1):(this.sub.callback(null,l),!s.noIterator)},r)}_checkHbOrderConsumer(e){const t=e.headers.get(Be.ConsumerStalledHdr);""!==t&&this.js.nc.publish(t);const r=parseInt(e.headers.get(Be.LastConsumerSeqHdr),10),s=this.info.ordered_consumer_sequence;return this.info.flow_control.heartbeat_count++,r!==s.delivery_seq&&this._resetOrderedConsumer(s.stream_seq+1),!1}_checkOrderedConsumer(e){const t=this.info.ordered_consumer_sequence,r=e.info.streamSequence,s=e.info.deliverySequence;return s!=t.delivery_seq+1?(this._resetOrderedConsumer(t.stream_seq+1),!1):(t.delivery_seq=s,t.stream_seq=r,!0)}destroy(){var e=this;return(0,d.Z)(function*(){e.isClosed()||(yield e.drain());const t=e.sub.info,s=`${t.api.prefix}.CONSUMER.DELETE.${t.stream}.${t.config.durable_name||t.name}`;yield t.api._request(s)})()}consumerInfo(){var e=this;return(0,d.Z)(function*(){const t=e.sub.info,s=`${t.api.prefix}.CONSUMER.INFO.${t.stream}.${t.config.durable_name||t.name}`,i=yield t.api._request(s);return t.last=i,i})()}}class to extends Jn{constructor(e,t,r){super(e,t,r)}pull(e={batch:1}){const{stream:t,config:r,name:s}=this.sub.info,i=r.durable_name??s,o={};if(o.batch=e.batch||1,o.no_wait=e.no_wait||!1,(e.max_bytes??0)>0){const m=this.js.nc.features.get(ne.JS_PULL_MAX_BYTES);if(!m.ok)throw new Error(`max_bytes is only supported on servers ${m.min} or better`);o.max_bytes=e.max_bytes}let l=0;e.expires&&e.expires>0&&(l=e.expires,o.expires=be(l));let p=0;if(e.idle_heartbeat&&e.idle_heartbeat>0&&(p=e.idle_heartbeat,o.idle_heartbeat=be(p)),p&&0===l)throw new Error("idle_heartbeat requires expires");if(p>l)throw new Error("expires must be greater than idle_heartbeat");if(this.info){this.monitor&&this.monitor.cancel(),l&&p&&(this.monitor?this.monitor._change(p,l):this._setupHbMonitoring(p,l));const m=this.info.api,_=this.sub.subject;m.nc.publish(`${m.prefix}.CONSUMER.MSG.NEXT.${t}.${i}`,m.jc.encode(o),{reply:_})}}}function no(n,e){return n||(n=Ot(e))?[n,null]:[null,Zt(e)]}function so(n,e){if(n)return[n,null];const t=Ot(e);return null!==t?[Kn(t),null]:[null,Zt(e)]}function Kn(n){if(null!==n)switch(n.code){case O.JetStream404NoMessages:case O.JetStream408RequestTimeout:return null;case O.JetStream409:return function pi(n){if(n.code!==O.JetStream409)return!1;const e=[Ze.MaxBatchExceeded,Ze.MaxExpiresExceeded,Ze.MaxBytesExceeded,Ze.MaxMessageSizeExceeded,Ze.PushConsumer,Ze.IdleHeartbeatMissed,Ze.ConsumerDeleted];return fi&&e.push(Ze.MaxWaitingExceeded),void 0!==e.find(t=>-1!==n.message.indexOf(t))}(n)?n:null;default:return n}return null}function io(n){n&&n.ack()}class oo extends Bt{constructor(e,t){super(e,t)}getMessage(e,t){var r=this;return(0,d.Z)(function*(){$e(e);let s=t;const{last_by_subj:i}=s;i&&(s=null);const o=s?r.jc.encode(s):_e,l=r.opts.apiPrefix||"$JS.API",p=i?`${l}.DIRECT.GET.${e}.${i}`:`${l}.DIRECT.GET.${e}`,m=yield r.nc.request(p,o),y=Ot(m);if(y)return Promise.reject(y);const _=new ao(m);return Promise.resolve(_)})()}}let ao=(()=>class n{data;header;static jc;constructor(t){if(!t.headers)throw new Error("headers expected");this.data=t.data,this.header=t.headers}get subject(){return this.header.get(Vt.Subject)}get seq(){const t=this.header.get(Vt.Sequence);return"string"==typeof t?parseInt(t):0}get time(){return new Date(Date.parse(this.timestamp))}get timestamp(){return this.header.get(Vt.TimeStamp)}get stream(){return this.header.get(Vt.Stream)}json(t){return De(t).decode(this.data)}string(){return fe.decode(this.data)}})();class co extends Bt{streams;consumers;direct;constructor(e,t){super(e,t),this.streams=new Gr(e,t),this.consumers=new qr(e,t),this.direct=new oo(e,t)}getAccountInfo(){var e=this;return(0,d.Z)(function*(){return yield e._request(`${e.prefix}.INFO`)})()}jetstream(){return this.nc.jetstream(this.getOptions())}advisories(){const e=new Re;return this.nc.subscribe("$JS.EVENT.ADVISORY.>",{callback:(t,r)=>{if(t)throw t;try{const s=this.parseJsResponse(r),i=s.type.split(".");e.push({kind:i[i.length-1],data:s})}catch(s){e.stop(s)}}}),e}}class Wn{msg;constructor(e){this.msg=e}get data(){return this.msg.data}get sid(){return this.msg.sid}get subject(){return this.msg.subject}get reply(){return this.msg.reply||""}get headers(){return this.msg.headers}respond(e,t){return this.msg.respond(e,t)}respondError(e,t,r,s){return(s=s||{}).headers=s.headers||ct(),s.headers?.set(w,`${e}`),s.headers?.set(x,t),this.msg.respond(r,s)}json(e){return this.msg.json(e)}string(){return this.msg.string()}}class Kt{subject;queue;srv;constructor(e,t="",r=""){""!==t&&function ho(n,e){if(-1!==e.indexOf(" "))throw new Error(`${n} cannot contain spaces: '${e}'`);e.split(".").forEach(r=>{if(">"===r)throw new Error(`${n} name cannot contain internal '>': '${e}'`)})}("service group",t);let s="";if(e instanceof Wt)this.srv=e,s="";else{if(!(e instanceof Kt))throw new Error("unknown ServiceGroup type");{const i=e;this.srv=i.srv,""===r&&""!==i.queue&&(r=i.queue),s=i.subject}}this.subject=this.calcSubject(s,t),this.queue=r}calcSubject(e,t=""){return""===t?e:""!==e?`${e}.${t}`:t}addEndpoint(e="",t){const r="function"==typeof(t=t||{subject:e})?{handler:t,subject:e}:t;$t("endpoint",e);let{subject:s,handler:i,metadata:o,queue:l}=r;return s=s||e,l=l||this.queue,function uo(n,e){if(""===e)throw new Error(`${n} cannot be empty`);if(-1!==e.indexOf(" "))throw new Error(`${n} cannot contain spaces: '${e}'`);const t=e.split(".");t.forEach((r,s)=>{if(">"===r&&s!==t.length-1)throw new Error(`${n} cannot have internal '>': '${e}'`)})}("endpoint subject",s),s=this.calcSubject(this.subject,s),this.srv._addEndpoint({name:e,subject:s,queue:l,handler:i,metadata:o})}addGroup(e="",t=""){return new Kt(this,e,t)}}class Wt{nc;_id;config;handlers;internal;_stopped;_done;started;static controlSubject(e,t="",r="",s){const i=s??"$SRV";return""===t&&""===r?`${i}.${e}`:($t("control subject name",t),""!==r?($t("control subject id",r),`${i}.${e}.${t}.${r}`):`${i}.${e}.${t}`)}constructor(e,t={name:"",version:""}){this.nc=e,this.config=Object.assign({},t),this.config.queue||(this.config.queue="q"),$t("name",this.config.name),$t("queue",this.config.queue),xt(this.config.version),this._id=Pe.next(),this.internal=[],this._done=z(),this._stopped=!1,this.handlers=[],this.started=(new Date).toISOString(),this.reset(),this.nc.closed().then(()=>{this.close().catch()}).catch(r=>{this.close(r).catch()})}get subjects(){return this.handlers.filter(e=>!1===e.internal).map(e=>e.subject)}get id(){return this._id}get name(){return this.config.name}get description(){return this.config.description??""}get version(){return this.config.version}get metadata(){return this.config.metadata}errorToHeader(e){const t=ct();if(e instanceof P){const r=e;t.set(x,r.message),t.set(w,`${r.code}`)}else t.set(x,e.message),t.set(w,"500");return t}setupHandler(e,t=!1){const r=t?"":e.queue?e.queue:this.config.queue,{name:s,subject:i,handler:o}=e,l=e;l.internal=t,t&&this.internal.push(l),l.stats=new fo(s,i,r),l.queue=r;const p=o?(m,y)=>{if(m)return void this.close(m);const _=Date.now();try{o(m,new Wn(y))}catch(S){l.stats.countError(S),y?.respond(_e,{headers:this.errorToHeader(S)})}finally{l.stats.countLatency(_)}}:void 0;return l.sub=this.nc.subscribe(i,{callback:p,queue:r}),l.sub.closed.then(()=>{this._stopped||this.close(new Error(`required subscription ${e.subject} stopped`)).catch()}).catch(m=>{if(!this._stopped){const y=new Error(`required subscription ${e.subject} errored: ${m.message}`);y.stack=m.stack,this.close(y).catch()}}),l}info(){return{type:yt.INFO,name:this.name,id:this.id,version:this.version,description:this.description,metadata:this.metadata,endpoints:this.endpoints()}}endpoints(){return this.handlers.map(e=>{const{subject:t,metadata:r,name:s,queue:i}=e;return{subject:t,metadata:r,name:s,queue_group:i}})}stats(){var e=this;return(0,d.Z)(function*(){const t=[];for(const r of e.handlers){if("function"==typeof e.config.statsHandler)try{r.stats.data=yield e.config.statsHandler(r)}catch(s){r.stats.countError(s)}t.push(r.stats.stats(r.qi))}return{type:yt.STATS,name:e.name,id:e.id,version:e.version,started:e.started,metadata:e.metadata,endpoints:t}})()}addInternalHandler(e,t){const r=`${e}`.toUpperCase();this._doAddInternalHandler(`${r}-all`,e,t),this._doAddInternalHandler(`${r}-kind`,e,t,this.name),this._doAddInternalHandler(`${r}`,e,t,this.name,this.id)}_doAddInternalHandler(e,t,r,s="",i=""){const o={};o.name=e,o.subject=Wt.controlSubject(t,s,i),o.handler=r,this.setupHandler(o,!0)}start(){const e=De(),s=e.encode(this.ping());return this.addInternalHandler(F.PING,(o,l)=>o?(this.close(o).then().catch(),Promise.reject(o)):(l.respond(s),Promise.resolve())),this.addInternalHandler(F.STATS,(o,l)=>o?(this.close(o),Promise.reject(o)):this.stats().then(p=>(l?.respond(e.encode(p)),Promise.resolve()))),this.addInternalHandler(F.INFO,(o,l)=>o?(this.close(o),Promise.reject(o)):(l?.respond(e.encode(this.info())),Promise.resolve())),this.handlers.forEach(o=>{const{subject:l}=o;"string"==typeof l&&null!==o.handler&&this.setupHandler(o)}),Promise.resolve(this)}close(e){if(this._stopped)return this._done;this._stopped=!0;let t=[];return this.nc.isClosed()||(t=this.handlers.concat(this.internal).map(r=>r.sub.drain())),Promise.allSettled(t).then(()=>{this._done.resolve(e||null)}),this._done}get stopped(){return this._done}get isStopped(){return this._stopped}stop(e){return this.close(e)}ping(){return{type:yt.PING,name:this.name,id:this.id,version:this.version,metadata:this.metadata}}reset(){if(this.started=(new Date).toISOString(),this.handlers)for(const e of this.handlers)e.stats.reset(e.qi)}addGroup(e,t){return new Kt(this,e,t)}addEndpoint(e,t){return new Kt(this).addEndpoint(e,t)}_addEndpoint(e){const t=new Re;t.noIterator="function"==typeof e.handler,t.noIterator||(e.handler=(s,i)=>{s?this.stop(s).catch():t.push(new Wn(i))},t.iterClosed.then(()=>{this.close().catch()}));const r=this.setupHandler(e,!1);return r.qi=t,this.handlers.push(r),t}}class fo{name;subject;average_processing_time;num_requests;processing_time;num_errors;last_error;data;metadata;queue;constructor(e,t,r=""){this.name=e,this.subject=t,this.average_processing_time=0,this.num_errors=0,this.num_requests=0,this.processing_time=0,this.queue=r}reset(e){this.num_requests=0,this.processing_time=0,this.average_processing_time=0,this.num_errors=0,this.last_error=void 0,this.data=void 0;const t=e;t&&(t.time=0,t.processed=0)}countLatency(e){this.num_requests++,this.processing_time+=be(Date.now()-e),this.average_processing_time=Math.round(this.processing_time/this.num_requests)}countError(e){this.num_errors++,this.last_error=e.message}_stats(){const{name:e,subject:t,average_processing_time:r,num_errors:s,num_requests:i,processing_time:o,last_error:l,data:p,queue:m}=this;return{name:e,subject:t,average_processing_time:r,num_errors:s,num_requests:i,processing_time:o,last_error:l,data:p,queue_group:m}}stats(e){const t=e;return!1===t?.noIterator&&(this.processing_time=t.time,this.num_requests=t.processed,this.average_processing_time=this.processing_time>0&&this.num_requests>0?this.processing_time/this.num_requests:0),this._stats()}}class po{nc;prefix;opts;constructor(e,t={strategy:Ie.JitterTimer,maxWait:2e3},r){this.nc=e,this.prefix=r,this.opts=t}ping(e="",t=""){return this.q(F.PING,e,t)}stats(e="",t=""){return this.q(F.STATS,e,t)}info(e="",t=""){return this.q(F.INFO,e,t)}q(e,t="",r=""){var s=this;return(0,d.Z)(function*(){const i=new Re,o=De(),l=Wt.controlSubject(e,t,r,s.prefix),p=yield s.nc.requestMany(l,_e,s.opts);return(0,d.Z)(function*(){var _,m=!1,y=!1;try{for(var E,S=(0,Z.Z)(p);m=!(E=yield S.next()).done;m=!1){const k=E.value;try{const R=o.decode(k.data);i.push(R)}catch(R){i.push(()=>{i.stop(R)})}}}catch(k){y=!0,_=k}finally{try{m&&null!=S.return&&(yield S.return())}finally{if(y)throw _}}i.push(()=>{i.stop()})})().catch(m=>{i.stop(m)}),i})()}}class Wr{options;protocol;draining;listeners;_services;constructor(e){this.draining=!1,this.options=ni(e),this.listeners=[]}static connect(e={}){return new Promise((t,r)=>{const s=new Wr(e);lr.connect(s.options,s).then(i=>{s.protocol=i,(0,d.Z)(function*(){var p,o=!1,l=!1;try{for(var y,m=(0,Z.Z)(i.status());o=!(y=yield m.next()).done;o=!1){const _=y.value;s.listeners.forEach(S=>{S.push(_)})}}catch(_){l=!0,p=_}finally{try{o&&null!=m.return&&(yield m.return())}finally{if(l)throw p}}})(),t(s)}).catch(i=>{r(i)})})}closed(){return this.protocol.closed}close(){var e=this;return(0,d.Z)(function*(){yield e.protocol.close()})()}_check(e,t,r){if(this.isClosed())throw j.errorForCode(O.ConnectionClosed);if(t&&this.isDraining()||r&&this.protocol.noMorePublishing)throw j.errorForCode(O.ConnectionDraining);if(0===(e=e||"").length)throw j.errorForCode(O.BadSubject)}publish(e,t,r){this._check(e,!1,!0),this.protocol.publish(e,t,r)}subscribe(e,t={}){this._check(e,!0,!1);const r=new An(this.protocol,e,t);return this.protocol.subscribe(r),r}_resub(e,t,r){this._check(t,!0,!1);const s=e;s.max=r,r&&(s.max=r+s.received),this.protocol.resub(s,t)}requestMany(e,t=_e,r={maxWait:1e3,maxMessages:-1}){try{this._check(e,!0,!0)}catch(l){return Promise.reject(l)}if(r.strategy=r.strategy||Ie.Timer,r.maxWait=r.maxWait||1e3,r.maxWait<1)return Promise.reject(new j("timeout",O.InvalidOption));const s=new Re;function i(l){s.push(()=>{s.stop(l)})}function o(l,p){l||null===p?i(null===l?void 0:l):s.push(p)}if(r.noMux){const l=(new Error).stack;let p="number"==typeof r.maxMessages&&r.maxMessages>0?r.maxMessages:-1;const m=this.subscribe(C(this.options.inboxPrefix),{callback:(E,k)=>{if(0===k?.data?.length&&k?.headers?.status===O.NoResponders&&(E=j.errorForCode(O.NoResponders)),E)return E.stack+=`\n\n${l}`,void y(E);o(null,k),r.strategy===Ie.Count&&(p--,0===p&&y()),r.strategy===Ie.JitterTimer&&(S(),_=setTimeout(()=>{y()},300)),r.strategy===Ie.SentinelMsg&&k&&0===k.data.length&&y()}});m.closed.then(()=>{i()}).catch(E=>{s.stop(E)});const y=E=>{E&&s.push(()=>{throw E}),S(),m.drain().then(()=>{i()}).catch(k=>{i()})};s.iterClosed.then(()=>{S(),m?.unsubscribe()}).catch(E=>{S(),m?.unsubscribe()});try{this.publish(e,t,{reply:m.getSubject()})}catch(E){y(E)}let _=setTimeout(()=>{y()},r.maxWait);const S=()=>{_&&clearTimeout(_)}}else{const l=r;l.callback=o,s.iterClosed.then(()=>{p.cancel()}).catch(m=>{p.cancel(m)});const p=new ui(this.protocol.muxSubscriptions,e,l);this.protocol.request(p);try{this.publish(e,t,{reply:`${this.protocol.muxSubscriptions.baseInbox}${p.token}`,headers:r.headers})}catch(m){p.cancel(m)}}return Promise.resolve(s)}request(e,t,r={timeout:1e3,noMux:!1}){try{this._check(e,!0,!0)}catch(s){return Promise.reject(s)}if(r.timeout=r.timeout||1e3,r.timeout<1)return Promise.reject(new j("timeout",O.InvalidOption));if(!r.noMux&&r.reply)return Promise.reject(new j("reply can only be used with noMux",O.InvalidOption));if(r.noMux){const s=r.reply?r.reply:C(this.options.inboxPrefix),i=z(),o=new Error;return this.subscribe(s,{max:1,timeout:r.timeout,callback:(p,m)=>{p?(p.code!==O.Timeout&&(p.stack+=`\n\n${o.stack}`),i.reject(p)):(p=gn(m))?(p.stack+=`\n\n${o.stack}`,i.reject(p)):i.resolve(m)}}).requestSubject=e,this.protocol.publish(e,t,{reply:s,headers:r.headers}),i}{const s=new kn(this.protocol.muxSubscriptions,e,r);this.protocol.request(s);try{this.publish(e,t,{reply:`${this.protocol.muxSubscriptions.baseInbox}${s.token}`,headers:r.headers})}catch(o){s.cancel(o)}const i=Promise.race([s.timer,s.deferred]);return i.catch(()=>{s.cancel()}),i}}flush(){return this.isClosed()?Promise.reject(j.errorForCode(O.ConnectionClosed)):this.protocol.flush()}drain(){return this.isClosed()?Promise.reject(j.errorForCode(O.ConnectionClosed)):this.isDraining()?Promise.reject(j.errorForCode(O.ConnectionDraining)):(this.draining=!0,this.protocol.drain())}isClosed(){return this.protocol.isClosed()}isDraining(){return this.draining}getServer(){const e=this.protocol.getServer();return e?e.listen:""}status(){const e=new Re;return e.iterClosed.then(()=>{const t=this.listeners.indexOf(e);this.listeners.splice(t,1)}),this.listeners.push(e),e}get info(){return this.protocol.isClosed()?void 0:this.protocol.info}stats(){return{inBytes:this.protocol.inBytes,outBytes:this.protocol.outBytes,inMsgs:this.protocol.inMsgs,outMsgs:this.protocol.outMsgs}}jetstreamManager(e={}){var t=this;return(0,d.Z)(function*(){const r=new co(t,e);try{yield r.getAccountInfo()}catch(s){const i=s;throw i.code===O.NoResponders&&(i.code=O.JetStreamNotEnabled),i}return r})()}jetstream(e={}){return new Kr(this,e)}getServerVersion(){const e=this.info;return e?xt(e.version):void 0}rtt(){var e=this;return(0,d.Z)(function*(){if(!e.protocol._closed&&!e.protocol.connected)throw j.errorForCode(O.Disconnect);const t=Date.now();return yield e.flush(),Date.now()-t})()}get features(){return this.protocol.features}get services(){return this._services||(this._services=new mo(this)),this._services}}class mo{nc;constructor(e){this.nc=e}add(e){try{return new Wt(this.nc,e).start()}catch(t){return Promise.reject(t)}}client(e,t){return new po(this.nc,e,t)}}class vo{version;lang;closeError;connected;done;socket;options;socketClosed;encrypted;peeked;yields;signal;closedNotification;constructor(){this.version="1.18.0",this.lang="nats.ws",this.connected=!1,this.done=!1,this.socketClosed=!1,this.encrypted=!1,this.peeked=!1,this.yields=[],this.signal=z(),this.closedNotification=z()}connect(e,t){var r=this;return(0,d.Z)(function*(){const i=z();if(t.tls)return i.reject(new j("tls",O.InvalidOption)),i;r.options=t;const o=e.src;if(t.wsFactory){const{socket:l,encrypted:p}=yield t.wsFactory(e.src,t);r.socket=l,r.encrypted=p}else r.encrypted=0===o.indexOf("wss://"),r.socket=new WebSocket(o);return r.socket.binaryType="arraybuffer",r.socket.onopen=()=>{r.isDiscarded()},r.socket.onmessage=l=>{if(r.isDiscarded())return;if(r.yields.push(new Uint8Array(l.data)),r.peeked)return void r.signal.resolve();const p=Ee.concat(...r.yields),m=function _s(n){const e=function gs(n){for(let e=0;e<n.length;e++){const t=e+1;if(n.byteLength>t&&n[e]===ps&&n[t]===ms)return t+1}return 0}(n);if(e>0){const r=new Uint8Array(n).slice(0,e);return fe.decode(r)}return""}(p);if(""!==m){const y=oi.exec(m);if(!y)return t.debug&&console.error("!!!",X(p)),void i.reject(new Error("unexpected response from server"));try{(function si(n,e){const{proto:t,tls_required:r,tls_available:s}=n;if((void 0===t||t<1)&&e.noEcho)throw new j("noEcho",O.ServerOptionNotAvailable);if(e.tls&&!r&&!s)throw new j("tls",O.ServerOptionNotAvailable)})(JSON.parse(y[1]),r.options),r.peeked=!0,r.connected=!0,r.signal.resolve(),i.resolve()}catch(_){return void i.reject(_)}}},r.socket.onclose=l=>{if(r.isDiscarded())return;let p;r.socketClosed=!0,r.done||(l.wasClean||(p=new Error(l.reason)),r._closed(p))},r.socket.onerror=l=>{if(r.isDiscarded())return;const m=new j(l.message,O.Unknown,new Error(l.error));i.reject(m)},i})()}disconnect(){this._closed(void 0,!0)}_closed(e,t=!0){var r=this;return(0,d.Z)(function*(){if(!r.isDiscarded()&&r.connected&&!r.done){if(r.closeError=e,!e)for(;!r.socketClosed&&r.socket.bufferedAmount>0;)yield G(100);r.done=!0;try{r.socket.close(e?1002:1e3,e?e.message:void 0)}catch{}t&&r.closedNotification.resolve(e)}})()}get isClosed(){return this.done}[Symbol.asyncIterator](){return this.iterate()}iterate(){var e=this;return He(function*(){for(;;){if(e.isDiscarded())return;0===e.yields.length&&(yield he(e.signal));const t=e.yields;e.yields=[];for(let r=0;r<t.length;r++)e.options.debug&&console.info(`> ${X(t[r])}`),yield t[r];if(e.done)break;0===e.yields.length&&(t.length=0,e.yields=t,e.signal=z())}})()}isEncrypted(){return this.connected&&this.encrypted}send(e){if(!this.isDiscarded())try{return this.socket.send(e.buffer),void(this.options.debug&&console.info(`< ${X(e)}`))}catch(t){this.options.debug&&console.error(`!!! ${X(e)}: ${t}`)}}close(e){return this._closed(e,!1)}closed(){return this.closedNotification}isDiscarded(){return!!this.done&&(this.discard(),!0)}discard(){this.done=!0;try{this.socket?.close()}catch{}}}function wo(n){/^(.*:\/\/)(.*)/.test(n)||(n=`https://${n}`);let t=new URL(n);const r=t.protocol.toLowerCase();let s,i;"https:"!==r&&"http"!==r&&(n=n.replace(/^(.*:\/\/)(.*)/gm,"$2"),t=new URL(`http://${n}`));const o=t.hostname,l=t.pathname,p=t.search||"";switch(r){case"http:":case"ws:":case"nats:":i=t.port||"80",s="ws:";break;default:i=t.port||"443",s="wss:"}return`${s}//${o}:${i}${l}${p}`}B(6021);let Yr=class{#e;#t;#r;#n=De();#s;constructor(e){this.#e=e||{name:""}}connect(e,t,r){var s=this;return(0,d.Z)(function*(){try{s.#t=yield function So(n={}){return function ge(n){T=n}({defaultPort:443,urlParseFn:wo,factory:()=>new vo}),Wr.connect(n)}({servers:e,user:t,pass:r})}catch(i){console.error(i)}s.#r=yield s.#t.jetstream()})()}publish(e,t){var r=this;return(0,d.Z)(function*(){try{const s={data:t};yield r.#r.publish(e,r.#n.encode(s))}catch(s){console.log(s)}})()}unsubscribe(){void 0!==this.#s?this.#s.close():console.error("Should have subscribed first")}subscribe(e=gr.Pull,t,r){return new le.Observable(s=>{(e===gr.Pull?this.#o(t):this.#i(t,r)).then(o=>{this.#s=o,s.next(o)})})}#i(e,t){var r=this;return(0,d.Z)(function*(){return t?(yield r.#r.consumers.get(r.#e.name,{filterSubjects:e,inactive_threshold:1e3,deliver_policy:t})).consume():(yield r.#r.consumers.get(r.#e.name,{filterSubjects:e,inactive_threshold:1e3})).consume()})()}#o(e){var t=this;return(0,d.Z)(function*(){return(yield t.#r.consumers.get(t.#e.name,e)).consume()})()}request(e,t){const r=new le.Subject;let s;return s=(0,le.from)(null!=t&&""!==t&&0!==t&&!1!==t?this.#t.request(`core.${e}`,this.#n.encode({data:t})):this.#t.request(`core.${e}`,this.#n.encode({data:{}}))),s.subscribe(l=>{r.next(this.#n.decode(l.data))}),r.asObservable()}drain(){var e=this;return(0,d.Z)(function*(){yield e.#t.drain()})()}};Yr=(0,a.gn)([(0,ce.Injectable)({providedIn:"root"})],Yr);var gr=function(n){return n.Pull="pull",n.Push="push",n}(gr||{}),Yn=function(n){return n.None="none",n.All="all",n.Explicit="explicit",n.NotSet="",n}(Yn||{}),Xn=function(n){return n.Limits="limits",n.Interest="interest",n.Workqueue="workqueue",n}(Xn||{}),Qn=function(n){return n.All="all",n.Last="last",n.New="new",n.StartSequence="by_start_sequence",n.StartTime="by_start_time",n.LastPerSubject="last_per_subject",n}(Qn||{})},6746:(Ct,Ne,B)=>{B.r(Ne),B.d(Ne,{NavigationViewComponent:()=>Ee});var d=B(5861),a=B(5863),ce=B(575),le=B(1189),Z=B(6701),ue=B(5126),he=B(5617);let ve=(()=>{class T{constructor(){this.isCollapsed=(0,a.signal)(!0),this.router=(0,a.inject)(Z.Router),this.event$=this.router.events.pipe((0,ue.filter)(N=>N instanceof Z.NavigationEnd)),this.routerSignal=(0,he.toSignal)(this.event$),this.isShowBody=(0,a.computed)(()=>{if(!(this.routerSignal()&&this.routerSignal()instanceof Z.NavigationEnd))return!1;let N=this.routerSignal();return console.log("is the view?","/appStore"!==N.urlAfterRedirects&&"/home"!==N.urlAfterRedirects&&"/news"!==N.urlAfterRedirects),"/appStore"!==N.urlAfterRedirects&&"/home"!==N.urlAfterRedirects&&"/news"!==N.urlAfterRedirects})}onCollapsClick(){this.isCollapsed.set(!this.isCollapsed())}static#e=this.\u0275fac=function(Y){return new(Y||T)};static#t=this.\u0275prov=a.\u0275\u0275defineInjectable({token:T,factory:T.\u0275fac,providedIn:"root"})}return T})();var He=B(6107),_e=B(7842),Oe=B(8093),fe=B(3171),nt=B(2175),je=B(7069),Ke=B(4009),ze=B(2998),We=B(6827),ft=B(8426),st=B(743),K=B(4008),ie=B(2182);let H=(()=>{class T{constructor(){this.userAccount=(0,a.signal)({}),this.#e=(0,a.inject)(ie.SharedService)}#e;getUserAccount(){var N=this;return(0,d.Z)(function*(){const Y=yield N.#e.getValue(history.state.token);N.userAccount.set(Y),console.log("userAccount",Y)})()}static#t=this.\u0275fac=function(Y){return new(Y||T)};static#r=this.\u0275prov=a.\u0275\u0275defineInjectable({token:T,factory:T.\u0275fac,providedIn:"root"})}return T})();var xe=B(9191),pe=B(6488),Pe=B(6409),Le=B(25);const Ye=function(){return{width:"24px",height:"24px"}};function O(T,ge){if(1&T&&(a.\u0275\u0275elementStart(0,"div",17),a.\u0275\u0275element(1,"p-avatar",7),a.\u0275\u0275text(2),a.\u0275\u0275elementEnd()),2&T){const N=a.\u0275\u0275nextContext();a.\u0275\u0275advance(1),a.\u0275\u0275styleMap(a.\u0275\u0275pureFunction0(3,Ye)),a.\u0275\u0275advance(1),a.\u0275\u0275textInterpolate1(" ",N.userAccountService.userAccount().userCode.display," ")}}function qe(T,ge){if(1&T&&(a.\u0275\u0275elementStart(0,"div",20),a.\u0275\u0275text(1),a.\u0275\u0275elementEnd()),2&T){const N=ge.$implicit;a.\u0275\u0275advance(1),a.\u0275\u0275textInterpolate1(" ",N.label," ")}}function D(T,ge){if(1&T){const N=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"p-listbox",18),a.\u0275\u0275listener("onClick",function(Q){a.\u0275\u0275restoreView(N);const Ae=a.\u0275\u0275nextContext();return a.\u0275\u0275resetView(Ae.onUserDialogListClick(Q))}),a.\u0275\u0275template(1,qe,2,1,"ng-template",19),a.\u0275\u0275elementEnd()}if(2&T){const N=a.\u0275\u0275nextContext();a.\u0275\u0275property("options",N.userDialogList)}}function W(T,ge){1&T&&(a.\u0275\u0275elementStart(0,"div",17),a.\u0275\u0275namespaceSVG(),a.\u0275\u0275elementStart(1,"svg",21)(2,"g",22),a.\u0275\u0275element(3,"path",23),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(4,"defs")(5,"clipPath",24),a.\u0275\u0275element(6,"rect",25),a.\u0275\u0275elementEnd()()(),a.\u0275\u0275namespaceHTML(),a.\u0275\u0275elementStart(7,"h6"),a.\u0275\u0275text(8,"\u7a0b\u5f0f\u96c6"),a.\u0275\u0275elementEnd()())}function j(T,ge){if(1&T){const N=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"div",31)(1,"div",32),a.\u0275\u0275listener("click",function(){a.\u0275\u0275restoreView(N);const Q=a.\u0275\u0275nextContext().$implicit,Ae=a.\u0275\u0275nextContext(2);return a.\u0275\u0275resetView(Ae.onNavAppClick(Q.url))}),a.\u0275\u0275elementStart(2,"div",33)(3,"span",34),a.\u0275\u0275text(4),a.\u0275\u0275elementEnd()(),a.\u0275\u0275text(5),a.\u0275\u0275elementEnd()()}if(2&T){const N=a.\u0275\u0275nextContext().$implicit;a.\u0275\u0275advance(4),a.\u0275\u0275textInterpolate1(" ",N.icon," "),a.\u0275\u0275advance(1),a.\u0275\u0275textInterpolate1(" ",N.title," ")}}function re(T,ge){if(1&T&&(a.\u0275\u0275elementContainerStart(0),a.\u0275\u0275template(1,j,6,2,"div",30),a.\u0275\u0275elementContainerEnd()),2&T){const N=ge.$implicit;a.\u0275\u0275advance(1),a.\u0275\u0275property("ngIf",!0===N.isFavorite)}}function Ie(T,ge){if(1&T){const N=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"div",31)(1,"span",35)(2,"div",32),a.\u0275\u0275listener("click",function(){a.\u0275\u0275restoreView(N);const Q=a.\u0275\u0275nextContext().$implicit,Ae=a.\u0275\u0275nextContext(2);return a.\u0275\u0275resetView(Ae.onNavAppClick(Q.url))}),a.\u0275\u0275elementStart(3,"div",33)(4,"span",34),a.\u0275\u0275text(5),a.\u0275\u0275elementEnd()(),a.\u0275\u0275text(6),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(7,"button",36),a.\u0275\u0275listener("click",function(){a.\u0275\u0275restoreView(N);const Q=a.\u0275\u0275nextContext().$implicit,Ae=a.\u0275\u0275nextContext(2);return a.\u0275\u0275resetView(Ae.onCloseApp(Q.appId))}),a.\u0275\u0275elementEnd()()()}if(2&T){const N=a.\u0275\u0275nextContext().$implicit;a.\u0275\u0275advance(5),a.\u0275\u0275textInterpolate1(" ",N.icon," "),a.\u0275\u0275advance(1),a.\u0275\u0275textInterpolate1(" ",N.title," ")}}function yt(T,ge){if(1&T&&(a.\u0275\u0275elementContainerStart(0),a.\u0275\u0275template(1,Ie,8,2,"div",30),a.\u0275\u0275elementContainerEnd()),2&T){const N=ge.$implicit;a.\u0275\u0275advance(1),a.\u0275\u0275property("ngIf",!0===N.isOpen)}}function x(T,ge){if(1&T){const N=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementStart(0,"div",26),a.\u0275\u0275text(1," \u67e5\u770b\u5168\u90e8 "),a.\u0275\u0275elementStart(2,"button",27),a.\u0275\u0275listener("click",function(){a.\u0275\u0275restoreView(N);const Q=a.\u0275\u0275nextContext();return a.\u0275\u0275resetView(Q.onAppStoreClick())}),a.\u0275\u0275elementEnd()(),a.\u0275\u0275element(3,"p-divider"),a.\u0275\u0275elementStart(4,"div",28),a.\u0275\u0275text(5,"\u6211\u7684\u6700\u611b"),a.\u0275\u0275elementEnd(),a.\u0275\u0275template(6,re,2,1,"ng-container",29),a.\u0275\u0275element(7,"p-divider"),a.\u0275\u0275elementStart(8,"div",28),a.\u0275\u0275text(9,"\u5df2\u958b\u555f"),a.\u0275\u0275elementEnd(),a.\u0275\u0275template(10,yt,2,1,"ng-container",29)}if(2&T){const N=a.\u0275\u0275nextContext();a.\u0275\u0275advance(6),a.\u0275\u0275property("ngForOf",N.appStoreService.myAppStores()),a.\u0275\u0275advance(4),a.\u0275\u0275property("ngForOf",N.appStoreService.myAppStores())}}const w=function(T){return{"collapsed-active":T}},P=function(T){return{"collapsed-inactive":T}},C=function(){return{width:"240px"}};let L=(()=>{class T{constructor(){this.isUserDialogVisible=!1,this.isUserProfileVisible=!1,this.isAppListDialogVisible=!1,this.navigationService=(0,a.inject)(ve),this.navigationViewService=(0,a.inject)(H),this.userAccountService=(0,a.inject)(pe.N),this.newsService=(0,a.inject)(Pe.NewsService),this.appStoreService=(0,a.inject)(xe.AppStoreService),this.#e=(0,a.inject)(Z.Router)}#e;ngOnInit(){this.userDialogList=[{label:"\u500b\u4eba\u8a2d\u5b9a",code:"PROFILE"},{label:"\u5e6b\u52a9\u4e2d\u5fc3",code:"HELP"}],this.editableUserInfo=Object.assign({},this.userAccountService.userAccount())}onHomeIconClick(){this.navigationService.isCollapsed.set(!0),this.#e.navigate(["/home"])}onUserIconClick(){this.isUserDialogVisible=!this.isUserDialogVisible}onUserDialogListClick(N){this.isUserDialogVisible=!this.isUserDialogVisible,"PROFILE"===N.option.code&&(this.isUserProfileVisible=!0)}onNewsIconClick(){this.#e.navigate(["/news"])}onAppListIconClick(){this.isAppListDialogVisible=!this.isAppListDialogVisible}onAppStoreClick(){this.#e.navigate(["/appStore"])}onNavAppClick(N){this.#e.navigate([N])}onCloseApp(N){this.appStoreService.setAppClose(N)}onLogoutIconClick(){this.#e.navigate(["/login"])}static#t=this.\u0275fac=function(Y){return new(Y||T)};static#r=this.\u0275cmp=a.\u0275\u0275defineComponent({type:T,selectors:[["his-footer"]],standalone:!0,features:[a.\u0275\u0275StandaloneFeature],decls:27,vars:15,consts:[[1,"navigation-footer"],[1,"logo"],["src","assets/companyLogo.png","alt","Image",1,"logo-style"],[3,"ngClass"],[1,"wrapNavitem",3,"ngClass"],["pButton","","pRipple","","type","button","icon","pi pi-home",1,"p-button-rounded","p-button-text","p-button-icon-only",3,"click"],["pButton","","pRipple","","type","button",1,"p-button-rounded","p-button-text","p-button-icon-only",3,"click"],["image","assets/user.png","shape","circle"],["header","Header",1,"userSetting",3,"visible","visibleChange"],["pTemplate","header"],["pTemplate","content"],["pButton","","pRipple","","type","button","icon","pi pi-bell",1,"p-button-rounded","p-button-text",3,"click"],[1,"badge-container"],["severity","danger",1,"badge-style",3,"value"],[1,"pi","pi-th-large"],["header","Header",1,"appList",3,"visible","visibleChange"],["pButton","","pRipple","","type","button","icon","pi pi-sign-out ",1,"p-button-rounded","p-button-text",3,"click"],[1,"dialog-header"],["optionLabel","label",3,"options","onClick"],["pTemplate","item"],[1,"labellist"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24","fill","none"],["clip-path","url(#clip0_2927_3142)"],["d","M4 8H8V4H4V8ZM10 20H14V16H10V20ZM4 20H8V16H4V20ZM4 14H8V10H4V14ZM10 14H14V10H10V14ZM16 4V8H20V4H16ZM10 8H14V4H10V8ZM16 14H20V10H16V14ZM16 20H20V16H16V20Z","fill","white"],["id","clip0_2927_3142"],["width","24","height","24","fill","white"],[1,"see-all-style"],["pButton","","pRipple","","type","button","icon","pi pi-angle-right",1,"p-button-text",3,"click"],[1,"title-style","label-m"],[4,"ngFor","ngForOf"],["class","dialog-content-title",4,"ngIf"],[1,"dialog-content-title"],[1,"app-container",3,"click"],[1,"p-image","p-component"],[1,"material-symbols-outlined","icon-style"],[1,"flex","opend","w-full"],["pButton","","pRipple","","type","button","icon","pi pi-times",1,"p-button-text",3,"click"]],template:function(Y,Q){1&Y&&(a.\u0275\u0275elementStart(0,"ul",0)(1,"li",1),a.\u0275\u0275element(2,"img",2),a.\u0275\u0275elementStart(3,"div",3),a.\u0275\u0275text(4," \u96f2\u884c\u81f3\u5584 "),a.\u0275\u0275elementEnd()(),a.\u0275\u0275element(5,"hr"),a.\u0275\u0275elementStart(6,"div",4)(7,"li")(8,"button",5),a.\u0275\u0275listener("click",function(){return Q.onHomeIconClick()}),a.\u0275\u0275elementEnd()(),a.\u0275\u0275elementStart(9,"li")(10,"button",6),a.\u0275\u0275listener("click",function(){return Q.onUserIconClick()}),a.\u0275\u0275element(11,"p-avatar",7),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(12,"p-dialog",8),a.\u0275\u0275listener("visibleChange",function(at){return Q.isUserDialogVisible=at}),a.\u0275\u0275template(13,O,3,4,"ng-template",9),a.\u0275\u0275template(14,D,2,1,"ng-template",10),a.\u0275\u0275elementEnd()(),a.\u0275\u0275elementStart(15,"li")(16,"button",11),a.\u0275\u0275listener("click",function(){return Q.onNewsIconClick()}),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(17,"div",12),a.\u0275\u0275element(18,"p-badge",13),a.\u0275\u0275elementEnd()(),a.\u0275\u0275elementStart(19,"li")(20,"button",6),a.\u0275\u0275listener("click",function(){return Q.onAppListIconClick()}),a.\u0275\u0275element(21,"i",14),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(22,"p-dialog",15),a.\u0275\u0275listener("visibleChange",function(at){return Q.isAppListDialogVisible=at}),a.\u0275\u0275template(23,W,9,0,"ng-template",9),a.\u0275\u0275template(24,x,11,2,"ng-template",10),a.\u0275\u0275elementEnd()(),a.\u0275\u0275elementStart(25,"li")(26,"button",16),a.\u0275\u0275listener("click",function(){return Q.onLogoutIconClick()}),a.\u0275\u0275elementEnd()()()()),2&Y&&(a.\u0275\u0275advance(3),a.\u0275\u0275property("ngClass",a.\u0275\u0275pureFunction1(9,w,Q.navigationService.isCollapsed())),a.\u0275\u0275advance(3),a.\u0275\u0275property("ngClass",a.\u0275\u0275pureFunction1(11,P,!Q.navigationService.isCollapsed())),a.\u0275\u0275advance(5),a.\u0275\u0275styleMap(a.\u0275\u0275pureFunction0(13,Ye)),a.\u0275\u0275advance(1),a.\u0275\u0275property("visible",Q.isUserDialogVisible),a.\u0275\u0275advance(6),a.\u0275\u0275propertyInterpolate("value",Q.newsService.normalNews().length+Q.newsService.toDoList().length),a.\u0275\u0275advance(4),a.\u0275\u0275styleMap(a.\u0275\u0275pureFunction0(14,C)),a.\u0275\u0275property("visible",Q.isAppListDialogVisible))},dependencies:[ce.CommonModule,ce.NgClass,ce.NgForOf,ce.NgIf,He.AvatarModule,He.Avatar,_e.DividerModule,_e.Divider,Z.RouterModule,le.ButtonModule,le.ButtonDirective,Le.PrimeTemplate,fe.DialogModule,fe.Dialog,nt.BadgeModule,nt.Badge,je.ImageModule,Ke.ListboxModule,Ke.Listbox,ze.InputTextModule,We.InputSwitchModule,ft.FormsModule,st.SelectButtonModule,K.PasswordModule,Oe.FileUploadModule],styles:[".navigation-footer[_ngcontent-%COMP%]{width:100%;margin:0;padding:0;list-style-type:none;display:flex;flex-direction:column;align-items:center;justify-content:flex-end;gap:6px}.navigation-footer[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center;margin-bottom:4px}.navigation-footer[_ngcontent-%COMP%]   .logo[_ngcontent-%COMP%]   .collapsed-active[_ngcontent-%COMP%]{display:none}.navigation-footer[_ngcontent-%COMP%]   .wrapNavitem[_ngcontent-%COMP%]{width:100%;display:flex;flex-wrap:wrap;flex-direction:column;justify-content:center;align-items:center;transition:all .3s;gap:5px}.navigation-footer[_ngcontent-%COMP%]   .wrapNavitem.collapsed-inactive[_ngcontent-%COMP%]{flex-direction:row}.navigation-footer[_ngcontent-%COMP%]   hr[_ngcontent-%COMP%]{position:relative;width:100%;margin:0}.navigation-footer[_ngcontent-%COMP%]   hr[_ngcontent-%COMP%]:after{position:absolute;width:100%;height:.5px;background-color:var(--outline-variant);left:50%;top:50%;transform:translate(-50%,-50%)}.navigation-footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background-color:transparent;border:none}.logo-container[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center}.logo-style[_ngcontent-%COMP%]{width:34px;height:24px}.badge-container[_ngcontent-%COMP%]{position:relative;display:inline-block}.badge-style[_ngcontent-%COMP%]{font-size:12px;min-width:1rem;height:1rem;line-height:.5rem;position:absolute;top:-28px;right:-2px;pointer-events:none}.dialog-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:4px}.dialog-content-title[_ngcontent-%COMP%]{padding:4px var(--spacing-md)}.see-all-style[_ngcontent-%COMP%]{cursor:pointer;display:flex;justify-content:space-between;align-items:center;padding:0 var(--spacing-md) 2px}.see-all-style[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:2rem;height:2rem;margin:0}.title-style[_ngcontent-%COMP%]{padding:var(--spacing-sm) var(--spacing-md);line-height:24px;letter-spacing:.16px}.app-container[_ngcontent-%COMP%]{display:flex;justify-content:flex-start;align-items:center;gap:4px;cursor:pointer}.profileContent[_ngcontent-%COMP%]{gap:var(--spacing-xxl)}.profileContent[_ngcontent-%COMP%]   h6[_ngcontent-%COMP%]{margin:0 0 8px;font-weight:700}.profileContent[_ngcontent-%COMP%]   .ImgBox[_ngcontent-%COMP%]{width:20%;min-width:160px}.profileContent[_ngcontent-%COMP%]   .ImgBox[_ngcontent-%COMP%]   .Img[_ngcontent-%COMP%]{position:relative}.profileContent[_ngcontent-%COMP%]   .ImgBox[_ngcontent-%COMP%]   .Img[_ngcontent-%COMP%]   .p-button[_ngcontent-%COMP%]{position:absolute;right:3px;bottom:3px;padding:4px}.profileContent[_ngcontent-%COMP%]   .ImgBox[_ngcontent-%COMP%]   .Img[_ngcontent-%COMP%]   .p-button[_ngcontent-%COMP%]:hover{background-color:var(--primary-300)}.profileContent[_ngcontent-%COMP%]   .ImgBox[_ngcontent-%COMP%]   .Img[_ngcontent-%COMP%]   .pencil[_ngcontent-%COMP%]{position:absolute;right:3px;bottom:3px;padding:4px}.profileContent[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{flex:1}.profileContent[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .formBox[_ngcontent-%COMP%]{column-gap:32px}.profileContent[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .formBox[_ngcontent-%COMP%]   .formList[_ngcontent-%COMP%]{width:calc(50% - 16px);display:flex;flex-direction:column}.profileContent[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .formBox[_ngcontent-%COMP%]   .formList[_ngcontent-%COMP%]   .fromColumn[_ngcontent-%COMP%]{margin-bottom:var(--spacing-xl)}.profileContent[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .formBox[_ngcontent-%COMP%]   .formList[_ngcontent-%COMP%]   .fromColumn[_ngcontent-%COMP%]   .fulid[_ngcontent-%COMP%]{width:100%}.profileContent[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .typeBox[_ngcontent-%COMP%]{border-top:1px solid var(--outline-variant);padding-top:var(--spacing-xl);justify-content:space-between;padding-right:30px}.profileContent[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]   .typeBox[_ngcontent-%COMP%]   .typeForm.column[_ngcontent-%COMP%]{gap:10px;flex-direction:column}.profileContent[_ngcontent-%COMP%]   .p-button.p-button-outlined.p-button-hover-outlined[_ngcontent-%COMP%]{margin:0 1px}.profileContent[_ngcontent-%COMP%]   .p-button.p-button-outlined.p-button-hover-outlined.active[_ngcontent-%COMP%]{box-shadow:inset 0 0 0 1px}.opend[_ngcontent-%COMP%]{justify-content:space-between}[_nghost-%COMP%]     .p-button{min-width:0}[_nghost-%COMP%]     .p-dialog{position:absolute;border-radius:4px;border:1px solid var(--outline-variant);font-size:1.125rem;box-shadow:0 2px 1px -1px #00000005,0 1px 1px #00000024,0 1px 3px #0000001f}[_nghost-%COMP%]     .p-dialog .p-dialog-header{background-color:var(--primary-main);color:var(--white);font-size:18px;font-style:normal;font-weight:700;line-height:26px;letter-spacing:.36px}[_nghost-%COMP%]     .p-dialog .p-dialog-content{display:flex;flex-direction:column;padding:4px 0;gap:0}[_nghost-%COMP%]     .p-dialog .p-dialog-footer{display:flex;align-items:center;padding:4px 12px}[_nghost-%COMP%]     #large-font .p-button-label{font-size:20px}[_nghost-%COMP%]     #medium-font .p-button-label{font-size:18px}[_nghost-%COMP%]     #small-font .p-button-label{font-size:16px}[_nghost-%COMP%]     .appList .p-dialog{left:45px;bottom:20px}[_nghost-%COMP%]     .appList .p-dialog .p-dialog-footer{justify-content:space-between}[_nghost-%COMP%]     .appList .p-dialog .p-dialog-footer button{width:2rem;height:2rem;margin:0}[_nghost-%COMP%]     .userSetting{min-width:180px}[_nghost-%COMP%]     .userSetting .p-dialog{bottom:100px}[_nghost-%COMP%]     .userSetting .p-dialog-content{padding:0}[_nghost-%COMP%]     .userSetting .p-dialog-content .p-listbox{border:none}[_nghost-%COMP%]     .userSetting .p-dialog-content .p-listbox .p-listbox-list .p-listbox-item{padding:4px 12px;min-height:40px}[_nghost-%COMP%]     .userSetting .p-dialog{left:45px;bottom:110px}[_nghost-%COMP%]     .profile .p-dialog{width:800px}[_nghost-%COMP%]     .profile .p-dialog .p-dialog-content{padding:20px 12px}[_nghost-%COMP%]     .profile .p-dialog .p-dialog-content .fromColumn .fulid{display:block;width:100%}[_nghost-%COMP%]     .profile .p-dialog .p-dialog-content .fromColumn .fulid .p-password{width:100%}[_nghost-%COMP%]     .profile .p-dialog .p-dialog-content .fromColumn .fulid .p-password .p-disabled{pointer-events:none;opacity:1;background-color:#1314141f;border-color:var(--outline-variant)}[_nghost-%COMP%]     .profile .p-dialog .p-dialog-content .fromColumn .fulid .p-password .p-disabled+.p-icon-wrapper{pointer-events:none}[_nghost-%COMP%]     .profile .p-dialog .p-dialog-content .fromColumn .fulid .p-input-icon-right>.p-icon-wrapper{right:15px;cursor:pointer}[_nghost-%COMP%]     .profile .p-dialog .p-dialog-footer{padding:16px 12px;justify-content:flex-end}[_nghost-%COMP%]     .profile .p-dialog .p-dialog-footer button{min-width:88px}[_nghost-%COMP%]     .p-divider.p-divider-horizontal{margin:0}[_nghost-%COMP%]     .p-image.p-component{display:block;width:30px;height:30px;background-color:var(--primary-main);border-radius:8px;overflow:hidden;padding:8px;position:relative;background:linear-gradient(0deg,rgba(0,0,0,.2) 0%,rgba(0,0,0,0) 100%),var(--primary-main);box-shadow:0 2px 1px -1px #00000005,0 1px 1px #00000024,0 1px 3px #0000001f}[_nghost-%COMP%]     .p-image.p-component img{display:block;width:100%;height:100%}[_nghost-%COMP%]     .p-badge{min-width:1rem!important;height:1rem;line-height:16px;font-size:10px;padding:0}[_nghost-%COMP%]     p-avatar{height:24px}[_nghost-%COMP%]     .p-avatar.p-avatar-circle{background-color:var(--primary-main)}[_nghost-%COMP%]     .p-avatar.p-avatar-circle .pi-pencil{color:var(--white)}[_nghost-%COMP%]     .p-avatar.p-avatar-circle:hover{background-color:var(--primary-300);cursor:pointer}[_nghost-%COMP%]     .formBox .p-inputtext{width:100%}[_nghost-%COMP%]     .opend .p-button.p-button-icon-only .pi{font-size:1rem}.icon-style[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;justify-content:center;align-items:center;color:var(--surface-a);font-size:18px}"]})}return T})();var F=B(9159);let X=(()=>{class T{#e="ws://localhost:8080";#t=(0,a.inject)(F.JetstreamWsService);connect(){var N=this;return(0,d.Z)(function*(){console.log("connected"),yield N.#t.connect(N.#e)})()}disconnect(){var N=this;return(0,d.Z)(function*(){yield N.#t.drain()})()}static#r=this.\u0275fac=function(Y){return new(Y||T)};static#n=this.\u0275prov=a.\u0275\u0275defineInjectable({token:T,factory:T.\u0275fac,providedIn:"root"})}return T})();function we(T,ge){if(1&T&&(a.\u0275\u0275elementContainerStart(0),a.\u0275\u0275elementStart(1,"div",3)(2,"span",4),a.\u0275\u0275text(3),a.\u0275\u0275elementEnd()(),a.\u0275\u0275elementStart(4,"div")(5,"div"),a.\u0275\u0275text(6),a.\u0275\u0275elementEnd()(),a.\u0275\u0275elementContainerEnd()),2&T){const N=a.\u0275\u0275nextContext();a.\u0275\u0275advance(3),a.\u0275\u0275textInterpolate1(" ",N.appInfo().icon," "),a.\u0275\u0275advance(3),a.\u0275\u0275textInterpolate(N.appInfo().title)}}function G(T,ge){if(1&T){const N=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementContainerStart(0),a.\u0275\u0275elementStart(1,"button",5),a.\u0275\u0275listener("click",function(){a.\u0275\u0275restoreView(N);const Q=a.\u0275\u0275nextContext();return a.\u0275\u0275resetView(Q.changeCollapsed())}),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementContainerEnd()}if(2&T){const N=a.\u0275\u0275nextContext();a.\u0275\u0275advance(1),a.\u0275\u0275propertyInterpolate("icon",N.collapsedButtonIcon())}}const z=function(T){return{"collapsed-inactive":T}};let Se=(()=>{class T{constructor(){this.appInfo=(0,a.signal)({}),this.navigationService=(0,a.inject)(ve),this.collapsedButtonIcon=(0,a.computed)(()=>!this.navigationService.isCollapsed()&&this.navigationService.isShowBody()?(console.log("pi pi-angle-double-left"),"pi pi-angle-double-left"):"pi pi-angle-double-right"),this.appStoreService=(0,a.inject)(xe.AppStoreService),this.wsNatsService=(0,a.inject)(X)}ngOnInit(){var N=this;return(0,d.Z)(function*(){console.log("in NAV"),yield N.wsNatsService.connect(),yield N.appStoreService.initAppStore(),console.log(N.appStoreService.myAppStores()),console.log("in nav bottom")})()}changeCollapsed(){this.navigationService.onCollapsClick()}static#e=this.\u0275fac=function(Y){return new(Y||T)};static#t=this.\u0275cmp=a.\u0275\u0275defineComponent({type:T,selectors:[["his-navigation"]],standalone:!0,features:[a.\u0275\u0275StandaloneFeature],decls:5,vars:5,consts:[[1,"navigation-container"],[1,"navigation-header",3,"ngClass"],[4,"ngIf"],[1,"m-1"],[1,"material-symbols-outlined"],["pButton","","pRipple","","type","button",1,"p-button-rounded","p-button-text",3,"icon","click"]],template:function(Y,Q){1&Y&&(a.\u0275\u0275elementStart(0,"div",0)(1,"div",1),a.\u0275\u0275template(2,we,7,2,"ng-container",2),a.\u0275\u0275template(3,G,2,1,"ng-container",2),a.\u0275\u0275elementEnd(),a.\u0275\u0275element(4,"his-footer"),a.\u0275\u0275elementEnd()),2&Y&&(a.\u0275\u0275advance(1),a.\u0275\u0275property("ngClass",a.\u0275\u0275pureFunction1(3,z,!Q.navigationService.isCollapsed())),a.\u0275\u0275advance(1),a.\u0275\u0275property("ngIf",Q.navigationService.isCollapsed),a.\u0275\u0275advance(1),a.\u0275\u0275property("ngIf",Q.navigationService.isShowBody()))},dependencies:[ce.CommonModule,ce.NgClass,ce.NgIf,le.ButtonModule,le.ButtonDirective,L],styles:["[_nghost-%COMP%]     .navigation-header .p-button.p-button-icon-only.p-button-rounded.p-button-text{color:var(--primary-main)}[_nghost-%COMP%]     .appList .p-dialog-content .p-button.p-button-icon-only .pi, [_nghost-%COMP%]     .navigation-footer .p-button.p-button-icon-only .pi{font-size:1.2rem}.layout-sidebar[_ngcontent-%COMP%]{position:fixed;display:flex;justify-content:center;width:60px;height:100%;z-index:999;overflow-y:auto;-webkit-user-select:none;user-select:none;top:0;left:0;transition:transform .2s,left .2s;background-color:var(--surface-overlay);border-right:1px solid var(--outline-variant);padding:.5rem 0rem;border-radius:0;box-shadow:none}.layout-sidebar.collapsed-inactive[_ngcontent-%COMP%]{width:200px}.layout-content[_ngcontent-%COMP%]{margin-left:60px;height:100%}.layout-content.collapsed-inactive[_ngcontent-%COMP%]{margin-left:200px}.systemTitle[_ngcontent-%COMP%]{font-size:20px;font-style:normal;font-weight:500;line-height:100%}.navigation-container[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;flex-direction:column;justify-content:space-between;gap:2px;padding-bottom:10px}.navigation-body[_ngcontent-%COMP%]{flex:1}.navigation-header[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center}.navigation-header.collapsed-inactive[_ngcontent-%COMP%]{justify-content:space-between}"]})}return T})();const me=function(T){return{"collapsed-inactive":T}};let Ee=(()=>{class T{constructor(){this.navigationService=(0,a.inject)(ve),this.navigationViewService=(0,a.inject)(H),this.newsService=(0,a.inject)(Pe.NewsService),this.userAccountService=(0,a.inject)(pe.N),this.#e=(0,a.inject)(ie.SharedService),this.#t=(0,a.inject)(X)}#e;#t;ngOnInit(){var N=this;return(0,d.Z)(function*(){yield N.#t.connect(),N.userAccountService.userAccount.set(N.#e.getValue(window.history.state.token)),N.userAccountService.getUserImage(N.userAccountService.userAccount().userCode.code),yield N.newsService.connect(),yield N.newsService.subMyNews(N.userAccountService.userAccount().userCode),N.newsService.getInitNews(N.userAccountService.userAccount().userCode).subscribe(Y=>{N.newsService.upsertAllNews(N.newsService.formatNews(Y))})})()}static#r=this.\u0275fac=function(Y){return new(Y||T)};static#n=this.\u0275cmp=a.\u0275\u0275defineComponent({type:T,selectors:[["app-navigation-view"]],standalone:!0,features:[a.\u0275\u0275ProvidersFeature([H]),a.\u0275\u0275StandaloneFeature],decls:4,vars:6,consts:[[1,"layout-sidebar",3,"ngClass"],[3,"setCollapsed"],[1,"layout-content",3,"ngClass"]],template:function(Y,Q){1&Y&&(a.\u0275\u0275elementStart(0,"div",0)(1,"his-navigation",1),a.\u0275\u0275listener("setCollapsed",function(){return Q.navigationService.onCollapsClick()}),a.\u0275\u0275elementEnd()(),a.\u0275\u0275elementStart(2,"div",2),a.\u0275\u0275element(3,"router-outlet"),a.\u0275\u0275elementEnd()),2&Y&&(a.\u0275\u0275property("ngClass",a.\u0275\u0275pureFunction1(2,me,!Q.navigationService.isCollapsed())),a.\u0275\u0275advance(2),a.\u0275\u0275property("ngClass",a.\u0275\u0275pureFunction1(4,me,!Q.navigationService.isCollapsed())))},dependencies:[ce.CommonModule,ce.NgClass,Se,Z.RouterOutlet],styles:[".layout-sidebar[_ngcontent-%COMP%]{position:fixed;display:flex;justify-content:center;width:60px;height:100%;z-index:999;overflow-y:auto;-webkit-user-select:none;user-select:none;top:0;left:0;transition:transform .2s,left .2s;background-color:var(--surface-overlay);border-right:1px solid var(--outline-variant);padding:.5rem 0rem;border-radius:0;box-shadow:none}.layout-sidebar.collapsed-inactive[_ngcontent-%COMP%]{width:200px}.layout-content[_ngcontent-%COMP%]{margin-left:60px;height:100%}.layout-content.collapsed-inactive[_ngcontent-%COMP%]{margin-left:200px}"]})}return T})()},9191:(Ct,Ne,B)=>{B.r(Ne),B.d(Ne,{AppStoreComponent:()=>Ye,AppStoreService:()=>pe});var d=B(5861),a=B(5863),ce=B(6701),le=B(9159),Z=B(2182),ue=B(575),he=B(8426),ve=B(743),He=B(1189),_e=B(2998),Oe=B(7842),fe=B(6107),nt=B(6984),je=B(3433),Ke=B(6488),ze=B(25);function We(O,qe){if(1&O&&(a.\u0275\u0275elementStart(0,"span"),a.\u0275\u0275text(1),a.\u0275\u0275elementEnd()),2&O){const D=qe.$implicit;a.\u0275\u0275classMap(D.icon),a.\u0275\u0275advance(1),a.\u0275\u0275textInterpolate1(" ",D.label," ")}}function ft(O,qe){if(1&O){const D=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementContainerStart(0),a.\u0275\u0275elementStart(1,"his-card-list",19),a.\u0275\u0275listener("setChange",function(j){a.\u0275\u0275restoreView(D);const re=a.\u0275\u0275nextContext(2);return a.\u0275\u0275resetView(re.appStoreService.onFavoriteClick(j))})("clickCard",function(j){a.\u0275\u0275restoreView(D);const re=a.\u0275\u0275nextContext(2);return a.\u0275\u0275resetView(re.appStoreService.onNavAppClick(j))}),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementContainerEnd()}if(2&O){const D=qe.$implicit;a.\u0275\u0275advance(1),a.\u0275\u0275property("myAppStore",D)}}function st(O,qe){if(1&O&&(a.\u0275\u0275elementContainerStart(0),a.\u0275\u0275elementStart(1,"div",15),a.\u0275\u0275element(2,"p-divider",16),a.\u0275\u0275elementStart(3,"div",17),a.\u0275\u0275template(4,ft,2,1,"ng-container",18),a.\u0275\u0275elementEnd()(),a.\u0275\u0275elementContainerEnd()),2&O){const D=a.\u0275\u0275nextContext();a.\u0275\u0275advance(4),a.\u0275\u0275property("ngForOf",D.appStoreService.myAppStores())}}function K(O,qe){if(1&O){const D=a.\u0275\u0275getCurrentView();a.\u0275\u0275elementContainerStart(0),a.\u0275\u0275elementStart(1,"his-card-list",22),a.\u0275\u0275listener("setChange",function(j){a.\u0275\u0275restoreView(D);const re=a.\u0275\u0275nextContext(2);return a.\u0275\u0275resetView(re.appStoreService.onFavoriteClick(j))})("clickCard",function(j){a.\u0275\u0275restoreView(D);const re=a.\u0275\u0275nextContext(2);return a.\u0275\u0275resetView(re.appStoreService.onNavAppClick(j))}),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementContainerEnd()}if(2&O){const D=qe.$implicit;a.\u0275\u0275advance(1),a.\u0275\u0275property("myAppStore",D)("isListView",!0)}}function ie(O,qe){if(1&O&&(a.\u0275\u0275elementStart(0,"div",20),a.\u0275\u0275element(1,"p-divider",16),a.\u0275\u0275elementStart(2,"div",21),a.\u0275\u0275template(3,K,2,2,"ng-container",18),a.\u0275\u0275elementEnd()()),2&O){const D=a.\u0275\u0275nextContext();a.\u0275\u0275advance(3),a.\u0275\u0275property("ngForOf",D.appStoreService.myAppStores())}}let xe=(()=>{class O{#e="ws://localhost:8080";#t=(0,a.inject)(le.JetstreamWsService);connect(){var D=this;return(0,d.Z)(function*(){console.log("connected"),yield D.#t.connect(D.#e)})()}disconnect(){var D=this;return(0,d.Z)(function*(){yield D.#t.drain()})()}static#r=this.\u0275fac=function(W){return new(W||O)};static#n=this.\u0275prov=a.\u0275\u0275defineInjectable({token:O,factory:O.\u0275fac,providedIn:"root"})}return O})(),pe=(()=>{class O{constructor(){this.myAppStores=(0,a.signal)([]),this.userAppStores=(0,a.signal)([]),this.appOpenedIndex=[],this.#e=(0,a.inject)(ce.Router),this.#t=(0,a.inject)(le.JetstreamWsService),this.#r=(0,a.inject)(Z.SharedService),this.#n=(0,a.inject)(xe)}#e;#t;#r;#n;convertToExtended(D){return D.map(W=>({...W,isOpen:!0}))}getAppStoreList(D){var W=this;return(0,d.Z)(function*(){W.#t.request("UserAppStore.myAppStore",D).subscribe(j=>{W.myAppStores.set(W.convertToExtended(j))})})()}getUserStoreList(D){var W=this;return(0,d.Z)(function*(){W.#t.request("UserAppStore.list",D).subscribe(j=>{W.userAppStores.set(j)})})()}getAppStoresByKeyword(D){return D?this.myAppStores().filter(W=>W.title.includes(D)):this.myAppStores()}getAppStore(D){return this.myAppStores().filter(j=>j.url===D)[0]}pubUserAppStoreFavorite(D){var W=this;return(0,d.Z)(function*(){yield W.#t.publish("UserAppStore.update.isFavorite",D)})()}initAppStore(){var D=this;return(0,d.Z)(function*(){const W=yield D.#r.getValue(history.state.token);console.log("get token",W),yield D.getAppStoreList(W.userCode.code),yield D.getUserStoreList(W.userCode.code)})()}onFavoriteClick(D){this.myAppStores.update(W=>(console.log("userAppStores",this.userAppStores()),W.map(j=>{if(j.appId===D){j.isFavorite=!j.isFavorite;const re=this.userAppStores().find(Ie=>Ie.appId===D);console.log("appId",D),console.log("userAppStoreID",re?.appId),re&&(re.isFavorite=j.isFavorite,this.pubUserAppStoreFavorite(re))}return j})))}onNavAppClick(D){this.#e.navigate([D])}setAppClose(D){if(this.myAppStores.update(W=>W.map(j=>(j.appId===D&&(j.isOpen=!1),j))),console.log(this.appOpenedIndex),this.appOpenedIndex.length>1){const W=this.appOpenedIndex.findIndex(j=>j._id===D);this.appOpenedIndex.splice(W,1),console.log(W),console.log(this.appOpenedIndex[this.appOpenedIndex.length-1]),this.#e.navigate([this.appOpenedIndex[this.appOpenedIndex.length-1].url])}else this.appOpenedIndex.splice(1,1),this.#e.navigateByUrl("/home")}static#s=this.\u0275fac=function(W){return new(W||O)};static#i=this.\u0275prov=a.\u0275\u0275defineInjectable({token:O,factory:O.\u0275fac,providedIn:"root"})}return O})();var Le=Object.freeze({__proto__:null,default:[{icon:"material-symbols-outlined",label:"grid_view",value:"grid"},{icon:"material-symbols-outlined",label:"view_agenda",value:"list"}]});let Ye=(()=>{class O{constructor(){this.isGridView=(0,a.signal)(!0),this.Options=[],this.value="grid",this.appStoreService=(0,a.inject)(pe),this.userAccountService=(0,a.inject)(Ke.N),this.#e=(0,a.inject)(Z.SharedService),this.#t=(0,a.inject)(je.TranslateService)}#e;#t;ngOnInit(){var D=this;return(0,d.Z)(function*(){D.#t.setDefaultLang("zh-Hant"),D.Options=Object.values(Le)[0]})()}onBackClick(){window.history.back()}onSelectedChange(){this.isGridView.set("grid"===this.value)}static#r=this.\u0275fac=function(W){return new(W||O)};static#n=this.\u0275cmp=a.\u0275\u0275defineComponent({type:O,selectors:[["his-app-store"]],standalone:!0,features:[a.\u0275\u0275StandaloneFeature],decls:21,vars:9,consts:[[1,"content-container"],[1,"top-bar-container"],["styleClass","mr-2","size","xlarge","shape","circle",3,"image"],[1,"title"],[1,"toolbar-container"],[1,"icon-container","title-box"],["pButton","","pRipple","","type","button","icon","pi pi-angle-left",1,"p-button-rounded","p-button-secondary","p-button-outlined",3,"click"],[1,"icon-container"],[1,"p-input-icon-left"],[1,"pi","pi-search"],["type","text","pInputText","","placeholder","\u67e5\u8a62"],["optionLabel","name","optionValue","value",3,"options","ngModel","ngModelChange","onOptionClick"],["pTemplate",""],[4,"ngIf","ngIfElse"],["listView",""],[1,"appstore-container"],[1,"first-class"],[1,"flex","flex-wrap","card-content"],[4,"ngFor","ngForOf"],[1,"grid-style",3,"myAppStore","setChange","clickCard"],[1,"appstore-container","listView"],[1,"flex","flex-wrap","list-content"],[1,"list-style",3,"myAppStore","isListView","setChange","clickCard"]],template:function(W,j){if(1&W&&(a.\u0275\u0275elementStart(0,"div",0)(1,"div",1),a.\u0275\u0275element(2,"p-avatar",2),a.\u0275\u0275elementStart(3,"div",3),a.\u0275\u0275text(4),a.\u0275\u0275pipe(5,"translate"),a.\u0275\u0275elementEnd()(),a.\u0275\u0275elementStart(6,"div",4)(7,"div",5)(8,"button",6),a.\u0275\u0275listener("click",function(){return j.onBackClick()}),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(9,"div")(10,"h3"),a.\u0275\u0275text(11,"\u7a0b\u5f0f\u96c6"),a.\u0275\u0275elementEnd()()(),a.\u0275\u0275elementStart(12,"div",7)(13,"span",8),a.\u0275\u0275element(14,"i",9)(15,"input",10),a.\u0275\u0275elementEnd(),a.\u0275\u0275elementStart(16,"p-selectButton",11),a.\u0275\u0275listener("ngModelChange",function(Ie){return j.value=Ie})("onOptionClick",function(){return j.onSelectedChange()}),a.\u0275\u0275template(17,We,2,3,"ng-template",12),a.\u0275\u0275elementEnd()()(),a.\u0275\u0275template(18,st,5,1,"ng-container",13),a.\u0275\u0275template(19,ie,4,1,"ng-template",null,14,a.\u0275\u0275templateRefExtractor),a.\u0275\u0275elementEnd()),2&W){const re=a.\u0275\u0275reference(20);a.\u0275\u0275advance(2),a.\u0275\u0275propertyInterpolate("image",j.userAccountService.userImage().image),a.\u0275\u0275advance(2),a.\u0275\u0275textInterpolate2(" ",j.userAccountService.userAccount().userCode.display,",",a.\u0275\u0275pipeBind1(5,7,"\u6b61\u8fce\u56de\u4f86")," "),a.\u0275\u0275advance(12),a.\u0275\u0275property("options",j.Options)("ngModel",j.value),a.\u0275\u0275advance(2),a.\u0275\u0275property("ngIf",j.isGridView())("ngIfElse",re)}},dependencies:[ue.CommonModule,ue.NgForOf,ue.NgIf,He.ButtonModule,He.ButtonDirective,ze.PrimeTemplate,Oe.DividerModule,Oe.Divider,ve.SelectButtonModule,ve.SelectButton,he.FormsModule,he.NgControlStatus,he.NgModel,_e.InputTextModule,_e.InputText,fe.AvatarModule,fe.Avatar,nt.D,je.TranslateModule,je.TranslatePipe],styles:["[_nghost-%COMP%]     .grid-style{margin:6px;width:calc(20% - 12px);max-width:320px}[_nghost-%COMP%]     .grid-style.second-class .p-image.p-component{background:linear-gradient(0deg,rgba(0,0,0,.2) 0%,rgba(0,0,0,0) 100%),var(--tertiary-main)}[_nghost-%COMP%]     .grid-style.third-class .p-image.p-component{background:linear-gradient(0deg,rgba(0,0,0,.2) 0%,rgba(0,0,0,0) 100%),var(--indigo-500)}[_nghost-%COMP%]     .grid-style.fourth-class .p-image.p-component{background:linear-gradient(0deg,rgba(0,0,0,.2) 0%,rgba(0,0,0,0) 100%),var(--orange-500)}[_nghost-%COMP%]     .list-style .p-image.p-component{width:56px;height:56px}[_nghost-%COMP%]     .p-selectbutton .p-button{border-radius:0}[_nghost-%COMP%]     .p-selectbutton .p-button:first-child{border-radius:6px 0 0 6px}[_nghost-%COMP%]     .p-selectbutton .p-button:last-child{border-radius:0 6px 6px 0}.content-container[_ngcontent-%COMP%]{padding:32px;height:100%;display:flex;flex-direction:column;background-color:var(--surface-ground);overflow:auto}.appstore-container[_ngcontent-%COMP%]{padding:var(--spacing-xs) var(--spacing-lg)}.appstore-container.listView[_ngcontent-%COMP%]{width:100%;margin:0 auto}.appstore-container[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]{width:95%;margin:0 auto;transform:translate(-6px);padding-bottom:var(--spacing-md)}.appstore-container[_ngcontent-%COMP%]   .list-content[_ngcontent-%COMP%]{gap:12px}.top-bar-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center}.icon-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:8px}.icon-container[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-size:1.5rem;font-style:normal;font-weight:700;line-height:2rem;letter-spacing:.03rem;color:var(--surface-on-surface)}.list-style[_ngcontent-%COMP%]{cursor:pointer;width:100%}[_nghost-%COMP%]     .p-buttonset .p-button-icon-only{justify-content:center;width:2rem;height:2rem}[_nghost-%COMP%]     .p-buttonset .p-button-icon-only .p-button-icon{font-size:1rem;padding-left:3px}[_nghost-%COMP%]     .p-divider.p-divider-horizontal{margin:12px 0}[_nghost-%COMP%]     .first-class .p-divider-solid.p-divider-horizontal:before{border-color:var(--primary-main);border-width:4px}[_nghost-%COMP%]     .second-class .p-divider-solid.p-divider-horizontal:before{border-color:var(--tertiary-main);border-width:4px}[_nghost-%COMP%]     .third-class .p-divider-solid.p-divider-horizontal:before{border-color:var(--indigo-500);border-width:4px}[_nghost-%COMP%]     .fourth-class .p-divider-solid.p-divider-horizontal:before{border-color:var(--orange-500);border-width:4px}.title[_ngcontent-%COMP%]{padding-left:24px;font-size:28px;font-weight:700;line-height:40px;letter-spacing:1.12px;color:var(--primary-main)}.toolbar-container[_ngcontent-%COMP%]{padding:var(--spacing-xs) var(--spacing-lg);display:flex;justify-content:space-between;width:100%;margin:var(--spacing-lg) 0 var(--spacing-sm)}"]})}return O})()},6488:(Ct,Ne,B)=>{B.d(Ne,{N:()=>le});var d=B(5863),a=B(9159);let le=(()=>{class Z{constructor(){this.#e=(0,d.inject)(a.JetstreamWsService),this.userAccount=(0,d.signal)({}),this.userImage=(0,d.signal)({})}#e;getUserImage(he){this.#e.request("UserImage.GetUserImage",he).subscribe(ve=>{this.userImage.set(ve),console.log("get image",ve)})}static#t=this.\u0275fac=function(ve){return new(ve||Z)};static#r=this.\u0275prov=d.\u0275\u0275defineInjectable({token:Z,factory:Z.\u0275fac,providedIn:"root"})}return Z})()},6984:(Ct,Ne,B)=>{B.d(Ne,{D:()=>st});var d=B(5863),a=B(575),ce=B(1189),le=B(7069),Z=B(6701);function ue(K,ie){if(1&K&&(d.\u0275\u0275elementContainerStart(0),d.\u0275\u0275elementContainer(1,5),d.\u0275\u0275elementContainerEnd()),2&K){const H=d.\u0275\u0275nextContext(2);d.\u0275\u0275advance(1),d.\u0275\u0275property("ngTemplateOutlet",H.footerTemplate)}}function he(K,ie){if(1&K){const H=d.\u0275\u0275getCurrentView();d.\u0275\u0275elementContainerStart(0),d.\u0275\u0275elementStart(1,"div",4),d.\u0275\u0275listener("click",function(){d.\u0275\u0275restoreView(H);const pe=d.\u0275\u0275nextContext();return d.\u0275\u0275resetView(pe.directToApp(pe.myAppStore.url))}),d.\u0275\u0275elementContainer(2,5)(3,5),d.\u0275\u0275template(4,ue,2,1,"ng-container",0),d.\u0275\u0275elementEnd(),d.\u0275\u0275elementContainerEnd()}if(2&K){const H=d.\u0275\u0275nextContext(),xe=d.\u0275\u0275reference(3),pe=d.\u0275\u0275reference(5);d.\u0275\u0275advance(2),d.\u0275\u0275property("ngTemplateOutlet",xe),d.\u0275\u0275advance(1),d.\u0275\u0275property("ngTemplateOutlet",pe),d.\u0275\u0275advance(1),d.\u0275\u0275property("ngIf",H.footerTemplate)}}function ve(K,ie){if(1&K){const H=d.\u0275\u0275getCurrentView();d.\u0275\u0275elementContainerStart(0),d.\u0275\u0275elementStart(1,"div",6),d.\u0275\u0275listener("click",function(){d.\u0275\u0275restoreView(H);const pe=d.\u0275\u0275nextContext();return d.\u0275\u0275resetView(pe.directToApp(pe.myAppStore.url))}),d.\u0275\u0275elementContainer(2,5),d.\u0275\u0275elementEnd(),d.\u0275\u0275elementContainerEnd()}if(2&K){d.\u0275\u0275nextContext();const H=d.\u0275\u0275reference(7);d.\u0275\u0275advance(2),d.\u0275\u0275property("ngTemplateOutlet",H)}}function He(K,ie){if(1&K&&(d.\u0275\u0275elementStart(0,"div",7)(1,"div",8)(2,"span",9),d.\u0275\u0275text(3),d.\u0275\u0275elementEnd()()()),2&K){const H=d.\u0275\u0275nextContext();d.\u0275\u0275advance(3),d.\u0275\u0275textInterpolate1(" ",H.myAppStore.icon," ")}}function _e(K,ie){1&K&&(d.\u0275\u0275elementContainerStart(0),d.\u0275\u0275element(1,"span",15),d.\u0275\u0275elementContainerEnd())}function Oe(K,ie){1&K&&(d.\u0275\u0275elementContainerStart(0),d.\u0275\u0275element(1,"span",16),d.\u0275\u0275elementContainerEnd())}function fe(K,ie){if(1&K){const H=d.\u0275\u0275getCurrentView();d.\u0275\u0275elementStart(0,"div",10)(1,"div",11)(2,"span",12),d.\u0275\u0275text(3),d.\u0275\u0275elementEnd(),d.\u0275\u0275elementStart(4,"button",13),d.\u0275\u0275listener("click",function(pe){d.\u0275\u0275restoreView(H);const Pe=d.\u0275\u0275nextContext();return Pe.changeFavorite(Pe.myAppStore.appId),d.\u0275\u0275resetView(pe.stopPropagation())}),d.\u0275\u0275template(5,_e,2,0,"ng-container",0),d.\u0275\u0275template(6,Oe,2,0,"ng-container",0),d.\u0275\u0275elementEnd()(),d.\u0275\u0275elementStart(7,"h5",14),d.\u0275\u0275text(8),d.\u0275\u0275elementEnd()()}if(2&K){const H=d.\u0275\u0275nextContext();d.\u0275\u0275advance(3),d.\u0275\u0275textInterpolate(H.myAppStore.versionNo),d.\u0275\u0275advance(2),d.\u0275\u0275property("ngIf",1==H.myAppStore.isFavorite),d.\u0275\u0275advance(1),d.\u0275\u0275property("ngIf",!0!==H.myAppStore.isFavorite),d.\u0275\u0275advance(2),d.\u0275\u0275textInterpolate(H.myAppStore.title)}}function nt(K,ie){1&K&&(d.\u0275\u0275elementContainerStart(0),d.\u0275\u0275element(1,"span",15),d.\u0275\u0275elementContainerEnd())}function je(K,ie){1&K&&(d.\u0275\u0275elementContainerStart(0),d.\u0275\u0275element(1,"span",16),d.\u0275\u0275elementContainerEnd())}function Ke(K,ie){1&K&&(d.\u0275\u0275elementStart(0,"span"),d.\u0275\u0275text(1,"\u3001"),d.\u0275\u0275elementEnd())}function ze(K,ie){if(1&K&&(d.\u0275\u0275elementContainerStart(0),d.\u0275\u0275text(1),d.\u0275\u0275template(2,Ke,2,0,"span",0),d.\u0275\u0275elementContainerEnd()),2&K){const H=ie.$implicit,xe=ie.last;d.\u0275\u0275advance(1),d.\u0275\u0275textInterpolate1(" ",H.title,""),d.\u0275\u0275advance(1),d.\u0275\u0275property("ngIf",!xe)}}function We(K,ie){if(1&K){const H=d.\u0275\u0275getCurrentView();d.\u0275\u0275elementStart(0,"div",17)(1,"button",13),d.\u0275\u0275listener("click",function(pe){d.\u0275\u0275restoreView(H);const Pe=d.\u0275\u0275nextContext();return Pe.changeFavorite(Pe.myAppStore.appId),d.\u0275\u0275resetView(pe.stopPropagation())}),d.\u0275\u0275template(2,nt,2,0,"ng-container",0),d.\u0275\u0275template(3,je,2,0,"ng-container",0),d.\u0275\u0275elementEnd(),d.\u0275\u0275elementStart(4,"div",8)(5,"span",9),d.\u0275\u0275text(6),d.\u0275\u0275elementEnd()(),d.\u0275\u0275elementStart(7,"div",14),d.\u0275\u0275text(8),d.\u0275\u0275elementEnd(),d.\u0275\u0275elementStart(9,"div",18),d.\u0275\u0275template(10,ze,3,2,"ng-container",19),d.\u0275\u0275elementEnd(),d.\u0275\u0275elementStart(11,"div",20),d.\u0275\u0275text(12),d.\u0275\u0275elementEnd(),d.\u0275\u0275elementStart(13,"div",20),d.\u0275\u0275text(14),d.\u0275\u0275elementEnd()()}if(2&K){const H=d.\u0275\u0275nextContext();d.\u0275\u0275advance(2),d.\u0275\u0275property("ngIf",1==H.myAppStore.isFavorite),d.\u0275\u0275advance(1),d.\u0275\u0275property("ngIf",!0!==H.myAppStore.isFavorite),d.\u0275\u0275advance(3),d.\u0275\u0275textInterpolate1(" ",H.myAppStore.icon," "),d.\u0275\u0275advance(2),d.\u0275\u0275textInterpolate(H.myAppStore.title),d.\u0275\u0275advance(2),d.\u0275\u0275property("ngForOf",H.myAppStore.appPages),d.\u0275\u0275advance(2),d.\u0275\u0275textInterpolate1("\u7dad\u8b77\u4eba\u54e1\uff1a",H.myAppStore.home.maintainer.display,""),d.\u0275\u0275advance(2),d.\u0275\u0275textInterpolate(H.myAppStore.versionNo)}}let st=(()=>{class K{constructor(){this.setChange=new d.EventEmitter,this.clickCard=new d.EventEmitter}directToApp(H){console.log("in component directToApp",H),this.clickCard.emit(H)}changeFavorite(H){this.setChange.emit(H)}static#e=this.\u0275fac=function(xe){return new(xe||K)};static#t=this.\u0275cmp=d.\u0275\u0275defineComponent({type:K,selectors:[["his-card-list"]],inputs:{myAppStore:"myAppStore",isListView:"isListView",headerTemplate:"headerTemplate",bodyTemplate:"bodyTemplate",footerTemplate:"footerTemplate"},outputs:{setChange:"setChange",clickCard:"clickCard"},standalone:!0,features:[d.\u0275\u0275StandaloneFeature],decls:8,vars:2,consts:[[4,"ngIf"],["gridViewHeader",""],["gridViewBody",""],["listViewHeader",""],[1,"p-card","p-commponent","app-grid-card",3,"click"],[3,"ngTemplateOutlet"],[1,"p-card","p-commponent","app-list-card",3,"click"],[1,"grid-header-container"],[1,"p-image","p-component"],[1,"material-symbols-outlined","icon-style"],[1,"grid-body-container"],[1,"btnBox"],[1,"subtitle","caption-s"],[3,"click"],[1,"title","label-l"],[1,"pi","pi-star-fill","selected"],[1,"pi","pi-star"],[1,"list-header-container"],[1,"content","caption-l"],[4,"ngFor","ngForOf"],[1,"subtitle","caption-m"]],template:function(xe,pe){1&xe&&(d.\u0275\u0275template(0,he,5,3,"ng-container",0),d.\u0275\u0275template(1,ve,3,1,"ng-container",0),d.\u0275\u0275template(2,He,4,1,"ng-template",null,1,d.\u0275\u0275templateRefExtractor),d.\u0275\u0275template(4,fe,9,4,"ng-template",null,2,d.\u0275\u0275templateRefExtractor),d.\u0275\u0275template(6,We,15,7,"ng-template",null,3,d.\u0275\u0275templateRefExtractor)),2&xe&&(d.\u0275\u0275property("ngIf",!pe.isListView),d.\u0275\u0275advance(1),d.\u0275\u0275property("ngIf",pe.isListView))},dependencies:[a.CommonModule,a.NgForOf,a.NgIf,a.NgTemplateOutlet,le.ImageModule,ce.ButtonModule,Z.RouterModule],styles:[".app-grid-card[_ngcontent-%COMP%]{display:flex;padding:var(--spacing-md) var(--spacing-sm);gap:8px;border-radius:12px;height:100px;cursor:pointer}.app-list-card[_ngcontent-%COMP%]{display:flex;padding:4px 12px;flex-direction:row;gap:8px;border-radius:12px}.grid-header-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:space-between;align-items:flex-start}.list-header-container[_ngcontent-%COMP%]{height:100%;width:100%;display:flex;flex-direction:row;align-items:center;padding:var(--spacing-xs) var(--spacing-xxl);gap:var(--spacing-sm)}.list-header-container[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{color:var(--surface-on-surface)}.list-header-container[_ngcontent-%COMP%]   .content[_ngcontent-%COMP%]{padding-left:5px;flex:1}.list-header-container[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{transition:all .3s}.list-header-container[_ngcontent-%COMP%]   .pi.selected[_ngcontent-%COMP%]{color:var(--yellow-500)}.grid-body-container[_ngcontent-%COMP%]{display:flex;flex:1;flex-direction:column}.grid-body-container[_ngcontent-%COMP%]   .btnBox[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:flex-end;align-items:center;gap:var(--spacing-sm)}.grid-body-container[_ngcontent-%COMP%]   .btnBox[_ngcontent-%COMP%]   .pi[_ngcontent-%COMP%]{transition:all .3s}.grid-body-container[_ngcontent-%COMP%]   .btnBox[_ngcontent-%COMP%]   .pi.selected[_ngcontent-%COMP%]{color:var(--yellow-500)}button[_ngcontent-%COMP%]{cursor:pointer;background-color:transparent;border:none}.icon-style[_ngcontent-%COMP%]{width:100%;height:100%;display:flex;justify-content:center;align-items:center;color:var(--surface-a);font-size:48px}[_nghost-%COMP%]     .p-button{padding:0;color:var(--surface-on-surface)}[_nghost-%COMP%]     .body-container .p-button.p-button-icon-only{height:2rem}[_nghost-%COMP%]     .body-container .p-button.p-button-icon-only .pi{font-size:.7rem}[_nghost-%COMP%]     .p-image.p-component{display:block;width:72px;height:72px;background-color:var(--primary-main);border-radius:18px;overflow:hidden;padding:8px;position:relative;background:linear-gradient(0deg,rgba(0,0,0,.2) 0%,rgba(0,0,0,0) 100%),var(--primary-main);box-shadow:0 2px 1px -1px #00000005,0 1px 1px #00000024,0 1px 3px #0000001f}[_nghost-%COMP%]     .p-image.p-component img{display:block;width:100%;height:100%}[_nghost-%COMP%]     .app-grid-card .p-button{height:2rem}[_nghost-%COMP%]     .app-grid-card.p-card{transition:all .3s}[_nghost-%COMP%]     .app-grid-card.p-card:hover{transform:translateY(-3px);border-bottom:3px solid var(--primary-main)}[_nghost-%COMP%]     .app-list-card.p-card{transition:all .3s}"]})}return K})()},6296:(Ct,Ne,B)=>{function d(ce){var le,Z,ue,he=2;for(typeof Symbol<"u"&&(Z=Symbol.asyncIterator,ue=Symbol.iterator);he--;){if(Z&&null!=(le=ce[Z]))return le.call(ce);if(ue&&null!=(le=ce[ue]))return new a(le.call(ce));Z="@@asyncIterator",ue="@@iterator"}throw new TypeError("Object is not async iterable")}function a(ce){function le(Z){if(Object(Z)!==Z)return Promise.reject(new TypeError(Z+" is not an object."));var ue=Z.done;return Promise.resolve(Z.value).then(function(he){return{value:he,done:ue}})}return(a=function(ue){this.s=ue,this.n=ue.next}).prototype={s:null,n:null,next:function(){return le(this.n.apply(this.s,arguments))},return:function(ue){var he=this.s.return;return void 0===he?Promise.resolve({value:ue,done:!0}):le(he.apply(this.s,arguments))},throw:function(ue){var he=this.s.return;return void 0===he?Promise.reject(ue):le(he.apply(this.s,arguments))}},new a(ce)}B.d(Ne,{Z:()=>d})},7582:(Ct,Ne,B)=>{function Z(x,w,P,C){var V,L=arguments.length,F=L<3?w:null===C?C=Object.getOwnPropertyDescriptor(w,P):C;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)F=Reflect.decorate(x,w,P,C);else for(var X=x.length-1;X>=0;X--)(V=x[X])&&(F=(L<3?V(F):L>3?V(w,P,F):V(w,P))||F);return L>3&&F&&Object.defineProperty(w,P,F),F}function fe(x,w,P,C){return new(P||(P=Promise))(function(F,V){function X(z){try{G(C.next(z))}catch(Se){V(Se)}}function we(z){try{G(C.throw(z))}catch(Se){V(Se)}}function G(z){z.done?F(z.value):function L(F){return F instanceof P?F:new P(function(V){V(F)})}(z.value).then(X,we)}G((C=C.apply(x,w||[])).next())})}function ie(x){return this instanceof ie?(this.v=x,this):new ie(x)}function H(x,w,P){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var L,C=P.apply(x,w||[]),F=[];return L={},V("next"),V("throw"),V("return"),L[Symbol.asyncIterator]=function(){return this},L;function V(me){C[me]&&(L[me]=function(Ee){return new Promise(function(T,ge){F.push([me,Ee,T,ge])>1||X(me,Ee)})})}function X(me,Ee){try{!function we(me){me.value instanceof ie?Promise.resolve(me.value.v).then(G,z):Se(F[0][2],me)}(C[me](Ee))}catch(T){Se(F[0][3],T)}}function G(me){X("next",me)}function z(me){X("throw",me)}function Se(me,Ee){me(Ee),F.shift(),F.length&&X(F[0][0],F[0][1])}}function pe(x){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var P,w=x[Symbol.asyncIterator];return w?w.call(x):(x=function ze(x){var w="function"==typeof Symbol&&Symbol.iterator,P=w&&x[w],C=0;if(P)return P.call(x);if(x&&"number"==typeof x.length)return{next:function(){return x&&C>=x.length&&(x=void 0),{value:x&&x[C++],done:!x}}};throw new TypeError(w?"Object is not iterable.":"Symbol.iterator is not defined.")}(x),P={},C("next"),C("throw"),C("return"),P[Symbol.asyncIterator]=function(){return this},P);function C(F){P[F]=x[F]&&function(V){return new Promise(function(X,we){!function L(F,V,X,we){Promise.resolve(we).then(function(G){F({value:G,done:X})},V)}(X,we,(V=x[F](V)).done,V.value)})}}}B.d(Ne,{FC:()=>H,KL:()=>pe,gn:()=>Z,mG:()=>fe,qq:()=>ie}),"function"==typeof SuppressedError&&SuppressedError}}]);